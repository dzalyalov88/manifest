{"version":3,"sources":["webpack:///webpack/bootstrap f4b3f8edada7bfe26fec","webpack:///../lib/jsl/promise.js","webpack:///../lib/jsl/utils.js","webpack:///../lib/jsl/event.js","webpack:///../lib/jsl/log.js","webpack:///../lib/jsl/globals.js","webpack:///../lib/jsl/dom.js","webpack:///./i18n.js","webpack:///../lib/jsl/chrome/chrome.js","webpack:///../lib/jsl/base.js","webpack:///../lib/jsl/ui/panel.js","webpack:///../lib/jsl/io/fetchproxy.js","webpack:///../lib/jsl/storage.js","webpack:///./office.js","webpack:///../lib/jsl/loader.js","webpack:///../lib/jsl/timer.js","webpack:///../lib/jsl/chrome/rpc/schema.js","webpack:///../lib/jsl/id/oauth.provider.js","webpack:///../lib/jsl/ui/action.js","webpack:///./invite.js","webpack:///./model/parties/types.js","webpack:///./states.js","webpack:///./model/identity/model.js","webpack:///./model/identity/states.js","webpack:///./model/api/api.js","webpack:///(webpack)/buildin/global.js","webpack:///../lib/jsl/maps/literal.js","webpack:///../lib/jsl/guid.js","webpack:///./sources/rooms/srcconfig.js","webpack:///./sources/spaces/srcconfig.js","webpack:///./model/rooms/model.js","webpack:///./model/spaces/model.js","webpack:///./model/parties/model.js","webpack:///../lib/jsl/ui/control.js","webpack:///./office.native.js","webpack:///./storage.js","webpack:///./model/rooms/settings.js","webpack:///./model/rooms/api.js","webpack:///./model/rooms/tom.js","webpack:///./model/rooms/templates.js","webpack:///./model/spaces/schema.js","webpack:///../lib/jsl/promise.cancel.js","webpack:///../lib/jsl/id/oauth.js","webpack:///../lib/jsl/id/oauth.storage.js","webpack:///../lib/jsl/id/oauth.provider.google.js","webpack:///../lib/jsl/io/fetch.js","webpack:///../lib/jsl/io/fetch.const.js","webpack:///../lib/jsl/id/jwt.js","webpack:///../lib/jsl/id/oauth.interactive.js","webpack:///../lib/jsl/chrome/window.js","webpack:///../lib/jsl/chrome/chrome.tabs.js","webpack:///../lib/jsl/id/oauth.provider.salesforce.js","webpack:///../lib/jsl/id/oauth.provider.esna.js","webpack:///../lib/jsl/id/oauth.provider.microsoft.js","webpack:///./model/onesna/model.js","webpack:///../lib/jsl/promise.queue.js","webpack:///./model/channel/model.js","webpack:///../lib/jsl/chrome/rpc/server.js","webpack:///../lib/jsl/chrome/rpc/port.js","webpack:///../lib/jsl/chrome/rpc/router.js","webpack:///../lib/jsl/chrome/rpc/proxy.js","webpack:///./model/identity/schema.js","webpack:///./model/parties/schema.js","webpack:///./model/spaces/spaces.js","webpack:///./sources/model.js","webpack:///./sources/rooms/model.js","webpack:///./sources/spaces/model.js","webpack:///./model/ui/spaces.list.js","webpack:///./app.js","webpack:///../css/main.css?7c3e","webpack:///./ui/controller.js","webpack:///./ui/cfgwizard.js","webpack:///./model/config/aemoAPI.js","webpack:///./model/config/zangAPI.js","webpack:///./ui/progress.js","webpack:///./ui/meeting.js","webpack:///../lib/jsl/ui/listview.js","webpack:///./ui/details.js","webpack:///./ui/topics.js","webpack:///./model/ui/spaces.view.js","webpack:///./model/ui/meeting.panel.js","webpack:///../lib/jsl/ui/animate.js","webpack:///./ui/invited.js","webpack:///./ui/popup.js","webpack:///./ui/error.js","webpack:///./ui/links.js","webpack:///./model.js","webpack:///./sources/test/model.js","webpack:///./format.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;AC7DA,qEAAO;AACP;;AAEA,eAAe,mBAAO,CAAC,EAAU;;AAEjC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC7BF,qEAAO;AACP;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,6D;AACA,6CAA6C,UAAU;AACvD,mC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mCAAmC,SAAS;AAC5C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA,mBAAmB,6BAA6B;AAChD,OAAO,oC;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL,qBAAqB;AACrB;AACA;AACA;;AAEA;AACA,iCAAiC,yBAAyB;AAC1D;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,2BAA2B,wBAAwB,WAAW,EAAE,EAAE;AAClE;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oG;AACA,S;AACA,gDAAgD,SAAS;AACzD;AACA,uC;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,kCAAkC,wEAAwE;AAC1G;AACA;AACA;AACA,OAAO,mCAAmC;AAC1C;AACA;AACA;AACA,gCAAgC,sDAAsD;AACtF;AACA,OAAO,sCAAsC;AAC7C;AACA,gCAAgC,oDAAoD;AACpF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,eAAe,kCAAkC;AACjD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,MAAM;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,mBAAmB;AACxC;AACA;AACA,uBAAuB,kBAAkB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,gBAAgB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,mBAAmB;AACtC;AACA;AACA;AACA,eAAe,mBAAmB;AAClC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACjSF,qEAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,cAAc;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,yB;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACtCF,qEAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,kBAAkB;AAClB;AACA;;AAEA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;;ACrEF,mHAAO;AACP;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,oBAAoB;AACpB,CAAC;AAAA,oGAAC,C;;;;;;;ACxBF,qEAAO;AACP;;AAEA,aAAa,mBAAO,CAAC,CAAQ;;AAE7B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,oBAAoB,0BAA0B;AAC9C;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA,gBAAgB;AAChB;;AAEA;AACA;AACA,mBAAmB,kBAAkB;AACrC;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,sBAAsB;AACzC;AACA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,sBAAsB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,WAAW;AACX;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,cAAc;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,cAAc;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,eAAe,eAAe;AAC9B;AACA;AACA;AACA;AACA,eAAe,gBAAgB;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACrMF,qEAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,aAAa;;AAEb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA,WAAW;AACX;AACA;AACA,SAAS;AACT;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC/MF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAY;;AAEpC;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACdF,qEAAO;AACP;;AAEA;AACA;;AAEA;AACA,6CAA6C;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,qBAAqB;AAC5D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,2DAA2D,eAAe,wCAAwC,UAAU,2CAA2C,EAAE;AACzK;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA;AACA,cAAc;AACd,eAAe,cAAc;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,I;AACA;AACA;AACA;AACA;AACA;AACA,I;;AAEA,0CAA0C;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,CAAC;AAAA,oGAAC,C;;;;;;ACtGF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,EAAW;;AAEnC;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACZF,qEAAO;AACP;;AAEA,eAAe,mBAAO,CAAC,CAAkB;AACzC,cAAc,mBAAO,CAAC,EAAS;;AAE/B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,8B;AACA,CAAC;AAAA,oGAAC;;;;;;;AClBF,qEAAO;AACP;;AAEA;AACA,WAAW;AACX;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACnEF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C,YAAY,mBAAO,CAAC,CAAc;AAClC,cAAc,mBAAO,CAAC,EAAgB;;AAEtC,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C;;AAEA,qBAAqB,mBAAO,CAAC,EAAiB;AAC9C,sBAAsB,mBAAO,CAAC,EAAW;;AAEzC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,kCAAkC;AACrD,SAAS;AACT;AACA;AACA;AACA,qBAAqB,mCAAmC;AACxD,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,8DAA8D;AAC9D,KAAK;AACL;;AAEA;AACA;AACA;AACA,+EAA+E;AAC/E;AACA,uBAAuB,wBAAwB;AAC/C,wBAAwB,uEAAuE;AAC/F;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,sBAAsB;AACtB;AACA,KAAK;AACL;;AAEA;AACA;AACA,sBAAsB;AACtB;AACA,KAAK;AACL;;AAEA;AACA;AACA,sBAAsB;AACtB;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,4DAA4D,EAAE;AAC9D,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA,wEAAwE,gFAAgF;AACxJ;;AAEA;AACA,wEAAwE,yCAAyC;AACjH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D,UAAU,WAAW,aAAa,cAAc,4CAA4C,gBAAgB;AACtK;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD,eAAe,oBAAoB,gBAAgB,sCAAsC,WAAW,UAAU,mBAAmB;;AAEpL;AACA;AACA;AACA,0DAA0D,oBAAoB,cAAc,6BAA6B,iBAAiB,eAAe,oBAAoB,oBAAoB;;AAEjM;AACA,8DAA8D,qBAAqB,wBAAwB;AAC3G;;AAEA;AACA,uDAAuD,cAAc;;AAErE;AACA;AACA,6DAA6D,cAAc,cAAc,iBAAiB,mDAAmD,iBAAiB,mBAAmB,qBAAqB,kCAAkC,sCAAsC;AAC9R;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW;;AAEX;AACA;AACA,6DAA6D,cAAc,cAAc,iBAAiB,mDAAmD,iBAAiB,mBAAmB,qBAAqB,kCAAkC,sCAAsC;AAC9R;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW;;AAEX;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA,oBAAoB;AACpB,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW;AACX,2BAA2B,wBAAwB;;AAEnD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,yBAAyB,eAAe;AACxC;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA,oBAAoB;AACpB;AACA,4BAA4B;AAC5B,kBAAkB;AAClB;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,+BAA+B,SAAS,iBAAiB,EAAE;AAC3D;AACA,wCAAwC;AACxC;AACA;;AAEA;AACA;AACA;AACA;AACA,kCAAkC,SAAS,iBAAiB,EAAE;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,SAAS,iBAAiB,EAAE;AACnD,cAAc;AACd,8CAA8C;AAC9C,c;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP,+BAA+B,SAAS,iBAAiB,EAAE;AAC3D,OAAO;AACP,0CAA0C;AAC1C;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,0B;AACA,CAAC;AAAA,oGAAC;;;;;;;ACjfF,qEAAO;AACP;;AAEA,cAAc,mBAAO,CAAC,EAAS;;AAE/B,iBAAiB,G;AACjB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,gBAAgB;AACnC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mBAAmB,gBAAgB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,qB;AACA,sC;AACA,sB;AACA,gB;AACA,0B;AACA,G;;;AAGA;AACA;AACA;AACA;AACA;AACA,4BAA4B;AAC5B;AACA,UAAU,KAA2C;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;;AAEA;AACA,mBAAmB,gBAAgB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,kCAAkC;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB,qBAAqB;AACxC;AACA;AACA,eAAe,iBAAiB;AAChC;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,qBAAqB;AACpC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC9JF,oCAAE,mCAAO;AACT;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACvBF,qEAAO;AACP;;AAEA,cAAc,mBAAO,CAAC,CAAa;;AAEnC;AACA;AACA;AACA;AACA;AACA;;AAEA,sC;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACzBF,qEAAO;AACP;;AAEA,aAAa,mBAAO,CAAC,CAAS;AAC9B,mBAAmB,mBAAO,CAAC,EAAiB;AAC5C,aAAa,mBAAO,CAAC,EAAS;AAC9B,gBAAgB,mBAAO,CAAC,CAAY;AACpC,cAAc,mBAAO,CAAC,CAAU;AAChC,mBAAmB,mBAAO,CAAC,EAAkB;;AAE7C,eAAe,mBAAO,CAAC,CAAkB;;AAEzC,YAAY,mBAAO,CAAC,EAAO;AAC3B,yBAAyB,mBAAO,CAAC,EAAqB;;AAEtD;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA,G;AACA;AACA;AACA;AACA;AACA;AACA,mEAAmE,sBAAsB;AACzF;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,qFAAqF,EAAE;AACvF,eAAe,6CAA6C,oDAAoD,gBAAgB,G;AAChI;AACA;AACA;AACA,OAAO;AACP;AACA,+BAA+B,SAAS,cAAc,EAAE;AACxD;AACA,KAAK;AACL;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,gBAAgB;AAChB,mGAAmG,EAAE;AACrG;AACA,yBAAyB,SAAS,SAAS,0BAA0B,EAAE;AACvE;AACA,gCAAgC;AAChC;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,gGAAgG,EAAE;AAClG;AACA;AACA;AACA;;AAEA;AACA;;AAEA,6BAA6B,4KAA4K;AACzM;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,G;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8EAA8E,sCAAsC,EAAE,yCAAyC,EAAE,UAAU;AAC3K,SAAS;AACT;AACA;AACA;AACA;AACA,8EAA8E,gCAAgC,EAAE,UAAU;AAC1H;AACA;AACA;AACA;AACA;AACA,+EAA+E,2EAA2E;AAC1J;AACA,yEAAyE,8DAA8D;AACvI,KAAK;AACL;AACA;AACA,eAAe,SAAS,gBAAgB;AACxC;AACA;AACA;AACA;AACA,qFAAqF,EAAE;AACvF;AACA;AACA;AACA;AACA,8BAA8B,mBAAmB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,uBAAuB;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,6C;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,gBAAgB;;AAEhB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsC,8B;AACtC;AACA;AACA,sCAAsC,4B;AACtC;AACA;AACA,sCAAsC,4B;AACtC;AACA;AACA,I;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,SAAS,gBAAgB;AAC5C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA,8C;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC3YF,qEAAO;AACP;;AAEA,YAAY,mBAAO,CAAC,CAAQ;AAC5B,gBAAgB,mBAAO,CAAC,EAAW;;AAEnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACjBF,qEAAO;AACP;;AAEA,qBAAqB,mBAAO,CAAC,CAAkB;AAC/C,qBAAqB,mBAAO,CAAC,CAAc;;AAE3C,qBAAqB,mBAAO,CAAC,CAAQ;AACrC,qBAAqB,mBAAO,CAAC,EAAU;;AAEvC,qBAAqB,mBAAO,CAAC,EAA2B;AACxD,qBAAqB,mBAAO,CAAC,EAA4B;;AAEzD,qBAAqB,mBAAO,CAAC,EAAqB;AAClD,qBAAqB,mBAAO,CAAC,EAAsB;;AAEnD;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,gBAAgB,SAAS,iBAAiB,EAAE;AAC5C;AACA;AACA;AACA;;AAEA;AACA,mCAAmC;AACnC;AACA;AACA;;AAEA;AACA;AACA;AACA,4BAA4B;AAC5B;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;;AAEA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,wBAAwB;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;;AAEP;AACA;AACA,oCAAoC;AACpC;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,iBAAiB;AACtC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,0BAA0B;AAC1B,kDAAkD;AAClD;AACA;AACA;AACA,wFAAwF;AACxF;AACA;AACA;AACA;AACA;AACA,KAAK,oBAAoB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,KAAK;AACL;AACA,qBAAqB,oBAAoB;AACzC,qBAAqB,gCAAgC;AACrD;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,mFAAmF,6BAA6B,EAAE;AAClH,qBAAqB,cAAc;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK,wBAAwB;AAC7B,sBAAsB;AACtB,cAAc;AACd;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,wEAAwE,6BAA6B,EAAE;AACvG,qBAAqB,cAAc;AACnC;AACA;AACA;AACA;AACA,kCAAkC,2BAA2B;AAC7D;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AAAA,oGAAC;;;;;;;AC3QF,qEAAO;AACP;;AAEA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACTF,qEAAO;AACP;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,gBAAgB;;AAEhB;AACA;AACA;AACA,GAAG,GAAG,EAAE;AACR;;AAEA;AACA;AACA;AACA,GAAG,GAAG,EAAE;AACR;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC9BF,qEAAO;AACP;;AAEA,cAAc,mBAAO,CAAC,CAAgB;AACtC,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C,sBAAsB,mBAAO,CAAC,EAAyB;AACvD,cAAc,mBAAO,CAAC,CAAgB;;AAEtC,cAAc,mBAAO,CAAC,EAAmB;AACzC;AACA,oBAAoB,mBAAO,CAAC,EAAmC;AAC/D,wBAAwB,mBAAO,CAAC,EAAuC;AACvE,kBAAkB,mBAAO,CAAC,EAAiC;AAC3D,uBAAuB,mBAAO,CAAC,EAAsC;;AAErE,eAAe,mBAAO,CAAC,EAAiB;;AAExC,gBAAgB,mBAAO,CAAC,EAAkB;;AAE1C,eAAe,mBAAO,CAAC,EAAU;AACjC,eAAe,mBAAO,CAAC,EAAU,E;;AAEjC;AACA;AACA,wDAAwD,iCAAiC;AACzF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,kCAAkC;;AAElC;AACA,4BAA4B,yCAAyC;AACrE;;AAEA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,sBAAsB;AACtB;AACA,8CAA8C;AAC9C;AACA;AACA;AACA;AACA;AACA,WAAW,mDAAmD,6LAA6L,kCAAkC;AAC7R;AACA,WAAW,sDAAsD,gMAAgM,EAAE;AACnQ;AACA,aAAa,yDAAyD,+JAA+J,EAAE;AACvO;AACA,aAAa,0DAA0D,+JAA+J,EAAE;AACxO;AACA,2CAA2C;AAC3C,OAAO;AACP;AACA;AACA,+BAA+B,wIAAwI,EAAE,oFAAoF;AAC7P;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,gBAAgB;AACjD,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD;AAChD;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,iBAAiB,SAAS,eAAe;AACzC;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,gBAAgB,yJ;AAChB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,iBAAiB,gBAAgB,2GAA2G;AAC5I;AACA;;AAEA;AACA;AACA,6BAA6B,SAAS,iBAAiB,EAAE;AACzD;;AAEA;AACA,gBAAgB;AAChB;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,O;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,uBAAuB,gBAAgB;AACvC;AACA;AACA,gCAAgC,iBAAiB;AACjD;AACA;AACA;AACA;;AAEA;;AAEA;AACA,0BAA0B,8CAA8C,gBAAgB,iCAAiC;AACzH;AACA,8EAA8E,EAAE,gBAAgB,EAAE;;AAElG;AACA,WAAW;AACX,WAAW;;AAEX,mCAAmC,kBAAkB;;AAErD;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,6BAA6B,SAAS,eAAe,EAAE;AACvD;;AAEA;AACA;AACA;AACA;AACA,iCAAiC,0BAA0B;AAC3D,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,wDAAwD,0BAA0B;AAClF;AACA;AACA;AACA;;AAEA,gB;AACA;AACA;AACA,6BAA6B,SAAS,eAAe,EAAE;AACvD;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,gBAAgB,qF;AAChB;;AAEA;AACA;AACA;AACA;AACA,6BAA6B,mBAAmB;;AAEhD;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA,4DAA4D,EAAE;AAC9D,OAAO;AACP;AACA,mCAAmC,iBAAiB;AACpD;AACA;AACA,2BAA2B,SAAS,eAAe,EAAE,EAAE;AACvD;;AAEA;AACA;AACA,8BAA8B,aAAa;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,qFAAqF;AACpH;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,mBAAmB,kBAAkB;AACrC;AACA;;AAEA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;AC5YF,qEAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACfF,qEAAO;AACP;;AAEA,aAAa,mBAAO,CAAC,CAAe;AACpC,YAAY,mBAAO,CAAC,CAAc;;AAElC;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK,GAAG,EAAE;AACV;AACA;AACA;AACA,uBAAuB,IAAI,2BAA2B;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,KAAK,GAAG,EAAE;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;;AAEA;AACA,uBAAuB,iBAAiB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAK,IAAI;AACT;;AAEA;AACA;;AAEA;AACA;AACA,kCAAkC,mBAAmB;;AAErD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;;AAEA,eAAe,0DAA0D;AACzE;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,eAAe,SAAS;AACxB;AACA;AACA,KAAK;AACL;AACA,aAAa,SAAS;AACtB,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACpNF;;AAEA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;;AAEA;AACA;AACA,4CAA4C;;AAE5C;;;;;;;ACpBA,qEAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kEAAkE,cAAc,EAAE,8BAA8B;AAChH;AACA;AACA,kEAAkE,cAAc,EAAE,+BAA+B;AACjH;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AChCF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAW;;AAEnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,cAAc;AACjC;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,gBAAgB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,EAAE;AAC/C;AACA;AACA;AACA;AACA;AACA,qBAAqB,QAAQ;AAC7B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACxDF,qEAAO;AACP;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACdF,qEAAO;AACP;;AAEA,eAAe,mBAAO,CAAC,EAAc;;AAErC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,uEAAuE;AACvE;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;AC3DF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C,gBAAgB,mBAAO,CAAC,EAAkB;AAC1C,gBAAgB,mBAAO,CAAC,CAAc;;AAEtC,sBAAsB,mBAAO,CAAC,EAAY;AAC1C,iBAAiB,mBAAO,CAAC,EAAO;AAChC,YAAY,mBAAO,CAAC,EAAO;AAC3B,kBAAkB,mBAAO,CAAC,EAAa;;AAEvC;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sCAAsC;AACtC;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,cAAc;AACd;;AAEA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,mCAAmC;AACnC;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA,2BAA2B,EAAE;AAC7B,yCAAyC;AACzC;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA,uCAAuC;AACvC,SAAS;AACT;AACA,wCAAwC;AACxC,SAAS;AACT,OAAO;AACP,sCAAsC;AACtC;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL,6BAA6B,yBAAyB;AACtD,KAAK;AACL,eAAe;AACf;AACA;AACA;AACA,KAAK,oBAAoB;AACzB;AACA,KAAK;AACL;;AAEA;AACA;AACA,+BAA+B;AAC/B,KAAK;AACL;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C;AAC3C;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,gBAAgB,kOAAkO;;AAElP;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;;AAEA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,8BAA8B,YAAY;AAC1C;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,YAAY;AAC5C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA,oBAAoB;AACpB;AACA;AACA,OAAO;;AAEP;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,iE;AACA,6C;AACA;;AAEA;AACA;AACA;AACA;;AAEA,oDAAoD,U;AACpD;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,8DAA8D;AAC9D;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,+EAA+E;;AAE/E,yBAAyB;AACzB;AACA;AACA,KAAK;AACL;;AAEA;AACA,mBAAmB,eAAe;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,0DAA0D;AAC1D;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,2BAA2B,EAAE;AAC7B;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,qBAAqB,4CAA4C;AACjE;AACA,KAAK,GAAG,gCAAgC;AACxC,YAAY;AACZ;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;;AAEA;AACA;AACA;AACA,6BAA6B,4KAA4K;AACzM,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,+DAA+D,uDAAuD;AACvI;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,EAAE;AAC/B,KAAK;AACL;AACA;AACA,gBAAgB;AAChB,OAAO;AACP,KAAK;AACL;AACA;AACA,KAAK;AACL,qBAAqB;AACrB;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,gBAAgB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,KAAK;AACL;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACzpBF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C,gBAAgB,mBAAO,CAAC,CAAc;AACtC,gBAAgB,mBAAO,CAAC,CAAgB;AACxC,gBAAgB,mBAAO,CAAC,EAAgB;AACxC,gBAAgB,mBAAO,CAAC,CAAgB;;AAExC,eAAe,mBAAO,CAAC,EAAU;;AAEjC,iBAAiB,mBAAO,CAAC,EAAmB;AAC5C,uBAAuB,mBAAO,CAAC,EAAoB;;AAEnD,qBAAqB,mBAAO,CAAC,EAAkB;AAC/C,0BAA0B,mBAAO,CAAC,EAAkB;;AAEpD,mBAAmB,mBAAO,CAAC,EAAU;;AAErC;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,sBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,6BAA6B;AAC7B;AACA,oDAAoD,qDAAqD;AACzG;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA,uDAAuD,8CAA8C;AACrG;AACA;AACA,6BAA6B,aAAa;AAC1C,8BAA8B,aAAa;AAC3C;AACA;AACA;AACA;AACA;AACA,+BAA+B,aAAa;AAC5C,gCAAgC,aAAa;AAC7C;AACA;AACA;;AAEA;AACA,mBAAmB,oBAAoB;AACvC;AACA;AACA;AACA,uCAAuC,cAAc;AACrD;AACA,2BAA2B,aAAa;AACxC,4BAA4B,aAAa;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,cAAc;AACzC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK,GAAG,kCAAkC;AAC1C,YAAY;AACZ;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,qBAAqB,iBAAiB;AACtC,gBAAgB,mEAAmE;AACnF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sEAAsE,EAAE;AACxE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,qBAAqB,iBAAiB;AACtC,gBAAgB,mEAAmE;AACnF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,+DAA+D,EAAE;AACjE;AACA,6CAA6C;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,qCAAqC;AACrC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,oBAAoB,mBAAmB;AACvC;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,kCAAkC,iBAAiB;AACnD,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,oBAAoB;AACxD;AACA;AACA;AACA;AACA;AACA,oCAAoC,sCAAsC;AAC1E,OAAO;AACP,gCAAgC,iCAAiC,2BAA2B,EAAE;AAC9F,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACpSF,qEAAO;AACP;;AAEA,cAAc,mBAAO,CAAC,CAAgB;;AAEtC,eAAe,mBAAO,CAAC,EAAU;;AAEjC,sBAAsB,mBAAO,CAAC,EAAmB;AACjD,kBAAkB,mBAAO,CAAC,EAAS;;AAEnC;;AAEA;AACA,oBAAoB;AACpB;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8B;AACA;AACA;AACA;AACA,4B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,UAAU;AAC3C;AACA;AACA;AACA;AACA,6BAA6B,cAAc;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,yBAAyB;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,iCAAiC,yBAAyB;AAC1D;;AAEA;AACA;AACA,6BAA6B,gBAAgB;AAC7C;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AClFF,qEAAO;AACP;;AAEA,YAAY,mBAAO,CAAC,CAAQ;;AAE5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,qBAAqB,kBAAkB;AACvC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;;AAEA;AACA,mBAAmB,kBAAkB;AACrC;;AAEA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACvEF,qEAAO;AACP;;AAEA,sBAAsB;;AAEtB;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACVF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,yBAAyB,+BAA+B;AACxD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA,iBAAiB;;AAEjB;AACA,CAAC;AAAA,oGAAC;;;;;;;AChDF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,EAAiB;;AAEzC,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C,gBAAgB,mBAAO,CAAC,EAAkB;AAC1C,gBAAgB,mBAAO,CAAC,CAAc;;AAEtC;;AAEA;;AAEA;AACA;AACA;AACA,mBAAmB,qBAAqB;AACxC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB,cAAc;AACjC;AACA;;AAEA,yEAAyE;AACzE;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA,6BAA6B,SAAS,wBAAwB,EAAE;AAChE;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;AACL;;AAEA;AACA,kBAAkB;AAClB;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;;AAEA,oBAAoB;AACpB,CAAC;AAAA,oGAAC;;;;;;;AClKF,qEAAO;AACP;;AAEA,YAAY,mBAAO,CAAC,EAAY;;AAEhC;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,mBAAmB,4EAA4E;AAC/F,gBAAgB;AAChB,OAAO;AACP;AACA,wBAAwB,oCAAoC;AAC5D,sBAAsB,kCAAkC;AACxD,qBAAqB,iCAAiC;AACtD,oBAAoB,4CAA4C;AAChE;AACA;AACA,oBAAoB,iCAAiC;AACrD,wBAAwB,oCAAoC;AAC5D,uBAAuB,mCAAmC;AAC1D,qBAAqB,iCAAiC;AACtD,2BAA2B,uCAAuC;AAClE,6BAA6B;AAC7B;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,mBAAmB,4EAA4E;AAC/F,gBAAgB,qDAAqD;AACrE,iBAAiB,+BAA+B;AAChD,uBAAuB,qCAAqC;AAC5D,kBAAkB;AAClB,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,gBAAgB,4BAA4B;AAC5C,kBAAkB,oCAAoC;AACtD,uBAAuB;AACvB;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,mBAAmB,4EAA4E;AAC/F,kBAAkB,oDAAoD;AACtE,iBAAiB,+BAA+B;AAChD,mBAAmB;AACnB,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,gBAAgB,4BAA4B;AAC5C,kBAAkB,oCAAoC;AACtD,uBAAuB;AACvB;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,mBAAmB,4EAA4E;AAC/F,kBAAkB,oDAAoD;AACtE,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA,gBAAgB,4BAA4B;AAC5C,kBAAkB,oCAAoC;AACtD,uBAAuB;AACvB;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,mBAAmB,4EAA4E;AAC/F,kBAAkB,oDAAoD;AACtE,gBAAgB,qDAAqD;AACrE,iBAAiB,2CAA2C;AAC5D,mBAAmB,8CAA8C;AACjE,iBAAiB;AACjB,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,qBAAqB,iCAAiC;AACtD;AACA,eAAe,kDAAkD;AACjE,iBAAiB,yCAAyC;AAC1D,mBAAmB,2CAA2C;AAC9D,mBAAmB,2CAA2C;AAC9D,sBAAsB,0DAA0D;;AAEhF,uBAAuB,+CAA+C;AACtE,wBAAwB,gDAAgD;AACxE,sBAAsB,4CAA4C;AAClE,4BAA4B,oDAAoD;AAChF,yBAAyB,gDAAgD;AACzE,+BAA+B,sDAAsD;AACrF,qBAAqB,6CAA6C;AAClE,qBAAqB,2CAA2C;AAChE,0BAA0B,kDAAkD;AAC5E,8BAA8B,sDAAsD;AACpF,4BAA4B,oDAAoD;AAChF,wBAAwB,gDAAgD;;AAExE,0BAA0B,kDAAkD;AAC5E,2BAA2B,mDAAmD;AAC9E,2BAA2B,mDAAmD;;AAE9E,8BAA8B,wEAAwE;AACtG,qCAAqC,+EAA+E;AACpH,iCAAiC,2EAA2E;;AAE5G,wBAAwB,oEAAoE;AAC5F,oBAAoB,gEAAgE;AACpF,yBAAyB,qEAAqE;AAC9F,oBAAoB;AACpB,SAAS;AACT;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,mBAAmB,4EAA4E;AAC/F,gBAAgB,oDAAoD;;AAEpE,oBAAoB,kCAAkC;AACtD,kBAAkB,gCAAgC;AAClD,yBAAyB,wCAAwC;AACjE,kBAAkB,gCAAgC;AAClD,mBAAmB,iCAAiC;AACpD,wBAAwB,sCAAsC;AAC9D,4BAA4B,0CAA0C;AACtE,iBAAiB,+BAA+B;AAChD,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,0BAA0B,6CAA6C;AACvE,0BAA0B,mDAAmD;AAC7E,mBAAmB,8CAA8C;AACjE,oBAAoB,+BAA+B;AACnD,iBAAiB;AACjB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,CAAC;AAAA,oGAAC;;;;;;;ACnNF,qEAAO;AACP;;AAEA,YAAY,mBAAO,CAAC,CAAc;;AAElC;;AAEA;AACA,iEAAiE,KAAK;;AAEtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,6BAA6B;AAC5C,iBAAiB;AACjB;AACA,iDAAiD;AACjD;AACA,+CAA+C;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,eAAe,qBAAqB;AACpC;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,YAAY;AACZ;AACA;AACA;AACA;AACA;;AAEA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK,GAAG,gDAAgD;AACxD;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,wCAAwC;AACxC,KAAK;AACL,qDAAqD;AACrD;;AAEA;AACA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;;AAEA,cAAc;AACd;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK,GAAG,gDAAgD;AACxD;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA,mEAAmE;AACnE,kDAAkD;AAClD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,qBAAqB;AACrB,0BAA0B;AAC1B;AACA,sBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC7YF,qEAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,6CAA6C;AAC7C;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL,aAAa,SAAS,sBAAsB;AAC5C,KAAK;AACL;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACvGF,qEAAO;AACP;;AAEA,eAAe,mBAAO,CAAC,EAA4B;;AAEnD;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACxBF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAW;;AAEnC;AACA,gBAAgB;AAChB;AACA,uCAAuC,SAAS,iBAAiB,EAAE;AACnE,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACzBF,qEAAO;AACP;;AAEA,aAAa,mBAAO,CAAC,CAAS,E;AAC9B,gBAAgB,mBAAO,CAAC,CAAY;AACpC,cAAc,mBAAO,CAAC,CAAU;AAChC,qBAAqB,mBAAO,CAAC,EAAiB;;AAE9C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mBAAmB,sBAAsB;AACzC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,6BAA6B,SAAS,iBAAiB,EAAE;AACzD;;AAEA;AACA;AACA;AACA;AACA;AACA,6BAA6B,SAAS,iBAAiB,EAAE;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,SAAS,iBAAiB,EAAE;AACzD;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC5DF,qEAAO;AACP;;AAEA,aAAa,mBAAO,CAAC,CAAS;AAC9B,gBAAgB,mBAAO,CAAC,EAAY;AACpC,cAAc,mBAAO,CAAC,CAAU;;AAEhC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC7EF,qEAAO;AACP;;AAEA,sBAAsB,mBAAO,CAAC,EAAkB;AAChD,mBAAmB,mBAAO,CAAC,EAAkB;;AAE7C;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB,gHAAgH;AACnI;AACA;AACA;AACA;;AAEA,eAAe,8BAA8B,gDAAgD;AAC7F;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AClCF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAY;AACpC;AACA,kBAAkB,mBAAO,CAAC,EAAe;;AAEzC,eAAe,mBAAO,CAAC,EAAW;;AAElC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACtBF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAY;;AAEpC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,8BAA8B;AAC9B,qDAAqD;;AAErD;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACpEF,qEAAO;AACP;;AAEA,mBAAmB,mBAAO,CAAC,EAAiB;;AAE5C;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC3BF,qEAAO;AACP;;AAEA,cAAc,mBAAO,CAAC,EAAU,E;AAChC,gBAAgB,mBAAO,CAAC,CAAY;AACpC,cAAc,mBAAO,CAAC,CAAU;AAChC,eAAe,mBAAO,CAAC,CAAkB;AACzC,eAAe,mBAAO,CAAC,EAAkB;;AAEzC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB,sBAAsB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,G;AACA;AACA;AACA;;AAEA;AACA,0BAA0B,SAAS,iBAAiB,EAAE;AACtD;;AAEA,8CAA8C;AAC9C;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;;AAEA;AACA;AACA,iCAAiC,cAAc;AAC/C;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK,a;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;AACA,iBAAiB,SAAS,mBAAmB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,oCAAoC;;AAEpC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,iBAAiB,SAAS,aAAa;AACvC;AACA;AACA;AACA;AACA;AACA,iDAAiD;AACjD;AACA;AACA;AACA,wCAAwC;AACxC,mFAAmF;AACnF;AACA;AACA;AACA;AACA,mBAAmB,SAAS,gBAAgB;AAC5C;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,SAAS,gBAAgB,EAAE;AACxD;AACA;AACA;AACA;AACA;AACA,2BAA2B,SAAS,eAAe,EAAE;AACrD,aAAa;AACb;AACA,YAAY,oDAAoD;AAChE,+DAA+D;AAC/D,2DAA2D;AAC3D;AACA;AACA;AACA,8BAA8B,SAAS,gBAAgB,EAAE;AACzD;AACA,OAAO;AACP,8BAA8B,SAAS,gBAAgB,EAAE;AACzD,OAAO;AACP;AACA,qEAAqE;AACrE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,O;AACA;AACA;AACA;AACA;AACA;AACA;AACA,O;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA,SAAS;AACT,wBAAwB;AACxB;AACA;AACA;AACA,0B;AACA,qBAAqB,SAAS,eAAe;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,SAAS,gBAAgB;AAC1C;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;AC/SF,qEAAO;AACP;;AAEA,mBAAmB,mBAAO,CAAC,EAAe;;AAE1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,oBAAoB;AACpB,CAAC;AAAA,oGAAC;;;;;;;ACfF,qEAAO;AACP;;AAEA;AACA,sDAAsD;AACtD,sBAAsB;AACtB;AACA;;AAEA,eAAe,mBAAO,CAAC,CAAU;AACjC,cAAc,mBAAO,CAAC,CAAU;;AAEhC;;AAEA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,+CAA+C;AAC/C;AACA,KAAK;AACL;;AAEA;AACA,kBAAkB;AAClB;AACA,wBAAwB,aAAa;AACrC;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACnDF,qEAAO;AACP;;AAEA,sBAAsB,mBAAO,CAAC,EAAkB;;AAEhD;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACvBF,qEAAO;AACP;;AAEA,sBAAsB,mBAAO,CAAC,EAAkB;AAChD,cAAc,mBAAO,CAAC,CAAU;AAChC,mBAAmB,mBAAO,CAAC,EAAkB;;AAE7C;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,eAAe,8BAA8B,gDAAgD;AAC7F;AACA;AACA;AACA,OAAO;AACP;AACA,+BAA+B,SAAS,cAAc,EAAE;AACxD;AACA,KAAK;AACL,uBAAuB;AACvB,yC;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC9EF,qEAAO;AACP;;AAEA,sBAAsB,mBAAO,CAAC,EAAkB;;AAEhD;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACvBF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C,qBAAqB,mBAAO,CAAC,EAAwB;AACrD,mBAAmB,mBAAO,CAAC,EAAwB;AACnD,cAAc,mBAAO,CAAC,CAAgB;;AAEtC;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,0CAA0C,EAAE;AAC5C;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,0CAA0C,EAAE;AAC5C;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,0CAA0C,EAAE;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,yBAAyB,GAAG;;AAE5B;AACA,mBAAmB;AACnB;AACA;AACA;AACA;;AAEA,WAAW,kBAAkB,6DAA6D;AAC1F;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA,mCAAmC,SAAS;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,yCAAyC,8DAA8D;AACvG;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,yCAAyC,6DAA6D;AACtG;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,yCAAyC,4EAA4E;AACrH;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,qBAAqB;AACrB,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC/JF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAW;AACnC;;AAEA;AACA;AACA,mBAAmB,eAAe;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,8CAA8C,SAAS,iBAAiB,EAAE,GAAG;AACpG;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,a;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACrDF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,EAA4B;;AAEpD;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACXF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAe;AACvC,eAAe,mBAAO,CAAC,CAAW;;AAElC,cAAc,mBAAO,CAAC,CAAa;;AAEnC,gBAAgB,mBAAO,CAAC,EAAQ;AAChC,kBAAkB,mBAAO,CAAC,EAAU;AACpC,iBAAiB,mBAAO,CAAC,EAAS;;AAElC;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,0BAA0B,OAAO,aAAa,WAAW,eAAe,EAAE;AAC1E;AACA;AACA;;AAEA;AACA;;AAEA,0BAA0B,OAAO,cAAc,WAAW,eAAe,EAAE;AAC3E;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,gBAAgB,qEAAqE;AACrF,KAAK;AACL,gBAAgB;AAChB;AACA,0BAA0B,OAAO,aAAa,kBAAkB;AAChE,cAAc,6BAA6B;;AAE3C;AACA;AACA;AACA;AACA,8BAA8B,OAAO,cAAc,kBAAkB;AACrE;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,S;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACvFF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAe;AACvC,cAAc,mBAAO,CAAC,CAAa;AACnC,aAAa,mBAAO,CAAC,EAAY;AACjC,eAAe,mBAAO,CAAC,CAAW;;AAElC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,oB;AACA;AACA,4BAA4B,WAAW;AACvC,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,wCAAwC,eAAe;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACxCF,qEAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,0BAA0B;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,qBAAqB;AAC1C;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,qBAAqB;AAC1C;AACA,oC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,eAAe;AACpC;AACA;AACA;AACA,yBAAyB,oBAAoB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,kBAAkB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,qBAAqB,oBAAoB;AACzC;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACjHF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAe;AACvC,cAAc,mBAAO,CAAC,CAAa;;AAEnC,kBAAkB,mBAAO,CAAC,EAAU;;AAEpC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAiB;;AAEjB;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB,SAAS;AACT,OAAO;AACP;AACA,mBAAmB,0BAA0B;AAC7C;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,kBAAkB;;AAElB;AACA;AACA;AACA;AACA;AACA,mBAAmB;;AAEnB,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,oCAAoC,4CAA4C,aAAa;;AAE7F;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G;;;AAGA;AACA;AACA;AACA;AACA;AACA,oCAAoC,4CAA4C,aAAa;;AAE7F;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;;AAEA;AACA,kEAAkE,eAAe;AACjF,OAAO;AACP,kEAAkE,gBAAgB;AAClF,OAAO;AACP,kEAAkE,EAAE;AACpE,OAAO;AACP,iEAAiE,EAAE;AACnE,OAAO;AACP,iEAAiE,eAAe;AAChF;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,0BAA0B,gCAAgC;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK;AACL,0BAA0B,wDAAwD;AAClF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,mDAAmD;AACtF;AACA;AACA;AACA,mCAAmC,mDAAmD;AACtF;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL,iCAAiC,uDAAuD;AACxF;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,mDAAmD;AACtF;AACA;AACA;AACA,mCAAmC,mDAAmD;AACtF;AACA;AACA,KAAK;AACL,iCAAiC,uDAAuD;AACxF;AACA;AACA;AACA;AACA;AACA,0BAA0B,EAAE,GAAG,EAAE;AACjC,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL,0BAA0B,oCAAoC;AAC9D;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AClSF,qEAAO;AACP;;AAEA,eAAe,mBAAO,CAAC,EAA4B;;AAEnD;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AClBF,qEAAO;AACP;;AAEA,eAAe,mBAAO,CAAC,EAA4B;;AAEnD;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AClBF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C,mBAAmB,mBAAO,CAAC,EAAwB;;AAEnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,yBAAyB,EAAE;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,iCAAiC,EAAE;AACnC;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,iCAAiC,EAAE;AACnC;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,iCAAiC,EAAE;AACnC;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,eAAe;AACf,KAAK;AACL;AACA;;AAEA,qC;AACA;AACA,mBAAmB,oBAAoB;AACvC;AACA;AACA;AACA,yBAAyB,0FAA0F;AACnH;AACA;AACA;AACA;AACA,qBAAqB,iEAAiE;AACtF;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,YAAY;AACZ;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,mBAAmB,oBAAoB;AACvC;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,qBAAqB;AACxC;AACA;AACA;AACA;AACA,wC;AACA;AACA;AACA;AACA;;AAEA;AACA,e;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,kCAAkC;AAClC;AACA;AACA;AACA;AACA;AACA,kCAAkC;AAClC;AACA,uBAAuB,mBAAmB;AAC1C;AACA;AACA;AACA;AACA;AACA,kCAAkC;AAClC;AACA;AACA;AACA;AACA,sBAAsB,6BAA6B,+CAA+C;AAClG;AACA;AACA;AACA;AACA;AACA,kCAAkC,0DAA0D,2DAA2D;AACvJ;AACA;AACA,kCAAkC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA,2BAA2B,QAAQ;AACnC;AACA;AACA,OAAO;AACP;;AAEA,qBAAqB,iBAAiB,0FAA0F;;AAEhI;AACA,gC;AACA,KAAK;AACL,8DAA8D;AAC9D,KAAK;AACL,8EAA8E;AAC9E,KAAK;AACL;AACA,KAAK;AACL;;AAEA;AACA,+C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,wBAAwB,2EAA2E;AACnG;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,wBAAwB,4IAA4I;AACpK;;AAEA;AACA;AACA,+BAA+B;AAC/B,wBAAwB,+GAA+G;AACvI;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,+BAA+B;AAC/B,wBAAwB,gHAAgH;AACxI;AACA;AACA,wBAAwB,gHAAgH;AACxI;AACA;AACA,YAAY;AACZ,wBAAwB,gHAAgH;AACxI;AACA;AACA,YAAY;AACZ,wBAAwB,4GAA4G;AACpI;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AChVF,qEAAO;AACP;;AAEA,kBAAkB,mBAAO,CAAC,CAAe;AACzC,kBAAkB,mBAAO,CAAC,CAAgB;AAC1C,kBAAkB,mBAAO,CAAC,CAAkB;;AAE5C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,YAAY;AACZ;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACpDF,qEAAO;AACP;;AAEA,sBAAsB,mBAAO,CAAC,CAAkB;;AAEhD,sBAAsB,mBAAO,CAAC,EAAc;;AAE5C,sBAAsB,mBAAO,CAAC,EAAyB;;AAEvD,sBAAsB,mBAAO,CAAC,EAAc;AAC5C,sBAAsB,mBAAO,CAAC,EAAU;;AAExC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,4EAA4E;AAC5E;AACA;AACA;AACA;;AAEA;AACA,kBAAkB;AAClB;AACA;AACA;AACA,+CAA+C;AAC/C,+BAA+B;AAC/B;AACA;AACA,6BAA6B,SAAS,oBAAoB,EAAE,EAAE;AAC9D;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA,+BAA+B,SAAS,oBAAoB,EAAE,EAAE;AAChE;AACA;AACA,+BAA+B,SAAS,0DAA0D,SAAS,+BAA+B,EAAE;AAC5I;AACA,cAAc;AACd,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,2DAA2D,sCAAsC,IAAI;AACrG;AACA;AACA;AACA,+BAA+B,SAAS,iBAAiB,EAAE;AAC3D;AACA;AACA,+BAA+B,QAAQ,yHAAyH,EAAE;AAClK,OAAO;AACP;AACA,KAAK;AACL;;AAEA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA,kCAAkC,kEAAkE;AACpG;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,+BAA+B,SAAS,0DAA0D,SAAS,+BAA+B,EAAE;AAC5I;AACA,cAAc;AACd,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA,6C;AACA,CAAC;AAAA,oGAAC;;;;;;;AChJF,qEAAO;AACP;;AAEA,sBAAsB,mBAAO,CAAC,CAAkB;AAChD,sBAAsB,mBAAO,CAAC,EAAkB;AAChD,sBAAsB,mBAAO,CAAC,CAAgB;;AAE9C,sBAAsB,mBAAO,CAAC,EAAc;;AAE5C,sBAAsB,mBAAO,CAAC,EAA4B;AAC1D,sBAAsB,mBAAO,CAAC,EAA6B;AAC3D,sBAAsB,mBAAO,CAAC,EAA0B;;AAExD,sBAAsB,mBAAO,CAAC,EAAc;;AAE5C,sBAAsB,mBAAO,CAAC,EAAU;;AAExC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,4EAA4E;AAC5E;AACA;;AAEA;AACA;AACA,wBAAwB;AACxB;AACA,mBAAmB;AACnB;AACA;AACA,oBAAoB;AACpB;AACA;AACA,+BAA+B;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,yCAAyC;AACzC;AACA,2CAA2C;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,SAAS,cAAc,EAAE;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,6CAA6C,gBAAgB;AAC7D,KAAK;AACL,6CAA6C,WAAW;AACxD,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA,kCAAkC,aAAa;AAC/C;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,6C;AACA,CAAC;AAAA,oGAAC;;;;;;;ACrKF,qEAAO;AACP;;AAEA,sBAAsB,mBAAO,CAAC,CAAc;AAC5C,sBAAsB,mBAAO,CAAC,EAAoB;AAClD,sBAAsB,mBAAO,CAAC,EAAsB;;AAEpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;;;AAGA;AACA,6BAA6B;AAC7B,kBAAkB;AAClB;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,mBAAmB,SAAS;AAC5B;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB,QAAQ;AAC3B,mBAAmB,2FAA2F;AAC9G;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACrMF,qEAAO;AACP;;AAEA,EAAE,mBAAO,CAAC,EAAiB;AAC3B,eAAe,mBAAO,CAAC,EAAiB;AACxC,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C,gBAAgB,mBAAO,CAAC,EAAkB;AAC1C,mBAAmB,mBAAO,CAAC,EAAiB;AAC5C,cAAc,mBAAO,CAAC,EAAS;;AAE/B;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL,kBAAkB;AAClB;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mDAAmD;AACnD;AACA,2DAA2D;AAC3D;AACA;AACA;AACA;;AAEA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,4BAA4B;AAC5B;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA,kBAAkB;AAClB,0DAA0D,6EAA6E;AACvI,GAAG;;AAEH,oBAAoB;AACpB,CAAC;AAAA,oGAAC;;;;;;;ACpFF,yC;;;;;;ACAA,qEAAO;AACP;;AAEA,YAAY,mBAAO,CAAC,CAAc;;AAElC,YAAY,mBAAO,CAAC,CAAc;AAClC,cAAc,mBAAO,CAAC,CAAmB;;AAEzC,kBAAkB,mBAAO,CAAC,EAAa;AACvC,iBAAiB,mBAAO,CAAC,EAAY;AACrC,iBAAiB,mBAAO,CAAC,EAAW;AACpC;AACA,iBAAiB,mBAAO,CAAC,EAAW;AACpC,iBAAiB,mBAAO,CAAC,EAAS;AAClC,iBAAiB,mBAAO,CAAC,EAAS;AAClC,iBAAiB,mBAAO,CAAC,EAAS;;AAElC,iBAAiB,mBAAO,CAAC,EAAW;;AAEpC,iBAAiB,mBAAO,CAAC,CAAS;;AAElC;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,gCAAgC,oBAAoB;AACpD,8BAA8B,oBAAoB;AAClD,4BAA4B,oBAAoB;AAChD,6BAA6B,oBAAoB;AACjD,4BAA4B,oBAAoB;AAChD,wBAAwB,oBAAoB;AAC5C;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,+BAA+B;;AAE/B;;AAEA;AACA;AACA;AACA;AACA;AACA,I;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB;AACvB;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA,kFAAkF;AAClF,4CAA4C;AAC5C;AACA;AACA;;AAEA;;AAEA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,uBAAuB;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACjLF,qEAAO;AACP;;AAEA,iBAAiB,mBAAO,CAAC,CAAc;AACvC,iBAAiB,mBAAO,CAAC,CAAmB;AAC5C,iBAAiB,mBAAO,CAAC,EAAoB;AAC7C,iBAAiB,mBAAO,CAAC,CAAc;AACvC,iBAAiB,mBAAO,CAAC,CAAgB;;AAEzC,gBAAgB,mBAAO,CAAC,EAAyB;AACjD,gBAAgB,mBAAO,CAAC,EAAyB;;AAEjD,iBAAiB,mBAAO,CAAC,EAAwB;AACjD,iBAAiB,mBAAO,CAAC,EAAyB;;AAElD,qBAAqB,mBAAO,CAAC,EAA4B;AACzD,qBAAqB,mBAAO,CAAC,EAA6B;;AAE1D,iBAAiB,mBAAO,CAAC,EAAW;;AAEpC,iBAAiB,mBAAO,CAAC,CAAS;;AAElC;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,oBAAoB,kCAAkC;AACtD;AACA;AACA;;AAEA;AACA;AACA,4BAA4B,sCAAsC;AAClE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,4EAA4E;AAC/G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,6EAA6E;AACjH,iFAAiF,mEAAmE;AACpJ;AACA;AACA;AACA,oCAAoC,oDAAoD;AACxF;AACA;AACA;AACA,mCAAmC,yEAAyE;AAC5G,gFAAgF,kEAAkE;AAClJ;AACA;AACA,uCAAuC,8FAA8F;AACrI,oFAAoF,sEAAsE;AAC1J;AACA;AACA;AACA,wBAAwB,gEAAgE;AACxF;AACA;AACA;AACA;AACA,8BAA8B,wEAAwE;AACtG,kCAAkC,4GAA4G;AAC9I,gCAAgC,sGAAsG;AACtI;AACA;AACA;AACA,qBAAqB,8EAA8E;AACnG,mBAAmB,+GAA+G;AAClI;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,sCAAsC;AACtC,KAAK;AACL;;AAEA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,4DAA4D,SAAS;AACrE;AACA;AACA;AACA;AACA,8DAA8D,wCAAwC;AACtG,WAAW;AACX;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,WAAW;AACX;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,kBAAkB;AAClB;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;AACA,uBAAuB;AACvB,KAAK;AACL,6CAA6C,4BAA4B;AACzE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB;AACtB,OAAO;AACP,KAAK,kBAAkB;AACvB;AACA,6DAA6D;AAC7D;AACA,+BAA+B,gBAAgB,EAAE;AACjD;AACA;AACA,KAAK;AACL,4BAA4B;AAC5B,mBAAmB,qBAAqB;AACxC,sBAAsB;AACtB;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,+BAA+B,gBAAgB;AAC/C,OAAO;AACP,KAAK;AACL,yBAAyB;AACzB;AACA;AACA;AACA;AACA,wCAAwC;AACxC;AACA,OAAO,kBAAkB;AACzB;AACA;AACA;AACA;AACA,uBAAuB;AACvB;AACA;AACA;AACA;AACA,+BAA+B;AAC/B,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA,oBAAoB;AACpB,KAAK;AACL;AACA,KAAK;AACL;AACA,qBAAqB,6CAA6C;AAClE;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,+BAA+B;AACxD,KAAK;AACL;AACA,qBAAqB,qCAAqC;AAC1D,0BAA0B,mBAAmB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsC;AACtC;AACA,OAAO;AACP;AACA;AACA,uBAAuB,uCAAuC,EAAE,YAAY;AAC5E;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA,uBAAuB;AACvB,KAAK;AACL,6CAA6C,4BAA4B;AACzE;AACA;AACA;AACA;AACA;AACA,8BAA8B,mFAAmF;AACjH,KAAK,kBAAkB;AACvB;AACA,6DAA6D;AAC7D;AACA,iCAAiC;AACjC;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA,+DAA+D,EAAE;AACjE,8BAA8B;AAC9B;AACA;AACA,SAAS;AACT;AACA,OAAO,kBAAkB;AACzB;AACA,+BAA+B,gBAAgB,EAAE,yCAAyC;AAC1F,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA,kCAAkC,yBAAyB;AAC3D;AACA;AACA,kCAAkC,0CAA0C;AAC5E;AACA;AACA,uBAAuB,kBAAkB;AACzC;AACA,+BAA+B;AAC/B,SAAS;AACT,kCAAkC,0BAA0B;AAC5D,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA,+BAA+B,gBAAgB;AAC/C;AACA;AACA,qBAAqB,wDAAwD;AAC7E;AACA;AACA,KAAK;AACL,KAAK,kBAAkB;AACvB;AACA;AACA;AACA;AACA;AACA,+BAA+B;AAC/B,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,0BAA0B;AAC1B;AACA;AACA,mCAAmC;AACnC;AACA;AACA;AACA;AACA;AACA,KAAK,GAAG,EAAE;AACV;AACA;AACA;AACA,wDAAwD;AACxD;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,0BAA0B,+CAA+C;AACzE;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,iCAAiC;AACjC,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsC,EAAE,IAAI,cAAc;AAC1D,OAAO;AACP;AACA;AACA;AACA;AACA,qBAAqB,iBAAiB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,yBAAyB,gBAAgB;AACzC;AACA;AACA;AACA,gCAAgC,gBAAgB;AAChD;AACA;AACA;;AAEA;AACA;AACA,4BAA4B,iBAAiB;AAC7C;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACvkBF,qEAAO;AACP;;AAEA,YAAY,mBAAO,CAAC,EAAY;;AAEhC;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,iBAAiB,+BAA+B;AAChD,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA,8BAA8B,2CAA2C;AACzE,gCAAgC;AAChC;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,CAAC;AAAA,oGAAC;;;;;;;ACpCF,qEAAO;AACP;;AAEA,YAAY,mBAAO,CAAC,EAAY;;AAEhC;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,iBAAiB,+BAA+B;AAChD,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,sBAAsB,oCAAoC;AAC1D,OAAO;AACP;AACA,qBAAqB;AACrB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,CAAC;AAAA,oGAAC;;;;;;;AC/CF,qEAAO;AACP;;AAEA,YAAY,mBAAO,CAAC,CAAc;AAClC,cAAc,mBAAO,CAAC,CAAmB;AACzC,eAAe,mBAAO,CAAC,EAAoB;;AAE3C,aAAa,mBAAO,CAAC,CAAS;AAC9B,eAAe,mBAAO,CAAC,EAAW;;AAElC;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,kCAAkC;AACnE,iCAAiC,kCAAkC;AACnE;AACA;AACA,gGAAgG,kCAAkC;AAClI,+FAA+F,iCAAiC;AAChI;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,8C;AACA,CAAC;AAAA,oGAAC;;;;;;;AChFF,qEAAO;AACP;;AAEA,iBAAiB,mBAAO,CAAC,CAAc;AACvC,iBAAiB,mBAAO,CAAC,CAAmB;AAC5C,iBAAiB,mBAAO,CAAC,EAAoB;;AAE7C,mBAAmB,mBAAO,CAAC,EAAyB;;AAEpD,iBAAiB,mBAAO,CAAC,CAAS;;AAElC,iBAAiB,mBAAO,CAAC,EAAW;AACpC;AACA,iBAAiB,mBAAO,CAAC,EAAU;;AAEnC;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,4HAA4H,kCAAkC;AAC9J;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,2FAA2F;AACzH,+BAA+B,qFAAqF;AACpH;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;AChGF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAS;AACjC,gBAAgB,mBAAO,CAAC,CAAQ;AAChC,gBAAgB,mBAAO,CAAC,CAAU;;AAElC;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA;AACA;AACA;AACA,wBAAwB,kBAAkB;AAC1C;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA,cAAc,6DAA6D;AAC3E,cAAc,mEAAmE;;AAEjF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mBAAmB,iCAAiC;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,4BAA4B,+CAA+C;AAC3E;AACA;AACA,6BAA6B,+CAA+C;AAC5E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,cAAc;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC9HF,qEAAO;AACP;;AAEA,YAAY,mBAAO,CAAC,CAAc;AAClC,cAAc,mBAAO,CAAC,CAAgB;AACtC,cAAc,mBAAO,CAAC,CAAmB;AACzC,eAAe,mBAAO,CAAC,EAAoB;;AAE3C,aAAa,mBAAO,CAAC,CAAS;;AAE9B;AACA;AACA;;AAEA;;AAEA,mBAAmB;AACnB,4BAA4B,4BAA4B;AACxD,eAAe,iCAAiC;AAChD,iBAAiB,0BAA0B;AAC3C,qCAAqC,yBAAyB,SAAS,2CAA2C;AAClH;AACA,iBAAiB,8BAA8B;AAC/C,uDAAuD,8BAA8B;AACrF,kDAAkD,+BAA+B;AACjF;AACA,iBAAiB,8BAA8B;AAC/C,0CAA0C,8BAA8B;AACxE,qCAAqC,+BAA+B;AACpE;AACA,iBAAiB,8BAA8B;AAC/C,oDAAoD,8BAA8B;AAClF,+CAA+C,+BAA+B;AAC9E;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,qBAAqB,kBAAkB;AACvC,wBAAwB,iBAAiB;AACzC;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,oBAAoB;AAC5D;;AAEA,+DAA+D;AAC/D,2B;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;AC1HF,qEAAO;AACP;;AAEA,sBAAsB,mBAAO,CAAC,CAAgB;AAC9C,sBAAsB,mBAAO,CAAC,CAAmB;;AAEjD,sBAAsB,mBAAO,CAAC,EAAyB,EAAE;;AAEzD,sBAAsB,mBAAO,CAAC,CAAS;AACvC,sBAAsB,mBAAO,CAAC,EAAW;;AAEzC;AACA,iBAAiB,8CAA8C;AAC/D;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;AAIA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;AC3FF,qEAAO;AACP;;AAEA,YAAY,mBAAO,CAAC,CAAc;AAClC,eAAe,mBAAO,CAAC,EAAoB;AAC3C,qBAAqB,mBAAO,CAAC,EAAiB;AAC9C,mBAAmB,mBAAO,CAAC,EAAe;AAC1C,kBAAkB,mBAAO,CAAC,EAAkB;AAC5C;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,uBAAuB;AACvB,KAAK;AACL;;AAEA;AACA,oB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,4DAA4D,6BAA6B;AACzF,2DAA2D,4BAA4B;AACvF,eAAe,2CAA2C;AAC1D;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,oCAAoC,mCAAmC;AACvE,iFAAiF,kCAAkC;AACnH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,wE;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,qBAAqB,iBAAiB;AACtC;AACA,wBAAwB,cAAc;AACtC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,uBAAuB,oBAAoB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uEAAuE,2CAA2C;AAClH,oCAAoC,iHAAiH;AACrJ,OAAO;AACP;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,oBAAoB;AACzC;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA,uBAAuB;AACvB;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,sBAAsB;AACtB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B;;AAE/B;AACA,8BAA8B,yCAAyC;AACvE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,2BAA2B;AAC3B;;AAEA;AACA;AACA;AACA,qBAAqB,kBAAkB;AACvC;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,2CAA2C;AAC3C,6BAA6B;AAC7B,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,YAAY;AACZ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC;AACnC;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACrVF,qEAAO;AACP;;AAEA,sBAAsB,mBAAO,CAAC,CAAmB;AACjD,sBAAsB,mBAAO,CAAC,EAAqB;AACnD,sBAAsB,mBAAO,CAAC,CAAgB;;AAE9C;AACA;;AAEA;AACA;AACA;AACA,kBAAkB;;AAElB;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,uDAAuD;AAC/E;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACzDF,qEAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,K;;AAEA;;AAEA;AACA,mBAAmB,mBAAmB;AACtC;AACA;AACA;AACA,eAAe,oBAAoB;AACnC;AACA;AACA;AACA,eAAe,qBAAqB;AACpC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,oD;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mBAAmB,oBAAoB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA,G;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA,oBAAoB,sHAAsH;AAC1I;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC/HF,qEAAO;AACP;;AAEA,YAAY,mBAAO,CAAC,CAAc;AAClC,cAAc,mBAAO,CAAC,CAAmB;AACzC,eAAe,mBAAO,CAAC,EAAoB;;AAE3C,eAAe,mBAAO,CAAC,EAAW;AAClC,aAAa,mBAAO,CAAC,CAAS;;AAE9B;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,eAAe,8BAA8B;AAC7C,wBAAwB,8BAA8B;AACtD,yBAAyB,+BAA+B;AACxD;AACA;AACA,eAAe;AACf;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mIAAmI,iCAAiC;AACpK,8IAA8I,kCAAkC;AAChL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB,mCAAmC;AACtD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,6C;AACA,CAAC;AAAA,oGAAC;;;;;;;ACtHF,qEAAO;AACP;;AAEA,iBAAiB,mBAAO,CAAC,CAAc;AACvC,iBAAiB,mBAAO,CAAC,CAAmB;AAC5C,iBAAiB,mBAAO,CAAC,CAAgB;;AAEzC;AACA,iBAAiB,gCAAgC;AACjD;AACA;;AAEA;AACA;AACA,yDAAyD,iCAAiC;AAC1F;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;AC9BF,qEAAO;AACP;;AAEA,iBAAiB,mBAAO,CAAC,CAAc;AACvC,iBAAiB,mBAAO,CAAC,CAAmB;AAC5C,iBAAiB,mBAAO,CAAC,EAAoB;;AAE7C,aAAa,mBAAO,CAAC,CAAS;;AAE9B;AACA,iBAAiB,gCAAgC;AACjD;;AAEA;AACA;AACA;;AAEA;AACA;AACA,0BAA0B,8BAA8B;AACxD,yBAAyB,kCAAkC;AAC3D,iBAAiB,gCAAgC;AACjD;AACA,mBAAmB,oBAAoB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,4CAA4C;AACjE,qBAAqB,oCAAoC;AACzD;AACA;AACA,qBAAqB,8CAA8C;AACnE,uCAAuC,gFAAgF;AACvH;AACA;AACA;AACA;;AAEA;AACA,mDAAmD;AACnD,iDAAiD;AACjD;AACA;AACA;AACA;AACA,oBAAoB,kGAAkG;AACtH,6BAA6B,uGAAuG;AACpI;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,gGAAgG;AAClH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B,yBAAyB,2BAA2B;AACpD,OAAO;AACP,KAAK;AACL,6BAA6B;AAC7B;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA,uC;AACA,CAAC;AAAA,oGAAC;;;;;;;ACzFF,qEAAO;AACP;;AAEA,YAAY,mBAAO,CAAC,CAAc;AAClC,gBAAgB,mBAAO,CAAC,EAAqB;;AAE7C,eAAe,mBAAO,CAAC,EAAW;;AAElC,aAAa,mBAAO,CAAC,CAAS;;AAE9B;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,+BAA+B,kEAAkE;AACjG,4BAA4B,oGAAoG;AAChI,mCAAmC,iFAAiF;AACpH;AACA,eAAe,kCAAkC;AACjD,iCAAiC,uCAAuC;AACxE;AACA;AACA;AACA,iBAAiB,2EAA2E;AAC5F;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,sCAAsC;AACtC,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACzEF,qEAAO;AACP;;AAEA,qBAAqB,mBAAO,CAAC,CAAgB;AAC7C,qBAAqB,mBAAO,CAAC,CAAkB;AAC/C,qBAAqB,mBAAO,CAAC,EAAkB;AAC/C,qBAAqB,mBAAO,CAAC,CAAc;AAC3C,qBAAqB,mBAAO,CAAC,CAAgB;;AAE7C,qBAAqB,mBAAO,CAAC,EAAuB;AACpD,qBAAqB,mBAAO,CAAC,EAAuB;AACpD,qBAAqB,mBAAO,CAAC,EAAwB;AACrD,qBAAqB,mBAAO,CAAC,EAAuB;AACpD,qBAAqB,mBAAO,CAAC,EAAsB;;AAEnD,qBAAqB,mBAAO,CAAC,EAAU;AACvC,qBAAqB,mBAAO,CAAC,CAAQ;AACrC,qBAAqB,mBAAO,CAAC,EAAU;AACvC,qBAAqB,mBAAO,CAAC,EAAU;;AAEvC,qBAAqB,mBAAO,CAAC,EAAU;;AAEvC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA,6BAA6B;AAC7B,qBAAqB;AACrB;AACA,oBAAoB;AACpB;AACA;AACA,qDAAqD;AACrD;AACA,+BAA+B,SAAS,iBAAiB,EAAE;AAC3D;;AAEA,wDAAwD;AACxD;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsC,aAAa;AACnD;AACA,8CAA8C,4CAA4C;AAC1F;AACA;AACA;;AAEA;AACA;AACA,+BAA+B;AAC/B,oCAAoC;AACpC;;AAEA;AACA;AACA,kCAAkC;AAClC;AACA;AACA;AACA;AACA,gEAAgE;AAChE;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,+BAA+B,SAAS,kBAAkB,EAAE;AAC5D;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,OAAO;AACP,qDAAqD;AACrD,2CAA2C;AAC3C,gCAAgC,SAAS,kBAAkB,EAAE;AAC7D;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;;AAEA;AACA,sBAAsB;AACtB;AACA;AACA,4BAA4B;AAC5B;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,sFAAsF;AACtF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,yDAAyD;AACzD;AACA,OAAO;AACP;AACA;AACA,kBAAkB;AAClB,oBAAoB;AACpB;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,wBAAwB;AACxB;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,8BAA8B;AAC9B,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yDAAyD;AACzD,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC;AACxC;AACA;AACA,gFAAgF,EAAE;AAClF;AACA;AACA;AACA;AACA,uCAAuC,sBAAsB;AAC7D,WAAW;AACX,uDAAuD;AACvD;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK,kBAAkB;AACvB,8EAA8E,EAAE;AAChF;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,kCAAkC,SAAS,iBAAiB,EAAE;AAC9D,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;;AAEA,0HAA0H,iFAAiF;AAC3M;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,QAAQ,gJAAgJ,EAAE;AAC3L,4BAA4B,oBAAoB;AAChD;AACA,SAAS;AACT;AACA,mCAAmC,QAAQ,2BAA2B,EAAE;AACxE,mFAAmF,qCAAqC;AACxH,mCAAmC,QAAQ,gJAAgJ,EAAE;AAC7L;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA,qCAAqC,QAAQ,gJAAgJ,EAAE;AAC/L;AACA;AACA;AACA;AACA,WAAW;AACX,sDAAsD;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,QAAQ,2BAA2B,EAAE;AAC1E;AACA;AACA;AACA,WAAW;AACX;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA,yCAAyC;AACzC,0BAA0B;AAC1B;AACA,mEAAmE;AACnE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,iCAAiC,QAAQ,2BAA2B,EAAE;AACtE,iFAAiF,qCAAqC;AACtH,iCAAiC,QAAQ,+IAA+I,EAAE;AAC1L;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP,gFAAgF,EAAE;AAClF,+BAA+B,QAAQ,2BAA2B,EAAE;AACpE,+EAA+E,qCAAqC;AACpH,+BAA+B,QAAQ,+IAA+I,EAAE;AACxL;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA,6CAA6C,mDAAmD;AAChG;AACA;AACA,oBAAoB,eAAe,EAAE;AACrC;AACA;AACA;AACA,gDAAgD;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wEAAwE,qBAAqB;AAC7F;AACA;AACA,+EAA+E,qBAAqB;AACpG;AACA;AACA,8EAA8E,qBAAqB;AACnG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2DAA2D;AAC3D;AACA;AACA,2DAA2D;AAC3D;AACA;AACA,sCAAsC;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf,wFAAwF,qBAAqB;AAC7G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,KAAK;AACL;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,6BAA6B,QAAQ,2BAA2B,EAAE;AAClE;AACA;AACA;AACA;AACA,gCAAgC,sCAAsC;AACtE,OAAO;AACP,+BAA+B,QAAQ,2BAA2B,EAAE,EAAE;AACtE,+EAA+E,qCAAqC;AACpH,+BAA+B,QAAQ,+IAA+I,EAAE;AACxL;AACA;AACA,mDAAmD;AACnD;AACA,yDAAyD;AACzD,+CAA+C;AAC/C,oCAAoC,SAAS,kBAAkB,EAAE;AACjE;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,0CAA0C,qEAAqE,WAAW,mCAAmC;AAC7J;AACA,oCAAoC,4BAA4B,mBAAmB;AACnF;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL,yCAAyC,EAAE;AAC3C;AACA,iCAAiC;AACjC;AACA;AACA;AACA;AACA,qCAAqC;AACrC;AACA;AACA,SAAS;AACT,OAAO;AACP,iCAAiC;AACjC,OAAO;AACP,KAAK;AACL,yCAAyC;AACzC;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC;AACpC,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA;AACA;AACA;AACA,qCAAqC;AACrC;AACA;AACA,SAAS;AACT,OAAO;AACP,iCAAiC;AACjC,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL,6BAA6B,UAAU;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,oCAAoC;AACpC,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,EAAE;AAC5B;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO,OAAO;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACz1BF,qEAAO;AACP;;AAEA,kBAAkB,mBAAO,CAAC,CAAkB;;AAE5C,kBAAkB,mBAAO,CAAC,EAAc;;AAExC,oBAAoB,mBAAO,CAAC,EAAU;AACtC,eAAe,mBAAO,CAAC,EAAc;;AAErC;AACA;AACA;AACA;AACA,kBAAkB,QAAQ,8DAA8D;AACxF;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,qBAAqB,SAAS,iBAAiB,EAAE;AACjD,kBAAkB,SAAS,cAAc,EAAE;AAC3C,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB;AACtB;AACA,iCAAiC,aAAa;AAC9C,SAAS;AACT;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA,eAAe;AACf;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA,kCAAkC,6BAA6B;AAC/D;AACA;AACA;AACA;AACA,uBAAuB,gBAAgB;AACvC;AACA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;;AAEA;AACA;AACA;;AAEA,6C;AACA,CAAC;AAAA,oGAAC;;;;;;;AC/FF,qEAAO;AACP;;AAEA,qBAAqB,mBAAO,CAAC,CAAc;;AAE3C,qBAAqB,mBAAO,CAAC,EAAU;;AAEvC;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,4DAA4D;AAC5D,KAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,4BAA4B;AAC5B,gGAAgG,yBAAyB,oBAAoB;AAC7I,yEAAyE,cAAc;AACvF,uEAAuE,oBAAoB;;AAE3F;AACA;AACA,yEAAyE,cAAc;AACvF;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,oDAAoD,qDAAqD;AACzG,qDAAqD;AACrD;AACA;AACA;AACA;;AAEA,oEAAoE;AACpE,kFAAkF,0BAA0B,2BAA2B;AACvI;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,iCAAiC;AACjC;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,UAAU,uBAAuB;AACjC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,mBAAmB,mBAAmB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,4BAA4B,uCAAuC;AACnE,4BAA4B,uCAAuC;AACnE;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mCAAmC,QAAQ;AAC3C;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,OAAO;AACP;AACA,mBAAmB;AACnB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B;AAC1B,oDAAoD;AACpD;AACA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,+BAA+B;;AAE/B;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,mBAAmB;;AAExC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,6CAA6C,iBAAiB;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,uBAAuB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,yCAAyC,KAAK,KAAK,IAAI,KAAK,MAAM,gBAAgB,KAAK,KAAK,IAAI,KAAK,MAAM;AAC3G,sDAAsD,IAAI,qCAAqC,IAAI;;AAEnG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,+BAA+B,IAAI,UAAU,IAAI;;AAEjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC","file":"app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 67);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap f4b3f8edada7bfe26fec","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var loader = require('./loader');\r\n\r\n  var _Promise = window.Promise;\r\n  var Promise = _Promise;\r\n\r\n  if (!Promise) {\r\n    /** @constructor */\r\n    Promise = function Promise(resolver) {\r\n      if (this instanceof Promise) {\r\n        return new _Promise(resolver);\r\n      }\r\n      return _Promise(resolver);\r\n    };\r\n\r\n    loader.load('/lib/contrib/es6-promise.auto.min.js', 'Promise', function () {\r\n      _Promise = window.Promise;\r\n      Promise.accept = _Promise['accept'];\r\n      Promise.all = _Promise['all'];\r\n      Promise.defer = _Promise['defer'];\r\n      Promise.race = _Promise['race'];\r\n      Promise.reject = _Promise['reject'];\r\n      Promise.resolve = _Promise['resolve'];\r\n    });\r\n  }\r\n\r\n  module.exports = Promise;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/promise.js\n// module id = 0\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  function safeParse(jso) {\r\n    try {\r\n      return JSON.parse(jso);\r\n    } catch (e) {\r\n    }\r\n  }\r\n  \r\n  function errmsg(e) {\r\n    if (typeof(e) === 'undefined') {\r\n      return 'undefined';\r\n    }\r\n    return JSON.stringify(e, Object.getOwnPropertyNames(e));\r\n  }\r\n  \r\n  function stringifyJSON(o) {\r\n    return (typeof(o) === 'undefined' || o instanceof Error) ? errmsg(o) : JSON.stringify(o);\r\n  }\r\n  \r\n  function getProperties(o, properties) {\r\n    var keyvalues = [];\r\n    properties = properties || Object.getOwnPropertyNames(o); \r\n    for (var i = 0, ilen = properties.length; i < ilen; i++) {\r\n      var property = properties[i]; \r\n      keyvalues.push(property + ': ' + stringifyProperties(o[property]));\r\n    }\r\n    return keyvalues;\r\n  }\r\n  \r\n  function getValues(a) {\r\n    var values = [];\r\n    for (var i = 0, len = a.length; i < len; i++) {\r\n      var elem = a[i];\r\n      values.push(stringifyProperties(elem));\r\n    }\r\n    return values;\r\n  }\r\n\r\n  function stringifyProperties(o, properties) {\r\n    var result;\r\n    var otype = typeof o;\r\n    if (otype === 'number') {\r\n      result = o.toString();\r\n    } else if (otype === 'string') {\r\n      result = '\\'' + o.toString() + '\\'';\r\n    } else if (otype === 'undefined') {\r\n      result = 'undefined';\r\n    } else if (o === null) {\r\n      result = 'null';\r\n    } else if (o) {\r\n      if (o.constructor === Object) {\r\n        var keyvalues = getProperties(o, properties);\r\n        result = '{' + keyvalues.join(', ') + '}';\r\n      } else if (o.constructor === Array) { \r\n        var values = getValues(o);\r\n        result = '[' + values.join(', ') + ']';\r\n      } else {\r\n        result = o.toString();\r\n      }\r\n    } else {\r\n      result = '???'; // should never get here...\r\n    }\r\n    return result;\r\n  }\r\n    \r\n  function getArraysDiff(a, b) {\r\n    return a.filter(function(i) {return b.indexOf(i) < 0;});\r\n  }\r\n  \r\n  function getArraysSymmDiff(a, b) {\r\n    var diffAdded = getArraysDiff(a, b);\r\n    var diffRemoved = getArraysDiff(b, a);\r\n    var diff = diffAdded.concat(diffRemoved);\r\n    return diff;\r\n  }\r\n  \r\n  function getArraysUnion(a, b) \r\n  {\r\n    var r = a.slice(0);\r\n    b.forEach(function(i) { if (r.indexOf(i) < 0) { r.push(i); } });\r\n    return r;\r\n  }\r\n  \r\n  function compareObjects(a, b, properties) {\r\n    var propertyChanges = [];\r\n    var propertyPath = [];\r\n    var compare = function (a, b, properties) {\r\n      var aconstructor = a.constructor;\r\n      if (aconstructor === Object ||\r\n         (aconstructor !== Number && \r\n          aconstructor !== String &&\r\n          aconstructor !== Date && \r\n          aconstructor !== RegExp &&\r\n          aconstructor !== Boolean &&\r\n          aconstructor !== Array &&\r\n          aconstructor !== Function)) {\r\n        if (!properties) {\r\n          properties = getArraysUnion(Object.getOwnPropertyNames(a), Object.getOwnPropertyNames(b)); \r\n        }  \r\n        for (var i = 0, len = properties.length; i < len; i++) {\r\n        // for (var property in a) {\r\n          var property = properties[i]; \r\n          propertyPath.push(propertyPath.length === 0 ? property : '.' + property);\r\n          if (a[property] && b[property]) {\r\n            if (a[property].constructor !== Function) {\r\n              compare(a[property], b[property]);\r\n            }\r\n          } else if (a[property] !== b[property]) {\r\n            propertyChanges.push({ 'property': propertyPath.join(''), 'a': a[property], 'b': b[property] });\r\n          }\r\n          propertyPath.pop();\r\n        }\r\n      } else if (aconstructor === Array) { // use special comparison for Arrays\r\n        var da = getArraysDiff(a, b);\r\n        var db = getArraysDiff(b, a);\r\n        if (da.length > 0 || db.length > 0) {\r\n          propertyChanges.push({ 'property': propertyPath.join(''), 'a': da, 'b': db });\r\n        }\r\n      } else if (aconstructor !== Function) { // skip comparison for Functions\r\n        if (a !== b) {\r\n          propertyChanges.push({ 'property': propertyPath.join(''), 'a': a, 'b': b });\r\n        }\r\n      }\r\n    };\r\n    compare(a, b, properties);\r\n    return propertyChanges;\r\n  }\r\n\r\n  function extractUrlArg(context, item) {\r\n    item = item.split('=');\r\n    var key = item.shift();\r\n    if (key) {\r\n      context[key] = decodeURIComponent(item.join('=')).replace(/\\+/g, ' ');\r\n    }\r\n    return context;\r\n  }\r\n  function extractUrlInfo(s, bag) {\r\n    return s.substr(1).split('&').reduce(extractUrlArg, bag);\r\n  }\r\n  \r\n  function updateDescription(odesc, ndesc, id) {\r\n    var re = /(^|\\s)=====+[^=]+\\[Zang\\:[^\\]]*\\]\\s*=====+(\\s|$)/im;\r\n\r\n    if (ndesc) {\r\n      var pre = '==================================================';\r\n      var pos = '[Zang:' + id + ']\\n' + pre;\r\n      ndesc = pre + '\\n\\n' + ndesc + '\\n\\n' + pos + '\\n';\r\n    }\r\n\r\n    var done = false;\r\n    var desc = odesc.replace(re, function () {\r\n      if (!done || !ndesc) {\r\n        done = true;\r\n        return ndesc;\r\n      }\r\n    });\r\n\r\n    if (!done && ndesc) {\r\n      desc = odesc + '\\n' + ndesc;\r\n    }\r\n    return desc;\r\n  }\r\n\r\n  function getObjectInfo(obj, fields) {\r\n    if (typeof(obj) === 'object') {\r\n      return '{ ' + getLogInfo(obj, fields) + ' }';\r\n    }\r\n    return getLogInfo(obj, fields);\r\n  }\r\n\r\n  function getLogInfo(obj, fields) {\r\n    if (typeof(obj) === 'string') {\r\n      return '\"' + obj + '\"';\r\n    }\r\n    if (!obj) {\r\n      return (String(obj));\r\n    }\r\n    if (typeof(obj) === 'function') {\r\n      // return (String(obj));\r\n      return 'function() { ... }';\r\n    }\r\n    if (typeof(obj) === 'object') {\r\n      if (Object.getOwnPropertyNames(obj).length === 0) {\r\n        return '';\r\n      }\r\n      fields = fields || Object.getOwnPropertyNames(obj);\r\n      var res = '';\r\n      for (var i = 0; i < fields.length; i++) {\r\n        var names = fields[i].split('.');\r\n        var val = obj;\r\n        for (var j = 0; j < names.length; j++) {\r\n          val = val[names[j]];\r\n          if (!val) {\r\n            break;\r\n          }\r\n        }\r\n        if (val instanceof Array) {\r\n          var arr = '[ ';\r\n          for (var k = 0; k < val.length; k++) {\r\n            if (k !== 0) {\r\n              arr += ', ';\r\n            }\r\n            arr += getObjectInfo(val[k]);\r\n          }\r\n          arr += ' ]';\r\n          val = arr;\r\n        } else {\r\n          val = getObjectInfo(val);\r\n        }\r\n        if (i !== 0) {\r\n          res += ', ';\r\n        }\r\n        res += fields[i] + ': ' + val;\r\n      }\r\n      return res;\r\n    }\r\n    return '' + obj;\r\n  }\r\n\r\n  function prepareLogInfo(point, obj, fields, exclude) {\r\n    // return;\r\n    if (typeof(obj) === 'undefined') {\r\n      return point;\r\n    }\r\n    if (fields && exclude) {\r\n      var ofields = Object.getOwnPropertyNames(obj);\r\n      fields.forEach(function (field) {\r\n        var index = ofields.indexOf(field);\r\n        if (index !== -1) {\r\n          ofields.splice(index, 1);\r\n        }\r\n      });\r\n      fields = ofields;\r\n    }\r\n    var info = point + ': ' + getObjectInfo(obj, fields);\r\n    return info;\r\n  }\r\n\r\n  function showLogInfo(point, obj, fields, exclude) {\r\n    var info = prepareLogInfo(point, obj, fields, exclude);\r\n    if (typeof(info) === 'undefined') {\r\n      return;\r\n    }\r\n    console.info(info);\r\n  }\r\n\r\n  function mergeConfigs(config1, config2) {\r\n    if (!config1 && !config2) {\r\n      return {};\r\n    }\r\n    if (!config1) {\r\n      return config2;\r\n    }\r\n    if (!config2) {\r\n      return config1;\r\n    }\r\n    var config = {};\r\n    var fields = Object.getOwnPropertyNames(config1);\r\n    for (var i = 0; i < fields.length; i++) {\r\n      config[fields[i]] = config1[fields[i]];\r\n    }\r\n    fields = Object.getOwnPropertyNames(config2);\r\n    for (i = 0; i < fields.length; i++) {\r\n      config[fields[i]] = config2[fields[i]];\r\n    }\r\n    return config;\r\n  }\r\n\r\n  var utils = {\r\n    safeParse: safeParse,\r\n    errmsg: errmsg,\r\n    stringifyJSON: stringifyJSON,\r\n    getArraysDiff: getArraysDiff,\r\n    getArraysSymmDiff: getArraysSymmDiff,\r\n    getArraysUnion: getArraysUnion,\r\n    compareObjects : compareObjects,\r\n    stringifyProperties: stringifyProperties,\r\n    extractUrlInfo: extractUrlInfo,\r\n    updateDescription: updateDescription,\r\n    getObjectInfo: getObjectInfo,\r\n    getLogInfo: getLogInfo,\r\n    prepareLogInfo: prepareLogInfo,\r\n    showLogInfo: showLogInfo,\r\n    mergeConfigs: mergeConfigs\r\n  };\r\n\r\n  module.exports = utils;\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/utils.js\n// module id = 1\n// module chunks = 0 1 4","define(function (require, exports, module) {\r\n  'use strict';\r\n  \r\n  /** @constructor */\r\n  function Event() {\r\n    this.clear();\r\n  }\r\n  Event.prototype.clear = function () {\r\n    this._handlers = [];\r\n    return this;\r\n  };\r\n  Event.prototype.dispatch = function () {\r\n    var i;\r\n    var h = this._handlers;\r\n    for (i = 0; i < h.length; i += 2) {\r\n      h[i].apply(h[i + 1], arguments);\r\n    }\r\n    return this;\r\n  };\r\n  Event.prototype.addListener = function (cb, context) {\r\n    if (cb) {\r\n      var h = this._handlers;\r\n      h.push(cb);\r\n      h.push(context || null);\r\n    }\r\n    return this;\r\n  };\r\n  Event.prototype.removeListener = function (cb) {\r\n    var h = this._handlers;\r\n    var n = h.indexOf(cb);\r\n    if (n >= 0) {\r\n      h.splice(n, 2);\r\n      this.removeListener(cb);\r\n    }\r\n    return this;\r\n  };\r\n  \r\n  module.exports = Event; \r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/event.js\n// module id = 2\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n  function noop() {\r\n  }\r\n\r\n  function wrapLogger(c, f, tag, lev) {\r\n    if (!f) {\r\n      return noop;\r\n    }\r\n    return f.bind(c, tag, lev);\r\n  }\r\n\r\n  function Log() {\r\n  }\r\n\r\n  Log.prototype.createLogger = function (tag) {\r\n    if (window && window.location) {\r\n      var path = (window.location.pathname || '').split('/');\r\n      var app = path[path.length - 1].split('.')[0];\r\n      if (app) {\r\n        tag = app.toUpperCase() + ':' + tag;\r\n      }\r\n      tag = '[' + tag + ']';\r\n    }\r\n    var logger = {\r\n      _info: wrapLogger(console, console.info || noop, tag, '[i]'),\r\n      _log: wrapLogger(console, console.log || noop, tag, '[l]'),\r\n      _warn: wrapLogger(console, console.warn || noop, tag, '[w]'),\r\n      _error: wrapLogger(console, console.error || noop, tag, '[e]'),\r\n      _debug: wrapLogger(console, console.debug || noop, tag, '[d]'),\r\n      _assert: wrapLogger(console, console.assert || noop, tag, '[a]'),\r\n      _trace: wrapLogger(console, console.trace || noop, tag, '[t]'),\r\n      _cred: wrapLogger(null, function () {\r\n        var args = Array.prototype.slice.apply(arguments);\r\n        var last = (args.pop() || '').replace(/[^a-z0-9]/ig, '\\\\$&');\r\n        if (last) {\r\n          var re = new RegExp(last, 'ig');\r\n          args = args.map(function (item) {\r\n            return item.replace(re, '********');\r\n          });\r\n        }\r\n        console.info.apply(console, args);\r\n      }, tag, '[i]'),\r\n      _empty: noop,\r\n      enable: function (v) {\r\n        this.cred = v ? this._cred : this._empty;\r\n        this.info = v ? this._info : this._empty;\r\n        this.log = v ? this._log : this._empty;\r\n        this.warn = v ? this._warn : this._empty;\r\n        this.error = v ? this._error : this._empty;\r\n        this.debug = v ? this._debug : this._empty;\r\n        this.assert = v ? this._assert : this._empty;\r\n        this.trace = v ? this._trace : this._empty;\r\n      }\r\n    };\r\n    logger.enable(true);\r\n    return logger;\r\n  };\r\n\r\n  Log.prototype.getErrInfo = function (err) {\r\n    err = err || { };\r\n    return err.message ? (err.message + ', ' + err.stack) : JSON.stringify(err);\r\n  }\r\n\r\n  Log.prototype.getInfo = function (o) {\r\n    return typeof(o) === 'undefined' ? 'undefined' : JSON.stringify(o);\r\n  }\r\n\r\n  module.exports = new Log();\r\n});\r\n\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/log.js\n// module id = 3\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var global = window;\r\n\r\n  function hasKey(key, object) {\r\n    object = object || global;\r\n    return (key in object);\r\n  }\r\n  function safeProp(key, def, object) {\r\n    object = object || global;\r\n    if (key in object) {\r\n      return object[key];\r\n    }\r\n    return def;\r\n  }\r\n  function wrapString(v) {\r\n    if (typeof (v) !== 'string') {\r\n      v = String(v);\r\n    }\r\n    return v;\r\n  }\r\n\r\n  module.exports = { hasKey: hasKey, safeProp: safeProp, wrapString: wrapString, global: global };\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/globals.js\n// module id = 4\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n  \r\n  var base = require('./base');\r\n  \r\n  var keys = {\r\n    text: '$t', html: '$h',\r\n    cssClass: '@class', id: '@id', href: '@href', style: '@style', _id: '@jslid', src: '@src', tip: '@title', hint: '@placeholder', tab: '@tabIndex', align: '@align', target: '@target',\r\n    click: '^click', dblclick: '^dblclick'\r\n  };\r\n  var rkeys = base.reverseMap(keys);\r\n  \r\n  function get(arg) {\r\n    if (arg instanceof Element) {\r\n      return new element(arg);\r\n    }\r\n    else if (arg instanceof element) {\r\n      return arg;\r\n    }\r\n    return new element(document.getElementById(arg) || document.body);\r\n  }\r\n  \r\n  function node(tag) {\r\n    return function (args) {\r\n      return get(document.createElement(tag)).set(args);\r\n    };\r\n  }\r\n  function parse(el, level) {\r\n    var sb = [];\r\n    level = level || 1;\r\n    var pad = '\\n' + new Array(level*2 + 1).join(' ');\r\n    var pad2 = '\\n' + new Array((level - 1)*2 + 1).join(' ');\r\n    \r\n    sb.push('dom.' + el.tagName.toLowerCase() + '(');\r\n    var args = [];\r\n    var attrs = [];\r\n    for (var i = 0 ; i < el.attributes.length; i++) {\r\n      var a = el.attributes[i];\r\n      var n = '@' + a.name;\r\n      attrs.push((rkeys[n] || n) + ':\\'' +  a.value + '\\'');\r\n    }\r\n    if (attrs.length) {\r\n      sb.push('{');\r\n      sb.push(attrs.join(', '));\r\n      sb.push('}');\r\n    }\r\n\r\n    var nodes = el.childNodes;\r\n    var p = nodes.length > 1 ? pad : '';\r\n    for (var i = 0; i < nodes.length; i++) {\r\n      if (nodes[i].nodeType === 3) {\r\n        args.push(p + '\\'' + nodes[i].nodeValue + '\\'');\r\n      } else {\r\n        args.push(p + parse(nodes[i], level + 1));\r\n      }\r\n    }\r\n    if (args.length) {\r\n      if ((args.length > 1) || attrs.length)\r\n        sb.push(').add(')\r\n      sb.push(args.join(','));\r\n    }\r\n    if (p)\r\n      sb.push(pad2);\r\n    sb.push(')');\r\n    return sb.join('');\r\n  }\r\n  \r\n\r\n  /** @constructor */\r\n  var element = function element(el) {\r\n    this.node = el;\r\n  };\r\n  element.prototype.clear = function () {\r\n    this.node.innerHTML = '';\r\n  }\r\n  element.prototype.add = function () {\r\n    for (var i = 0; i < arguments.length; i++) {\r\n      var arg = arguments[i];\r\n      if (arg instanceof element) {\r\n        this.node.appendChild(arg.node);\r\n      } else if (arg instanceof Element) {\r\n        this.node.appendChild(arg);\r\n      } else if (typeof (arg) === 'string') {\r\n        this.node.appendChild(document.createTextNode(arg));\r\n      }\r\n    }\r\n    return this;\r\n  };\r\n  element.prototype.del = function (final) {\r\n    var n = this.node;\r\n    if (n && n.parentElement) {\r\n      n.parentElement.removeChild(n);\r\n    }\r\n    if (final) {\r\n      this.node = undefined;\r\n    }\r\n    return n;\r\n  };\r\n  element.prototype.set = function (args) {\r\n    for (var i = 0; i < arguments.length; i++) {\r\n      var arg = arguments[i];\r\n      if (typeof (arg) === 'string') {\r\n        this.add(arg);\r\n      }\r\n      else if (arg instanceof element) {\r\n        this.add(arg);\r\n      } else {\r\n        for (var k in arg) {\r\n          var kk = keys[k] || k;\r\n          if (kk[0] === '@') {\r\n            this.node.setAttribute(kk.substr(1), arg[k]);\r\n          } else if (kk[0] === '^') {\r\n            this.node.addEventListener(kk.substr(1), arg[k]);\r\n          } else if (kk === '$t') {\r\n            this.node.textContent = arg[k];\r\n          } else if (kk === '$h') {\r\n            this.node.innerHTML = arg[k];\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return this;\r\n  };\r\n  element.prototype.addClass = function (c) {\r\n    if (!c) {\r\n      return this;\r\n    }\r\n    var i;\r\n    c = Array.isArray(c) ? c : c.split(' ');\r\n    for (i = 0; i < c.length; i++) {\r\n      this.node.classList.add(c[i]);\r\n    }\r\n    return this;\r\n  };\r\n  element.prototype.delClass = function (c) {\r\n    if (!c) {\r\n      return this;\r\n    }\r\n    var i;\r\n    c = Array.isArray(c) ? c : c.split(' ');\r\n    for (i = 0; i < c.length; i++) {\r\n      this.node.classList.remove(c[i]);\r\n    }\r\n    return this;\r\n  };\r\n  element.prototype.hasClass = function (c) {\r\n    return this.node.classList.contains(c);\r\n  };\r\n  element.prototype.toggleClass = function (c, v) {\r\n    return v ? this.addClass(c) : this.delClass(c);\r\n  };\r\n  element.prototype.mixClass = function (lst, lstKeep) {\r\n    var i, cl = this.node.classList, hn = [], hd = [];\r\n    lstKeep = lstKeep || [];\r\n\r\n    for (i = 0; i < cl.length; i++) {\r\n      if ((lst.indexOf(cl[i]) < 0) && (lstKeep.indexOf(cl[i]) < 0)) {\r\n        hd.push(cl[i]);\r\n      }\r\n    }\r\n    for (i = 0; i < lst.length; i++) {\r\n      if (!cl.contains[lst[i]]) {\r\n        hn.push(lst[i]);\r\n      }\r\n    }\r\n    this.delClass(hd);\r\n    this.addClass(hn);\r\n    return this;\r\n  };\r\n  element.prototype.setText = function (t) {\r\n    this.node.textContent = t || '';\r\n    return this;\r\n  };\r\n  \r\n  var dom = {\r\n    html: get(document.documentElement),\r\n    head: get(document.head),\r\n    body: get(document.body),\r\n    title: get(document.title),\r\n    \r\n    br: node('br'), hr: node('hr'),\r\n    div: node('div'), span: node('span'), p: node('p'), pre: node('pre'),\r\n    h1: node('h1'), h2: node('h2'), h3: node('h3'),\r\n    header: node('header'), footer: node('footer'), section: node('section'),\r\n    \r\n    img: node('img'),\r\n    ul: node('ul'), li: node('li'),\r\n    \r\n    a: node('a'), link: node('link'),\r\n    input: node('input'), textarea: node('textarea'), select: node('select'), option: node('option'), button: node('button'), label: node('label'),\r\n\r\n    audio: node('audio'), video: node('video'),\r\n    \r\n    get: get, parse: parse, element: base.extend(element)\r\n  };\r\n  \r\n  module.exports = dom;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/dom.js\n// module id = 5\n// module chunks = 0","define(function(require, exports, module) {\r\n  \"use strict\";\r\n\r\n  var strings = {\r\n    \"sourceTitle\": \"Source\",\r\n    \"sourceEquinox\": \"Equinox Rooms\",\r\n    \"sourceSpaces\": \"Spaces\",\r\n    \"actionOk\": \"Ok\",\r\n    \"actionCancel\": \"Cancel\",\r\n    \"hintPassword\": \"Password\",\r\n    \"titleUnknownInvitation\": \"Unknown invitation\",\r\n    \"titleSpaceUrl\": \"Space URL\",\r\n    \"titleMeetingPlaces\": \"Places to Meet\",\r\n    \"actionCreateTopic\": \"Create Topic\",\r\n    \"titleMeetingDetails2\": \"Your meeting details have been added!\",\r\n    \"errorSourceInitialization\": \"Could not retrieve your $source meeting information\",\r\n    \"retrySourceInitialization\": \"Retrying retrieve your $source meeting information\",\r\n    \"hintSpacesSearch\": \"Search\",\r\n    \"noteAppInitializing\": \"Initializing application\",\r\n    \"notePleaseWait\": \"Please wait...\",\r\n    \"noteLoading\": \"Loading\",\r\n    \"noteAppNotInitialized\": \"Application not initialized\",\r\n    \"noteUnknown\": \"Unknown\",\r\n    \"noteInitializing\": \"Initializing\",\r\n    \"noteNotInitialized\": \"Not initialized\",\r\n    \"noteInitialized\": \"Initialized\",\r\n    \"noteAuthorizing\": \"Authorizing\",\r\n    \"noteNotAuthorized\": \"Not authorized\",\r\n    \"noteAuthorized\": \"Authorized\",\r\n    \"noteUnauthorizing\": \"Unauthorizing\",\r\n    \"noteNotUnauthorized\": \"Not unauthorized\",\r\n    \"noteUnauthorized\": \"Unauthorized\",\r\n    \"noteFetching\": \"Fetching\",\r\n    \"noteNotFetched\": \"NotFetched\",\r\n    \"noteFetched\": \"Fetched\",\r\n    \"noteChecking\": \"Checking\",\r\n    \"noteNotChecked\": \"Not checked\",\r\n    \"noteChecked\": \"Checked\",\r\n    \"partyTypeSelectLabel\": \"Invite participants as:\",\r\n    \"partyTypeMembers\": \"Members\",\r\n    \"partyTypeGuests\": \"Guests\",\r\n    \"partiesMeOnly\": \"Me only\",\r\n    \"partiesMePlus\": \"Me + \",\r\n    \"partiesOtherMembers\": \" member(s)\",\r\n    \"topicCreateNew\": \"Create new $source\",\r\n    \"errorUnknown\": \"Unknown error\",\r\n    \"errorNoOffice\": \"Office is not initialized...\",\r\n    \"errorAccountDisabled\": \"Account disabled\",\r\n    \"errorLoginBlocked\": \"Login window blocked\",\r\n    \"errorLoginClosed\": \"Login window closed\",\r\n    \"errorLoginTimeout\": \"Login timed out\",\r\n    \"errorNoInvite\": \"No invite\",\r\n    \"errorNetwork\": \"Network error while accessing $source\",\r\n    \"errorSignInRequired\": \"Please sign-in in your browser to access $source\",\r\n    \"errorLoginRequired\": \"Please login to access $source\",\r\n    \"errorNoAppConfiguration\": \"Please provide configuration to start application\",\r\n    \"errorNoSourceConfiguration\": \"Please provide configuration to access $source\",\r\n    \"errorNoValidSources\": \"No valid sources\",\r\n    \"errorUnknownSource\": \"Unknown source\",\r\n    \"errorInviteEmpty\": \"Invite is empty\",\r\n    \"errorInviteContentEmpty\": \"Invite content is empty\",\r\n    \"errorTemplate\": \"The template could not be accessed.\",\r\n    \"notificationMeetingJoined\": \"Joined meeting\",\r\n    \"notificationMeetingNotJoined\": \"Failed to join meeting\",\r\n    \"notificationNoMeetingLink\": \"Meeting link not found\",\r\n    \"errorPopupBlocked\" : \"Popup blocked\",\r\n\r\n    \"askResetConfiguration\": \"Reset the configuration?\",\r\n    \"actionReset\": \"Reset\",\r\n    \"titleAddinAds\": \"Schedule Avaya Equinox and Avaya Spaces meetings.\",\r\n    \"titleSetupMeetingDetails\": \"Let’s setup your meeting details!<br/>Enter your email address.\",\r\n    \"hintEmailAddress\": \"Email address\",\r\n    \"titleAccountAds\": \"Don't have an Avaya Equinox or Avaya Spaces account?\",\r\n    \"titleAccountAdsLink\": \"Get a demo, purchase or learn more about our services here\",\r\n    \"actionNext\": \"Next\",\r\n    \"actionSkip\": \"Skip\",\r\n    \"actionClear\": \"Clear\",\r\n    \"titleCheckingCloudAccount\": \"Checking your Avaya Cloud account...\",\r\n    \"titleEnterCloudCredentials\": \"Enter your credentials<br/>for Avaya Cloud\",\r\n    \"titleOpensInBrowser\": \"(Opens in separate browser window)\",\r\n    \"linkClickToLogin\": \"Click here to login\",\r\n    \"titleLoggingToCloud\": \"Logging in to Avaya Cloud\",\r\n    \"hintUsername\": \"Username\",\r\n    \"titleCheckingEquinoxAccount\": \"Checking your Equinox account...\",\r\n    \"titleChooseEquinoxEnvironment\": \"Choose your environment\",\r\n    \"titleEnterAEMOCredentials\": \"Enter your credentials<br/>for Equinox Meetings Online\",\r\n    \"titleEnterEquinoxCredentials\": \"Enter your credentials<br/>for Equinox Meetings\",\r\n    \"titleLoggingToAEMO\": \"Logging in to Equinox Meetings Online\",\r\n    \"titleLoggingToEquinox\": \"Logging in to Equinox Meetings\",\r\n    \"errorBadCredentials\": \"Incorrect Username or Password\",\r\n    \"errorConfigureAccount\": \"Unable to configure account at this time.\",\r\n    \"errorNoConfiguredAccounts\": \"Sorry, your account could not be found.<br/>You may want to:<ul><li>check your email address and try again</li><li>check with your organization to see if you have a Equinox Meetings Online or Equinox Conferencing account</li><li><a href=\\\"https://spaces.zang.io\\\" target=\\\"_blank\\\">sign up</a> for a Spaces account.</li></ul>\",\r\n    \"titleSettingAddin\": \"Setting up your add-in...\",\r\n\r\n    \"titleRequestInfo\": \"Retrieving Portal Info...\",\r\n    \"titleMeetingDetails\": \"Your Meeting Details\",\r\n\r\n    \"titleConferenceAccessNumber\": \"Conference Access Number\",\r\n    \"titleMeetingId\": \"Meeting ID\",\r\n    \"titleConferenceAccessUrl\": \"Conference Access URL\",\r\n\r\n    \"actionAddDetails\": \"Add Details\",\r\n    \"actionAddingDetails\": \"Adding Details...\",\r\n    \"actionStart\": \"Start Meeting\",\r\n    \"actionJoin\": \"Join Meeting\",\r\n    \"actionRemoveDetails\": \"Remove Details\",\r\n    \"actionRemovingDetails\": \"Removing Details...\",\r\n    \"actionLogin\": \"Login\",\r\n    \"actionRetry\": \"Retry\",\r\n    \"actionAllow\": \"Allow\",\r\n    \"actionIgnore\": \"Ignore\",\r\n    \"actionTryAgain\": \"Try Again\",\r\n\r\n    \"linkEquinoxSettings\": \"Go to Equinox Settings\",\r\n    \"linkResetConfiguration\": \"Reset Add-in Configuration\",\r\n\r\n    \"additionalNumbersTitle\": \"Additional numbers:\",\r\n    \"titlePasswordDetails\": \"Specify your password:\",\r\n    \"titleUserId\": \"User name:\",\r\n    \"titlePassword\": \"Password:\",\r\n\r\n    \"aacRoomName\": \"Default AAC\",\r\n    \"aacLabel\": \"Avaya Aura Conferencing\",\r\n\r\n    \"ipoRoomName\": \"Default IP Office\",\r\n    \"ipoLabel\": \"Avaya IP Office Conferencing\",\r\n\r\n    \"statusOffline\": \"Add-in is running in offline mode\",\r\n    \"statusCached\": \"Only cached rooms information is currently available.\",\r\n\r\n    \"errorNoConfiguration\": \"Configuration settings are incomplete. Go to your portal settings to reconfigure.\",\r\n    \"errorPortal\": \"The Portal could not be accessed.\",\r\n    \"errorInvalidCredentials\": \"Your user credentials were invalid. Check your Equinox Settings or contact support for details.\",\r\n    \"errorNoRooms\": \"Error while fetching conference rooms.\",\r\n    \"errorInternal\": \"Internal application error.\",\r\n\r\n    \"promptDisplayNewWindow\": \"$1 wants to display a new window\",\r\n  };\r\n\r\n\r\n  var i18n = {\r\n    ready: false,\r\n    languageId: \"en-US\", // default\r\n\r\n    i18n: strings\r\n  };\r\n\r\n  i18n.loadI18n = function (id) {\r\n    if (i18n.ready) {\r\n      return Promise.resolve(i18n.languageId);\r\n    }\r\n    if (i18n.loading) {\r\n      return i18n.loading;\r\n    }\r\n    i18n.loading = new Promise(function(resolve, reject) {\r\n      var setReady = function(failed) {\r\n        i18n.ready = true;\r\n        delete i18n.loading;\r\n        if (!failed) {\r\n          i18n.languageId = id;\r\n        }\r\n        resolve(i18n.languageId);\r\n      };\r\n\r\n      try {\r\n        id = id.toLowerCase();\r\n        var langid = id.split('-')[0];\r\n        switch (id) {\r\n          case 'pt-br':\r\n          case 'zh-cn':\r\n          case 'zh-tw':\r\n            langid = id.replace('-', '_');\r\n        }\r\n        var url = 'i18n.json';\r\n        fetch(url).then(function (r) {\r\n          if (!r.ok) {\r\n            throw null;\r\n          }\r\n          return r.text();\r\n        }).then(function (text) {\r\n          try {\r\n            var langstrings = JSON.parse(text);\r\n            Object.getOwnPropertyNames(langstrings).forEach(function (lcid) {\r\n              langstrings[lcid.toLowerCase()] = langstrings[lcid];\r\n            });\r\n            \r\n            var ln_strings = langstrings[langid] || {};\r\n            var en_strings = langstrings['en'] || {};\r\n            \r\n            Object.getOwnPropertyNames(en_strings).forEach(function(key) {\r\n              strings[key] = ln_strings[key] || en_strings[key];\r\n            });\r\n            setReady(false);\r\n          } catch (e) {\r\n            setReady(true);\r\n          }\r\n        }, function () {\r\n          setReady(true);\r\n        });\r\n      } catch (e) {\r\n        setReady(true);\r\n      }\r\n    });\r\n    return i18n.loading;\r\n  };\r\n\r\n  module.exports = i18n;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./i18n.js\n// module id = 6\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var globals = require('../globals');\r\n  \r\n  var _chrome = globals.safeProp('chrome');\r\n  if (!_chrome || !('runtime' in _chrome)) {\r\n    _chrome = globals.safeProp('browser');\r\n  }\r\n  if (!_chrome || !('runtime' in _chrome)) {\r\n    _chrome = { };\r\n  }\r\n  \r\n  module.exports = _chrome;\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/chrome/chrome.js\n// module id = 7\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  function empty() {\r\n  }\r\n  \r\n  function keys(o) {\r\n    return Object.getOwnPropertyNames(o || {});\r\n  }\r\n  function mergeKey(context, key) {\r\n    if (key !== 'constructor') {\r\n      context.dst[key] = context.src[key];\r\n    }\r\n    return context;\r\n  }\r\n  function merge(src, dst) {\r\n    return keys(src).reduce(mergeKey, { src: src, dst: dst }).dst;\r\n  }\r\n\r\n  function declare(constructor, instance, statics) {\r\n    constructor = constructor || empty;\r\n    instance    = instance    || constructor.prototype;\r\n    merge(instance, constructor.prototype);\r\n    merge(statics, constructor);\r\n    return constructor;\r\n  }\r\n  function extend(base, constructor, instance, statics) {\r\n    statics = statics || {};\r\n    return derive(constructor, base, instance, statics);\r\n  }\r\n  function derive(constructor, base, instance, statics) {\r\n    var proto;\r\n    constructor = constructor || empty;\r\n    proto       = constructor.prototype;\r\n    base        = base || Object;\r\n    statics     = statics  || base.statics || {};\r\n    \r\n    constructor.prototype = Object.create(base.prototype, { constructor: { value: constructor, enumerable: false }, $base: { value: base.prototype, enumerable: false } });\r\n    merge(proto, constructor.prototype);\r\n    merge(instance, constructor.prototype);\r\n    merge(statics, constructor);\r\n    constructor.extend = extend.bind(null, constructor);\r\n    constructor.statics = constructor.statics || {};\r\n    merge(statics, constructor.statics);\r\n    return constructor;\r\n  }\r\n  function mix(constructor) {\r\n    constructor = constructor || empty;\r\n    var i, len;\r\n    for (i = 1, len = arguments.length; i < len; i++) {\r\n      merge(arguments[i], constructor.prototype);\r\n    }\r\n    return constructor;\r\n  }\r\n  function reverseMap(o) {\r\n    var r = {}, k = keys(o), i;\r\n    for (i = 0; i < k.length; i++) {\r\n      r[o[k[i]]] = k[i];\r\n    }\r\n    return r;\r\n  }\r\n  function reduce(bag, f, context) {\r\n    if (!Array.isArray(bag)) {\r\n      bag = keys(bag);\r\n    }\r\n    bag.reduce(f, context);\r\n  }\r\n  function findFunction(o, f) {\r\n    var key;\r\n    for (key in o) {\r\n      if (o[key] === f) {\r\n        return key;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n  \r\n  /** @constructor */\r\n  function Base() {\r\n    //console.info('base', this);\r\n  }\r\n  Base.prototype.$call = function (f, args) {\r\n    f = f;\r\n    args = args;\r\n    //var k = this.$this;\r\n  }; \r\n  Base.prototype.$super = function () {\r\n    var t = this.$this;\r\n    this.$this = (t || this).$base;\r\n    this.$this.constructor.apply(this, arguments);\r\n    this.$this = t;\r\n  }; \r\n  \r\n  module.exports = derive(Base, Object, {}, {\r\n    empty: empty,\r\n    declare: declare,\r\n    derive: derive,\r\n    mix: mix,\r\n    keys: keys,\r\n    reduce: reduce,\r\n    reverseMap: reverseMap,\r\n  });\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/base.js\n// module id = 8\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n  \r\n  var Control = require('./control');\r\n  \r\n  /** @constructor */\r\n  function Panel(opt) {\r\n    this.$super(opt)\r\n    this.addClass('panel');\r\n  }\r\n\r\n  module.exports = Control.extend(Panel);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/ui/panel.js\n// module id = 9\n// module chunks = 0","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var chrome = require('../chrome/chrome');\r\n  var fetch = require('./fetch');\r\n\r\n  function fetchproxy(url, opt) {\r\n    if (!chrome || !chrome.runtime || !chrome.runtime.id) {\r\n      //var proxypath = location.href.replace(/(.*)\\/.*\\/.*(\\.html)($|\\??.*)/i, '$1/proxy/proxy.ashx?url=');\r\n      var proxypath = '../proxy/proxy.ashx?url=';\r\n      url = proxypath + url;\r\n\r\n      console.log('fetchproxy:' + url);\r\n    }\r\n    return fetch(url, opt);\r\n  }\r\n  \r\n  module.exports = fetchproxy;  \r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/io/fetchproxy.js\n// module id = 10\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n  \r\n  var _empty = {\r\n    bag: {},\r\n    set: function (key, val) {\r\n      this.bag[key] = val;\r\n    },\r\n    get: function (key) {\r\n      return this.bag[key];\r\n    },\r\n    del: function (key) {\r\n      delete this.bag[key];\r\n    }\r\n  };\r\n  var _local = {\r\n    set: function (key, val) {\r\n      localStorage.setItem(key, val);\r\n    },\r\n    get: function (key) {\r\n      return localStorage.getItem(key);\r\n    },\r\n    del: function (key) {\r\n      localStorage.removeItem(key);\r\n    }\r\n  };\r\n\r\n  /** @constructor */\r\n  function Storage() {\r\n    this.enabled = true;\r\n    this.empty = _empty;\r\n    this.local = _local;\r\n    this._store = _local;\r\n  }\r\n  \r\n  Storage.prototype.setStore = function (store) {\r\n    if (store) {\r\n      this._store = store;\r\n    }\r\n  };\r\n\r\n  Storage.prototype.getItem = function (key) {\r\n    if (!this.enabled) {\r\n      return null;\r\n    }\r\n    return this._store.get(key);\r\n  };\r\n\r\n  Storage.prototype.setItem = function(key, val) {\r\n    if (!this.enabled) {\r\n      return;\r\n    }\r\n    if ((val === null) || (typeof (val) === 'undefined')) {\r\n      this.removeItem(key);\r\n      return;\r\n    }\r\n    this._store.set(key, val);\r\n  };\r\n\r\n  Storage.prototype.removeItem = function (key) {\r\n    if (!this.enabled) {\r\n      return;\r\n    }\r\n    this._store.del(key);\r\n  };\r\n\r\n  module.exports = new Storage();\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/storage.js\n// module id = 11\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise = require('/lib/jsl/promise');\r\n  var Log = require('/lib/jsl/log');\r\n  var Timer = require('/lib/jsl/timer');\r\n\r\n  var globals = require('/lib/jsl/globals');\r\n  var Office = globals.safeProp('Office');\r\n\r\n  var officeNative = require('./office.native');\r\n  var officeStorage = require('./storage');\r\n\r\n  var logger = Log.createLogger('OFFICE');\r\n\r\n  var office = {\r\n    getStore: officeStorage.getStore\r\n  };\r\n  var strings_defaults = {\r\n    appName: '',\r\n    actionAllow: 'Allow',\r\n    actionIgnore: 'Ignore',\r\n    promptDisplayNewWindow:  '$1 wants to display a new window.'\r\n  };\r\n  var strings = {\r\n  };\r\n\r\n  if (officeNative.missing) {\r\n    Office.initialize = function (reason) {\r\n      logger.info('Office.initialize: ' + reason);\r\n      office.webAPI = true;\r\n      office.initialized = true;\r\n      office.hostName = Office.context.mailbox.diagnostics.hostName;\r\n      office.joinMode = typeof(Office.context.mailbox.item.itemId) !== 'undefined';\r\n    };\r\n  } else {\r\n    office.webAPI = false;\r\n    office.initialized = true;\r\n    Office = officeNative;\r\n    office.hostName = Office.context.mailbox.diagnostics.hostName;\r\n    if ('apiVersion' in Office.context.mailbox.diagnostics) {\r\n      office.apiVersion = Office.context.mailbox.diagnostics.apiVersion;\r\n    }\r\n  }\r\n\r\n  function callback(action, resolve, reject) {\r\n    return function(result) {\r\n      if (result.error) {\r\n        reject(result.error);\r\n        return;\r\n      }\r\n      try {\r\n        var value = result.value;\r\n        if (action) {\r\n          value = action(value);\r\n        }\r\n        resolve(value);\r\n      } catch (e) {\r\n        reject(e);\r\n      }\r\n    };\r\n  }\r\n\r\n  function checkOffice() {\r\n    return new Promise(function(resolve, reject) {\r\n      var timer;\r\n      var delay = 0;\r\n      var interval = 100;\r\n      var wait = 15000;\r\n      var checkInitialized = function () {\r\n        if (office.initialized) {\r\n          timer.reset();\r\n          office.version = Office.context.mailbox.diagnostics.hostVersion.toString() || '';\r\n          logger.info('Office initialized, webAPI: ' + office.webAPI + ', version: ' + office.version + ', apiVersion: ' + office.apiVersion + ', delay: ' + delay);\r\n          logger.info('Office userProfile displayName: ' + office.getDisplayName() + ', emailAddress: ' + office.getEmailAddress());\r\n          officeStorage.init(Office.context.roamingSettings);\r\n          resolve({ checkOffice: true, delay: delay });\r\n        } else {\r\n          if (delay >= wait) {\r\n            timer.reset();\r\n            logger.info('Office not initialized, delay: ' + delay);\r\n            resolve({ checkOffice: false, delay: delay });\r\n          } else {\r\n            timer.start(interval);\r\n            delay += interval;\r\n          }\r\n        }\r\n      };\r\n      timer = new Timer(checkInitialized, 0);\r\n    });\r\n  }\r\n\r\n  function getDialogApi() {\r\n    try {\r\n      return Office.context.requirements.isSetSupported('DialogAPI', '1.1');\r\n    } catch (ex) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  function setTranslations(s) {\r\n    s = s || {};\r\n    strings.actionAllow = s.actionAllow;\r\n    strings.actionIgnore = s.actionIgnore;\r\n    strings.appName = s.manifest_DisplayName;\r\n    strings.promptDisplayNewWindow = strings.promptDisplayNewWindow;\r\n  }\r\n\r\n  function getDisplayName() {\r\n    var displayName;\r\n\r\n    var mailbox = Office.context.mailbox;\r\n    if ('userProfile' in mailbox) {\r\n      var userProfile = mailbox.userProfile;\r\n      if ('displayName' in userProfile) {\r\n        displayName = userProfile.displayName;\r\n      }\r\n    }\r\n    return typeof(displayName) === 'string' ?  displayName : null;\r\n  }\r\n\r\n  function getEmailAddress() {\r\n    var emailAddress;\r\n\r\n    var mailbox = Office.context.mailbox;\r\n    if ('userProfile' in mailbox) {\r\n      var userProfile = mailbox.userProfile;\r\n      if ('emailAddress' in userProfile) {\r\n        emailAddress = userProfile.emailAddress;\r\n      }\r\n    }\r\n\r\n    return typeof(emailAddress) === 'string' ?  emailAddress : null;\r\n  }\r\n\r\n  function getSubject() {\r\n    return new Promise(function(resolve, reject) {\r\n      var action = function (subject) {\r\n        return subject || '';\r\n      };\r\n      Office.context.mailbox.item.subject.getAsync(callback(action, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function setSubject(subject) {\r\n    return new Promise(function(resolve, reject) {\r\n      Office.context.mailbox.item.subject.setAsync(subject, {}, callback(null, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function getParties(member) {\r\n    return new Promise(function(resolve, reject) {\r\n      var action = function (recipients) {\r\n        var _recipients = typeof(recipients) === 'string' ? recipients.split(';') : recipients;\r\n        var parties = [];\r\n        for (var i = 0; i < _recipients.length; i++) {\r\n          parties.push({ email: _recipients[i].emailAddress || _recipients[i], member: member });\r\n        }\r\n        return parties;\r\n      };\r\n      Office.context.mailbox.item.requiredAttendees.getAsync(callback(action, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function getDescription(type) {\r\n    return new Promise(function(resolve, reject) {\r\n      var action = function (desc) {\r\n        return(desc);\r\n      };\r\n      var coercion = type || 'text';\r\n      Office.context.mailbox.item.body.getAsync(coercion, callback(action, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function setDescription(desc, type) {\r\n    return new Promise(function(resolve, reject) {\r\n      var coercion = { coercionType: type || 'text' };\r\n      Office.context.mailbox.item.body.setAsync(desc, coercion, callback(null, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function prependDescription(desc, type) {\r\n    return new Promise(function(resolve, reject) {\r\n      var coercion = { coercionType: type || 'text' };\r\n      Office.context.mailbox.item.body.prependAsync(desc, coercion, callback(null, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function insertDescription(desc, type) {\r\n    return new Promise(function(resolve, reject) {\r\n      var coercion = { coercionType: type || 'text' };\r\n      if ('setSelectedDataAsync' in Office.context.mailbox.item.body) {\r\n        Office.context.mailbox.item.body.setSelectedDataAsync(desc, coercion, callback(null, resolve, reject));\r\n      } else {\r\n        Office.context.mailbox.item.body.prependAsync(desc, coercion, callback(null, resolve, reject));\r\n      }\r\n    });\r\n  }\r\n\r\n  function setLocation(value) {\r\n    return new Promise(function(resolve, reject) {\r\n      Office.context.mailbox.item.location.setAsync(value, { }, callback(null, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function getLocation() {\r\n    return new Promise(function(resolve, reject) {\r\n      var action = function (value) {\r\n        return(value);\r\n      };\r\n      if (typeof(Office.context.mailbox.item.location) === 'string') {\r\n        resolve(action(Office.context.mailbox.item.location));\r\n      } else {\r\n        Office.context.mailbox.item.location.getAsync(callback(action, resolve, reject));\r\n      }\r\n    });\r\n  }\r\n\r\n  function getLanguageSync() {\r\n    var language = Office.context.displayLanguage;\r\n    return typeof(language) === 'string' ?  language : null;\r\n  }\r\n\r\n  function notifyInfo(key, icon, message) {\r\n    Office.context.mailbox.item.notificationMessages.replaceAsync(key, { type: 'informationalMessage', icon: icon, message: message, persistent: false });\r\n  }\r\n\r\n  function notifyError(key, message) {\r\n    Office.context.mailbox.item.notificationMessages.replaceAsync(key, { type: 'errorMessage', message: message });\r\n  }\r\n\r\n  function displayDialog2016RTM(url, opt) {\r\n    Microsoft.Office.WebExtension.EventType = Microsoft.Office.WebExtension.EventType || {};\r\n    Microsoft.Office.WebExtension.EventType.DialogEventReceived = 'dialogEventReceived';\r\n    Microsoft.Office.WebExtension.EventType.DialogMessageReceived = 'dialogMessageReceived';\r\n\r\n    return new Promise(function (resolve, reject) {\r\n      var elBkg, elDlg;\r\n\r\n      function clearPrompt() {\r\n        if (elDlg) {\r\n          elDlg.parentElement.removeChild(elDlg);\r\n          elDlg = null;\r\n        }\r\n        if (elBkg) {\r\n          elBkg.parentElement.removeChild(elBkg);\r\n          elBkg = null;\r\n        }\r\n      }\r\n      function createPrompt(cb) {\r\n        if (!elBkg) {\r\n          elBkg = document.createElement('div');\r\n          elBkg.setAttribute('style', 'position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; background-color: rgba(198, 198, 198, 0.5); z-index: 99998;');\r\n          document.body.appendChild(elBkg);\r\n        }\r\n        if (!elDlg) {\r\n          elDlg = document.createElement('div');\r\n          elDlg.id = 'newWindowNotificaiton';\r\n          elDlg.setAttribute('role', 'dialog');\r\n          elDlg.setAttribute('style', 'width: 100%; height: 190px; position: absolute; z-index: 99999; background-color: rgb(255, 255, 255); left: 0px; top: 50%; margin-top: -95px;');\r\n\r\n          var elHead, elText, elAct, elAccept, elIgnore;\r\n          elHead = document.createElement('div');\r\n          elHead.id = 'dialogNotificationTextPanel';\r\n          elHead.setAttribute('style', 'margin: 20px 14px; font-family: &quot;Segoe UI&quot;, Arial, Verdana, sans-serif; font-size: 14px; height: 100px; line-height: 100px; padding-left: 30px;');\r\n\r\n          elText = document.createElement('span');\r\n          elText.setAttribute('style', 'display: inline-block; line-height: normal; vertical-align: middle;');\r\n          elText.textContent = (strings.promptDisplayNewWindow || strings_defaults.promptDisplayNewWindow || '').replace('$1', strings.appName || strings_defaults.appName || '');\r\n\r\n          elAct = document.createElement('div');\r\n          elAct.setAttribute('style', 'margin: 0px 9px; float: right;');\r\n\r\n          elAccept = document.createElement('input');\r\n          elAccept.type = 'button';\r\n          elAccept.setAttribute('style', 'text-align: center; width: 100px; height: 25px; font-size: 14px; font-family: Segoe UI, Arial, Verdana, sans-serif; margin: 0px 5px; border-width: 1px; border-style: solid; border-color: rgb(171, 171, 171); background-color: rgb(255, 255, 255);');\r\n          elAccept.value = strings.actionAllow || strings_defaults.actionAllow || '';\r\n          elAccept.addEventListener('click', function (ev) {\r\n            ev.preventDefault();\r\n            ev.stopPropagation();\r\n\r\n            clearPrompt();\r\n            cb(true);\r\n          });\r\n\r\n          elIgnore = document.createElement('input');\r\n          elIgnore.type = 'button';\r\n          elIgnore.setAttribute('style', 'text-align: center; width: 100px; height: 25px; font-size: 14px; font-family: Segoe UI, Arial, Verdana, sans-serif; margin: 0px 5px; border-width: 1px; border-style: solid; border-color: rgb(171, 171, 171); background-color: rgb(255, 255, 255);');\r\n          elIgnore.value = strings.actionIgnore || strings_defaults.actionIgnore || '';\r\n          elIgnore.addEventListener('click', function (ev) {\r\n            ev.preventDefault();\r\n            ev.stopPropagation();\r\n\r\n            clearPrompt();\r\n            cb(false);\r\n          });\r\n\r\n          elDlg.appendChild(elHead);\r\n          elDlg.appendChild(elAct);\r\n\r\n          elHead.appendChild(elText);\r\n\r\n          elAct.appendChild(elAccept);\r\n          elAct.appendChild(elIgnore);\r\n\r\n          document.body.appendChild(elDlg);\r\n        }\r\n      }\r\n      function checkWindow(context) {\r\n        if (context.stop) {\r\n          return;\r\n        }\r\n        if (!context.wnd || context.wnd.closed) {\r\n          context.cb();\r\n        } else {\r\n          setTimeout(checkWindow, 100, context);\r\n        }\r\n      }\r\n\r\n      opt = opt || { width: 100, height: 100, requireHTTPS: true };\r\n      var result = { value: null, status: Office.AsyncResultStatus.Failed, error: null };\r\n      createPrompt(function (res) {\r\n        if (res) {\r\n          var t, l, w, h;\r\n          w = 0 | (opt.width*window.screen.availWidth/100);\r\n          h = 0 | (opt.height*window.screen.availHeight/100);\r\n          l = 0 | ((window.screen.availWidth - w)/2);\r\n          t = 0 | ((window.screen.availHeight - h)/2);\r\n\r\n          var wnd = window.open(url, 'DialogAPI', 'width=' + w + ',height=' + h + ',top=' + t + ',left=' + l + ',resizable,scrollbars=yes');\r\n          if (!wnd) {\r\n            // result update;\r\n            reject(result);\r\n          } else {\r\n            var context = { wnd: wnd, stop: false }, handler;\r\n\r\n            result.value = {\r\n              close: function () {\r\n                context.stop = true;\r\n                if (context.wnd) {\r\n                  context.wnd.close();\r\n                  context.wnd = null;\r\n                }\r\n\r\n                handler = null;\r\n              },\r\n              addEventHandler: function (name, h) {\r\n                if (name === Microsoft.Office.WebExtension.EventType.DialogEventReceived) {\r\n                  handler = h;\r\n                }\r\n              }\r\n            };\r\n\r\n            context.cb = function () {\r\n              if (handler) {\r\n                handler({ error: 12006 });\r\n              }\r\n            };\r\n            checkWindow(context);\r\n            \r\n            result.status = Office.AsyncResultStatus.Succeeded;\r\n            resolve(result);\r\n          }\r\n        } else {\r\n          // result update;\r\n          reject(result);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  function displayDialog(url, opt) {\r\n    if (!('ui' in Office.context) || !('displayDialogAsync' in Office.context.ui)) {\r\n      return displayDialog2016RTM(url, opt);\r\n    }\r\n\r\n    return new Promise(function (resolve, reject) {\r\n      opt = opt || { width: 100, height: 100, requireHTTPS: true };\r\n      Office.context.ui.displayDialogAsync(url, opt, function (result) {\r\n        result = result || { };\r\n        result = { value: result.value, status: result.status, error: result.error };\r\n        logger.info('displayDialogAsync, opt: ' + JSON.stringify(opt) + ', result: ' + JSON.stringify(result));\r\n        if (result.status !== Office.AsyncResultStatus.Succeeded) {\r\n          reject(result);\r\n        } else {\r\n          resolve(result);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  function getCustomProp(name) {\r\n    return new Promise(function(resolve, reject) {\r\n      var action = function (customProps) {\r\n        var value = customProps.get(name);\r\n        if (!value) {\r\n          return value;\r\n        }\r\n        return JSON.parse(value);\r\n      };\r\n      Office.context.mailbox.item.loadCustomPropertiesAsync(callback(action, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function setCustomProp(name, value) {\r\n    if (typeof(value) === 'undefined') {\r\n      return delCustomProp(name);\r\n    }\r\n    return new Promise(function(resolve, reject) {\r\n      var action = function (customProps) {\r\n        customProps.set(name, JSON.stringify(value));\r\n        customProps.saveAsync(callback(null, resolve, reject));\r\n      };\r\n      Office.context.mailbox.item.loadCustomPropertiesAsync(callback(action, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function delCustomProp(name) {\r\n    return new Promise(function(resolve, reject) {\r\n      var action = function (customProps) {\r\n        customProps.remove(name);\r\n        customProps.saveAsync(callback(null, resolve, reject));\r\n      };\r\n      Office.context.mailbox.item.loadCustomPropertiesAsync(callback(action, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function save() {\r\n    return new Promise(function(resolve, reject) {\r\n      Office.context.mailbox.item.saveAsync(callback(null, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function invokeCallback(type, data) {\r\n    Office.context.mailbox.item.location.callback(type, data);\r\n  }\r\n\r\n  function execCmd0(cmd) {\r\n    return function () {\r\n      if (!office.initialized) {\r\n        return Promise.reject({ error: { nooffice: true } });\r\n      }\r\n      return cmd.apply(this, arguments); // pass provided arguments to cmd itself\r\n    };\r\n  }\r\n\r\n  function execCmd(cmd) {\r\n    var args = arguments;\r\n    return function () {\r\n      if (office.initialized === undefined) {\r\n        // return Promise.reject({ error: { nooffice: true } });\r\n        // sometimes Office.initialize is called later than checkInvite in case of auto login, \r\n        // so we need to wait a bit before reject 'not intitialized' error\r\n        return new Promise(function(resolve, reject) \r\n        {\r\n          setTimeout(function()\r\n          {\r\n             if (!office.initialized) {\r\n               reject({ error: { nooffice: true } });\r\n             } else {\r\n               resolve(cmd.apply(this, args)); // pass provided arguments to cmd itself\r\n             } \r\n          }, 500);\r\n        });\r\n      } else if (!office.initialized) {\r\n        return Promise.reject({ error: { nooffice: true } });\r\n      } else {\r\n        return cmd.apply(this, arguments); // pass provided arguments to cmd itself\r\n      }\r\n    };\r\n  }\r\n\r\n  office.checkOffice = checkOffice;\r\n  office.getDialogApi = getDialogApi;\r\n  office.getDisplayName = execCmd(getDisplayName);\r\n  office.getEmailAddress = execCmd(getEmailAddress);\r\n  office.getSubject = execCmd(getSubject);\r\n  office.setSubject = execCmd(setSubject);\r\n  office.getParties = execCmd(getParties);\r\n  office.getDescription = execCmd(getDescription);\r\n  office.setDescription = execCmd(setDescription);\r\n  office.prependDescription = execCmd(prependDescription);\r\n  office.insertDescription = execCmd(insertDescription);\r\n  office.getLocation = execCmd(getLocation);\r\n  office.setLocation = execCmd(setLocation);\r\n  office.getLanguageSync = execCmd(getLanguageSync);\r\n  office.notifyInfo = execCmd(notifyInfo);\r\n  office.notifyError = execCmd(notifyError);\r\n  office.displayDialog = execCmd(displayDialog);\r\n  office.getCustomProp = execCmd(getCustomProp);\r\n  office.setCustomProp = execCmd(setCustomProp);\r\n  office.delCustomProp = execCmd(delCustomProp);\r\n  office.save = execCmd(save);\r\n  office.invokeCallback = execCmd(invokeCallback);\r\n  office.setTranslations = setTranslations;\r\n  \r\n  module.exports = office;  \r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./office.js\n// module id = 12\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var Timer = require('./timer');\r\n\r\n  var modules = { }; \r\n  var lmodules = [];\r\n  var monitors = [];\r\n  var timer = new Timer(onTimer, 10);\r\n  \r\n  var pageUrl = location.href;\r\n  var rootUrl = getRootUrl();\r\n  var baseUrl = getBaseUrl(rootUrl, pageUrl);\r\n\r\n  function getBaseUrl(root, page) {\r\n    var url = page.replace(root, '').replace(/(\\#|\\?).*/ig, '').split('/');\r\n    // remove leading /\r\n    url.shift();\r\n    // remove trailing /\r\n    url.pop();\r\n    for (var i = 0; i < url.length; i++) {\r\n      url[i] = '..';\r\n    }\r\n    return url.join('/');\r\n  }\r\n  \r\n  function getRootUrl() {\r\n    var re = /\\/?boot\\.js/i;\r\n    var els = document.getElementsByTagName('script');\r\n    for (var i = 0; i < els.length; i++) {\r\n      var url = els[i].src;\r\n      if (re.exec(url)) {\r\n        return commonUrl(pageUrl, url);\r\n      }\r\n    }\r\n  }\r\n  function commonUrl(url1, url2) {\r\n    for (var i = 0; i < url1.length; i++) {\r\n      if (url1[i] !== url2[i]) {\r\n        return url1.substr(0, url1[i - 1] === '/' ? i - 1 : i);\r\n      }\r\n    }\r\n    return '';\r\n  }\r\n  function adjustUrl(base, url) {\r\n    if ((url[0] === '/') && (url[1] !== '/')) {\r\n      if (base === '') {\r\n        url = url.substr(1);\r\n      }\r\n      return base + url;\r\n    }\r\n    return url;\r\n  }\r\n  \r\n  function loadScript(url, isAsync) {\r\n    url = adjustUrl(baseUrl, url);\r\n    var d = document; \r\n    var j = d.createElement('script'); \r\n    j.async = isAsync; \r\n    j.src = url; \r\n    d.head.appendChild(j); \r\n  }  \r\n\r\n  \r\n  function load(url, check, cb) {\r\n    console.info('load', url);\r\n    var key = adjustUrl(rootUrl, url);\r\n    var mod = modules[key];\r\n    if (!mod) {\r\n      mod = modules[key] = { url: url, notify: [], check: check, loaded: false };\r\n      lmodules.push(mod);\r\n      if (typeof(__webpack_require__) === 'undefined') {\r\n        loadScript(url, true);\r\n      }\r\n    }\r\n    if (cb) {\r\n      mod.notify.push(cb);\r\n    }\r\n    onTimer();\r\n  }\r\n  function wait(cb) {\r\n    monitors.push(cb);\r\n    onTimer();\r\n  }\r\n  function loadMany(items, cb) {\r\n    var item = items.shift();\r\n    if (!item) {\r\n      return;\r\n    }\r\n    var i = items.length;\r\n    load(item.url, item.name, function () {\r\n      if (i) {\r\n        loadMany(items, cb);\r\n      } else {\r\n        cb();\r\n      }\r\n    });\r\n  }\r\n  \r\n  function exec(lcb) {\r\n    for (var i = 0; i < lcb.length; i++) {\r\n      lcb[i]();\r\n    }\r\n    return [];\r\n  }\r\n  function checkObject(o) {\r\n    var p = window;\r\n    for (o = o.split('.'); o.length && !!(p = p[o.shift()]);) {\r\n      p = p;\r\n    }\r\n    return !!p;\r\n  }\r\n  function checkLoaded(mod) {\r\n    if (!mod.loaded) {\r\n      var c = mod.check;\r\n      if (typeof (c) === 'function') {\r\n        mod.loaded = c();\r\n      } else if (typeof (c) === 'string') {\r\n        mod.loaded = checkObject(c);\r\n      }\r\n    }\r\n    return mod.loaded;\r\n  }\r\n  \r\n  function onTimer() {\r\n    var i, mod, mods = [];\r\n    for (var i = 0; i < lmodules.length; i++) {\r\n      mods.push(lmodules[i]);\r\n    }\r\n    for (i = 0; i < mods.length; i++) {\r\n      mod = mods[i];\r\n      if (checkLoaded(mod)) {\r\n        mod.notify = exec(mod.notify);\r\n      }\r\n    }\r\n    mods = [];\r\n    for (i = 0; i < lmodules.length; i++) {\r\n      mod = lmodules[i];\r\n      if (!mod.loaded) {\r\n        mods.push(mod);\r\n      }\r\n    }\r\n    lmodules = mods;\r\n\r\n    if (lmodules.length === 0) {\r\n      monitors = exec(monitors);\r\n    } else {\r\n      timer.start(25);\r\n    }\r\n  }\r\n  \r\n  function Loader() {\r\n  }\r\n  Loader.prototype.load = load;\r\n  Loader.prototype.loadMany = loadMany;\r\n  Loader.prototype.wait = wait;\r\n\r\n  module.exports = new Loader();\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/loader.js\n// module id = 13\n// module chunks = 0 1","  define(function (require, exports, module) {\r\n  'use strict';\r\n  \r\n  /** @constructor */\r\n  function Timer(cb, delay, arg) {\r\n    this._cb = cb;\r\n    this.start(delay, arg);\r\n  }\r\n  Timer.prototype.start = function (delay, arg) {\r\n    this.reset();\r\n    if (!delay && delay !== 0) {\r\n      return;\r\n    }\r\n    \r\n    this._timer = setTimeout(this._cb, delay, arg);\r\n  };\r\n  Timer.prototype.reset = function () {\r\n    if (this._timer) {\r\n      this._timer = clearTimeout(this._timer) || null;\r\n    }\r\n  };\r\n  \r\n  module.exports = Timer;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/timer.js\n// module id = 14\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Event = require('../../event');\r\n\r\n  function rpcMethodOneWay() {\r\n  }\r\n  function rpcMethodCallback() {\r\n  }\r\n  function rpcMethodPromise() {\r\n  }\r\n \r\n  var rpcEventBroadcast = new Event(); \r\n  var rpcEventUnicast = new Event();\r\n\r\n  var RPCSchemaDefs = {\r\n    methodOneWay: rpcMethodOneWay,\r\n    methodCallback: rpcMethodCallback,\r\n    methodPromise: rpcMethodPromise,\r\n\r\n    eventBroadcast: rpcEventBroadcast,\r\n    eventUnicast: rpcEventUnicast\r\n  };\r\n\r\n  module.exports = RPCSchemaDefs;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/chrome/rpc/schema.js\n// module id = 15\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var Base = require('../base');\r\n  var LiteralMap = require('../maps/literal');\r\n  var Guid = require('../guid');\r\n  var Promise = require('../promise');\r\n  var Utils = require('../utils');\r\n  var fetchproxy = require('../io/fetchproxy');\r\n\r\n  var chrome = require('../chrome/chrome');\r\n\r\n  var JWT = require('./jwt');\r\n  var OAuthInteractive = require('./oauth.interactive');\r\n\r\n  var authMap = new LiteralMap({\r\n    state: 'state', clientUrl: 'redirect_uri', responseType: 'response_type', clientId: 'client_id', resource: 'resource',\r\n    scope: 'scope', prompt: 'prompt', accessType: 'access_type', approvalPrompt: 'approval_prompt', loginHint: 'login_hint',\r\n    nonce: 'nonce', incremental: 'include_granted_scopes', clientSecret: 'client_secret', grantType: 'grant_type',\r\n    code: 'code', refreshToken: 'refresh_token'\r\n  });\r\n  var responseMap = new LiteralMap({\r\n    token: 'access_token', tokenType: 'token_type', idToken: 'id_token', expiry: 'expires_in', scope: 'scope', state: 'state',\r\n    accountIndex: 'authuser', accountDomain: 'hd', prompt: 'prompt', sessionState: 'session_state', code: 'code', refreshToken: 'refresh_token',\r\n  });\r\n\r\n  function encode(s) {\r\n    //return encodeURIComponent(s);\r\n    return s;\r\n  }  \r\n  function applyArgument(context, key) {\r\n    context.args.push(key + '=' + encode(context.opt[key]));\r\n    return context;\r\n  }\r\n  function prepareArgs(args) {\r\n    args = Object.getOwnPropertyNames(args).reduce(applyArgument, { args: [], opt: args }).args;\r\n    return args.join('&');\r\n  }\r\n  function prepareUrl(url, args) {\r\n    args = prepareArgs(args);\r\n    if (url.indexOf('?') === -1) {\r\n      return url + '?' + args;\r\n    } else {\r\n      return url + encodeURIComponent('?' + args);\r\n    }\r\n  }\r\n  function prepareMappedUrl(url, args) {\r\n    args = authMap.mapDirect(args);\r\n    return prepareUrl(url, args);\r\n  }\r\n\r\n  function getToken(provider, args) {\r\n    args = authMap.mapDirect(args);\r\n    args = prepareArgs(args);\r\n    Utils.showLogInfo('identity: OAuthProvider.getToken, provider: ' + (provider || { }).clientType + ', args', args);\r\n    var opt = { 'method': 'POST', 'body': args, 'headers': { 'content-type': 'application/x-www-form-urlencoded;charset=UTF-8' } }; \r\n    return fetchproxy(provider.urlToken, opt).then(function (r) {\r\n      try {\r\n        return r.json();\r\n      } catch (e) {\r\n        Utils.showLogInfo('identity: OAuthProvider.getToken, error: ' + e.message + ', r: ' + r.toString());\r\n        return Promise.reject({ error: { fetch: true } });\r\n      }\r\n    });\r\n  }\r\n  function getTokenByCode(provider, code, state) {\r\n    var args = { clientId: provider.clientId, clientSecret: provider.clientSecret, clientUrl: provider.clientUrl, grantType: 'authorization_code', code: code, state: state };\r\n    return getToken(provider, args).then(function (r) {\r\n      //debugger;\r\n      r = responseMap.mapReverse(r);\r\n      r = provider.extractInteractiveResult(r);\r\n      return r;\r\n    });\r\n  }\r\n  function getTokenByRefreshToken(provider, refreshToken) {\r\n    var args = { clientId: provider.clientId, clientSecret: provider.clientSecret, clientUrl: provider.clientUrl, grantType: 'refresh_token', refreshToken: refreshToken };\r\n    Utils.showLogInfo('identity: OAuthProvider.getTokenByRefreshToken, provider: ' + (provider || { }).clientType + ', args', args);\r\n    return getToken(provider, args).then(function (r) {\r\n      if (r && r.error) { // r = { error: { message: ..., code: ... } } if refreshToken is bad\r\n        Utils.showLogInfo('identity: OAuthProvider.getTokenByRefreshToken error', r);\r\n        return Promise.reject(); // reject no result\r\n      }\r\n      r = responseMap.mapReverse(r);\r\n      r = provider.extractInteractiveResult(r);\r\n      return r;\r\n    });\r\n  }\r\n  function getTokenInteractive(provider, opt) {\r\n    Utils.showLogInfo('identity: OAuthProvider.getTokenInteractive, provider: ' + (provider || { }).clientType + ', opt', opt, ['cancelToken'], true);\r\n    var args = provider.getInteractiveArgs(opt);\r\n    var url = opt.logout ?  provider.urlLogout : provider.urlLogin;\r\n    url = url || provider.urlLogin;\r\n    url = prepareMappedUrl(url, args);\r\n\r\n    //!! adjust no ui\r\n    opt.nosilent = true;\r\n\r\n    return OAuthInteractive({ url: url, redirect: provider.clientUrl, state: args.state, cancelToken: opt.cancelToken, noui: opt.noui, nosilent: opt.nosilent, asyncui: opt.asyncui, logout: opt.logout }).then(function (r) {\r\n      Utils.showLogInfo('identity: OAuthProvider getTokenInteractive resolved', r);\r\n      r = responseMap.mapReverse(r);\r\n      if (r.code) {\r\n        return getTokenByCode(provider, r.code, args.state);\r\n      }\r\n      r = provider.extractInteractiveResult(r);\r\n      Utils.showLogInfo('identity: OAuthProvider getTokenInteractive, extractInteractiveResult', r);\r\n      return r;\r\n    });\r\n  }\r\n  \r\n  function exec(cmd, cancel) {\r\n    var ap = [cmd];\r\n    if (cancel) {\r\n      ap.push(cancel);\r\n    }\r\n    return Promise.race(ap);\r\n  } \r\n\r\n  function validateCache(provider, opt) {\r\n    Utils.showLogInfo('identity: OAuthProvider.validateCache');\r\n    var info;\r\n    if (provider.storage) {\r\n      if (opt.primary) {\r\n        info = provider.storage.getPrimary();\r\n      } else if (opt.userId) {\r\n        info = provider.storage.getByType(provider.clientType, opt.userId);\r\n      }\r\n    }\r\n    if (info) {\r\n      if (info.accountsUrl && info.accountsUrl === provider.urlRoot) {\r\n        var dt = Date.now();\r\n        if (opt.login) {\r\n          if ((info.identity && (new Date(info.identity.expiry).valueOf() > dt + 10000)) &&\r\n            (info.token && (info.token.expiry.valueOf() > dt + 10000)))\r\n          {\r\n            Utils.showLogInfo('identity: OAuthProvider.validateCache resolve', info);\r\n            return Promise.resolve(info);\r\n          }\r\n          Utils.showLogInfo('identity: OAuthProvider.validateCache expired', { 'identityExpiry': (info.identity || { }).expiry, 'tokenExpiry': (info.token || { }).expiry });\r\n        } else {\r\n          if (info.token && (info.token.expiry.valueOf() > dt + 10000)) {\r\n            Utils.showLogInfo('identity: OAuthProvider.validateCache resolve', info);\r\n            return Promise.resolve(info);\r\n          }\r\n          Utils.showLogInfo('identity: OAuthProvider.validateCache expired', { 'tokenExpiry': (info.token || { }).expiry });\r\n        }\r\n        if (provider.supportsOffline() && info.refreshToken) {\r\n          var cmd = getTokenByRefreshToken(provider, info.refreshToken);\r\n          return exec(cmd, opt.cancelToken);\r\n        }\r\n        Utils.showLogInfo('identity: OAuthProvider.validateCache no refresh', { 'offline': provider.supportsOffline(), 'refreshToken': info.refreshToken });\r\n      }\r\n      Utils.showLogInfo('identity: OAuthProvider.validateCache no url', { 'accounts': info.accountsUrl, 'provider':  provider.urlRoot });\r\n    } else {\r\n      Utils.showLogInfo('identity: OAuthProvider.validateCache no info');\r\n    }\r\n    var err = { error: { nocache: true } };\r\n    Utils.showLogInfo('identity: OAuthProvider.validateCache reject', err);\r\n    return Promise.reject(err);\r\n  }\r\n  function validate(provider, opt) {\r\n    Utils.showLogInfo('identity: OAuthProvider.validate, provider: ' + (provider || { }).clientType + ', opt: ', opt, ['cancelToken'], true);\r\n    if (opt.token) {\r\n      if (opt.token.error) {\r\n        return Promise.reject(new Error(opt.token.error));\r\n      }\r\n      return Promise.resolve({ token: opt.token });\r\n    }\r\n    return validateCache(provider, opt).then(null, function (res) {\r\n      if (res && res.error && res.cancel) {\r\n        return Promise.reject(res);\r\n      }\r\n      var cmd = getTokenInteractive(provider, opt);\r\n      return exec(cmd, opt.cancelToken);\r\n    }).then(null, function (res) {\r\n      return Promise.reject(res);\r\n    });\r\n  }\r\n  \r\n  /** @constructor */  \r\n  function OAuthProvider() {\r\n  }\r\n  OAuthProvider.prototype.setStorage = function (storage) {\r\n    this.storage = storage;\r\n  };\r\n  OAuthProvider.prototype.initUrls = function (opt) {\r\n    opt = opt || {};\r\n    this.urlRoot = opt.urlRoot || '';\r\n    this.urlLogin = opt.urlLogin || '';\r\n    this.urlLogout = opt.urlLogout || '';\r\n    this.urlToken = opt.urlToken || '';\r\n  };\r\n  OAuthProvider.prototype.initClient = function (opt) {\r\n    opt = opt || {};\r\n    this.clientType = opt.clientType || this.clientType;\r\n    this.clientId = opt.clientId || '';\r\n    this.clientSecret = opt.clientSecret || '';\r\n    this.clientUrl = opt.clientUrl || '';\r\n  };\r\n  OAuthProvider.prototype.supportsOffline = function () {\r\n    return !!this.clientSecret;\r\n  };\r\n  OAuthProvider.prototype.supportsIncremental = function () {\r\n    return true;\r\n  };\r\n  OAuthProvider.prototype.supportsOpenId = function () {\r\n    return true;\r\n  };\r\n\r\n  OAuthProvider.prototype.applyPrompt = function (opt, args) {\r\n    var prompt = [];\r\n    if (!opt.userId) {\r\n      prompt.push('select_account');\r\n      //prompt.push('login');\r\n    }\r\n    if (opt.consent) {\r\n      prompt.push('consent');\r\n    }\r\n    prompt = prompt.join(' ');\r\n    //if (!prompt) {\r\n    //  prompt = 'none';\r\n    //}\r\n    if (prompt) {\r\n      args.prompt = prompt;\r\n    }\r\n  };\r\n  OAuthProvider.prototype.applyOffline = function (opt, args) {\r\n    if (this.supportsOffline() && opt.offline) {\r\n      args.accessType = 'offline';\r\n    }\r\n  };\r\n  OAuthProvider.prototype.applyIncremental = function (opt, args) {\r\n    if (this.supportsIncremental()) {\r\n      args.incremental = true;\r\n    }\r\n  };\r\n  OAuthProvider.prototype.applyLoginHint = function (opt, args) {\r\n    if (opt.userId) {\r\n      args.loginHint = opt.userId;\r\n    }\r\n  };\r\n  OAuthProvider.prototype.applyResponseType = function (opt, args) {\r\n    if (this.supportsOffline()) {\r\n      args.responseType = 'code';\r\n    } else if (opt.login && this.supportsOpenId()) {\r\n      args.responseType = 'token id_token';\r\n    } else {\r\n      args.responseType = 'token';\r\n    }\r\n  };\r\n  OAuthProvider.prototype.applyLoginScope = function (scope) {\r\n    scope.push('openid');\r\n    scope.push('profile');\r\n    scope.push('email');\r\n  };\r\n  OAuthProvider.prototype.applyScope = function (opt, args) {\r\n    var scopes = [];\r\n    if (opt.scopes) {\r\n      for (var i = 0; i < opt.scopes.length; i++) {\r\n        scopes.push(opt.scopes[i]);\r\n      }\r\n    }\r\n    if (opt.login) {\r\n      this.applyLoginScope(scopes);\r\n    }\r\n    args.scope = scopes.join(' ');\r\n  };\r\n  OAuthProvider.prototype.applyState = function (opt, args) {\r\n    if (opt.state) {\r\n      args.state = opt.state;\r\n    } else {\r\n      args.state = Guid.NewGuid().toString(); \r\n    }\r\n\r\n    var id = location.hostname;\r\n    if (chrome && chrome.runtime && chrome.runtime.id) {\r\n      id = chrome.runtime.id;\r\n    }\r\n\r\n    if (location.protocol === 'moz-extension:') {\r\n      id = 'MOZ:' + id;\r\n    }\r\n    if (location.protocol === 'ms-browser-extension:') {\r\n      id = 'MSE:' + id;\r\n    }\r\n    if (location.protocol === 'https:') {\r\n      var page = location.protocol + '//' + location.hostname + location.pathname;\r\n      id = page.replace(/\\/[^\\/]*\\.html/i, '/auth.html');\r\n    }\r\n\r\n    args.state = args.state + '---' + id + '---';\r\n  };\r\n  OAuthProvider.prototype.applyNonce = function (opt, args) {\r\n    args.nonce = Guid.NewGuid().toString();\r\n  };\r\n  \r\n  OAuthProvider.prototype.getInteractiveArgs = function (opt) {\r\n    var args = { clientId: this.clientId, clientUrl: this.clientUrl };\r\n\r\n    this.applyResponseType(opt, args);\r\n    this.applyLoginHint(opt, args);\r\n    this.applyIncremental(opt, args);\r\n    this.applyOffline(opt, args);\r\n    this.applyPrompt(opt, args);\r\n    this.applyScope(opt, args);\r\n    this.applyState(opt, args);\r\n    this.applyNonce(opt, args);\r\n    \r\n    return args;\r\n  };\r\n  \r\n  OAuthProvider.prototype.login = function (opt) {\r\n    opt.login = true;\r\n    return validate(this, opt);\r\n  };\r\n  OAuthProvider.prototype.logout = function (opt) {\r\n    var self = this;\r\n    if (self.storage) {\r\n      self.storage.remove(opt);\r\n    }\r\n  };\r\n\r\n  OAuthProvider.prototype.extractInteractiveResult = function (args) {\r\n    var res = { };\r\n    if (args.scope) {\r\n      res.scope = args.scope.split(' ');\r\n    }\r\n    if (args.token) {\r\n      var expiry = Date.now() + (0 | (args.expiry || 3600)) * 1000;\r\n      res.token = { token: args.token, type: args.tokenType || 'Bearer', expiry: expiry };\r\n    }\r\n    if (args.refreshToken) {\r\n      res.refreshToken = args.refreshToken;\r\n    }\r\n    if (args.idToken) {\r\n      res.identity = new JWT(args.idToken);\r\n    }\r\n    if (args.accountDomain) {\r\n      (res.account = res.account || {}).domain = args.accountDomain;  \r\n    }\r\n    if (args.accountIndex) {\r\n      (res.account = res.account || {}).index = args.accountIndex;  \r\n    }\r\n    if (args.sessionState) {\r\n      (res.account = res.account || {}).state = args.sessionState;  \r\n    }\r\n    return res;\r\n  };  \r\n\r\n  OAuthProvider.prototype.getUserInfo = function (r) {\r\n    return Promise.resolve(r);\r\n  };\r\n\r\n  OAuthProvider.prototype._getUserInfo = function (r) {\r\n    if (!r.userInfo) {\r\n      return this.getUserInfo(r);\r\n    } else {\r\n      return Promise.resolve(r);\r\n    }\r\n  };\r\n  OAuthProvider.prototype._saveUserInfo = function (r) {\r\n    if (this.storage) {\r\n      r.userId = r.userInfo.user;\r\n      r.accountsUrl = this.urlRoot;\r\n      this.storage.add(r);\r\n    }\r\n  };\r\n  OAuthProvider.prototype._applyUserInfo = function (r) {\r\n    var self = this;\r\n    return self._getUserInfo(r).then(function (r) {\r\n      self._saveUserInfo(r);\r\n      return r;\r\n    });\r\n  };\r\n\r\n  OAuthProvider.prototype.getToken = function (opt) {\r\n    Utils.showLogInfo('identity: OAuthProvider.getToken', opt, ['cancelToken'], true);\r\n    var self = this;\r\n    return validate(this, opt).then(function (r) {\r\n      Utils.showLogInfo('identity: OAuthProvider.getToken resolved', r);\r\n      if (!r.token || !r.token.token) {\r\n        var err = { error: { notoken: true } };\r\n        Utils.showLogInfo('identity: OAuthProvider.getToken reject', err);\r\n        return Promise.reject(err);\r\n      }\r\n      r.type = opt.type;\r\n      r.primary = opt.primary;\r\n\r\n      if (!opt.login) {\r\n        return r.token.token;\r\n      }\r\n      return self._applyUserInfo(r);\r\n    });\r\n  };\r\n  \r\n  module.exports = Base.extend(OAuthProvider);  \r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/id/oauth.provider.js\n// module id = 16\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n  \r\n  var dom = require('../dom');\r\n  var Control = require('./control');\r\n  \r\n  /** @constructor */\r\n  function Action(opt) {\r\n    //this.$super(opt).addClass('action').addClass(opt.cssClass).add(opt.text);\r\n    this.$super(opt);\r\n    this.addClass('action');\r\n  }\r\n  Action.prototype.create = function (opt) {\r\n    return this.node || dom.a(opt).node;\r\n  };\r\n \r\n  module.exports = Control.extend(Action);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/ui/action.js\n// module id = 17\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise      = require('/lib/jsl/promise');\r\n  var Log          = require('/lib/jsl/log');\r\n\r\n  var i18n         = require('./i18n');\r\n  var office       = require('./office');\r\n\r\n  var roomsConfig  = require('./sources/rooms/srcconfig');\r\n  var spacesConfig = require('./sources/spaces/srcconfig');\r\n\r\n  var rooms        = require('./model/rooms/model');\r\n  var spaces       = require('./model/spaces/model');\r\n\r\n  var SOURCE_SPACES = 'spaces';\r\n  var SOURCE_ROOMS = 'rooms';\r\n  var KNOWN_SOURCES = [SOURCE_SPACES, SOURCE_ROOMS];\r\n\r\n  var logger = Log.createLogger('INVITE');\r\n\r\n  var store;\r\n  var configuration;\r\n  var configuredSources;\r\n\r\n  function getStore() {\r\n    if (!store) {\r\n      store = office.getStore();\r\n      if (!store) {\r\n        throw ({ error: { nooffice: true } });\r\n      }\r\n    }\r\n    return store;\r\n  }\r\n\r\n  function getStoreItem(key) {\r\n    var item = getStore().get(key); // store: office, Storage.getItem(key);\r\n    logger.info('Get store item \\'' + key + '\\': ' + ((typeof(item) === 'undefined' || item === null) ? 'not defined' : (item && item.length ? 'length = ' + item.length : '\\'' + item.toString() + '\\'')));\r\n    return item;\r\n  }\r\n\r\n  function delStoreItem(key) {\r\n    logger.info('Remove store item \\'' + key + '\\'');\r\n    // getStore().del(key);\r\n    getStore().set(key, ''); // set empty string instead of deleting key to avoid settings.remove() call\r\n  }\r\n\r\n  function setStoreItem(key, item) {\r\n    logger.info('Set store item \\'' + key + '\\': ' + 'length = ' + item.length);\r\n    getStore().set(key, item);\r\n  }\r\n\r\n  function getConfiguration(force) {\r\n    var manual = false;\r\n    if (force) {\r\n      configuration = null;\r\n    }\r\n    if (!configuration) {\r\n      var configurationItem = getStoreItem('configuration');\r\n      if (!configurationItem) {\r\n        configurationItem = getStoreItem('configuration-manual');\r\n        manual = true;\r\n      }\r\n      if (configurationItem) {\r\n        try {\r\n          configuration = JSON.parse(configurationItem);\r\n          configuration['manual'] = manual;\r\n        } catch (e) {\r\n          logger.error('Configuration parse error: ' + e.message);\r\n        }\r\n      }\r\n      if (!configuration) {\r\n        configuration = { };\r\n      }\r\n      logger.cred('Use stored configuration: ' + JSON.stringify(configuration), configuration['Password']);\r\n    } else {\r\n      logger.cred('Use cached configuration');\r\n    }\r\n    return configuration;\r\n  }\r\n\r\n  function setConfiguration(cfg, save) {\r\n    configuration = cfg;\r\n    configuredSources = null;\r\n    if (save) {\r\n      setStoreItem('configuration-manual', JSON.stringify(configuration));\r\n    }\r\n    configuration['manual'] = true;\r\n  }\r\n\r\n  function updateMeetingInfo() {\r\n    logger.info('Force meeting info update');\r\n    office.getLocation().then(function (res) {\r\n      office.setLocation(res);\r\n    }, function (err) {\r\n      logger.error('Force meeting info update error: ', Log.getErrInfo(err));\r\n    })\r\n  }\r\n\r\n  function resetConfiguration() {\r\n    configuration = { };\r\n    configuredSources = null;\r\n    delStoreItem('configuration');\r\n    delStoreItem('configuration-manual');\r\n  }\r\n\r\n  function getConfiguredSources(force) {\r\n    if (force || !configuredSources) {\r\n      getConfiguration(force);\r\n      configuredSources = [];\r\n      var srcConfigs = { };\r\n      srcConfigs[SOURCE_ROOMS] = roomsConfig;\r\n      srcConfigs[SOURCE_SPACES] = spacesConfig;\r\n      Object.getOwnPropertyNames(srcConfigs).forEach(function (source) {\r\n        try {\r\n          var isValid = srcConfigs[source].isValid(configuration);\r\n          logger.info(source + ' configuration validation: ' + isValid);\r\n          if (isValid) {\r\n            configuredSources.push(source);\r\n          }\r\n        } catch (err) {\r\n          logger.error(source + ' configuration validation error: ', Log.getErrInfo(err));\r\n        }\r\n      });\r\n\r\n      logger.info('Use configured sources: [ ' + configuredSources.toString() + ' ]');\r\n      if (configuredSources.length === 0) {\r\n        // configuredSources = null; // need retry???\r\n        throw new Error('nosources');\r\n      }\r\n    } else {\r\n      logger.info('Use cached configured sources');\r\n    }\r\n    return configuredSources;\r\n  };\r\n\r\n  function setSpacesOpt(spaces, cfg) {\r\n    if (!cfg) {\r\n      getConfiguration();\r\n      cfg = configuration;\r\n    }\r\n    var spacesUri = cfg['AVAYA_CLOUD_SPACES_API_URI'] || cfg['AVAYA_CLOUD_SPACES_URI'];\r\n    if (spacesUri) {\r\n      spacesUri = spacesUri.replace('spaces.zang.io', 'spacesapis.zang.io');\r\n      spaces.setOpt({ url: spacesUri });\r\n    }\r\n  };\r\n\r\n function getMeetingInfo(opt) {\r\n    var getInfo = [];\r\n    if (opt.location) {\r\n      getInfo.push(office.getLocation());\r\n    }\r\n    if (opt.body) {\r\n      var type = opt.type || '';\r\n      getInfo.push(office.getDescription(type));\r\n    }\r\n    return Promise.all(getInfo);\r\n  };\r\n\r\n  function extractMeetingInfo(extractor) {\r\n    logger.info('extractMeetingInfo extractor: ' + extractor);\r\n    var sources;\r\n    var languageId = 'en'; // default languageId\r\n    return office.checkOffice().then(function () { // catch office.initialized flag\r\n      ////sources = getConfiguredSources(true);\r\n      ////if (sources.indexOf(SOURCE_SPACES) > 0) {\r\n      ////  sources = sources.slice(0);\r\n      ////  sources = sources.splice(sources.indexOf(SOURCE_SPACES), 1).concat(sources); // set spaces extractor first\r\n      ////}\r\n      sources = KNOWN_SOURCES;\r\n      logger.info('extractMeetingInfo sources: [ ' + sources.join(', ') + ' ]');\r\n      languageId = office.getLanguageSync() || languageId;\r\n      return i18n.loadI18n(languageId);\r\n    }).then(function(r) { // languageId\r\n      languageId = r;\r\n      var getters = [office.getLocation(), office.getDescription('')];\r\n      if (office.webAPI) {\r\n        getters.push(office.getDescription('html'));\r\n      }\r\n      return Promise.all(getters);\r\n    }).then(function (r) {\r\n      var location = r[0];\r\n      var bodyText = r[1];\r\n      var bodyHtml = r[2];\r\n      var extractors = [ ];\r\n      ////sources.forEach(function (name) {\r\n      ////  switch (name) {\r\n      ////    case SOURCE_SPACES:\r\n            setSpacesOpt(spaces);\r\n            extractors.push(spaces[extractor](bodyText));\r\n      ////      break;\r\n      ////    case SOURCE_ROOMS:\r\n            extractors.push(rooms[extractor](JSON.stringify(getConfiguration()), languageId, location, office.webAPI ? bodyHtml : bodyText));\r\n      ////      break;\r\n      ////  }\r\n      ////});\r\n      return Promise.all(extractors);\r\n    }).then(function (r) {\r\n      var result = [];\r\n      for (var i = 0; i < sources.length; i++) {\r\n        result.push({ source: sources[i], info: r[i]});\r\n      }\r\n      return Promise.resolve(result);\r\n    });\r\n  }\r\n\r\n  function extractMeetingInfoNative() {\r\n    logger.info('extractMeetingInfoNative');\r\n    return extractMeetingInfo('getInviteInfo').then(function (r) {\r\n      logger.info('extractMeetingInfoNative meetings: [ ' + r.map(function (info) { return JSON.stringify(info); }).join(', ') + ' ]');\r\n      for (var i = 0; i < r.length; i++) {\r\n        var info = r[i].info;\r\n        if (info && info.type !== 'empty') {\r\n           info.type = info.type || r[i].source;\r\n           info.isHost = typeof(info.isHost) === 'undefined' ? true : info.isHost;\r\n           return info;\r\n        }\r\n      }\r\n    }).catch (function (err) {\r\n      logger.error('extractMeetingInfoNative error: ', Log.getErrInfo(err));\r\n    }).then(function (info) { // finally\r\n      info = info || { };\r\n      info = { url: info.url || '', dial: info.dial || '', room: info.room || '', pin: info.pin || '', isHost: info.isHost || false, type: info.type || 'empty' };\r\n      logger.info('extractMeetingInfoNative, info: ' + JSON.stringify(info));\r\n      office.invokeCallback('meetingInfo', info);\r\n    });\r\n  }\r\n\r\n  function getJoinMeetingUrl() {\r\n    return extractMeetingInfo('getInviteUrl').then(function (r) {\r\n      logger.info('getJoinMeetingUrl urls: [ ' + r.map(function (info) { return JSON.stringify(info); }).join(', ') + ' ]');\r\n      for (var i = 0; i < r.length; i++) {\r\n        var url = r[i].info;\r\n        if (url) {\r\n          var source = r[i].source;\r\n          logger.info('getJoinMeetingUrl url: ' + url + ', source: ' + source);\r\n          return Promise.resolve({ source: source, url: url });\r\n        }\r\n      }\r\n      throw new Error('nomeetingurl');\r\n    }).catch (function (err) {\r\n      logger.error('getJoinMeetingUrl error: ' + Log.getErrInfo(err));\r\n      return Promise.resolve();\r\n    });\r\n  }\r\n\r\n  window.extractMeetingInfoNative = extractMeetingInfoNative;\r\n\r\n  function clear() {\r\n    configuration = null;\r\n    configuredSources = null;\r\n  }\r\n\r\n  document.title = 'bkgLoaded';\r\n\r\n  module.exports = {\r\n    getConfiguration: getConfiguration,\r\n    setConfiguration: setConfiguration,\r\n    resetConfiguration: resetConfiguration,\r\n    getConfiguredSources: getConfiguredSources,\r\n    updateMeetingInfo: updateMeetingInfo,\r\n    setSpacesOpt: setSpacesOpt,\r\n    getMeetingInfo: getMeetingInfo,\r\n    getJoinMeetingUrl: getJoinMeetingUrl,\r\n    clear: clear\r\n  };\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./invite.js\n// module id = 18\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var partyType = {\r\n    member: 'member',\r\n    guest: 'guest'\r\n  };\r\n\r\n  module.exports = partyType;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/parties/types.js\n// module id = 19\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var appStates = [\"Unknown\",\r\n    \"Initializing\", \"NotInitialized\", \"Initialized\",\r\n    \"Configuring\", \"NotConfigured\", \"Configured\",\r\n    \"SrcInitializing\", \"SrcNotInitialized\", \"SrcInitialized\"];\r\n\r\n  var srcStates = [\"Unknown\",\r\n    \"Initializing\", \"NotInitialized\", \"Initialized\",\r\n    \"Authorizing\", \"NotAuthorized\", \"Authorized\",\r\n    \"Unauthorizing\", \"NotUnauthorized\", \"Unauthorized\",\r\n    \"Fetching\", \"NotFetched\", \"Fetched\",\r\n    \"Checking\", \"NotChecked\", \"Checked\"];\r\n\r\n  var states = { };\r\n\r\n  states.App = appStates.reduce(function (r, n, i) {\r\n    r[n] = i;\r\n    return r;\r\n  }, { });\r\n  states.App.names = appStates;\r\n\r\n  states.Src = srcStates.reduce(function (r, n, i) {\r\n    r[n] = i;\r\n    return r;\r\n  }, { });\r\n  states.Src.names = srcStates;\r\n\r\n  module.exports = states;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./states.js\n// module id = 20\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Event = require('/lib/jsl/event');\r\n  var Promise = require('/lib/jsl/promise');\r\n  var PromiseCancel = require('/lib/jsl/promise.cancel');\r\n  var Utils = require('/lib/jsl/utils');\r\n  \r\n  var OAuth = require('/lib/jsl/id/oauth');\r\n  //var OAuthGeneric = require('/lib/jsl/id/oauth.provider');\r\n  var OAuthGoogle = require('/lib/jsl/id/oauth.provider.google');\r\n  var OAuthSalesforce = require('/lib/jsl/id/oauth.provider.salesforce');\r\n  var OAuthEsna = require('/lib/jsl/id/oauth.provider.esna');\r\n  var OAuthMicrosoft = require('/lib/jsl/id/oauth.provider.microsoft');\r\n\r\n  var OnEsna = require('../onesna/model');\r\n\r\n  var channel = require('../channel/model');\r\n\r\n  var schema = require('./schema');\r\n  var states = require('./states'); \r\n  \r\n  function updateState(identity, account, state) {\r\n    if (account.state !== state) {\r\n      Utils.showLogInfo('Identity: model.updateState', { account: account, state: state });\r\n      account.state = state;\r\n      identity.onAccount.dispatch(account);\r\n    }\r\n  }\r\n  function cancelCommand(pending, id) {\r\n    var p = pending[id];\r\n    if (!p) {\r\n      return Promise.resolve();\r\n    }\r\n    delete pending[id];\r\n    // return p.cancel();\r\n    p.cancel();\r\n    return p;\r\n  }\r\n\r\n  \r\n  /** @constructor */\r\n  function Identity() {\r\n    this.accounts = {};\r\n    this.pending = {};\r\n    this.tokens = {};\r\n\r\n    this.onesna = new OnEsna();\r\n\r\n    this.onAccount = new Event();\r\n    this.onAccounts = new Event();\r\n\r\n    this.onPrimary = new Event();\r\n\r\n    channel.onConnect.addListener(this.evConnect, this);\r\n  }\r\n  Identity.prototype._schema = schema;\r\n  Identity.prototype.state = states;\r\n  Identity.prototype.providers = { google: OAuthGoogle, esna: OAuthEsna, salesforce: OAuthSalesforce, microsoft: OAuthMicrosoft };\r\n\r\n  Identity.prototype.init = function (opt) {\r\n    this.oauth = new OAuth({ key: opt.app, allowSave: opt.allowSave });\r\n    var items = opt.providers || [];\r\n    \r\n    for (var i = 0; i < items.length; i++) {\r\n      var item = items[i];\r\n      var provider = new item.provider();\r\n      provider.init(item);\r\n      this.oauth.registerProvider(provider);\r\n    }\r\n  };\r\n  Identity.prototype.shut = function () {\r\n    this.logout();\r\n  };\r\n\r\n    \r\n  Identity.prototype.evConnect = function (portInfo) {\r\n    if (portInfo.id) {\r\n      this.onAccounts.dispatch(portInfo.id, this.accounts);\r\n    }\r\n  };\r\n\r\n  // login  \r\n  Identity.prototype.login = function (opt) {\r\n    if (!this.oauth) { // not initialized yet... (init moved from loading to get ready storage in Office case)\r\n      var providers = service.providers;\r\n      var accountsUrls = opt.accountsUrls || { };\r\n      service.init({\r\n        app: 'zangAgenda',\r\n        allowSave: true,\r\n        providers: [\r\n          // onesna\r\n          { primary: true, provider: providers.esna, client: { clientUrl: 'https://manage1.esna.com/oauth/token.redirect', clientId: '7edbde34c699f670da574d047a6d409bb74d7cfad40980d3a3d1826495548428', clientSecret: '7375341cc70b0bb02463ca2ad78782a2' }, accountsUrl: accountsUrls.esna },\r\n          // google\r\n          { primary: false, provider: providers.google, client: { clientUrl: 'https://manage1.esna.com/oauth/token.redirect', clientId: '132802444345-nni4g5350ou4afgddedcc4shofjbja70.apps.googleusercontent.com' /*clientSecret: 'HZHq0ZAzmzijXsXmSo7IQBE3'*/ } },\r\n          // office 365\r\n          //{ primary: false, provider: providers.microsoft, client: { clientUrl: 'https://manage1.esna.com/oauth/token.redirect', clientId: '472976097227.apps.googleusercontent.com' /*clientSecret: 'eXC0s4A36ONswicIvN8HNws_'*/ } },\r\n          // salesforce\r\n          //{ primary: false, provider: providers.salesforce, client: { clientUrl: 'https://manage1.esna.com/oauth/token.redirect', clientId: '472976097227.apps.googleusercontent.com' /*clientSecret: 'eXC0s4A36ONswicIvN8HNws_'*/ } },\r\n        ],\r\n        accountsUrls: opt.accountsUrls || { }\r\n      });\r\n    }\r\n    opt = opt || {};\r\n    return this.createAccount({ type: this.providers.esna.clientType, primary: true, scopes: ['https://www.onesna.com/auth/logan'], accountsUrl: (opt.accountsUrls || { }).esna, noui: opt.noui, asyncui: opt.asyncui, logout: opt.logout, token: opt.token });\r\n  };\r\n  // Logout\r\n  Identity.prototype.logout = function () {\r\n    Utils.showLogInfo('Identity: model.logout');\r\n    this.onesna.shut();\r\n    if (this.oauth) {\r\n      this.oauth.storage.clear();\r\n      return this.removeAccount({ primary: true });\r\n    } else {\r\n      return Promise.resolve();\r\n    }\r\n  };\r\n\r\n  // get token\r\n  Identity.prototype.getToken = function (opt) {\r\n    Utils.showLogInfo('Identity: model.getToken', opt);\r\n    var id = opt.primary ? 'primary' : (opt.id || ('' + Date.now()));\r\n    var account = this.accounts[id];\r\n    if (account) {\r\n      if (account.state !== states.Authorized) { // exclude state switch if Authorized (due to periodic poll requests)\r\n        updateState(this, account, states.Authorizing);\r\n      }\r\n      if (this.pending[id]) {\r\n        return this.pending[id];\r\n      }\r\n    } else {\r\n      var err = { error: { noitem: true } };\r\n      Utils.showLogInfo('Identity: model.getToken reject', err);\r\n      return Promise.reject(err);\r\n    }\r\n    \r\n    var token = this.tokens[account.id];\r\n    if (token) {\r\n      var dtn = Date.now();\r\n      token = token.token;\r\n      \r\n      if (token && (dtn < (token.expiry - 60000))) {\r\n        Utils.showLogInfo('Identity: model.getToken resolve', token);\r\n        return Promise.resolve(token);\r\n      }\r\n    }\r\n\r\n    var pc = new PromiseCancel();\r\n    var args = { type: account.info.type, primary: opt.primary, login: true, noui: true, userId: account.info.user, scopes: account.info.scopes, cancelToken: pc.token };  \r\n    var self = this;\r\n    \r\n    var cmd = this.oauth.getToken(args);\r\n    // var pending = this.pending[id] = pc.exec(cmd);\r\n    var pending = this.pending[id] = pc.exec(cmd).then(function (res) {\r\n      Utils.showLogInfo('Identity: model.getToken resolved', res);\r\n      delete self.pending[account.id];\r\n      self.tokens[account.id] = res;\r\n      updateState(self, account, states.Authorized);\r\n      Utils.showLogInfo('Identity: model.getToken resolve', res.token);\r\n      return Promise.resolve(res.token);\r\n    }, function (err) {\r\n      Utils.showLogInfo('Identity: model.getToken rejected', err);\r\n      delete self.pending[account.id];\r\n      delete self.tokens[account.id];\r\n\r\n      if (account.primary) {\r\n        self.removePrimaryAccount();\r\n      }\r\n      updateState(self, account, states.Unauthorized);\r\n      Utils.showLogInfo('Identity: model.getToken reject', err);\r\n      return Promise.reject(err);\r\n    });\r\n    return pending;\r\n  };\r\n\r\n  // providers\r\n  Identity.prototype.getProviders = function () {\r\n  };\r\n\r\n  // accounts\r\n  Identity.prototype.getPrimaryAccount = function () {\r\n    return this.accounts['primary'];\r\n  };\r\n  Identity.prototype.getAccounts = function () {\r\n    return this.accounts;\r\n  };\r\n\r\n  // account operations\r\n  Identity.prototype.createAccount = function (opt) {\r\n    Utils.showLogInfo('Identity: model.createAccount', opt);\r\n    var id = opt.primary ? 'primary' : (opt.id || ('' + Date.now()));\r\n    var account = this.accounts[id];\r\n    if (account) {\r\n      if (this.pending[id]) {\r\n        return this.pending[id];\r\n      }\r\n    } else {\r\n      var enabled = typeof (opt.enabled) === 'undefined' ? true : opt.enabled;\r\n      account = { id: id, info: { type: opt.type, primary: !!opt.primary, user: opt.user || '', enabled: enabled, scopes: opt.scopes || [] }, state: states.Unknown };\r\n      this.accounts[id] = account;\r\n    }\r\n\r\n    if (!account.info.enabled) {\r\n      updateState(this, account, states.Unauthorized);\r\n      return Promise.reject({ error: { disabled: true } });\r\n    }\r\n\r\n    var pc = new PromiseCancel();\r\n    var args = { type: account.info.type, primary: account.info.primary, login: true, noui: opt.noui, asyncui: opt.asyncui, logout: opt.logout, token: opt.token, userId: account.info.user, scopes: account.info.scopes, cancelToken: pc.token, offline: true };\r\n    var self = this;\r\n    \r\n    updateState(this, account, states.Authorizing);\r\n\r\n    var cmd = this.oauth.getToken(args);\r\n    var pending = this.pending[id] = pc.exec(cmd);\r\n    \r\n    return pending.then(function (res) {\r\n      Utils.showLogInfo('Identity: model.createAccount resolved', res);\r\n      account.info.enabled = true;\r\n      delete self.pending[account.id];\r\n\r\n      if (res.identity) {\r\n        account.info.user = res.identity.email || account.info.user;\r\n      }      \r\n      if (res.userInfo) {\r\n        account.userInfo        = account.userInfo || {};\r\n        account.userInfo.name   = res.userInfo.name;\r\n        account.userInfo.user   = res.userInfo.user;\r\n        account.userInfo.image  = res.userInfo.image;\r\n        account.info.user       = account.info.user || res.userInfo.user;\r\n      }\r\n\r\n      if (!account.info.primary) {\r\n        var ids = Object.getOwnPropertyNames(self.accounts);\r\n        for (var i = 0; i < ids.length; i++) {\r\n          var user = self.accounts[ids[i]];\r\n          if ((user.info.type === account.info.type) && (user.info.user === account.info.user) && (user.id !== account.id)) {\r\n            self.removeAccount({ id: account.id });\r\n            account = user;\r\n          }\r\n        }\r\n      }\r\n\r\n      self.tokens[account.id] = res;\r\n \r\n      if (account.info.primary) {\r\n        self.onesna.init({ sku: '', getToken: self.getToken.bind(self, { primary: true }), accountsUrl: opt.accountsUrl });\r\n        return self.onesna.loadProfileSection('accounts').then(function (r) {\r\n          //self.onesna.saveProfileSection('accounts', []).then(function (r) { }, function (r) { });\r\n\r\n          self.restoreAccounts(r).then(function (r) {\r\n          }, function (e) {\r\n          });\r\n          \r\n          self.onPrimary.dispatch({ connected: true });\r\n          \r\n          updateState(self, account, states.Authorized);\r\n          return res;\r\n        });\r\n      } else {\r\n        self.saveAccounts();\r\n      }\r\n\r\n      updateState(self, account, states.Authorized);\r\n      return Promise.resolve(res);\r\n    }, function (err) {\r\n      Utils.showLogInfo('Identity: model.createAccount rejected', err);\r\n      delete self.pending[account.id];\r\n      delete self.tokens[account.id];\r\n\r\n      if (account.primary) {\r\n        self.removePrimaryAccount();\r\n      } else if (account.info.user) {\r\n        account.info.enabled = false;\r\n        self.saveAccounts();\r\n      } else {\r\n        self.removeAccount(account);\r\n        return Promise.reject(err);\r\n      }\r\n      \r\n      updateState(self, account, states.Unauthorized);\r\n      return Promise.reject(err);\r\n    });\r\n  };\r\n  \r\n  Identity.prototype.updateAccount = function (opt) {\r\n    Utils.showLogInfo('Identity: model.getToken updateAccount', opt);\r\n    var account = this.accounts[opt.id];\r\n    if (!account) {\r\n      return Promise.reject({ error: { noitem: true } });\r\n    }\r\n\r\n    if (opt.enabled && !account.info.enabled) {\r\n      account.info.enabled = true;\r\n      account.state = states.Unknown;\r\n      updateState(this, account, states.Unauthorized);\r\n      return this.createAccount({ id: opt.id, noui: false });\r\n    } else if (!opt.enabled && account.info.enabled) {\r\n      account.info.enabled = false;\r\n      account.state = states.Unknown;\r\n      delete this.tokens[account.id];\r\n      updateState(this, account, states.Unauthorized);\r\n      this.saveAccounts();\r\n      return cancelCommand(this.pending, account.id);\r\n    }\r\n\r\n    updateState(this, account, account.state);\r\n    return Promise.resolve(account);\r\n  };\r\n  \r\n  Identity.prototype.removeAccount = function (opt, logout) {\r\n    Utils.showLogInfo('Identity: model.removeAccount', {opt: opt, logout: logout });\r\n    var id, account;\r\n    if (opt.primary) {\r\n      return this.removePrimaryAccount();\r\n    }\r\n\r\n    id = opt.id;    \r\n    account = this.accounts[id];\r\n    if (!account) {\r\n      return Promise.reject({ error: { noitem: true } });\r\n    }\r\n    \r\n    Utils.showLogInfo('Identity: model.removeAccount delete', account);\r\n    delete this.accounts[id];\r\n    account.deleted = true;\r\n    account.state = states.Unknown;\r\n\r\n    updateState(this, account, states.Unauthorized);\r\n    if (!logout) {\r\n      this.saveAccounts();\r\n    }\r\n\r\n    var args = { type: account.info.type, primary: account.info.primary, userId: account.info.user };  \r\n    this.oauth.logout(args);\r\n\r\n    return cancelCommand(this.pending, id);\r\n  };\r\n  Identity.prototype.removePrimaryAccount = function () {\r\n    Utils.showLogInfo('Identity: model.removePrimaryAccount');\r\n    this.onPrimary.dispatch({ connected: false });\r\n    \r\n    var id, account, primary;\r\n    var keys = Object.getOwnPropertyNames(this.accounts);\r\n    for (var i = 0; i < keys.length; i++) {\r\n      id = keys[i];\r\n      account = this.accounts[id];\r\n      if (!account.info.primary) {\r\n        this.removeAccount(account, true).then(function () { });\r\n      } else {\r\n        primary = account;\r\n        return this.removeAccount({ id: primary.id }, true);\r\n      }\r\n    }\r\n    return Promise.reject({ error: { noitem: true } }); // ???\r\n  };\r\n\r\n  Identity.prototype.restoreAccounts = function (accounts) {\r\n    if (!accounts) {\r\n      return Promise.resolve({ done: true });\r\n    }\r\n    var item = accounts.shift();\r\n    if (!item) {\r\n      return this.saveAccounts();\r\n    }\r\n    var self = this;\r\n    return this.createAccount({ user: item.user, type: item.type, enabled: item.enabled, scopes: item.scopes || [] }).then(function (r) {\r\n      r = r;\r\n      self.restoreAccounts(accounts);\r\n    }, function (e) {\r\n      e = e;\r\n      self.restoreAccounts(accounts);\r\n    });\r\n  };\r\n  \r\n  Identity.prototype.saveAccounts = function () {\r\n    var items = Object.getOwnPropertyNames(this.accounts);\r\n    var p = [];\r\n    for (var i = 0; i < items.length; i++) {\r\n      var item = items[i];\r\n      item = this.accounts[item];\r\n      \r\n      if (item && !item.info.primary) {\r\n        var info = { type: item.info.type, enabled: item.info.enabled, user: item.info.user, scopes: item.info.scopes };\r\n        if (info.user) {\r\n          p.push(info);\r\n        }\r\n      }\r\n    }\r\n    return this.onesna.saveProfileSection('accounts', p);\r\n  };\r\n\r\n\r\n  var service = new Identity();\r\n\r\n  module.exports = service;\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/identity/model.js\n// module id = 21\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var states = {\r\n    Unknown: 0,\r\n    Unauthorized: 1,\r\n    Authorizing: 2,\r\n    Authorized: 3,\r\n    Unauthorizing: 4,\r\n    LicenseCheck: 5,\r\n    AcceptLicense: 6,\r\n    LoadProfile: 7\r\n  };\r\n\r\n  module.exports = states;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/identity/states.js\n// module id = 22\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var Base = require('/lib/jsl/base');\r\n  var Log = require('/lib/jsl/log');\r\n\r\n  var logger = Log.createLogger('API');\r\n\r\n  function API(serverBase) {\r\n    this.serverBase = serverBase;\r\n  }\r\n  \r\n  API.prototype._prepareValue = function (def, value) {\r\n    var flags = def.flags;\r\n    if (typeof(value) === 'undefined') {\r\n      value = def.default;\r\n    }\r\n    \r\n    for (var i = 0; i < flags.length; i++) {\r\n      var flag = flags[i];\r\n      switch (flag) {\r\n        case 's':\r\n          // if (typeof(value) !== 'string') {\r\n          //   logger.warn(def.key + ': should be valid string');\r\n          // }\r\n          if (typeof(value) !== 'undefined') {\r\n            value = '' + value;\r\n          }\r\n          break;\r\n        case 'S':\r\n          // if (typeof(value) !== 'string') {\r\n          //   logger.warn(def.key + ': should be valid string');\r\n          // }\r\n          if (typeof(value) !== 'undefined') {\r\n            value = '' + value;\r\n            // if (value.length === 0) {\r\n            //   logger.warn(def.key + ': should be non-empty string');\r\n            // }\r\n          }\r\n          break;\r\n        case 'b':\r\n          // if (typeof(value) !== 'boolean') {\r\n          //   logger.warn(def.key + ': should be valid boolean');\r\n          // }\r\n          break;\r\n        case 'B':\r\n          // if (typeof(value) !== 'string') {\r\n          //   logger.warn(def.key + ': should be base64 string');\r\n          // }\r\n          if (value) {\r\n            value = atob(value);\r\n          }\r\n          value = value || '';\r\n          break;\r\n        case 'i':\r\n          if (typeof(value) !== 'number') {\r\n            // logger.warn(def.key + ': should be valid number');\r\n            value = 0 | value;\r\n          }\r\n          break;\r\n        case 'e':\r\n          // if (typeof(value) !== 'string') {\r\n          //   logger.warn(def.key + ': should be valid string');\r\n          // }\r\n          break;\r\n        case 'r':\r\n          // if (typeof(value) === 'undefined') {\r\n          //   logger.error(def.key + ': value is required');\r\n          // }\r\n          break;\r\n        case 'D':\r\n          // if (typeof(value) !== 'string') {\r\n          //   logger.warn(def.key + ': should be valid string');\r\n          // }\r\n          break;\r\n      }\r\n    }\r\n\r\n    if (def.format && (typeof(value) !== 'undefined')) {\r\n      value = def.format.replace(/\\$0/ig, value);\r\n    }\r\n\r\n    return value;\r\n  };\r\n  API.prototype._prepareArgs = function (command, args) {\r\n    var argsDefs = command.args;\r\n    var argsKeys = Object.getOwnPropertyNames(argsDefs);\r\n\r\n    var self = this;\r\n    return argsKeys.reduce(function (res, key) {\r\n      var def = argsDefs[key];\r\n      res[def.key] = self._prepareValue(def, args[key]);\r\n      return res;\r\n    }, { });\r\n  };\r\n  API.prototype._extractVars = function (template) {\r\n    var re = /\\$\\([^\\)]*\\)/ig;\r\n    for (var items = {}, m; !!(m = re.exec(template)); ) {\r\n      items[m[0]] = 1;\r\n    }\r\n    return Object.getOwnPropertyNames(items);\r\n  };\r\n  API.prototype._replaceAll = function (s, f, r) {\r\n    var re = new RegExp(f.replace(/([^a-z0-9])/ig, '\\\\$1'), 'ig');\r\n    return s.replace(re, r);\r\n  };\r\n  API.prototype._substitute = function (template, args) {\r\n    if (!template) {\r\n      return null;\r\n    }\r\n\r\n    var self = this;\r\n    var keys = Object.getOwnPropertyNames(template);\r\n    return keys.reduce(function (res, key) {\r\n      var t = template[key];\r\n      res[key] = self._extractVars(t).reduce(function (r, key) {\r\n        var v = args[key];\r\n        if (r === key) {\r\n          return v;\r\n        }\r\n        return self._replaceAll(r, key, v);\r\n      }, t);\r\n      if (typeof(res[key]) === 'undefined') {\r\n        delete res[key];\r\n      }\r\n      return res;\r\n    }, { });\r\n  };\r\n  API.prototype._extractData = function (schema, data, index) {\r\n    var self = this;\r\n    var keys = Object.getOwnPropertyNames(schema);\r\n    return keys.reduce(function (res, key) {\r\n      if (typeof(res) === 'undefined') {\r\n        return;\r\n      }\r\n\r\n      var def = schema[key];\r\n\r\n      if (Array.isArray(def)) {\r\n        res[key] = [];\r\n        var item, ndx = 0;\r\n        while (!!(item = self._extractData(def[0], data, ndx++))) {\r\n          res[key].push(item);\r\n        }\r\n      } else if (def.$v) {\r\n        res[key] = self._extractData(def.$v, data);\r\n      } else {\r\n        var path = def.key.replace(/\\.\\#\\./ig, '.' + index + '.').split('.');\r\n\r\n        var c = data;\r\n        for (var j = 0; j < path.length; j++) {\r\n          c = c[path[j]];\r\n          if (typeof(c) === 'undefined') {\r\n            if (('' + index) === path[j]) {\r\n              return;\r\n            }\r\n            break;\r\n          }\r\n        }\r\n        c = self._prepareValue(def, c);\r\n        if (typeof (c) !== 'undefined') {\r\n          res[key] = c;\r\n        }\r\n      }\r\n\r\n      return res;\r\n    }, {});\r\n  };\r\n\r\n  API.prototype._exec = function (command, args) {\r\n    var _args = this._prepareArgs(command, args);\r\n\r\n    var _body = this._substitute(command.body, _args);\r\n    var _hdrs = this._substitute(command.headers, _args);\r\n    var _uri  = this._substitute({ uri: command.uri }, _args);\r\n\r\n    var uri  = this.serverBase + _uri.uri;\r\n    var hdrs = _hdrs || {};\r\n    var body = null;\r\n    if (command.headers['content-type'] === 'application/x-www-form-urlencoded') {\r\n      body = Object.getOwnPropertyNames(_body).reduce(function (r, key) {\r\n        r.push(key + '=' + _body[key]);\r\n        return r;\r\n      }, []).join('&');\r\n    } else {\r\n      body = _body ? JSON.stringify(_body) : null;\r\n    }\r\n\r\n    var opt = { method: command.method, mode: 'cors', headers: hdrs || {}, body: body };\r\n    if (!body) {\r\n      delete opt.body;\r\n    }\r\n\r\n    var self = this;\r\n    logger.info('fetch: ' + uri);\r\n    return fetch(uri, opt).then(function (r) {\r\n      logger.info('fetch:result: ' + r.ok);\r\n      if (!r.ok) {\r\n        throw { error: { httpStatus: r.status, httpStatusText: r.statusText }};\r\n      }\r\n      return r.json();\r\n    }, function (e) {\r\n      logger.error('fetch:error: ' + e.message);\r\n      throw { error: { fetch: true }};\r\n    }).then(function (r) {\r\n      logger.info('fetch:payload: ' + JSON.stringify(r));\r\n      var res = self._extractData(command.response, r);\r\n      return res;\r\n    });\r\n  };\r\n\r\n  module.exports = Base.extend(API);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/api/api.js\n// module id = 23\n// module chunks = 0 1","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/global.js\n// module id = 24\n// module chunks = 0 1 2","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  function reverse(context, key) {\r\n    context.reverse[context.direct[key]] = key;\r\n    return context;\r\n  }\r\n  function applyProperty(context, key) {\r\n    var _key = context.map[key];\r\n    if (_key) {\r\n      var val = context.src[key];\r\n      if (typeof (val) !== 'undefined') {\r\n        context.dst[_key] = val;\r\n      }\r\n    }\r\n    return context;\r\n  }\r\n\r\n  /** @constructor */  \r\n  function LiteralMap(map) {\r\n    this.direct = map;\r\n    this.reverse = {};\r\n    Object.getOwnPropertyNames(map).reduce(reverse, this);\r\n  }\r\n  LiteralMap.prototype.mapDirect = function (src, dst) {\r\n    return Object.getOwnPropertyNames(src).reduce(applyProperty, { dst: dst || { }, src: src, map: this.direct }).dst;\r\n  };\r\n  LiteralMap.prototype.mapReverse = function (src, dst) {\r\n    return Object.getOwnPropertyNames(src).reduce(applyProperty, { dst: dst || { }, src: src, map: this.reverse }).dst;\r\n  };\r\n\r\n  module.exports = LiteralMap;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/maps/literal.js\n// module id = 25\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var globals = require('./globals');\r\n  \r\n  function hex(v) {\r\n    var n = Math.abs(v).toString(16);\r\n    return (n.length === 1) ? '0' + n : n;\r\n  }\r\n  function toUid(v) {\r\n    var r = Array.prototype.map.call(v, hex);\r\n    return r.join('').toUpperCase();\r\n  }\r\n  function toHex(s) {\r\n    var r = [];\r\n    for (var i = 0; i < s.length; i++) {\r\n      r.push(hex(s.charCodeAt(i)));\r\n    }\r\n    return r.join('');\r\n  }\r\n  function formatUid(uid) {\r\n    var s = '';\r\n    for (var i = 0; i < uid.length; i++) {\r\n      s += hex(uid[i]);\r\n      if ((i === 5) || (i === 7) || (i === 9) || (i === 11)) {\r\n        s += '-';\r\n      }\r\n    }\r\n    return s.toUpperCase();\r\n  }\r\n  function getUid() {\r\n    var r;\r\n    var crypto = globals.safeProp('crypto', { });\r\n    if (globals.hasKey('getRandomValues', crypto)) {\r\n      r = crypto.getRandomValues(new Int8Array(16));\r\n    }\r\n    if (!r) {\r\n      r = [];\r\n      for (var i = 0; i < 16; i++) {\r\n        r.push(Math.ceil(Math.random() * 255));\r\n      }\r\n    }\r\n    return r;\r\n  }\r\n\r\n  function Guid(r) {\r\n    this.guid = r;\r\n  }\r\n  Guid.prototype.toString = function () {\r\n    return formatUid(this.guid);\r\n  };\r\n  Guid.NewGuid = function () {\r\n    return new Guid(getUid());\r\n  };\r\n  \r\n  module.exports = Guid;\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/guid.js\n// module id = 26\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  /** @constructor */\r\n  function SrcConfig() {\r\n  }\r\n\r\n  SrcConfig.prototype.isValid = function(configuration) {\r\n    return !!configuration['UNIFIEDPORTALENABLED'] ||\r\n      !!configuration['CONFERENCE_MODERATOR_URL'] ||\r\n      !!configuration['CONFERENCE_PARTICIPANT_URL'];\r\n  };\r\n\r\n  module.exports = new SrcConfig();\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./sources/rooms/srcconfig.js\n// module id = 27\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var office = require('../../office');\r\n\r\n  /** @constructor */\r\n  function SrcConfig(configuration) {\r\n  }\r\n\r\n  function checkMinVersion(version, major, minor) {\r\n    console.info('checkMinVersion:', version, major, minor);\r\n    if (!version || typeof(version) !== 'string') {\r\n      return false;\r\n    }\r\n    var nums = version.split('.').map(function (num) {\r\n      return parseInt(num);\r\n    });\r\n    var numMajor = nums[0] || 0;\r\n    if (major < numMajor) {\r\n      return true;\r\n    }\r\n    if (major > numMajor) {\r\n      return false;\r\n    }\r\n    if (major < numMajor) {\r\n      return true;\r\n    }\r\n    var numMinor = nums[1] || 0;\r\n    return minor <= numMinor;\r\n  }\r\n\r\n  SrcConfig.prototype.isValid = function(configuration) {\r\n    // uncomment before 3.4 release\r\n    if (true) {\r\n    // if (office.webAPI || checkMinVersion(office.apiVersion, 3, 4)) { // check apiVersion major/minor\r\n      // this is deprecated but was referenced in SRAD\r\n      //var eac = configuration['ENABLE_AVAYA_CLOUD'];\r\n      //if (typeof(eac) === 'undefined') {\r\n      //  eac = true;\r\n      //}\r\n\r\n      // this is new way of zang enablement control\r\n      var eaca = configuration['ENABLE_AVAYA_CLOUD_ACCOUNTS'];\r\n      if (typeof(eaca) === 'undefined') {\r\n        eaca = true;\r\n      }\r\n\r\n      if (eaca) {\r\n        // SRAD change Feb 01 2018\r\n        var acl = configuration['AVAYA_CLOUD_LOGIN_ID'];\r\n        if ((typeof(acl) === 'undefined') || !!acl) {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  };\r\n\r\n  module.exports = new SrcConfig();\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./sources/spaces/srcconfig.js\n// module id = 28\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise = require('/lib/jsl/promise');\r\n  var Storage = require('/lib/jsl/storage');\r\n  var Log     = require('/lib/jsl/log');\r\n\r\n  var RoomsSettings = require('./settings');\r\n  var RoomsAPI = require('./api');\r\n  var TOM = require('./tom');\r\n  var Templates = require('./templates');\r\n\r\n  var logger = Log.createLogger('ROOMS');\r\n\r\n  function Rooms() {\r\n    this.rooms = {};\r\n  }\r\n\r\n  Rooms.prototype.setConfig = function (config) {\r\n    logger.info('setConfig, refresh: ' + config.forceRefresh);\r\n    this.config = config;\r\n    this.config.cacheKey = 'rooms.v2';\r\n    \r\n    var portalInfo = this._extractPortalInfo(this.config.portalUri);\r\n    this.config.serverBase = portalInfo.serverBase;\r\n    this.config.tenantId = portalInfo.tenantId;\r\n\r\n    this.config.conferenceRoomName = 'Default';\r\n    if (this.config.conferenceType === 'aac') {\r\n      this.config.conferenceRoomName = this.i18n.aacRoomName || 'Default AAC';\r\n      this.config.locationFormatConference = '$(bridgeNumber),,,$(room), $(conferenceJoinUrl)';\r\n    } else if (this.config.conferenceType === 'ipo') {\r\n      this.config.conferenceRoomName = this.i18n.ipoRoomName || 'Default IP Office';\r\n      this.config.locationFormatConference = '$(bridgeNumber),,,$(room), $(conferenceJoinUrl)';\r\n    }\r\n\r\n    this.config.locationFormatEquinox = '$(portalJoinUrl)$(room)$(pinE164)';\r\n\r\n    if (this.config.forceRefresh) {\r\n      this._updateTokenInfo(null);\r\n      this._updateCachedRooms(null);\r\n    }\r\n    this.roomsAPI = new RoomsAPI(config.serverBase);\r\n  };\r\n\r\n  Rooms.prototype.configure = function (configuration, languageId, i18n) {\r\n    if (this.config) {\r\n      return Promise.resolve(this.config);\r\n    }\r\n    logger.info('configure, languageId: ' + languageId);\r\n    this.i18n = i18n || this.i18n || { };\r\n    var self = this;\r\n    return RoomsSettings.getAPIConfig(configuration, languageId).then(function (config) {\r\n      self.setConfig(config);\r\n      return Promise.resolve(config);\r\n    });\r\n  };\r\n\r\n  Rooms.prototype._safeJSONParse = function (s) {\r\n    try {\r\n      return JSON.parse(s);\r\n    } catch (e) {\r\n      return {};\r\n    }\r\n  };\r\n\r\n  Rooms.prototype._extractPortalInfo = function (url) {\r\n    var re = /(https?\\:\\/\\/)?([^\\/\\:]*):?([0-9]*)?\\/?(.*tenants\\/([^\\/]*))?/i;\r\n    var m = re.exec(url);\r\n    var proto = m[1] || 'https://';\r\n    var server = m[2];\r\n\r\n    var port = m[3] || '443';\r\n    port = (port === '443') ? '' : ':' + port;\r\n\r\n    var tenantId = m[5] || 'default';\r\n      return { serverBase: proto + server + port, tenantId: tenantId };\r\n  };\r\n\r\n  Rooms.prototype._fetchTokenInfo = function () {\r\n    var key = 'token:' + this.config.user;\r\n    var stokenInfo = Storage.getItem(key);\r\n    logger.info('token, use cached token ' + key + ':' + stokenInfo);\r\n    var tokenInfo = stokenInfo ? this._safeJSONParse(stokenInfo) : null;\r\n    return tokenInfo; // comment this to skip token check & refresh\r\n    var dtn = Date.now();\r\n    if (tokenInfo && (tokenInfo.expires || 0) - dtn < 60 * 1000) {\r\n      logger.info('token, expired cached token ' + key + ':' + stokenInfo);\r\n      tokenInfo = null;\r\n      this._updateTokenInfo(null);\r\n    }\r\n    return tokenInfo;\r\n  };\r\n  Rooms.prototype._updateTokenInfo = function (info) {\r\n    var key = 'token:' + this.config.user;\r\n    if (!info) {\r\n      if (Storage.getItem(key)) {\r\n        logger.info('token, remove cached token ' + key);\r\n      }\r\n    } else {\r\n      var stokenInfo = JSON.stringify(info);\r\n      if (Storage.getItem(key) !== stokenInfo) {\r\n        Storage.setItem(key, stokenInfo);\r\n        logger.info('token, update cached token ' + key + ':' + stokenInfo);\r\n      }\r\n    }\r\n  };\r\n\r\n  Rooms.prototype.resources = function (args) {\r\n    args.tenantId = args.tenantId || this.config.tenantId;\r\n    if (args.token && this._infoUser) {\r\n      return Promise.resolve(this._infoUser);\r\n    }\r\n    if (!args.token && this._infoGuest) {\r\n      return Promise.resolve(this._infoGuest);\r\n    }\r\n    logger.info('resources: get API info args: ', Log.getInfo(args));\r\n    var self = this;\r\n    return this.roomsAPI.info(args).then(function (r) {\r\n      logger.info('resources: get API info result (' + (args.token ? 'user' : 'guest') + '):', Log.getInfo(r));\r\n      if (args.token) {\r\n        return (self._infoUser = r);\r\n      }\r\n      return (self._infoGuest = r);\r\n    }, function (e) {\r\n      logger.info('resources: get API info error: ', Log.getErrInfo(e));\r\n      if (args.token) {\r\n        self._updateTokenInfo(null);\r\n        self._infoUser = null;\r\n      } else {\r\n        self._infoGuest = null;\r\n      }\r\n      throw e;\r\n    });\r\n  };\r\n\r\n  Rooms.prototype._login = function (args) {\r\n    var info = this._infoGuest || { };\r\n    var dfd;\r\n    if (info.iwaEnabled) {\r\n      logger.info('login: API loginIWA');\r\n      dfd = self.roomsAPI.loginIWA(args);\r\n    } else {\r\n      dfd = Promise.reject();\r\n    }\r\n    var self = this;\r\n    return dfd.then(function (r) {\r\n      return r;\r\n    }, function () {\r\n    logger.info('login: API login');\r\n    return self.roomsAPI.login(args);\r\n  });\r\n  };\r\n\r\n  Rooms.prototype._getToken = function () {\r\n    var tokenInfo;\r\n    var self = this;\r\n    // always start with resources call\r\n    return this.resources({ }).then(function () {\r\n      tokenInfo = self._fetchTokenInfo(); // allows to skip token check & refresh (see above)\r\n      if (tokenInfo) {\r\n        var args = { tenantId: self.config.tenantId, token: tokenInfo.token, userId: self.config.user, passwordHash: tokenInfo.passwordHash, aliasId: self.config.tenantId };\r\n        // check vaild token or refresh expired one via password hash\r\n        return self.roomsAPI.refreshToken(args).then(function (r) {\r\n          logger.info('getToken: cached token is valid');\r\n          if (tokenInfo.token !== r.token) {\r\n            // store refreshed token\r\n            tokenInfo = { token: r.token, expires: new Date(r.expires).valueOf(), passwordHash: r.passwordHash };\r\n            logger.info('getToken: token refresh result: ', Log.getInfo(tokenInfo));\r\n            self._updateTokenInfo(tokenInfo);\r\n          }\r\n          return Promise.resolve(true); // valid token, no login required\r\n        }, function (e) {\r\n          logger.info('getToken: cached token is invalid, error: ', Log.getErrInfo(e));\r\n          return Promise.resolve(false); // invalid token, try login with user credentials\r\n        })\r\n      } else {\r\n        return Promise.resolve(false); // no token info, try login with user credentials\r\n      }\r\n    }).then( function (r) {\r\n      if (r) {\r\n        return Promise.resolve();\r\n      }\r\n      // perform login\r\n      var args = { userId: self.config.user, password: self.config.password, tenantId: self.config.tenantId, aliasId: self.config.tenantId };\r\n      logger.cred('getToken: login: ' + Log.getInfo(args), args['password']);\r\n      return self._login(args).then(function (r) {\r\n        // store new token\r\n        tokenInfo = { token: r.token, expires: new Date(r.expires).valueOf(), passwordHash: r.passwordHash };\r\n        logger.info('getToken: login result: ', Log.getInfo(tokenInfo));\r\n        self._updateTokenInfo(tokenInfo);\r\n      }, function (e) {\r\n        logger.error('getToken: login error: ', Log.getErrInfo(e));\r\n        self._updateTokenInfo(null);\r\n        return Promise.reject(e, true);\r\n      });\r\n    }).then(function (r) {\r\n      return self.resources({ token: tokenInfo.token });\r\n    }, function (e, f) {\r\n      if (!f) { // just skip already logged errors\r\n        logger.error('getToken: error: ', Log.getErrInfo(e));\r\n      }\r\n      throw e;\r\n    }).then(function () { // should never get here without without valid token\r\n      return tokenInfo.token;\r\n    });\r\n  };\r\n\r\n  Rooms.prototype.login = function () {\r\n    return this._getToken().then(function () {\r\n      return Promise.resolve(); // just to not return token as result\r\n    }, function (err) {\r\n      throw err;\r\n    });\r\n  };\r\n\r\n  Rooms.prototype.logout = function () {\r\n    delete this.config;\r\n    RoomsSettings.clear();\r\n    return Promise.resolve();\r\n  }\r\n\r\n  var _cacheVersion = 20170622;\r\n  Rooms.prototype._fetchCachedRooms = function () {\r\n    var srooms = Storage.getItem(this.config.cacheKey + ':' + this.config.user);\r\n    var rooms = this._safeJSONParse(srooms) || {};\r\n    var dtn = Date.now();\r\n    if ((rooms.expires || 0) - dtn > 60*1000) {\r\n      if (!rooms.version || (rooms.version < _cacheVersion)) {\r\n        return null;\r\n      }\r\n      return rooms;\r\n    }\r\n    return null;\r\n  };\r\n  Rooms.prototype._updateCachedRooms = function (rooms) {\r\n    if (rooms) {\r\n      rooms.expires = Date.now() + 30*60*1000;\r\n      rooms.version = _cacheVersion;\r\n    }\r\n    var srooms = JSON.stringify(rooms || {});\r\n    Storage.setItem(this.config.cacheKey + ':' + this.config.user, srooms);\r\n  };\r\n  \r\n  Rooms.prototype._addConferenceRoom = function (rooms) {\r\n    var url = this.config.conferenceParticipantUrl || this.config.conferenceModeratorUrl || '';\r\n    var pin = this.config.conferenceParticipantPIN || this.config.conferenceModeratorPIN || '';\r\n\r\n    if (!url) {\r\n      logger.info('getRooms: no conference room with empty conference url');\r\n      return rooms;\r\n    }\r\n\r\n    var room = pin || ((/(\\/|participantCode=)([0-9]+)/i.exec(url) || [])[2]) || '';\r\n    this.config.conferenceParticipantPIN = room;\r\n    \r\n    rooms.push({ id: room || 'default', name: this.config.conferenceRoomName, meetingId: room || '', number: room || '', conferenceAccessUrl: url, type: this.config.conferenceType, conferenceAccessNumber: this.config.bridgeNumber, own: true });\r\n\r\n    return rooms;\r\n  };\r\n\r\n  var _delegateMapping = {\r\n    // test ones\r\n    'sergeyv': ['georgeu'],\r\n  };\r\n\r\n  Rooms.prototype.__getRooms = function (args) {\r\n    if (!args._users) {\r\n      var delegateName = this.config.delegateName;\r\n      if (delegateName) {\r\n        args._users = [ delegateName, args.userId ];\r\n      } else {\r\n        args._users = (_delegateMapping[args.userId] || []).concat(args.userId);\r\n      }\r\n    }\r\n\r\n    args.userId = args._users.shift();\r\n\r\n    var self = this;\r\n    logger.info('getRooms: API getRooms');\r\n    return this.roomsAPI.getRooms(args).then(function (r) {\r\n      r.rooms = r.rooms.map(function (room) {\r\n        room.userId = args.userId;\r\n        return room;\r\n      });\r\n\r\n      if (!args._result) {\r\n        args._result = r;\r\n      } else {\r\n        args._result.rooms = args._result.rooms.concat(r.rooms);\r\n      }\r\n\r\n      if (!args._users.length) {\r\n        return args._result;\r\n      }\r\n\r\n      return self.__getRooms(args);\r\n    });\r\n  };\r\n\r\n  Rooms.prototype._getRooms = function (args) {\r\n    logger.info('getRooms: ' + JSON.stringify(args));\r\n    if (this.config.mode !== 'equinox') {\r\n      logger.info('getRooms resolve: no virtual rroms in non-equinox mode');\r\n      return Promise.resolve({ rooms: [] });\r\n    }\r\n\r\n    if (!args.forceFetch) {\r\n      var rooms = this._fetchCachedRooms();\r\n      if (rooms) {\r\n        logger.info('getRooms resolve: cached rooms');\r\n        return Promise.resolve(rooms);\r\n      }\r\n      if (args.cachedOnly) {\r\n        return Promise.resolve({ rooms: [] });\r\n      }\r\n    }\r\n    \r\n    var self = this;\r\n    return this._getToken().then(function (r) {\r\n      args.token = r;\r\n      args.tenantId = self.config.tenantId;\r\n      args.aliasId = self.config.tenantId;\r\n      args.userId = self.config.user;\r\n      return self.__getRooms(args);\r\n    }).then(function (r) {\r\n      self._updateCachedRooms(r);\r\n      logger.info('getRooms resolve: fetched rooms');\r\n      return r;\r\n    }, function (err) {\r\n      logger.error('getRooms error: ' + Log.getErrInfo(err));\r\n      self._updateCachedRooms(null);\r\n      self._updateTokenInfo(null);\r\n      if (!args.retry && (err.error && !(err.error.httpStatus === 400 || err.error.httpStatus === 401))) {\r\n        args.retry = true;\r\n        return self.getRooms(args);\r\n      }\r\n      throw err;\r\n    });\r\n  };\r\n\r\n  Rooms.prototype.getRooms = function (args) {\r\n    var self = this;\r\n    return this._getRooms(args).then(function (r) {\r\n      var rooms = r.rooms.map(function (room) {\r\n        var ruserId = (room.userId || '').toLowerCase();\r\n        var cuserId = (self.config.user || '').toLowerCase();\r\n\r\n        return {\r\n          id: room.id, name: room.name, conferenceAccessNumber: '',\r\n          meetingId: room.number, conferenceAccessUrl: room.url || self.config.portalUri,\r\n          accessPIN: room.accessPIN, type: 'equinox', own: (ruserId === cuserId), userId: room.userId,\r\n        };\r\n      });\r\n      rooms = self._addConferenceRoom(rooms);\r\n\r\n      self.rooms = { };\r\n      rooms.forEach(function (room) {\r\n        self.rooms[room.id] = room;\r\n      });\r\n\r\n      return Promise.resolve(rooms);\r\n    });\r\n  };\r\n\r\n  Rooms.prototype._replaceAll = function (s, f, r) {\r\n    var re = new RegExp(f.replace(/([^a-z0-9])/ig, '\\\\$1'), 'ig');\r\n    return s.replace(re, r);\r\n  };\r\n\r\n  Rooms.prototype._patchDialInfo = function (dialingInfo, args) {\r\n    var bridgeNumber = this.config.bridgeNumber || '';\r\n    var location = args.conference ? this.config.locationFormatConference : this.config.locationFormatEquinox;\r\n    location = this._replaceAll(location, '$(bridgePrefix)', (this.config.bridgePrefix || ''));\r\n    location = this._replaceAll(location, '$(bridgeNumber)', (bridgeNumber || ''));\r\n\r\n    if (args.conference) {\r\n      var room = args.dialableNumber || '';\r\n      if (room && (room[room.length - 1] !== '#')) {\r\n        room += '#';\r\n      }\r\n      location = this._replaceAll(location, '$(room)', room);\r\n\r\n      location = this._replaceAll(location, '$(conferenceJoinUrl)', (this.config.conferenceParticipantUrl || ''));\r\n    } else {\r\n      location = this._replaceAll(location, '$(room)', (args.dialableNumber || ''));\r\n      location = this._replaceAll(location, '$(pinE164)', (args.accessPIN ? '***' + atob(args.accessPIN) : ''));\r\n      location = this._replaceAll(location, '$(pin)', (args.accessPIN ? atob(args.accessPIN) : ''));\r\n\r\n      var portal = this.config.serverBase + '/portal/tenants/' + this.config.tenantId + '/?ID=';\r\n      location = this._replaceAll(location, '$(portalJoinUrl)', (portal || ''));\r\n    }\r\n    if (!bridgeNumber) {\r\n      location = location.substr(location.indexOf('http'));\r\n    }\r\n    location = location.trim();\r\n    dialingInfo.location = location;\r\n\r\n    var numbers = args.conference ? this.config.additionalNumbers : '';\r\n    if (!numbers) {\r\n      return;\r\n    }\r\n\r\n    dialingInfo.dialingInfoText = typeof(dialingInfo.dialingInfoText) === 'undefined' ? '' : (dialingInfo.dialingInfoText + '\\n');\r\n    dialingInfo.dialingInfoHTML  = '<div>' + dialingInfo.dialingInfoHTML;\r\n    dialingInfo.dialingInfoHTML += '<div><br/>';\r\n\r\n    if (args.additionalNumbersTitle) {\r\n      dialingInfo.dialingInfoText += args.additionalNumbersTitle;\r\n      dialingInfo.dialingInfoText += '\\n';\r\n\r\n      dialingInfo.dialingInfoHTML += args.additionalNumbersTitle;   \r\n      dialingInfo.dialingInfoHTML += '<br/>';   \r\n    }\r\n\r\n    numbers.split(',').forEach(function (item) {\r\n      var kv = item.split(':');\r\n      dialingInfo.dialingInfoText += kv[0] + ' ' + kv[1];\r\n      dialingInfo.dialingInfoText += '\\n';\r\n\r\n      dialingInfo.dialingInfoHTML += kv[0] + '&nbsp;' + kv[1];   \r\n      dialingInfo.dialingInfoHTML += '<br/>';\r\n    });\r\n    dialingInfo.dialingInfoHTML += '</div>';\r\n    dialingInfo.dialingInfoHTML += '</div>';\r\n  };\r\n\r\n  Rooms.prototype.getDialInfoCustom = function (args) {\r\n    logger.info('getDialInfoCustom');\r\n    var self = this;\r\n    var type = (args.conference ? 'aac' : 'scopia');\r\n    var langId = self.config.languageId;\r\n    var opt = { html: true, logger: logger, i18n: self.i18n, langId: langId };\r\n    return new Templates(opt).getTemplate(type).then(function (r) {\r\n      var content = r;\r\n      var bridgeNumber = self.config.bridgeNumber || '';\r\n      content = self._replaceAll(content, '$(bridgePrefix)', (self.config.bridgePrefix || ''));\r\n      content = self._replaceAll(content, '$(bridgeNumber)', (bridgeNumber || ''));\r\n\r\n      if (args.conference) {\r\n        var room = args.dialableNumber || '';\r\n        if (room && (room[room.length - 1] !== '#')) {\r\n          room += '#';\r\n        }\r\n        content = self._replaceAll(content, '$(room)', room);\r\n\r\n        var typeLabel = '';\r\n        if (self.config.conferenceType === 'aac') {\r\n          typeLabel = self.i18n.aacLabel;\r\n        } else if (self.config.conferenceType === 'ipo') {\r\n          typeLabel = self.i18n.ipoLabel;\r\n        }\r\n        content = self._replaceAll(content, '$(conferenceType)', (typeLabel || ''));\r\n      } else {\r\n        content = self._replaceAll(content, '$(room)', (args.dialableNumber || ''));\r\n        content = self._replaceAll(content, '$(pinE164)', (args.accessPIN ? '***' + atob(args.accessPIN) : ''));\r\n        content = self._replaceAll(content, '$(pin)', (args.accessPIN ? atob(args.accessPIN) : ''));\r\n        content = self._replaceAll(content, '$(roomName)', (args.name || ''));\r\n      }\r\n      var portal = self.config.serverBase + '/portal/tenants/' + self.config.tenantId + '/?ID=';\r\n      content = self._replaceAll(content, '$(portalJoinUrl)', (portal || ''));\r\n\r\n      var scopiaUrl = (self._infoUser || self._infoGuest || {}).scopiaUrl;\r\n      scopiaUrl = null;\r\n      if (!scopiaUrl) {\r\n        scopiaUrl = self.config.serverBase + '/portal/tenants/' + self.config.tenantId + '/';\r\n      }\r\n      var scopiaBaseUrl = (/https?\\:\\/\\/[^\\/]*/i.exec(scopiaUrl) || [])[0] || '';\r\n      var scopiaJoinUrl = scopiaUrl + '?ID=';\r\n\r\n      content = self._replaceAll(content, '$(conferenceJoinUrl)', (self.config.conferenceParticipantUrl || ''));\r\n      content = self._replaceAll(content, '$(scopiaBaseUrl)', scopiaBaseUrl);\r\n      content = self._replaceAll(content, '$(scopiaJoinUrl)', scopiaJoinUrl);\r\n      content = self._replaceAll(content, '$(autojoin)', args.autojoin ? '&amp;autojoin' : '');\r\n  \r\n      var dialingInfo = { };\r\n      dialingInfo.dialingInfoHTML = content;\r\n      return Promise.resolve(dialingInfo);\r\n    });\r\n  };\r\n\r\n  Rooms.prototype._compareVersion = function (v1, v2) {\r\n    for (var i = 0; i < v1.length; i++) {\r\n      var xv1 = 0 | (v1[i] || '0');\r\n      var xv2 = 0 | (v2[i] || '0');\r\n      var x = xv1 - xv2;\r\n      if (x) {\r\n        return x;\r\n      }\r\n    }\r\n    return 0;\r\n  };\r\n\r\n  \r\n  Rooms.prototype._isGetDialInfoFromPortalSupported = function (args) {\r\n    if (args.conference) {\r\n      return false;\r\n    }\r\n    var version = (this._infoGuest || this._infoUser || {}).portalVersion || '';\r\n    var versionBase = '3.2.0.0.228';\r\n    if (this._compareVersion(version.split('.'), versionBase.split('.')) < 0) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  Rooms.prototype.getDialInfo = function (args) {\r\n    if (args.accessPIN) {\r\n      args.accessPIN = btoa(args.accessPIN);\r\n    }\r\n    return this.getDialInfoPatched(args);\r\n  };\r\n\r\n  Rooms.prototype.getDialInfoPatched = function (args) {\r\n    var self = this;\r\n    if (self.config.mode !== 'equinox') {\r\n      return self.getDialInfoWithRetry(args, true);\r\n    }\r\n    return self.resources({ }).then(function (r) {\r\n      if (!self._isGetDialInfoFromPortalSupported(args)) {\r\n        return self.getDialInfoWithRetry(args, true);\r\n      }\r\n\r\n      return self._getToken().then(function (r) {\r\n        args.token = r;\r\n        args.tenantId = self.config.tenantId;\r\n        return self.getDialInfoWithRetry(args);\r\n      }, function (e) {\r\n        self._updateTokenInfo(null);\r\n        if (!args.retry) {\r\n          args.retry = true;\r\n          return self.getDialInfoPatched(args);\r\n        }\r\n        throw e;\r\n      });\r\n    }, function (e) {\r\n      return self.getDialInfoWithRetry(args, true);\r\n    });\r\n    \r\n  };\r\n  Rooms.prototype.getDialInfoWithRetry = function (args, fallBack) {\r\n    var deferred;\r\n    if (fallBack) {\r\n      deferred = this.getDialInfoCustom(args);\r\n    } else {\r\n      logger.info('getDialInfo: API getDialInfo');\r\n      deferred = this.roomsAPI.getDialInfo(args);\r\n    }\r\n\r\n    var self = this;\r\n    return deferred.then(function (r) {\r\n      if (!r.location) {\r\n        self._patchDialInfo(r, args);\r\n      }\r\n      return r;\r\n    }, function (e) {\r\n      if (!fallBack) {\r\n        return self.getDialInfoWithRetry(args, true);\r\n      }\r\n      throw e;\r\n    });\r\n  };\r\n\r\n  Rooms.prototype.getTopics = function () {\r\n    var res = Object.getOwnPropertyNames(this.rooms).reduce(function (r, key) {\r\n      var room = r.rooms[key];\r\n      r.result.push({ id: room.id, title: room.name, room: room });\r\n      return r;\r\n    }, { result: [], rooms: this.rooms }).result;\r\n    return { items: res };\r\n  };\r\n  Rooms.prototype.getTopic = function (id) {\r\n    var room = this.rooms[id];\r\n    if (room) {\r\n      return { id: room.id, title: room.name, room: room };\r\n    }\r\n  };\r\n\r\n  Rooms.prototype.createInvite = function (invite) {\r\n    var room = this.rooms[invite.id];\r\n    var self = this;\r\n    return this.getDialInfo({ name: room.name, accessPIN: room.accessPIN, dialableNumber: room.meetingId, conference: room.type !== 'equinox', additionalNumbersTitle: this.i18n.additionalNumbersTitle }).then(function (r) {\r\n      var meeting = { 'location': r.location, 'body': r.dialingInfoText || r.dialingInfoHTML };\r\n      var meetingInfo = TOM.extractMeetingInfo(self.config.settings, self.rooms, meeting);\r\n      var joinUrl = TOM.getJoinMeetingUri(meetingInfo);\r\n      var info = {\r\n        topicId: invite.id,\r\n        topicTitle: room.name,\r\n        conferenceAccessNumber: room.conferenceAccessNumber,\r\n        meetingId: room.type === 'equinox' ? room.meetingId : '',\r\n        conferenceAccessUrl: room.conferenceAccessUrl,\r\n        joinUrl: joinUrl\r\n      };\r\n      var res = { id: room.id, type: room.type, location: r.location, content: { 'text': r.dialingInfoText, 'html': r.dialingInfoHTML }, info: info};\r\n      logger.info('createInvite res: ' + JSON.stringify(res));\r\n      return Promise.resolve(res);\r\n    });\r\n  };\r\n\r\n  Rooms.prototype.getInviteInfo = function (configuration, languageId, location, body) {\r\n    var config;\r\n    var self = this;\r\n    var rooms;\r\n    return this.configure(configuration, languageId).then(function (r) {\r\n      config = r;\r\n      return self._getRooms({ });\r\n    }).then(function (r) {\r\n      rooms = (r.rooms || []).map(function (room) {\r\n        var pin = room.accessPIN;\r\n        return { id: room.id, name: room.name, meetingId: room.number, conferenceAccessUrl: room.url, accessPIN: pin || '', moderatorPIN: room.moderatorPIN };\r\n      });\r\n    }, function (err) {\r\n      logger.error('getInviteInfo error: ' + Log.getErrInfo(err));\r\n      rooms = [];\r\n    }).then(function () {\r\n      var meeting = { 'location': location, 'body': body };\r\n      var res = TOM.extractMeetingInfo(config.settings, rooms, meeting)\r\n      logger.info('getInviteInfo res: ' + JSON.stringify(res));\r\n      return Promise.resolve(res);\r\n    });\r\n  };\r\n\r\n  Rooms.prototype.getInviteUrl = function (configuration, languageId, location, body) {\r\n    var self = this;\r\n    return this.getInviteInfo(configuration, languageId, location, body).then(function (r) {\r\n      return Promise.resolve(TOM.getJoinMeetingUri(r));\r\n    });\r\n  };\r\n\r\n  Rooms.prototype.checkInvite = function (configuration, languageId, location, body) {\r\n    var self = this;\r\n    return this.getInviteInfo(configuration, languageId, location, body).then(function (r) {\r\n      if (!r || r.type === 'empty') {\r\n        return Promise.resolve(null);\r\n      }\r\n      var inviteId;\r\n      var ids = Object.getOwnPropertyNames(self.rooms);\r\n      for (var i = 0; i < ids.length; i++) {\r\n        var id = ids[i];\r\n        if ((self.rooms[id].meetingId === r.room) || (r.url && self.rooms[id].conferenceAccessUrl === r.url)) {\r\n          inviteId = id;\r\n          break;\r\n        }\r\n      }\r\n      if (!inviteId) {\r\n        return Promise.resolve(null);\r\n      }\r\n      var room = self.rooms[inviteId];\r\n      var joinUrl = TOM.getJoinMeetingUri(r);\r\n      var info = {\r\n        topicId: inviteId,\r\n        topicTitle: room.name,\r\n        conferenceAccessNumber: room.conferenceAccessNumber,\r\n        meetingId: room.type === 'equinox' ? room.meetingId : '',\r\n        conferenceAccessUrl: room.conferenceAccessUrl,\r\n        joinUrl: joinUrl\r\n      };\r\n      var res = { id: inviteId, isHost: r.isHost, info: info };\r\n      logger.info('checkInvite res: ' + JSON.stringify(res));\r\n      return Promise.resolve(res);\r\n    });\r\n  };\r\n\r\n  module.exports = new Rooms();\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/rooms/model.js\n// module id = 29\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise = require('/lib/jsl/promise');\r\n  var Log     = require('/lib/jsl/log');\r\n  var Event   = require('/lib/jsl/event');\r\n  var Timer   = require('/lib/jsl/timer');\r\n  var Utils   = require('/lib/jsl/utils');\r\n\r\n  var schema = require('./schema');\r\n\r\n  var identity = require('../identity/model');\r\n  var identityStates = require('../identity/states');\r\n\r\n  var modelParties = require('../parties/model');\r\n  var modelPartiesTypes = require('../parties/types');\r\n\r\n  var ZangSpaces = require('./spaces');\r\n\r\n  var logger = Log.createLogger('SPACES');\r\n\r\n  function Spaces() {\r\n    this.onTopic = new Event();\r\n    this.onReady = new Event();\r\n    this.onSearch = new Event();\r\n\r\n    this.service = new ZangSpaces();\r\n    this.evTimer = this.evTimer.bind(this);\r\n    this.reschedule = this.reschedule.bind(this);\r\n    this.pollTopics = this.pollTopics.bind(this);\r\n\r\n    identity.onAccount.addListener(this.evAccount, this);\r\n  }\r\n  Spaces.prototype._schema = schema;\r\n  \r\n  Spaces.prototype.setOpt = function (opt) {\r\n    logger.info('setOpt: ' + JSON.stringify(opt));\r\n    this.opt = opt || {};\r\n  };\r\n  Spaces.prototype.init = function (opt) {\r\n    logger.info('init: ' + JSON.stringify(opt));\r\n    this.opt = opt || {};\r\n    this.topics = {};\r\n    this.service.init(opt);\r\n    this.timer = new Timer(this.evTimer);\r\n    this.lastUpdate = 0;\r\n\r\n    // this.refresh(); // do not start pollTopics on init\r\n  };\r\n  Spaces.prototype.shut = function () {\r\n    this.topics = {};\r\n    this.service.shut();\r\n    if (this.timer) {\r\n      this.timer.reset();\r\n      this.timer = null;\r\n    }\r\n    this.lastUpdate = 0;\r\n  };\r\n  Spaces.prototype.evAccount = function (account) {\r\n    if (!account || account.info.type !== 'esna') {\r\n      return;\r\n    }\r\n    // so far supporting only primary account\r\n    if (!account.info.primary) {\r\n      return;\r\n    }\r\n\r\n    if (account.state === identityStates.Authorized) {\r\n      var opt = this.opt || { };\r\n      opt.user = account.info.user;\r\n      opt.token = identity.getToken.bind(identity, { id: account.id, primary:  account.id === 'primary' });\r\n      this.init(opt);\r\n    } else {\r\n      this.shut();\r\n    }\r\n  };\r\n\r\n  Spaces.prototype.pollTopics = function (r) {\r\n    Utils.showLogInfo('spaces: model.pollTopics', r ? { next: r.next, items: (r.items || []).length } : r);\r\n    if (!this.service.opt) {\r\n      Utils.showLogInfo('spaces: model.pollTopics skip', 'service not configured or shutted down');\r\n      this.onReady.dispatch({ skip: true });\r\n      return Promise.resolve({ skip: true });\r\n    }\r\n    if (!r) {\r\n      var dtn = Date.now();\r\n      if (dtn - this.lastUpdate < 5 * 60000) {\r\n        Utils.showLogInfo('spaces: model.pollTopics skip', 'topics are up to date');\r\n        this.onReady.dispatch({ skip: true });\r\n        return Promise.resolve({ skip: true });\r\n      }\r\n      return this.service.fetchTopics().then(this.pollTopics);\r\n    }\r\n    \r\n    this.lastUpdate = Date.now();\r\n    for (var i = 0; i < r.items.length; i++) {\r\n      this.reportTopic(r.items[i]);\r\n    }\r\n    if (r.next) {\r\n      return this.service.fetchTopics({ url: r.next }).then(this.pollTopics);\r\n    }\r\n    this.onReady.dispatch({ done: true });\r\n    return Promise.resolve({ done: true });\r\n  };\r\n  Spaces.prototype.reportTopic = function (topic) {\r\n    if (!topic.selfMember) {\r\n      Utils.showLogInfo('spaces: model.reportTopic skip', 'role: guest, id: ' + topic.id);\r\n      return;\r\n    }\r\n    this.topics[topic.id] = topic;\r\n    this.onTopic.dispatch({ item: topic });\r\n  };\r\n  \r\n  Spaces.prototype.reschedule = function () {\r\n    // periodic polling switched off\r\n    //if (this.timer) {\r\n    //  this.timer.start(60000);\r\n    //}\r\n  };\r\n  Spaces.prototype.evTimer = function () {\r\n    if (this.timer) {\r\n      Utils.showLogInfo('spaces: model.evTimer');\r\n      this.timer.reset();\r\n      return this.pollTopics().then(this.reschedule, this.reschedule);\r\n    }\r\n  };\r\n\r\n  \r\n  Spaces.prototype.refresh = function () {\r\n    Utils.showLogInfo('spaces: model.refresh');\r\n    this.lastUpdate = 0;\r\n    return this.evTimer();\r\n  };\r\n  Spaces.prototype.getTopics = function () {\r\n    Utils.showLogInfo('spaces: model.getTopics');\r\n    var res = Object.getOwnPropertyNames(this.topics).reduce(function (r, key) {\r\n      r.result.push(r.topics[key]);\r\n      return r;\r\n    }, { result: [], topics: this.topics }).result;\r\n    return { items: res };\r\n  };\r\n  Spaces.prototype.getTopic = function (id) {\r\n    return this.topics[id];\r\n  };\r\n\r\n  Spaces.prototype.searchTopics = function () {\r\n  };\r\n\r\n  Spaces.prototype.createTopic = function (topic) {\r\n    if (!topic.parties) {\r\n      var parties = modelParties.getParties();\r\n      var partiesType = modelParties.getPartiesType();\r\n      modelParties.clear();\r\n\r\n      var keys = Object.getOwnPropertyNames(parties);\r\n      var p = [];\r\n      for (var i = 0; i < keys.length; i++) {\r\n        p.push({ email: keys[i], member: partiesType === modelPartiesTypes.member });\r\n      }\r\n      topic.parties = p;\r\n    }\r\n    \r\n    var self = this;\r\n    return this.service.createTopic(topic).then(function (r) {\r\n      self.reportTopic(r);\r\n      if (topic.join) {\r\n        self.joinTopic(r.id);\r\n      }\r\n      if (!r.invite) {\r\n        return r;\r\n      }\r\n      r.invite.topicId = r.id;\r\n      var inviteUrl = (self._getInviteInfo(r.invite.content.text) || { }).url;\r\n      r.invite.location = inviteUrl;\r\n      var info = {\r\n        topicId: r.id,\r\n        topicTitle: r.title,\r\n        spaceUrl: inviteUrl\r\n      };\r\n      r.invite.info = info;\r\n      return r;\r\n    });\r\n  };\r\n  Spaces.prototype.removeTopic = function () {\r\n  };\r\n\r\n  Spaces.prototype.createInvite = function (invite) {\r\n    if (!invite.parties) {\r\n      var parties = modelParties.getParties();\r\n      var partiesType = modelParties.getPartiesType();\r\n      modelParties.clear();\r\n\r\n      var keys = Object.getOwnPropertyNames(parties);\r\n      var p = [];\r\n      for (var i = 0; i < keys.length; i++) {\r\n        p.push({ email: keys[i], member: partiesType === modelPartiesTypes.member });\r\n      }\r\n      invite.parties = p;\r\n    }\r\n    \r\n    var self = this;\r\n    return this.service.createInvite(invite).then(function (r) {\r\n      if (invite.join) {\r\n        self.joinInvite(r.id);\r\n      }\r\n      var inviteUrl = (self._getInviteInfo(r.content.text) || { }).url;\r\n      r.location = inviteUrl;\r\n      var topic = self.topics[invite.id] || { };\r\n      var info = {\r\n        topicId: invite.id,\r\n        topicTitle: topic.title,\r\n        spaceUrl: inviteUrl\r\n      };\r\n      r.info = info;\r\n      return r;\r\n    });\r\n  };\r\n  \r\n  Spaces.prototype.removeInvite = function (inviteId) {\r\n    return this.service.removeInvite(inviteId);\r\n  };\r\n\r\n  Spaces.prototype._getInviteInfo = function (body) {\r\n    function escapeRegExp(v) {\r\n      v = v.replace(/([./:])/ig, '\\\\$1');\r\n      return v;\r\n    }\r\n\r\n    // var endpoint = (this.opt || {}).url || 'https://spaces.zang.io';\r\n    // var reText = escapeRegExp(endpoint) + '\\/spaces\\/invites\\/(.*?)\\/(join|meet)';\r\n    var reText = 'https:\\/\\/[^\\/]*\\/spaces\\/invites\\/(.*?)\\/(join|meet)';\r\n    logger.info('getInviteInfo search: ' + reText);\r\n\r\n    var re = new RegExp(reText, 'i');\r\n    var result = re.exec(body) || [];\r\n    var id = result[1];\r\n    var url = result[0];\r\n    var res = id ? { id: id, url: url } : null;\r\n    logger.info('getInviteInfo res: ' + JSON.stringify(res));\r\n    return res;\r\n  };\r\n\r\n  Spaces.prototype.getInviteInfo = function (body) {\r\n    return Promise.resolve(this._getInviteInfo(body));\r\n  };\r\n\r\n  Spaces.prototype.getInviteUrl = function (body) {\r\n    return this.getInviteInfo(body).then(function (r) {\r\n      return Promise.resolve(r? r.url : null);\r\n    });\r\n  };\r\n\r\n  Spaces.prototype.checkInvite0 = function (body) {\r\n    return this.getInviteInfo(body).then(function (r) {\r\n      return Promise.resolve(r ? { inviteId: r.id } : null);\r\n    });\r\n  };\r\n\r\n  Spaces.prototype.checkInvite = function (body, precheck) {\r\n    var inviteInfo;\r\n    var self = this;\r\n    return this.getInviteInfo(body).then(function (r) {\r\n      if (precheck) {\r\n        return Promise.resolve(!!r);\r\n      }\r\n      if (!r) {\r\n        return Promise.resolve(null);\r\n      }\r\n      inviteInfo = r;\r\n      return self.service.getTopic({ id: inviteInfo.id }).then(function (r) {\r\n        var info = {\r\n          topicId: r.topic._id,\r\n          topicTitle: r.topic.title,\r\n          spaceUrl: inviteInfo.url\r\n        };\r\n        return Promise.resolve(r ? { inviteId: inviteInfo.id, info: info } : null);\r\n      }, function (err) {\r\n        return Promise.resolve({ inviteId: inviteInfo.id, info: { spaceUrl: inviteInfo.url } });\r\n      });\r\n    });\r\n  };\r\n\r\n  Spaces.prototype.joinTopic = function (id) {\r\n    var url = this.service.getJoinUrl(id);\r\n    // Window.open(url, '_blank');\r\n  };\r\n  Spaces.prototype.joinInvite = function (id) {\r\n    var url = this.service.getInviteJoinUrl(id);\r\n    Window.open(url, '_blank');\r\n  };\r\n\r\n  module.exports = new Spaces();\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/spaces/model.js\n// module id = 30\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Event = require('/lib/jsl/event');\r\n\r\n  var schema = require('./schema');\r\n\r\n  var modelIdentity = require('../identity/model');\r\n  var partyType = require('./types');\r\n\r\n  var _storageKey = 'spaces:partiesType';\r\n\r\n  function Parties() {\r\n    this.parties = { };\r\n    this.partiesType = localStorage.getItem(_storageKey) || partyType.member;\r\n\r\n    this.onParties = new Event();\r\n    this.onPartiesType = new Event();\r\n\r\n    modelIdentity.onPrimary.addListener(this.evIdentity, this);\r\n  }\r\n  Parties.prototype._schema = schema;\r\n  \r\n  Parties.prototype.evIdentity = function (info) {\r\n    if (!info.connected) {\r\n      this.clear();\r\n    } else {\r\n      this.parties = {};\r\n    }\r\n  };\r\n  \r\n  Parties.prototype.getParties = function () {\r\n    return this.parties;\r\n  };\r\n  Parties.prototype.createParty = function (party) {\r\n    var p = this.parties[party.id];\r\n    if (p) {\r\n      var update = false;\r\n      if (party.image && (p.image !== party.image)) {\r\n        update = true;\r\n        p.image = party.image; \r\n      }\r\n      if (party.name && (p.name !== party.name)) {\r\n        update = true;\r\n        p.name = party.name; \r\n      }\r\n      if (party.member) {\r\n        update = true;\r\n        p.member = true;\r\n      }\r\n      if (update) {\r\n        this.onParties.dispatch({ item: p });\r\n      }\r\n      return;\r\n    }\r\n    this.parties[party.id] = party;\r\n    this.onParties.dispatch({ item: party });\r\n  };\r\n  Parties.prototype.removeParty = function (id) {\r\n    var p = this.parties[id];\r\n    if (!p) {\r\n      return;\r\n    }\r\n    delete this.parties[id];\r\n    this.onParties.dispatch({ deleted: true, item: p });\r\n  };\r\n  Parties.prototype.getPartiesType = function () {\r\n    return this.partiesType;\r\n  };\r\n  Parties.prototype.setPartiesType = function (type) {\r\n    this.partiesType = type;\r\n    localStorage.setItem(_storageKey, this.partiesType);\r\n\r\n    this.onPartiesType.dispatch({ type: this.partiesType });\r\n  };\r\n\r\n  Parties.prototype.clear = function () {\r\n    this.parties = {};\r\n    this.onParties.dispatch({ cleared: true });\r\n  };\r\n\r\n  module.exports = new Parties();\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/parties/model.js\n// module id = 31\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n  \r\n  var dom = require('../dom');\r\n  \r\n  function getEventPrefixed(name) {\r\n    switch (name) {\r\n      case 'animationend':\r\n        return [name, 'webkitAnimationEnd'];\r\n    }\r\n    return [name];\r\n  }\r\n  function onanimate(opt, ev) {\r\n    if (opt.final) {\r\n      return;\r\n    }\r\n    \r\n    var node = opt.node;\r\n    var css = opt.stages[opt.index];\r\n    if (css && opt.clearCss) {\r\n      node.classList.remove(css);\r\n    }\r\n    css = opt.stages[opt.index + 1];\r\n    if (css) {\r\n      node.classList.add(css);\r\n      opt.index = opt.index + 1;\r\n    } else if (ev) {\r\n      opt.final = 1;\r\n      \r\n      var names = getEventPrefixed(opt.track);\r\n      for (var i = 0; i < names.length; i++) {\r\n        node.removeEventListener(names[i], opt.handler);\r\n      }\r\n      \r\n      if (opt.remove) {\r\n        node.parentElement.removeChild(node);\r\n      }\r\n      if (opt.cb) {\r\n        opt.cb();\r\n      }\r\n    }\r\n  }\r\n  \r\n  /** @constructor */\r\n  function Control(opt) {\r\n    this.node = this.create(opt);\r\n  }\r\n  Control.prototype.create = function (opt) {\r\n    return this.node || dom.div(opt).node;\r\n  };\r\n  Control.prototype.attach = function (p) {\r\n    this.del();\r\n    p.appendChild(this.node);\r\n  };\r\n  Control.prototype.remove = function () {\r\n    return this.del();\r\n  };\r\n  Control.prototype.render = function (opt) {\r\n  };\r\n  Control.prototype.mutate = function (opt) {\r\n    opt = { node: opt.node || this.node, handler: onanimate, track: opt.track || 'animationend', cb: opt.cb, index: -1, stages: opt.stages || [], remove: opt.remove, clearCss: 1 };\r\n    opt.handler = opt.handler.bind(opt, opt);\r\n\r\n    var names = getEventPrefixed(opt.track);\r\n    for (var i = 0; i < names.length; i++)\r\n      opt.node.addEventListener(names[i], opt.handler);\r\n\r\n    onanimate(opt, null);\r\n  };\r\n  \r\n  module.exports = dom.element.extend(Control);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/ui/control.js\n// module id = 32\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var officeNative = { missing: true };\r\n\r\n  if (window.external && ('context' in window.external)) {\r\n    officeNative = window.external;\r\n  }\r\n\r\n  module.exports = officeNative;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./office.native.js\n// module id = 33\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n  \r\n  var globals = require('/lib/jsl/globals');\r\n  var Office = globals.safeProp('Office');\r\n\r\n  var _settings;\r\n  var store;\r\n\r\n  function save() {\r\n    var cb = function() {};\r\n    _settings.saveAsync(cb);\r\n  }\r\n  function get(key) {\r\n    return _settings.get(key);\r\n  }\r\n  function set(key, val) {\r\n    _settings.set(key, val);\r\n    save();\r\n  }\r\n  function del(key) {\r\n    _settings.remove(key);\r\n    save();\r\n  }\r\n\r\n  function init(settings) {\r\n    _settings = settings;\r\n    store = _settings ? { get: get, set: set, del: del } : null;\r\n  }\r\n\r\n  function getStore() {\r\n    if (typeof(store) !== 'undefined') {\r\n      return store;\r\n    }\r\n    if (typeof(Office) === 'undefined' ||\r\n        !Office.context || \r\n        !Office.context.roamingSettings) {\r\n      _settings = null;\r\n    } else {\r\n      _settings = Office.context.roamingSettings;\r\n    }\r\n    init();\r\n    return store;\r\n  }\r\n\r\n  var storage = { init: init, getStore: getStore };\r\n\r\n  module.exports = storage;\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./storage.js\n// module id = 34\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var loader  = require('/lib/jsl/loader');\r\n\r\n  var Promise = require('/lib/jsl/promise');\r\n  var Storage = require('/lib/jsl/storage');\r\n  var Log     = require('/lib/jsl/log');\r\n\r\n  var logger = Log.createLogger('SETTINGS');\r\n\r\n  var settings = null;\r\n\r\n  function toHexString(buffer) {\r\n    var hexCodes = [];\r\n    var view = new DataView(buffer);\r\n    for (var i = 0; i < view.byteLength; i += 4) {\r\n      var value = view.getUint32(i);\r\n      var stringValue = value.toString(16);\r\n      var padding = '00000000';\r\n      var paddedValue = (padding + stringValue).slice(-padding.length);\r\n      hexCodes.push(paddedValue);\r\n    }\r\n\r\n    // Join all the hex strings into one\r\n    return hexCodes.join('');\r\n  }\r\n\r\n  function getHash(v) {\r\n    v = v || '';\r\n\r\n  if (!window.crypto && window.md5) {\r\n    return Promise.resolve(window.md5(v));\r\n  }\r\n\r\n    var buffer = new ArrayBuffer(v.length * 2);\r\n    var bufView = new Uint16Array(buffer);\r\n    for (var i = 0; i < v.length; i++) {\r\n      bufView[i] = v.charCodeAt(i);\r\n    }\r\n\r\n    //var buffer = String.fromCharCode.apply(null, new Uint16Array(buf));new TextEncoder('utf-8').encode(v);\r\n    return window.crypto.subtle.digest('SHA-256', buffer).then(function (hash) {\r\n      return toHexString(hash);\r\n    });\r\n  }\r\n\r\n  function loadSettings(configuration, languageId) {\r\n    if (settings !== null) {\r\n      return Promise.resolve(settings);\r\n    }\r\n\r\n    if (!configuration) {\r\n      return Promise.reject({ error: { noconfiguration: true } });\r\n    }\r\n\r\n    configuration = JSON.parse(configuration);\r\n    settings = {\r\n      languageId: languageId,\r\n      manual: configuration.manual || Object.getOwnPropertyNames(configuration).length === 0,\r\n      outlookCallContact: configuration['OUTLOOK_CALL_CONTACT'] || '',\r\n      conferenceAccessNumber: configuration['CONFERENCE_ACCESS_NUMBER'] || '',\r\n      conferenceAdditionalNumbers: configuration['ADDITIONAL_CONFERENCE_ACCESS_NUMBER_LIST'] || '',\r\n\r\n      unifiedPortalEnabled: !!configuration['UNIFIEDPORTALENABLED'],\r\n\r\n      // equinox properties\r\n      unifiedPortalUri: configuration['UNIFIED_PORTAL_URI'] || '', // to be removed\r\n      unifiedPortalUsername: configuration['UNIFIED_PORTAL_USERNAME'] || '',\r\n      unifiedPortalSSO: !!configuration['UNIFIED_PORTAL_SSO'],\r\n      unifiedPortalPassword: configuration['Password'] || '',\r\n\r\n      unifiedPortalDelegateName: configuration['delegateName'] || '',\r\n\r\n      conferenceFQDNSIPDialList: configuration['CONFERENCE_FQDN_SIP_DIAL_LIST'] || '',\r\n      uccpEnabled: !!configuration['UCCPENABLED'],\r\n      sipEnabled: !!configuration['SIP_ENABLED'],\r\n      conferencePortalUri: configuration['CONFERENCE_PORTAL_URI'] || '',\r\n\r\n      // conference properties\r\n      conferenceModeratorCode: configuration['CONFERENCE_MODERATOR_CODE'] || '',\r\n      conferenceModeratorUrl: configuration['CONFERENCE_MODERATOR_URL'] || '',\r\n      conferenceParticipantCode: configuration['CONFERENCE_PARTICIPANT_CODE'] || '',\r\n      conferenceParticipantUrl: configuration['CONFERENCE_PARTICIPANT_URL'] || '',\r\n\r\n      conferenceType: configuration['ENABLE_IPO'] ? 'ipo' : 'aac',\r\n    };\r\n\r\n    var validateArray = [\r\n      settings.conferenceAccessNumber,\r\n      settings.conferenceAdditionalNumbers,\r\n      settings.unifiedPortalEnabled,\r\n      settings.unifiedPortalUri,\r\n      settings.unifiedPortalUsername,\r\n      settings.unifiedPortalSSO,\r\n      settings.unifiedPortalPassword,\r\n      settings.unifiedPortalDelegateName,\r\n      settings.conferenceFQDNSIPDialList,\r\n      settings.conferencePortalUri,\r\n      settings.conferenceModeratorCode,\r\n      settings.conferenceModeratorUrl,\r\n      settings.conferenceParticipantCode,\r\n      settings.conferenceParticipantUrl,\r\n      settings.conferenceType,\r\n    ];\r\n    var sValidate = validateArray.join(',');\r\n\r\n    return getHash(sValidate).then(function (hash) {\r\n      var oldHash = Storage.getItem('equinox-config-hash') || '';\r\n      logger.info('compare-config:' + hash + ':' + oldHash);\r\n\r\n      settings.forceRefresh = oldHash !== hash;\r\n      Storage.setItem('equinox-config-hash', hash);\r\n\r\n      return Promise.resolve(settings);\r\n    }, function () {\r\n\r\n      settings.forceRefresh = true;\r\n      return Promise.resolve(settings);\r\n    });\r\n  }\r\n\r\n  function buildAPIConfig(settings) {\r\n    var config = { };\r\n    config.mode = settings.unifiedPortalEnabled ? 'equinox' : settings.conferenceType;\r\n\r\n    config.languageId = settings.languageId;\r\n\r\n    config.bridgeNumber = settings.conferenceAccessNumber;\r\n    config.additionalNumbers = settings.conferenceAdditionalNumbers;\r\n\r\n    config.portalUri = settings.unifiedPortalUri || settings.conferencePortalUri;\r\n    config.user = settings.unifiedPortalUsername;\r\n    config.password = settings.unifiedPortalPassword;\r\n    config.delegateName = settings.unifiedPortalDelegateName;\r\n\r\n    config.conferenceModeratorPIN = settings.conferenceModeratorCode;\r\n    config.conferenceModeratorUrl = settings.conferenceModeratorUrl;\r\n    config.conferenceParticipantPIN = settings.conferenceParticipantCode;\r\n    config.conferenceParticipantUrl = settings.conferenceParticipantUrl;\r\n    config.conferenceType = settings.conferenceType;\r\n\r\n    config.forceRefresh = settings.forceRefresh;\r\n\r\n    return config;\r\n  }\r\n\r\n  function getAPIConfig(configuration, languageId) {\r\n    return loadSettings(configuration, languageId).then(function (settings) {\r\n      var config = buildAPIConfig(settings);\r\n      config.settings = settings;\r\n      return Promise.resolve(config);\r\n    });\r\n  }\r\n\r\n  function clear() {\r\n    settings = null;\r\n  }\r\n\r\n  loader.load('/lib/contrib/webcrypto-shim.js', 'crypto');\r\n\r\n  module.exports = { getAPIConfig: getAPIConfig, clear: clear };\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/rooms/settings.js\n// module id = 35\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var API = require('../api/api');\r\n\r\n  var methods = {\r\n    info: {\r\n      uri: '/ups/resources/$(tenantId)',\r\n      method: 'GET',\r\n      headers: {\r\n        'authorization': '$(token)'\r\n      },\r\n      body: null,\r\n      args: {\r\n        tenantId: { key: '$(tenantId)', flags: 's', format: 'tenants/$0/', default: 'default' },\r\n        token: { key: '$(token)', flags: 's', format: 'UPToken $0' }\r\n      },\r\n      response: {\r\n        portalVersion: { key: 'portalVersion', flags: 'Sr' },\r\n        multitenant: { key: 'multitenant', flags: 'br' },\r\n        iwaEnabled: { key: 'iwaEnabled', flags: 'br' },\r\n        scopiaUrl: { key: 'scopiaDesktopServerURL', flags: 's' },\r\n        self: {\r\n          $v: {\r\n            email: { key: 'self.email', flags: 'sr' },\r\n            firstName: { key: 'self.firstName', flags: 's' },\r\n            lastName: { key: 'self.lastName', flags: 's' },\r\n            userId: { key: 'self.userId', flags: 's' },\r\n            scopiaUserId: { key: 'self.scopiaUserId', flags: 's' },\r\n            scopiaTenantId: { key: 'self.scopiaMemberId', flags: 's' }\r\n          }\r\n        }\r\n      },\r\n    },\r\n    refreshToken: {\r\n      uri: '/ups/resources/$(tenantId)authentication/login',\r\n      method: 'POST',\r\n      headers: {\r\n        'content-type': 'application/json',\r\n        'authorization': '$(token)'\r\n      },\r\n      args: {\r\n        tenantId: { key: '$(tenantId)', flags: 's', format: 'tenants/$0/', default: 'default' },\r\n        token: { key: '$(token)', flags: 'Sr', format: 'UPToken $0' },\r\n        userId: { key: '$(userId)', flags: 's' },\r\n        passwordHash: { key: '$(passwordHash)', flags: 's' },\r\n        aliasId: { key: '$(aliasId)', flags: 's', default: 'default' }\r\n      },\r\n      body: {\r\n        'login': '$(userId)',\r\n        'encryptedPassword': '$(passwordHash)',\r\n        'organizationAlias': '$(aliasId)'\r\n      },\r\n      response: {\r\n        token: { key: 'token', flags: 'Sr' },\r\n        expires: { key: 'expirationTime', flags: 'D' },\r\n        passwordHash: { key: 'encryptedPassword', flags: 's' }\r\n      }\r\n    },\r\n    login: {\r\n      uri: '/ups/resources/$(tenantId)authentication/login',\r\n      method: 'POST',\r\n      headers: {\r\n        'content-type': 'application/json'\r\n      },\r\n      args: {\r\n        tenantId: { key: '$(tenantId)', flags: 's', format: 'tenants/$0/', default: 'default' },\r\n        aliasId: { key: '$(aliasId)', flags: 's', default: 'default' },\r\n        userId: { key: '$(userId)', flags: 's' },\r\n        password: { key: '$(password)', flags: 's' }\r\n      },\r\n      body: {\r\n        'login': '$(userId)',\r\n        'organizationAlias': '$(aliasId)',\r\n        'password': '$(password)'\r\n      },\r\n      response: {\r\n        token: { key: 'token', flags: 'Sr' },\r\n        expires: { key: 'expirationTime', flags: 'D' },\r\n        passwordHash: { key: 'encryptedPassword', flags: 's' }\r\n      }\r\n    },\r\n    loginIWA: {\r\n      uri: '/ups/resources/$(tenantId)authentication/login?useSSO=true',\r\n      method: 'POST',\r\n      credentials: true,\r\n      headers: {\r\n        'content-type': 'application/json'\r\n      },\r\n      args: {\r\n        tenantId: { key: '$(tenantId)', flags: 's', format: 'tenants/$0/', default: 'default' },\r\n        aliasId: { key: '$(aliasId)', flags: 's', default: 'default' },\r\n      },\r\n      body: {\r\n        'organizationAlias': '$(aliasId)',\r\n      },\r\n      response: {\r\n        token: { key: 'token', flags: 'Sr' },\r\n        expires: { key: 'expirationTime', flags: 'D' },\r\n        passwordHash: { key: 'encryptedPassword', flags: 's' }\r\n      }\r\n    },\r\n    getRooms: {\r\n      uri: '/ups/resources/$(tenantId)conference/virtual_room',\r\n      method: 'POST',\r\n      headers: {\r\n        'content-type': 'application/vnd.avaya.portal.conference.virtual_room.v1+json',\r\n        'authorization': '$(token)'\r\n      },\r\n      args: {\r\n        tenantId: { key: '$(tenantId)', flags: 's', format: 'tenants/$0/', default: 'default' },\r\n        aliasId: { key: '$(aliasId)', flags: 's', default: 'default' },\r\n        token: { key: '$(token)', flags: 'Sr', format: 'UPToken $0' },\r\n        offset: { key: '$(offset)', flags: 'i', default: 1 },\r\n        pageSize: { key: '$(pageSize)', flags: 'i', default: 20 },\r\n        userId: { key: '$(userId)', flags: 'Sr' }\r\n      },\r\n      body: {\r\n        memberId: '$(aliasId)',\r\n        offset: '$(offset)',\r\n        pageSize: '$(pageSize)',\r\n        loginId: '$(userId)'\r\n      },\r\n      response: {\r\n        totalCount: { key: 'totalCount ', flags: 'i' },\r\n        rooms: [{\r\n          id: { key: 'virtualRoom.#.virtualRoomId', flags: 'Sr' },\r\n          name: { key: 'virtualRoom.#.name', flags: 'Sr' },\r\n          number: { key: 'virtualRoom.#.number', flags: 'Sr' },\r\n          userId: { key: 'virtualRoom.#.userId', flags: 'Sr' },\r\n          accessPIN: { key: 'virtualRoom.#.accessPIN', flags: 'B', default: '' },\r\n          \r\n          autoExtend: { key: 'virtualRoom.#.autoExtend', flags: 'br' },\r\n          blockDialIn: { key: 'virtualRoom.#.blockDialIn', flags: 'br' },\r\n          isDefault: { key: 'virtualRoom.#.default', flags: 'br' },\r\n          maxParticipants: { key: 'virtualRoom.#.maxParticipants', flags: 'ir' },\r\n          moderatorPIN: { key: 'virtualRoom.#.moderatorPIN', flags: 'B' },\r\n          oneTimePINRequired: { key: 'virtualRoom.#.oneTimePINRequired', flags: 'b' },\r\n          priority: { key: 'virtualRoom.#.priority', flags: 'er' },\r\n          isPublic: { key: 'virtualRoom.#.public', flags: 'br' },\r\n          servicePrefix: { key: 'virtualRoom.#.servicePrefix', flags: 'sr' },\r\n          serviceTemplateId: { key: 'virtualRoom.#.serviceTemplateId', flags: 'sr' },\r\n          streamingStatus: { key: 'virtualRoom.#.streamingStatus', flags: 'er' },\r\n          waitingRoom: { key: 'virtualRoom.#.waitingRoom', flags: 'br' },\r\n          \r\n          allowKnocking: { key: 'virtualRoom.#.allowKnocking', flags: 'br' },\r\n          allowRecording: { key: 'virtualRoom.#.allowRecording', flags: 'er' },\r\n          allowStreaming: { key: 'virtualRoom.#.allowStreaming', flags: 'er' },\r\n\r\n          durationAfterLeft: { key: 'virtualRoom.#.advancedProperties.durationAfterLeft', flags: 'T' },\r\n          minutesBeforeTermination: { key: 'virtualRoom.#.advancedProperties.minutesBeforeTermination', flags: 'T' },\r\n          terminationCondition: { key: 'virtualRoom.#.advancedProperties.terminationCondition', flags: 'e' },\r\n\r\n          portsFullHD: { key: 'virtualRoom.#.reservedPorts.fullHD', flags: 'i', default: 0 },\r\n          portsHD: { key: 'virtualRoom.#.reservedPorts.hd', flags: 'i', default: 0 },\r\n          portsRegular: { key: 'virtualRoom.#.reservedPorts.regular', flags: 'i', default: 0 },\r\n          portsSD: { key: 'virtualRoom.#.reservedPorts.sd', flags: 'i', default: 0 }\r\n        }]\r\n      }\r\n    },\r\n    getDialInfo: {\r\n      uri: '/ups/resources/$(tenantId)conference/dialing_info',\r\n      method: 'POST',\r\n      headers: {\r\n        'authorization': '$(token)',\r\n        'content-type': 'application/vnd.avaya.portal.conference.dialing_info.v1+json'\r\n      },\r\n      args: {\r\n        tenantId: { key: '$(tenantId)', flags: 's', format: 'tenants/$0/', default: 'default' },\r\n        token: { key: '$(token)', flags: 'S', format: 'UPToken $0' },\r\n\r\n        accessPIN: { key: '$(accessPIN)', flags: 's' },\r\n        confGID: { key: '$(confGID)', flags: 's' },\r\n        dialableNumber: { key: '$(dialableNumber)', flags: 'Sr' },\r\n        loginId: { key: '$(loginId)', flags: 's' },\r\n        memberId: { key: '$(memberId)', flags: 's' },\r\n        servicePrefix: { key: '$(servicePrefix)', flags: 's' },\r\n        serviceTemplateId: { key: '$(serviceTemplateId)', flags: 's' },\r\n        userId: { key: '$(userId)', flags: 's' },\r\n      },\r\n      body: {\r\n        'AccessPIN': '$(accessPIN)',\r\n        'ConfGID': '$(confGID)',\r\n        'DialableNumber': '$(dialableNumber)',\r\n        'LoginId': '$(loginId)',\r\n        'MemberId': '$(memberId)',\r\n        'ServicePrefix': '$(servicePrefix)',\r\n        'ServiceTemplateId': '$(serviceTemplateId)',\r\n        'UserId': '$(userId)',\r\n      },\r\n      response: {\r\n        dialingInfoText: { key: 'DialingInfo.Description', flags: 's' },\r\n        dialingInfoHTML: { key: 'DialingInfo.DescriptionOfHTML', flags: 's' },\r\n        location: { key: 'DialingInfo.LocationInfo', flags: 's' },\r\n        requestId: { key: 'RequestID', flags: 's' },\r\n        result: { key: 'ReturnValue', flags: 'er' }\r\n      }\r\n    }\r\n  };\r\n\r\n  function RoomsAPI(serverBase) {\r\n    this.$super(serverBase);\r\n  }\r\n\r\n  Object.getOwnPropertyNames(methods).forEach(function (name) {\r\n    RoomsAPI.prototype[name] = function(args) {\r\n      return this._exec(methods[name], args);\r\n    }\r\n  }, this);\r\n\r\n  module.exports = API.extend(RoomsAPI);\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/rooms/api.js\n// module id = 36\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Log = require('/lib/jsl/log');\r\n\r\n  var logger = Log.createLogger('TOM');\r\n\r\n  var reUri = /(https?\\:\\/\\/)(([^\\. ]+(\\.[^\\. \\/\\:]+)*)(\\:[0-9]+)?)(\\/[^\\,\\.\\!\\?\\r\\n]?[^\\? \\r\\n]*)?((\\?[^ \\r\\n\"<>]*))?/igm;\r\n  var reTel = /([\\=\\&]?(\\+[0-9])?((?:[- .()]*)[0-9](?:[- .()]*)){8,20})((?:[ ]*)?([\\,0-9\\*\\#]+))?/igm;\r\n\r\n  function unquote(v) {\r\n    if (v && v[v.length - 1] === '\"') {\r\n      return v.substr(0, v.length - 1);\r\n    }\r\n    return v;\r\n  }\r\n  function extractUrls(s) {\r\n    var r = [];\r\n    for (var m; (m = reUri.exec(s)) && m[3]; ) {\r\n      var uri = { proto: m[1] || 'http://', serverName: m[3].toLowerCase(), port: m[5] || '', path: m[6] || '', query: m[7] || '' };\r\n      uri.server = unquote(uri.server);\r\n      uri.query = uri.query.replace(/[\\,\\. \\?\\!\\;]$/ig, '');\r\n      uri.query = unquote(uri.query);\r\n      uri.path = uri.path.replace(/[\\,\\. \\?\\!\\;]$/ig, '');\r\n      uri.path = unquote(uri.path);\r\n      uri.url = [uri.proto, uri.serverName, uri.port, uri.path, uri.query].join('');\r\n      r.push(uri);\r\n    }\r\n    return r;\r\n  }\r\n  function extractTels(s) {\r\n    var r = [];\r\n\r\n    for (var m; (m = reTel.exec(s)); ) {\r\n      if (m[1] && ((m[1].indexOf('=') === 0) || (m[1].indexOf('&') === 0))) {\r\n        continue;\r\n      }\r\n      var tel = { phone: m[1], pin: m[4] || '' };\r\n      tel.tel = tel.phone.replace(/[^0-9\\+\\*\\#]/ig, '');\r\n      r.push(tel);\r\n    }\r\n    return r;\r\n  }\r\n  function parseUrl(url) {\r\n    url = url || '';\r\n    if ((url.indexOf('http://') < 0) && (url.indexOf('https://') < 0)) {\r\n      url += 'https://';\r\n    }\r\n    return extractUrls(url)[0];\r\n  }\r\n\r\n  // Equinox validation\r\n  function validateEquinoxMeetingUrl(config, url) {\r\n    var path = url.path;\r\n    var query = url.query;\r\n\r\n    var reQuery = /^\\?ID=([0-9]+)(\\*+([0-9]+)?)?/ig;\r\n    var room, pin;\r\n    var mQuery = reQuery.exec(query);\r\n    if (mQuery) {\r\n      room = mQuery[1];\r\n      pin = mQuery[3] || '';\r\n    }\r\n\r\n    var rePath = /recording\\/?$/ig;\r\n    var mPath = rePath.exec(path);\r\n    if (mPath) {\r\n      return null;\r\n    }\r\n\r\n    return { url: url, room: room, pin: pin };\r\n  }\r\n  function validateEquinoxMeetingCode(info) {\r\n    var reRoom = /VirtualRoom([: -,.]*)([0-9]*)/ig;\r\n    var rePIN = /VirtualRoomPin([: -,.]*)([0-9\\#\\*]*)/ig;\r\n    var location = info.location.value;\r\n\r\n    var res = { room: '', pin: '' };\r\n    var mRoom = reRoom.exec(location);\r\n    if (mRoom && mRoom[2]) {\r\n      res.room = mRoom[2];\r\n    }\r\n    var mPIN = rePIN.exec(location);\r\n    if (mPIN && mPIN[2]) {\r\n      res.pin = mPIN[2];\r\n    }\r\n\r\n    return res;\r\n  }\r\n  function validateEquinoxMeetingInfo(config, rooms, info) {\r\n    var confInfo = { type: 'equinox', url: '', tel: '', room: '', dial: '', isHost: false, clientUrl: !config.manual };\r\n    confInfo = info.urls.reduce(function (r, item) {\r\n      if (r.room) {\r\n        return r;\r\n      }\r\n      var res = validateEquinoxMeetingUrl(config, item);\r\n      if (res) {\r\n        if (res.room) {\r\n          r.url = res.url.url;\r\n          r.room = res.room;\r\n          r.pin = res.pin || '';\r\n        } else {\r\n          r.url = r.url || res.url.url;\r\n        }\r\n      }\r\n      return r;\r\n    }, confInfo);\r\n\r\n    var res = validateEquinoxMeetingCode(info);\r\n    if (!confInfo.room && res) {\r\n      confInfo.room = res.room;\r\n      confInfo.pin = res.pin;\r\n    } else if (!confInfo.pin && res) {\r\n      confInfo.pin = res.pin;\r\n    }\r\n\r\n    var telInfo = info.tels.reduce(function (r, item){\r\n      var pin = item.pin.replace(/[^0-9*#]/ig, '');\r\n      var tel = item.tel.replace(/[^0-9*#]/ig, '');\r\n\r\n      if (tel === r.room) {\r\n        return r;\r\n      }\r\n\r\n      if (pin && (pin.indexOf(r.room) === 0)) {\r\n        r.telRoom = r.telRoom || item.tel;\r\n      } else {\r\n        r.telFirst = r.telFirst || item.tel;\r\n      }\r\n      return r;\r\n    }, { room: confInfo.room.replace(/[^0-9*#]/ig, '') });\r\n    confInfo.tel = telInfo.telRoom || telInfo.telFirst || '';\r\n\r\n    if (!confInfo.room) {\r\n      logger.info('validateEquinoxMeetingInfo (no room): ' + JSON.stringify(confInfo));\r\n      return null;\r\n    }\r\n    \r\n    var sipFQDNS = (config.conferenceFQDNSIPDialList || '').split(',');\r\n    var sipUrls = sipFQDNS.map(function (item) {\r\n      if ((item.indexOf('http://') !== 0) && (item.indexOf('https://') !== 0)) {\r\n        item = 'https://' + item;\r\n      }\r\n      return (parseUrl(item || '') || {}).serverName || '';\r\n    });\r\n    var confUrl = (parseUrl(confInfo.url || '') || {}).serverName;\r\n    var sipDial = confUrl && (sipUrls.indexOf(confUrl) >= 0);\r\n\r\n    var pin = confInfo.pin;\r\n    for (var i = 0; i < rooms.length; i++) {\r\n      if (rooms[i].meetingId === confInfo.room) {\r\n        confInfo.id = rooms[i].id;\r\n        confInfo.isHost = true;\r\n        // ACMACOS-10934, ACW-11836\r\n        //if (rooms[i].moderatorPIN) {\r\n        //  confInfo.pin = pin = rooms[i].moderatorPIN;\r\n        //}\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (sipDial) {\r\n      confInfo.dial = confInfo.room + (pin ? '***' + pin : '');\r\n      confInfo.bridge = confInfo.room || '';\r\n    } else {\r\n      if (!confInfo.tel) {\r\n        logger.info('validateEquinoxMeetingInfo (no tel): ' + JSON.stringify(confInfo));\r\n        return null;\r\n      }\r\n      // ACMACOS-10934, ACW-11836 - should we add moderator code for non-sipDial case?\r\n      confInfo.dial = confInfo.tel ? confInfo.tel + ',,,' + (confInfo.room || '') + (pin ? '***' + pin : '') : '';\r\n      confInfo.bridge = confInfo.tel || '';\r\n    }\r\n\r\n    return confInfo;\r\n  }\r\n  // Equinox validation\r\n\r\n  // Cponference Validation\r\n  function getConferenceInfoFromCodeAdjusted(code) {\r\n    code = (code || '').replace(/^\\,+/ig, '').replace(/\\,+$/, '');\r\n    var av = code.split(',');\r\n    var room = av.shift().replace(/\\#+$/, '');\r\n    var pin = av.join(',');\r\n    if (pin) {\r\n      pin = ',' + pin;\r\n    }\r\n    return { room: room, pin: pin.replace(/^\\,+/ig, ''), pinOrig: pin };\r\n  }\r\n  function validateConferenceMeetingUrl(config, url) {\r\n    //if ((config.conferenceFQDNSIPDialList || '').indexOf(url.serverName) < 0) {\r\n    //  return null;\r\n    //}\r\n\r\n    var q = url.path + url.query;\r\n    var re = /(\\/|\\?participantCode=)(\\d+)$/ig;\r\n    var m = re.exec(q);\r\n    if (m && m[2]) {\r\n      var info = getConferenceInfoFromCodeAdjusted(m[2]);\r\n      return { url: url, room: info.room || '', pin: info.pin || '' };\r\n    }\r\n  }\r\n  function validateConferenceMeetingCode(info) {\r\n    var reCode = /(PC|PIN|Passcode)([\\#\\:])?[ ]*([0-9\\#\\*\\,]+)/ig;\r\n\r\n    var _info;\r\n    var mlCode = reCode.exec(info.location.value);\r\n    if (mlCode && mlCode[3]) {\r\n      _info = getConferenceInfoFromCodeAdjusted(mlCode[3]);\r\n      return { room: _info.room, _info: info.pin };\r\n    }\r\n    var mbCode = reCode.exec(info.body.value);\r\n    if (mbCode && mbCode[3]) {\r\n      _info = getConferenceInfoFromCodeAdjusted(mbCode[3]);\r\n      \r\n      return { room: _info.room, _info: info.pin };\r\n    }\r\n  }\r\n  function validateConferenceMeetingInfo(config, info) {\r\n    var confInfo = { type: config.conferenceType, url: '', tel: '', room: '', dial: '', isHost: false };\r\n    confInfo = info.urls.reduce(function (r, item) {\r\n      if (r.room) {\r\n        return r;\r\n      }\r\n\r\n      var res = validateConferenceMeetingUrl(config, item);\r\n      if (res) {\r\n        if (res.room) {\r\n          r.url = res.url.url;\r\n          r.room = res.room;\r\n        } else {\r\n          r.url = r.url || res.url.url;\r\n        }\r\n      }\r\n      return r;\r\n    }, confInfo);\r\n\r\n    var res = validateConferenceMeetingCode(info);\r\n    if (!confInfo.room && res) {\r\n      confInfo.room = res.room;\r\n      confInfo.pin = res.pin || '';\r\n    } else if (!confInfo.pin && res) {\r\n      confInfo.pin = res.pin || '';\r\n    }\r\n    // in above block should we care if pin retrieved from url somehow, or forcing it from PC code or tels is ok\r\n\r\n    var telInfo = info.tels.reduce(function (r, item){\r\n      var info = getConferenceInfoFromCodeAdjusted(item.pin);\r\n\r\n      if (info.pin && ((info.room === r.room) || !r.room)) {\r\n        r.telRoom = r.telRoom || item.tel;\r\n\r\n        r.telPIN = r.telPIN || info.pin;\r\n        if (!r.room) {\r\n          r._room = r._room || info.room;\r\n        }\r\n      } else {\r\n        r.telFirst = r.telFirst || item.tel;\r\n      }\r\n      return r;\r\n    }, { room: confInfo.room.replace(/[^0-9*#]/ig, '') });\r\n    confInfo.tel = telInfo.telRoom || telInfo.telFirst || '';\r\n\r\n    if (!confInfo.room && telInfo._room) {\r\n      confInfo.room = telInfo._room || '';\r\n    }\r\n    if (!confInfo.pin && telInfo.telPIN) {\r\n      confInfo.pin = (telInfo.telPIN || '');\r\n    }\r\n\r\n    if (!confInfo.room || (!confInfo.url && !confInfo.tel)) {\r\n      logger.info('validateConferenceMeetingInfo (no room/url+tel): ' + JSON.stringify(confInfo));\r\n      return null;\r\n    }\r\n    \r\n    var confPC = (config.conferenceParticipantCode || '').replace(/[^0-9\\*\\#\\,]/ig, '');\r\n    var confPCInfo = getConferenceInfoFromCodeAdjusted(confPC);\r\n    var confMC = (config.conferenceModeratorCode || '').replace(/[^0-9\\*\\#\\,]/ig, '');\r\n    var confMCInfo = getConferenceInfoFromCodeAdjusted(confMC);\r\n\r\n    var roomNP = (confInfo.room || '');\r\n    \r\n    var hostServer = (parseUrl(config.conferenceModeratorUrl) || {}).serverName || '-';\r\n    var confServer = (parseUrl(confInfo.url) || {}).serverName || '';\r\n    confInfo.isHost = /*(!confServer || (hostServer === confServer)) &&*/ (roomNP === confPCInfo.room);\r\n    if (config.conferenceParticipantUrl && (config.conferenceParticipantUrl === confInfo.url)) {\r\n      confInfo.isHost = true;\r\n    }\r\n    confInfo.tel = confInfo.tel;\r\n\r\n    var dtmf = '';\r\n    if (confInfo.isHost) {\r\n      dtmf = confMCInfo.room + '#';\r\n      if (confMCInfo.pinOrig) {\r\n        confInfo.pin = confMCInfo.pinOrig;\r\n        dtmf = dtmf + confMCInfo.pinOrig;\r\n      }\r\n    }\r\n    if (!dtmf) {\r\n      dtmf = confInfo.room + '#';\r\n      if (confInfo.pin) {\r\n        dtmf = dtmf + ',,' + confInfo.pin;\r\n      }\r\n    }\r\n\r\n    confInfo.dial = confInfo.tel ? confInfo.tel + (dtmf ? ',,,' + dtmf : '') : '';\r\n\r\n    return confInfo;\r\n  }\r\n  // Conference Validation\r\n\r\n  function extractMeetingInfo(config, rooms, meeting) {\r\n    rooms = rooms || [];\r\n    logger.info('extractMeetingInfo rooms: ' + JSON.stringify(rooms));\r\n    var extracted = { };\r\n    extracted.location = { urls: extractUrls(meeting.location || ''), tels: extractTels(meeting.location || ''), value: meeting.location || '' };\r\n    logger.info('extracted location: urls: ' + JSON.stringify(extracted.location.urls) + ', tels: ' + JSON.stringify(extracted.location.tels));\r\n    extracted.body = { urls: extractUrls(meeting.body || ''), tels: extractTels(meeting.body || ''), value: meeting.body || '' };\r\n    logger.info('extracted body: urls: ' + JSON.stringify(extracted.body.urls) + ', tels: ' + JSON.stringify(extracted.body.tels));\r\n    extracted.urls = [].concat(extracted.location.urls, extracted.body.urls);\r\n    extracted.tels = [].concat(extracted.location.tels, extracted.body.tels);\r\n    var confInfo = validateEquinoxMeetingInfo(config, rooms, extracted);\r\n    if (!confInfo) {\r\n      confInfo = validateConferenceMeetingInfo(config, extracted);\r\n    }\r\n    if (!confInfo) {\r\n      confInfo = { url: '', dial: '', room: '', pin: '', isHost: false, type: 'empty' };\r\n    }\r\n    logger.info('extractMeetingInfo: ' + JSON.stringify(confInfo));\r\n    return confInfo;\r\n  }\r\n\r\n  function getJoinConferenceMeetingUri(info) {\r\n    logger.info('getJoinConferenceMeetingUri');\r\n    if (info.dial) {\r\n      var uri = 'avaya://video?' + info.dial;\r\n      logger.info('getJoinConferenceMeetingUri:' + uri);\r\n      return uri;\r\n    }\r\n    return '';\r\n  }\r\n  function getJoinEquinoxMeetingUri(info) {\r\n    logger.info('getJoinEquinoxMeetingUri:' + JSON.stringify(info));\r\n    if (info.bridge) {\r\n      var uri;\r\n      if (!info.clientUrl) {\r\n        uri = info.url;\r\n      } else {\r\n        var args = { };\r\n        if (info.pin) {\r\n          args['MeetingPasscode'] = info.pin;\r\n        }\r\n        if (info.room) {\r\n          args['MeetingId'] = info.room;\r\n        }\r\n        if (info.url) {\r\n          args['portalUrl'] = info.url;\r\n        }\r\n\r\n        var urlArgs = Object.getOwnPropertyNames(args).reduce(function (r, key) {\r\n          // r.push([key, encodeURIComponent(args[key])].join('='));\r\n          r.push([key, args[key]].join('='));\r\n          return r;\r\n        }, []);\r\n        if (urlArgs.length) {\r\n          urlArgs = '&' + urlArgs.join('&');\r\n        }\r\n        uri = 'avaya://video?' + info.bridge + urlArgs;\r\n      }\r\n      logger.info('getJoinEquinoxMeetingUri:' + uri);\r\n      return uri;\r\n    }\r\n  }\r\n\r\n  function getJoinMeetingUri(meetingInfo) {\r\n    logger.info('getJoinMeetingUri');\r\n    if (meetingInfo.type !== 'equinox') {\r\n      return getJoinConferenceMeetingUri(meetingInfo);\r\n    } else {\r\n      return getJoinEquinoxMeetingUri(meetingInfo);\r\n    }\r\n  }\r\n\r\n  function joinMeeting(meetingInfo) {\r\n    var uri = getJoinMeetingUri(meetingInfo);\r\n    if (uri) {\r\n      window.open(uri, '_self');\r\n    }\r\n  }\r\n\r\n  var TopOfMind = {\r\n    extractMeetingInfo: extractMeetingInfo,\r\n    getJoinMeetingUri: getJoinMeetingUri,\r\n    joinMeeting: joinMeeting,\r\n  };\r\n\r\n  module.exports = TopOfMind;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/rooms/tom.js\n// module id = 37\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  function Templates(opt) {\r\n    this._url = opt.url || '../templates/';\r\n    this._langId = opt.langId || 'en';\r\n    this._html = !!opt.html;\r\n    this._maxLineLength = opt.maxLineLength || 68;\r\n    this._logger = opt.logger;\r\n    this.i18n = opt.i18n;\r\n  }\r\n  Templates.prototype._limitLineLength = function (s, len) {\r\n    var words = s.split(' ');\r\n    var lines = words.reduce(function (r, word) {\r\n      var line = r[r.length - 1] || '';\r\n      if (!line.length) {\r\n        line = word;\r\n      } else if (line.length + word.length + 1 > len) {\r\n        line = word;\r\n        r.push('');\r\n      } else {\r\n        line = line + ' ' + word;\r\n      }\r\n      r[r.length - 1] = line;\r\n  \r\n      return r;\r\n    }, ['']);\r\n  \r\n    return lines.join('\\r\\n');\r\n  };\r\n\r\n  Templates.prototype._splitCompoundValues = function (strings) {\r\n    Object.getOwnPropertyNames(strings).forEach(function(key) {\r\n      var value = strings[key];\r\n      if (value.indexOf('%%') !== -1) {\r\n        delete strings[key];\r\n        var pp = value.split('%%');\r\n        strings[key + '_PREFIX'] = pp[0];\r\n        strings[key + '_POSTFIX'] = pp[2];\r\n      } else {\r\n        var re = /(.*)?<a xsubst>(.*)?<\\/a>(.*)?/;\r\n        var m = re.exec(value);\r\n        if (m && m.length === 4) {\r\n          delete strings[key];\r\n          strings[key + '_PREFIX'] = m[1] || '';\r\n          strings[key + '_LINK'] = m[2] || '';\r\n          strings[key + '_POSTFIX'] = m[3] || '';\r\n        }\r\n      }\r\n   });\r\n  }\r\n    \r\n  Templates.prototype.applyTranslations = function(content, type, langId, html) {\r\n    var self = this;\r\n    langId = langId || self._langId || 'en';\r\n\r\n    var ln_strings = self.i18n[langId] || self.i18n;\r\n    this._splitCompoundValues(ln_strings);\r\n    var langIdEn = 'en';\r\n    var en_strings = self.i18n[langIdEn] || { };\r\n    this._splitCompoundValues(en_strings);\r\n\r\n    var lineTag = html ? '--' + Date.now() + '--' : '';\r\n  \r\n    var re = /\\$\\(([^\\)]+)\\)/gm;\r\n    content = content.replace(re, function (m, key) {\r\n      var s = typeof(ln_strings[type + '_' + key]) !== 'undefined' ? ln_strings[type + '_' + key] : en_strings[type + '_' + key];\r\n      if (typeof(s) !== 'undefined') {\r\n        return lineTag + (s);\r\n      }\r\n      return m;\r\n    });\r\n  \r\n    var reTag = /--\\d+--/ig;\r\n    var reLines = /^.*(--\\d+--).*$/gm;\r\n    var maxLen = this._maxLineLength;\r\n    content = content.replace(reLines, function (m, tag) {\r\n      if (tag !== lineTag) {\r\n        return m;\r\n      }\r\n      m = m.replace(reTag, '');\r\n      return self._limitLineLength(m, maxLen);\r\n    });\r\n  \r\n    return content;\r\n  };\r\n    \r\n  Templates.prototype.getTemplate = function (type) {\r\n    var self = this;\r\n    var templateUrl = self._url + type + (self._html ? '.html' : '.txt');\r\n    if (self._logger) {\r\n      self._logger.info('getTemplate: ' + templateUrl);\r\n    }\r\n    return fetch(templateUrl).then(function (r) {\r\n      return r.text();\r\n    }).then(function (content) {\r\n      return self.applyTranslations(content, type.toUpperCase(), self._langId, self._html);\r\n    }, function (err) {\r\n      throw { error: { fetchTemplate: true } };\r\n    });\r\n  };\r\n\r\n  module.exports = Templates;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/rooms/templates.js\n// module id = 38\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var schema = require('/lib/jsl/chrome/rpc/schema');\r\n\r\n  var SpacesSchema = {\r\n    onTopic: schema.eventBroadcast,\r\n    onSearch: schema.eventUnicast,\r\n\r\n    getTopics: schema.methodPromise,\r\n    searchTopics: schema.methodPromise,\r\n\r\n    createInvite: schema.methodPromise,\r\n    removeInvite: schema.methodPromise,\r\n\r\n    createTopic: schema.methodPromise,    \r\n    removeTopic: schema.methodPromise,\r\n    \r\n    refresh: schema.methodPromise,\r\n\r\n    joinTopic: schema.methodOneWay,\r\n  };\r\n\r\n  module.exports = SpacesSchema;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/spaces/schema.js\n// module id = 39\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise = require('./promise');\r\n\r\n  function createToken() {\r\n    var self = { };\r\n    self.token = new Promise(function (resolve, reject) {\r\n      self.cancel = reject.bind(null, { error: { canceled: true } });\r\n    });\r\n    return self;\r\n  }\r\n  \r\n  function PromiseCancel() {\r\n    var token = createToken();\r\n    this.token = token.token;\r\n    this.cancel = token.cancel;\r\n  }\r\n  PromiseCancel.prototype.exec = function (promise) {\r\n    var cmd = Promise.race([promise, this.token]);\r\n    cmd.cancel = this.cancel;\r\n    return cmd;\r\n  };\r\n\r\n  module.exports = PromiseCancel;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/promise.cancel.js\n// module id = 40\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var Base = require('../base');  \r\n  var Promise = require('../promise');\r\n  var Utils = require('../utils');\r\n  var OAuthStorage = require('./oauth.storage');\r\n\r\n  /** @constructor */  \r\n  function OAuth(opt) {\r\n    this.storage = opt.storage || new OAuthStorage(opt);\r\n    this.providers = [];\r\n  }\r\n  OAuth.prototype.registerProvider = function (provider) {\r\n    provider.setStorage(this.storage);\r\n    \r\n    this.providers.push(provider);\r\n  };\r\n  OAuth.prototype.getProvider = function (type) {\r\n    var providers = this.providers;\r\n    for (var i = 0; i < providers.length; i++) {\r\n      var provider = providers[i];\r\n      if (provider.clientType === type) {\r\n        return provider;\r\n      }\r\n    }\r\n  };\r\n  \r\n  OAuth.prototype.login = function (opt) {\r\n    if (!opt.type) {\r\n      var p = this.storage.getPrimary();\r\n      if (p) {\r\n        opt.type = p.type;\r\n      }\r\n    }\r\n    \r\n    var provider = this.getProvider(opt.type);\r\n    if (!provider) {\r\n      return Promise.reject({ error: { provider: true } });\r\n    }\r\n    \r\n    return provider.login(opt);\r\n  };\r\n  OAuth.prototype.logout = function (opt) {\r\n    var provider = this.getProvider(opt.type);\r\n    if (!provider) {\r\n      return Promise.reject({ error: { provider: true } });\r\n    }\r\n    return provider.logout(opt);\r\n  };\r\n  OAuth.prototype.getToken = function (opt) {\r\n    Utils.showLogInfo('identity: OAuth.getToken', opt, ['cancelToken'], true);\r\n    var provider = this.getProvider(opt.type);\r\n    if (!provider) {\r\n      return Promise.reject({ error: { provider: true } });\r\n    }\r\n    return provider.getToken(opt);\r\n  };\r\n\r\n  module.exports = Base.extend(OAuth);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/id/oauth.js\n// module id = 41\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var Base = require('../base');\r\n  var Storage = require('../storage');\r\n  var Utils = require('../utils');\r\n\r\n  /** @constructor */  \r\n  function OAuthStorage(opt) {\r\n    this.key = opt.key || 'oauth_storage';\r\n    this.allowSave = !!opt.allowSave;\r\n\r\n    this.load();\r\n  }\r\n  OAuthStorage.prototype.load = function () {\r\n    var jso = Storage.getItem(this.key) || null;\r\n    this.items = Utils.safeParse(jso) || {};\r\n  };\r\n  OAuthStorage.prototype.save = function () {\r\n    if (!this.allowSave) {\r\n      return;\r\n    }\r\n    var jso = JSON.stringify(this.items);\r\n    Storage.setItem(this.key, jso);\r\n  };\r\n  OAuthStorage.prototype.clear = function () {\r\n    this.items = {};\r\n    this.save();\r\n  };\r\n  OAuthStorage.prototype.getAll = function () {\r\n    var res = [];\r\n    var types = Object.getOwnPropertyNames(this.items);\r\n    for (var i = 0; i < types.length; i++) {\r\n      res.push(this.items[types[i]]);\r\n    }\r\n    return res;\r\n  };\r\n  OAuthStorage.prototype.getPrimary = function () {\r\n    var items = this.getAll();\r\n    for (var i = 0; i < items.length; i++) {\r\n      if (items[i].primary) {\r\n        return items[i];\r\n      }\r\n    }\r\n  };\r\n  OAuthStorage.prototype.getByType = function (type, userId) {\r\n    if (!type) {\r\n      return null;\r\n    }\r\n    var key = type;\r\n    if (userId) {\r\n      key = key + '-' + userId;\r\n    }\r\n    return this.items[key] || null;\r\n  };\r\n  OAuthStorage.prototype.add = function (item) {\r\n    if (item && item.type) {\r\n      var key = item.type;\r\n      if (!item.primary && item.userId) {\r\n        key = key + '-' + item.userId;\r\n      }\r\n      this.items[key] = item;\r\n      this.save();\r\n    }\r\n  };\r\n  OAuthStorage.prototype.remove = function (item) {\r\n    if (item && item.type) {\r\n      var key = item.type;\r\n      if (!item.primary && item.userId) {\r\n        key = key + '-' + item.userId;\r\n      }\r\n      delete this.items[key];\r\n      this.save();\r\n    }\r\n  };\r\n  \r\n  module.exports = Base.extend(OAuthStorage);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/id/oauth.storage.js\n// module id = 42\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var OAuthProvider = require('./oauth.provider');\r\n  var fetchproxy = require('../io/fetchproxy');\r\n\r\n  var clientType = 'google';\r\n\r\n  /** @constructor */\r\n  function OAuthProviderGoogle() {\r\n    this.clientType = clientType;\r\n  }\r\n  OAuthProviderGoogle.clientType = clientType;\r\n  \r\n  OAuthProviderGoogle.prototype.init = function (opt) {\r\n    this.initUrls({ urlLogin: 'https://accounts.google.com/o/oauth2/auth', urlToken: 'https://accounts.google.com/o/oauth2/token' });\r\n    this.initClient(opt.client);\r\n  };\r\n  OAuthProviderGoogle.prototype.getUserInfo = function (info) {\r\n    var url = 'https://www.googleapis.com/oauth2/v1/userinfo';\r\n\r\n    var opt = { 'method': 'GET', 'headers': { 'authorization': 'Bearer ' + info.token.token } };\r\n    return fetchproxy(url, opt).then(function (r) {\r\n      return r.json();\r\n    }).then(function (r) {\r\n      info.userInfo = {};\r\n      info.userInfo.user = r['email'] || '';\r\n      info.userInfo.image = r['picture'] || '';\r\n      info.userInfo.name = r['name'] || '';\r\n      return info;\r\n    });\r\n  };\r\n  \r\n  module.exports = OAuthProvider.extend(OAuthProviderGoogle);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/id/oauth.provider.google.js\n// module id = 43\n// module chunks = 0 1","define(function (require, exports, module){\r\n  'use strict';\r\n  \r\n  var globals = require('../globals');\r\n  //var fetch = require('./fetch.poly');\r\n  var fetchDefs = require('./fetch.const');\r\n\r\n  var loader = require('../loader');\r\n\r\n  var _fetch = globals.safeProp(fetchDefs.fetchKey);\r\n  var fetch = _fetch;\r\n\r\n  if (!fetch) {\r\n    fetch = function fetch() {\r\n      return _fetch.apply(null, arguments);\r\n    };\r\n    loader.load('/lib/contrib/fetch.js', 'fetch', function () {\r\n      _fetch = globals.safeProp(fetchDefs.fetchKey);\r\n    });\r\n  }\r\n\r\n  module.exports = fetch;\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/io/fetch.js\n// module id = 44\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var globals = require('../globals');\r\n\r\n  var debug = '';\r\n\r\n  var fetchMethods = {\r\n    get: 'GET',\r\n    delete: 'DELETE',\r\n    head: 'HEAD',\r\n    options: 'OPTIONS',\r\n    post: 'POST',\r\n    put: 'PUT'\r\n  };\r\n\r\n  var fetchDefinitions = {\r\n    sEmpty: '',\r\n    sEqual: '=',\r\n    sSpace: ' ',\r\n    sAmp: '&',\r\n    sLF: '\\n',\r\n    sColon: ':',\r\n\r\n    encodedSpace: /\\+/g,\r\n    \r\n    headersKey: debug + 'Headers',\r\n    headersValidator: /[^a-z0-9\\-#$%&'*+.\\^_`|~]/i,\r\n    headersInvalidHeader: 'Invalid character in header field name',\r\n    headersContentType: 'content-type',\r\n    headersLocation: 'location',\r\n    headersXRequestUrl: 'X-Request-URL',\r\n\r\n    errBodyUnsupported: 'unsupported type',\r\n    errBodyConsumed: 'already read',\r\n    errBodyFormBlob: 'could not read FormData body as blob',\r\n    errBodyFormText: 'could not read FormData body as text',\r\n    errRedirectStatus: 'Invalid status code',\r\n    errRequestBody: 'Body not allowed for GET or HEAD requests',\r\n    errRequestFailed: 'Network request failed',\r\n\r\n    hasFormData: globals.hasKey('FormData'),\r\n    hasBlob: globals.hasKey('FileReader') && globals.hasKey('Blob'),\r\n    hasSearchParams: globals.hasKey('URLSearchParams'),\r\n    hasArrayBuffer: globals.hasKey('ArrayBuffer'),\r\n\r\n    mimeTextUTF8: 'text/plain;charset=UTF-8',\r\n    mimeFormUTF8: 'application/x-www-form-urlencoded;charset=UTF-8',\r\n\r\n    fetchKey: debug + 'fetch',\r\n\r\n    requestKey: debug + 'Request',\r\n    requestCredentialsInclude: 'include',\r\n\r\n    responseKey: debug + 'Response',    \r\n    responseTypeDefault: 'default',\r\n    responseTypeError: 'error',\r\n    responseTypeKeyXHR: 'responseType',\r\n    responseTypeBlobXHR: 'blob',\r\n    responseKeyXHR: 'response',\r\n    responseURLKeyXHR: 'responseURL',\r\n    \r\n    redirectCodes: [301, 302, 303, 307, 308],\r\n    requestMethods: fetchMethods,\r\n    requestMethodsNormalize: [ fetchMethods.get, fetchMethods.post, fetchMethods.delete, fetchMethods.put, fetchMethods.head, fetchMethods.options ],\r\n  };\r\n\r\n  module.exports = fetchDefinitions;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/io/fetch.const.js\n// module id = 45\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var LiteralMap = require('../maps/literal');\r\n\r\n  var jwtProps = new LiteralMap({\r\n    audience: 'aud', nonce: 'nonce', issuer: 'iss', issued: 'iat', expiry: 'exp', verified: 'email_verified', email: 'email',\r\n    client: 'azp', hash: 'at_hash', subject: 'sub' \r\n  });\r\n\r\n  /** @constructor */  \r\n  function JWT(data) {\r\n    if (!(this instanceof JWT)) {\r\n      return new JWT(data);\r\n    }\r\n    if (typeof (data) === 'string') {\r\n      var jso = JSON.parse(atob(data.split('.')[1]));\r\n      jwtProps.mapReverse(jso, this);\r\n\r\n      var dt = Date.now() / 1000;\r\n      this.expiry = new Date((this.expiry || dt)*1000);\r\n      this.issued = new Date((this.issued || dt)*1000);\r\n      this.token = data;\r\n    }\r\n  }\r\n\r\n  module.exports = JWT;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/id/jwt.js\n// module id = 46\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var Timer = require('../timer');  \r\n  var Promise = require('../promise');\r\n  var Utils = require('../utils');\r\n  var chrome = require('../chrome/chrome');\r\n  var Window = require('../chrome/window');\r\n\r\n  var authErrKey = 'auth-error';\r\n\r\n  function exec(promise, cancel, cleanup) {\r\n    var ap = [promise];\r\n    if (cancel) {\r\n      ap.push(cancel);\r\n    }\r\n    var resolve = function (res) {\r\n      if (cleanup) {\r\n        cleanup();\r\n      }\r\n      return Promise.resolve(res);\r\n    };\r\n    var reject = function (err) {\r\n      if (cleanup) {\r\n        cleanup();\r\n      }\r\n      return Promise.reject(err);\r\n    };\r\n    return Promise.race(ap).then(resolve, reject);\r\n  }\r\n\r\n  function clearAuthInfo() {\r\n    for (var i = 0; i < arguments.length; i++) {\r\n      var key = arguments[i];\r\n      if (key && localStorage.getItem(key)) {\r\n        localStorage.removeItem(key);\r\n      }\r\n    }\r\n  }\r\n  function extractAuthInfo(hash) {\r\n    var info = {};\r\n    Utils.extractUrlInfo(hash || '', info);\r\n    return info;\r\n  }\r\n  \r\n  function addFrame(url, cb) {\r\n    var frame = document.createElement('iframe');\r\n    frame.src = url;\r\n    frame.style.display = 'none';\r\n    frame.addEventListener('load', cb);\r\n    document.body.appendChild(frame);\r\n    return frame;\r\n  }\r\n\r\n  function UnattendedValidator(opt) {\r\n    Utils.showLogInfo('identity: UnattendedValidator', opt, ['cancelToken'], true);\r\n    this.opt = opt;\r\n  }  \r\n  UnattendedValidator.prototype.init = function (resolve, reject) {\r\n    this.resolve = resolve;\r\n    this.reject = reject;\r\n\r\n    if (this.opt.nosilent) {\r\n      return this.reject({ error: { nosilent: true } });\r\n    }\r\n\r\n    clearAuthInfo(this.opt.state, authErrKey); // just for case\r\n    this.frame = addFrame(this.opt.url, function () {\r\n      this._waitFrame = setTimeout(this.check.bind(this, true), 2000);\r\n    }.bind(this));\r\n\r\n    window.addEventListener('message', this.cbMessage = function (ev) {\r\n      //debugger;\r\n      console.info('RECV:', ev);\r\n      var data = ev.data || {};\r\n\r\n      if (data.validate) {\r\n        if (data.id === chrome.runtime.id) {\r\n          ev.source.postMessage({ id: data.id }, '*');\r\n        }\r\n      } else if (typeof(data.hash) !== 'undefined') {\r\n        localStorage.setItem(this.opt.state, data.hash);\r\n        this.check(true);\r\n      }\r\n    }.bind(this));  \r\n\r\n    this._waitEvent = this.check.bind(this);\r\n    window.addEventListener('storage', this._waitEvent);\r\n  };\r\n  UnattendedValidator.prototype.shut = function () {\r\n    if (this.frame) {\r\n      this.frame.parentElement.removeChild(this.frame);\r\n      this.frame = null;\r\n    }\r\n    if (this.cbMessage) {\r\n      window.removeEventListener('message', this.cbMessage);\r\n      this.cbMessage = null;\r\n    }\r\n    if (this._waitFrame) {\r\n      this._waitFrame = clearTimeout(this._waitFrame) || 0;\r\n    }\r\n    if (this._waitEvent) {\r\n      window.removeEventListener('storage', this._waitEvent);\r\n      this._waitEvent = null;\r\n    }\r\n  };\r\n  UnattendedValidator.prototype.check = function (force) {\r\n    var hash = localStorage.getItem(this.opt.state);\r\n    if (hash) {\r\n      if (this._waitFrame) {\r\n        this._waitFrame = clearTimeout(this._waitFrame) || 0;\r\n      }\r\n      clearAuthInfo(this.opt.state);\r\n      Utils.showLogInfo('identity: UnattendedValidator.check', hash);\r\n      var res = extractAuthInfo(hash);\r\n      Utils.showLogInfo('identity: UnattendedValidator.check resolve', res);\r\n      if (!res.error) {\r\n        this.resolve(res);\r\n      } else {\r\n        this.reject(res);\r\n      }\r\n    } else if (force) {\r\n      clearAuthInfo(authErrKey);\r\n      var err = { error: { unattended: true } };\r\n      Utils.showLogInfo('identity: UnattendedValidator.check reject', err);\r\n      this.reject(err);\r\n    }\r\n  };\r\n  UnattendedValidator.prototype.async = function () {\r\n    var cmd = new Promise(this.init.bind(this));\r\n    return exec(cmd, this.opt.cancelToken, this.shut.bind(this));\r\n  };\r\n\r\n  var FORCEGETITEM = 'forceGetItem'; // Force MS Outlook catch state on check (see below), storage event never occurs\r\n  \r\n  function AttendedValidator(opt) {\r\n    Utils.showLogInfo('identity: AttendedValidator', opt, ['cancelToken'], true);\r\n    this.opt = opt;\r\n  }\r\n  AttendedValidator.prototype.init = function (resolve, reject) {\r\n    this.resolve = resolve;\r\n    this.reject = reject;\r\n\r\n    if (this.opt.noui) {\r\n      var err = { error: { noui: true } };\r\n      Utils.showLogInfo('identity: AttendedValidator reject', err);\r\n      return this.reject(err);\r\n    }\r\n    var self = this;\r\n    var apppath = window.location.protocol + '//' + window.location.hostname + window.location.pathname;\r\n// self.wnd = window.open(self.opt.url, '_self'); // open auth url in the app window\r\n// localStorage.setItem('myAppPath', apppath);\r\n    if (!this.opt.asyncui) {\r\n      var url = this.opt.url;\r\n      if (!(chrome && chrome.runtime)) { // allow Chrome (Edge, Firefox) open auth window directly (or as tab)\r\n        var redirectpath = apppath.replace(/(.*)\\/.*\\.html$/i, '$1/redirect.html'); // but use redirect for IE\r\n        url = redirectpath + '?' + this.opt.url;\r\n      }\r\n      this.wnd = Window.open(url, this.opt.target || '_blank');\r\n      if (!this.wnd) {\r\n        var err = { error: { blocked: true } };\r\n        Utils.showLogInfo('identity: AttendedValidator reject', err);\r\n        return this.reject(err);\r\n      }\r\n      this.checkWndClosed = true;\r\n    } else {\r\n      var url;\r\n      if (this.opt.asyncui.hostName === 'Outlook') {\r\n        url = apppath.replace(/(.*)\\/.*\\.html$/i, '$1/redirect.html') + '?' + this.opt.url;\r\n      } else {\r\n        url = this.opt.url;\r\n      }\r\n\r\n      this.opt.asyncui.open(url).then(function (result) {\r\n        function closePending() {\r\n          window.removeEventListener('unload', closePending);\r\n          if (self.wnd) {\r\n            self.wnd.close();\r\n            self.wnd = null;\r\n          }\r\n        }\r\n        window.addEventListener('unload', closePending);\r\n        self.wnd = result.value;\r\n        if (self.wnd) { // all known browsers open OAuth window via DialogAPI\r\n          var asyncDialog = typeof(self.wnd) === 'object' && 'addEventHandler' in self.wnd;\r\n          self.checkWndClosed = !asyncDialog;\r\n          if (asyncDialog) {\r\n            self.wnd.addEventHandler(Microsoft.Office.WebExtension.EventType.DialogEventReceived, function (event) {\r\n              if (!self.wnd) {\r\n                return;\r\n              }\r\n              console.info('dialog event received:', event.message);\r\n              if (event.error === 12002) {\r\n                if (self.wnd) {\r\n                  self.wnd.close();\r\n                  self.wnd = null;\r\n                }\r\n                self.reject({ error: { blocked: true } });\r\n                return;\r\n              }\r\n              if (event.error === 12006) {\r\n                self.wnd = null;\r\n              }\r\n              self.reject({ error: { closed: true } });\r\n            });\r\n          }\r\n        // } else if (self.opt.asyncui.hostName === 'Outlook') { // but old Outlook desktop client returns 5001 error\r\n        //   // self.wnd = window.open(self.opt.url, '_blank'); // redirect is not required // avoid allow popups request\r\n        //   self.wnd = window.open(self.opt.url, '_self'); // open auth url in the app window instead\r\n        //   localStorage.setItem('myAppPath', apppath);\r\n        }\r\n        if (!self.wnd) {\r\n          return self.reject({ error: { blocked: true } });\r\n        }\r\n      }, function (result) {\r\n          return self.reject({ error: { blocked: true } });\r\n      });\r\n    }\r\n    clearAuthInfo(this.opt.state, this.opt.authErrKey, FORCEGETITEM); // just for case\r\n    window.addEventListener('storage', this.onStorage = function onStorage(e) {\r\n      if (e.key === self.opt.state && e.newValue) {\r\n        var hash = e.newValue;\r\n        window.removeEventListener('storage', onStorage);\r\n        clearAuthInfo(self.opt.state, FORCEGETITEM);\r\n        Utils.showLogInfo('identity: AttendedValidator event resolve', hash);\r\n        self.resolve(extractAuthInfo(hash));\r\n      } \r\n      if (e.key === authErrKey && e.newValue) {\r\n        var err = e.newValue;\r\n        window.removeEventListener('storage', onStorage);\r\n        clearAuthInfo(authErrKey, FORCEGETITEM);\r\n        Utils.showLogInfo('identity: AttendedValidator event reject', err);\r\n        self.reject(err);\r\n      } \r\n    });\r\n    this.timerInterval = this.opt.checkInterval || 1000;\r\n    this.checks = 0;\r\n    this.timer = new Timer(this.check.bind(this), 0);\r\n  };\r\n  AttendedValidator.prototype.shut = function () {\r\n    if (this.wnd) {\r\n      this.wnd.close();\r\n      this.wnd = null;\r\n    }\r\n    if (this.timer) {\r\n      this.timer.reset();\r\n      this.timer = null;\r\n    }\r\n  };\r\n  AttendedValidator.prototype.check = function () {\r\n    this.checks += 1;\r\n    localStorage.setItem(FORCEGETITEM, '!!!'); // MS Outlook never gets state item without some setItem call\r\n    var hash = localStorage.getItem(this.opt.state);\r\n    if (hash) {\r\n      window.removeEventListener('storage', this.onStorage);\r\n      clearAuthInfo(this.opt.state, FORCEGETITEM);\r\n      Utils.showLogInfo('identity: AttendedValidator.check (' + this.checks + ') resolve', hash);\r\n      this.resolve(extractAuthInfo(hash));\r\n    }\r\n\r\n    if (this.checkWndClosed) {\r\n      if (chrome) { //  && chrome.runtime???\r\n        var closed;\r\n        try {\r\n          // if window.close() executed in web browser control could lead to exception here\r\n          closed = this.wnd.closed || (this.wnd.opener !== window.self);\r\n        } catch (e) {\r\n          closed = true; // wnd.opener on closed window causes error in IE\r\n        }\r\n        if (closed) {\r\n          // skip cleanup for window that is reported as closed anyway\r\n          this.wnd = null; \r\n          var err = { error: { closed: true } };\r\n          Utils.showLogInfo('identity: AttendedValidator.check (' + this.checks + ') reject', err);\r\n          return this.reject(err);\r\n        }\r\n      }\r\n    }\r\n    if (this.timeout > Date.now()) {\r\n      var err = { error: { timeout: true } };\r\n      Utils.showLogInfo('identity: AttendedValidator.check (' + this.checks + ') reject', err);\r\n      return this.reject(err);\r\n    }\r\n\r\n    this.timer.start(this.timerInterval);\r\n  };\r\n  AttendedValidator.prototype.async = function () {\r\n    var cmd = new Promise(this.init.bind(this));\r\n    return exec(cmd, this.opt.cancelToken, this.shut.bind(this));\r\n  };\r\n\r\n \r\n  function OAuthInteractive(opt) {\r\n    return new UnattendedValidator(opt).async().then(null, function (res) {\r\n      Utils.showLogInfo('identity: OAuthInteractive rejected', res);\r\n      if (res && res.error && res.error.canceled) {\r\n        return Promise.reject(res);\r\n      }\r\n      return new AttendedValidator(opt).async();\r\n    });\r\n  }\r\n\r\n  module.exports = OAuthInteractive;\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/id/oauth.interactive.js\n// module id = 47\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var ChromeTabs = require('./chrome.tabs');\r\n\r\n  function open(url, target) {\r\n    switch (window.location.protocol) {\r\n      case 'moz-extension:':\r\n        return ChromeTabs.create(url);\r\n      default:\r\n        return window.open(url, target);\r\n    }\r\n  }\r\n  \r\n  module.exports = { open: open };\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/chrome/window.js\n// module id = 48\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  // chrome.tabs is only available in background scripts\r\n  if (window.location.protocol !== 'moz-extension:') { // see ChromeTabs usage in ./window\r\n    module.exports = { };\r\n    return;\r\n  }\r\n\r\n  var chrome = require('./chrome');\r\n  var Utils = require('../utils');\r\n\r\n  var OAUTH_PROVIDER = 'https://manage1.esna.com/oauth/token.redirect';\r\n\r\n  /** @constructor */\r\n  function ChromeTabs() {\r\n    this.tabs = { };\r\n    chrome.tabs.onRemoved.addListener(function (id, info) {\r\n      if (this.tabs[id]) {\r\n        this.tabs[id].closed = true;\r\n        delete this.tabs[id];\r\n      }\r\n    }.bind(this));\r\n    chrome.tabs.onUpdated.addListener(function (id, info) {\r\n      if (!this.tabs[id] || !info || !info.url || info.url.indexOf(OAUTH_PROVIDER) !== 0) {\r\n        return;\r\n      }\r\n      var auth = info.url.substr(OAUTH_PROVIDER.length);\r\n      var state = Utils.extractUrlInfo(auth, {})['state'];\r\n      localStorage.setItem(state, auth);\r\n    }.bind(this));\r\n  }\r\n\r\n  ChromeTabs.prototype.create = function (url) {\r\n    var objtab = { opener: window };\r\n    var self = this;\r\n    chrome.tabs.create({ 'url': url }, function (tab) {\r\n      objtab.id = tab.id;\r\n      self.tabs[tab.id] = objtab;\r\n    });\r\n    objtab.close = function() {\r\n      if (this.id && !this.closed) {\r\n        chrome.tabs.remove(this.id);\r\n      }\r\n      this.closed = true;\r\n    };\r\n    objtab.closed = false;\r\n    return objtab;\r\n  };\r\n\r\n  module.exports = new ChromeTabs();\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/chrome/chrome.tabs.js\n// module id = 49\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var OAuthProvider = require('./oauth.provider');\r\n\r\n  var clientType = 'salesforce';\r\n  \r\n  /** @constructor */  \r\n  function OAuthProviderSalesforce() {\r\n    this.clientType = clientType;\r\n  }\r\n  OAuthProviderSalesforce.clientType = clientType;\r\n  \r\n  OAuthProviderSalesforce.prototype.init = function (opt) {\r\n    opt = opt || {};\r\n    if (!opt.urls) {\r\n      opt.urls = { urlLogin: 'https://login.salesforce.com/services/oauth2/authorize', urlToken: 'https://login.salesforce.com/services/oauth2/token' };\r\n    }\r\n    this.initUrls(opt.urls);\r\n    this.initClient(opt.client);\r\n  };\r\n  \r\n  module.exports = OAuthProvider.extend(OAuthProviderSalesforce);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/id/oauth.provider.salesforce.js\n// module id = 50\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var OAuthProvider = require('./oauth.provider');\r\n  var Utils = require('../utils');\r\n  var fetchproxy = require('../io/fetchproxy');\r\n\r\n  var clientType = 'esna';\r\n\r\n  /** @constructor */  \r\n  function OAuthProviderEsna() {\r\n    this.clientType = clientType;\r\n  }\r\n  OAuthProviderEsna.clientType = clientType;\r\n  \r\n  OAuthProviderEsna.prototype.init = function (opt) {\r\n    opt = opt || {};\r\n    if (!opt.urls) {\r\n      var root = opt.accountsUrl || 'https://accounts.zang.io';\r\n      if (opt.staging) {\r\n        root = 'https://onesnastaging.appspot.com';\r\n      } else if (opt.testing) {\r\n        root = 'https://onesnatesting.appspot.com';\r\n      }\r\n      var urlLogin = root + '/oauth2/authorize';\r\n      var urlLogout = root + '/account/logout' + '?next=' +  encodeURIComponent(urlLogin);\r\n      opt.urls = { urlRoot: root, urlLogin: urlLogin, urlLogout: urlLogout, urlToken: root + '/oauth2/access_token' };\r\n    }\r\n    this.initUrls(opt.urls);\r\n    this.initClient(opt.client);\r\n  };\r\n  OAuthProviderEsna.prototype.supportsIncremental = function () {\r\n    return false;\r\n  };\r\n  OAuthProviderEsna.prototype.supportsOpenId = function () {\r\n    return false;\r\n  };\r\n  OAuthProviderEsna.prototype.applyLoginScope = function (scope) {\r\n    scope.push('https://www.onesna.com/auth/userinfo.email');\r\n    scope.push('https://www.onesna.com/auth/userinfo.profile');\r\n  };\r\n  OAuthProviderEsna.prototype.getUserInfo = function (info) {\r\n    var root = this.urlRoot;\r\n    \r\n    var url = '/api/1.0/user/self/';\r\n    //var url = '/api/users/me/';\r\n    url = root + url;\r\n\r\n    var opt = { 'method': 'GET', 'headers': { 'authorization': 'Bearer ' + info.token.token } };\r\n    return fetchproxy(url, opt).then(function (r) {\r\n      try {\r\n        return r.json();\r\n      } catch (e) {\r\n        Utils.showLogInfo('identity: OAuthProviderEsna.getUserInfo, error: ' + e.message + ', r: ' + r.toString());\r\n        return Promise.reject({ error: { fetch: true } });\r\n      }\r\n    }).then(function (r) {\r\n      info.userInfo = { };\r\n      info.userInfo.user = r['username'];    \r\n      info.userInfo.image = r['picture_url'];\r\n      var n = [], name = r['name'];\r\n      if (name['formatted']) {\r\n        n.push(name['formatted']);\r\n      } else {\r\n        if (name['givenname']) {\r\n          n.push(name['givenname']);\r\n        }\r\n        if (name['familyname']) {\r\n          n.push(name['familyname']);\r\n        }\r\n      }\r\n      info.userInfo.name = n.join(' ') || '';\r\n      Utils.showLogInfo('identity: OAuthProviderEsna.getUserInfo', info);\r\n      return info;\r\n    });\r\n  };\r\n  \r\n  module.exports = OAuthProvider.extend(OAuthProviderEsna);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/id/oauth.provider.esna.js\n// module id = 51\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var OAuthProvider = require('./oauth.provider');\r\n\r\n  var clientType = 'microsoft';\r\n\r\n  /** @constructor */\r\n  function OAuthProviderMicrosoft() {\r\n    this.clientType = clientType;\r\n  }\r\n  OAuthProviderMicrosoft.clientType = clientType;\r\n  \r\n  OAuthProviderMicrosoft.prototype.init = function (opt) {\r\n    opt = opt || {};\r\n    if (!opt.urls) {\r\n      opt.urls = { urlLogin: 'https://login.windows.net/common/oauth2/authorize', urlToken: 'https://login.windows.net/common/oauth2/token' };\r\n    }\r\n    this.initUrls(opt.urls);\r\n    this.initClient(opt.client);\r\n  };\r\n  \r\n  module.exports = OAuthProvider.extend(OAuthProviderMicrosoft);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/id/oauth.provider.microsoft.js\n// module id = 52\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise = require('/lib/jsl/promise');\r\n  var PromiseQueue = require('/lib/jsl/promise.queue');\r\n  var fetchproxy = require('/lib/jsl/io/fetchproxy');\r\n  var Utils = require('/lib/jsl/utils');\r\n\r\n  var commands = {\r\n    check: {\r\n      url: '/api/1.0/licenses/self/check',\r\n      method: 'GET',\r\n      'authorization': 'Bearer '\r\n    },\r\n    accept: {\r\n      url: '/api/1.0/users/self/products/{0}/agreement/',\r\n      method: 'POST',\r\n      headers: {\r\n        'content-type': 'application/json',\r\n        'authorization': 'Bearer '\r\n      }\r\n    },\r\n    load: {\r\n      url: '/api/1.0/users/self/products/{0}/app_profile_setting/',\r\n      method: 'GET',\r\n      headers: {\r\n        'authorization': 'Bearer '\r\n      }\r\n    },\r\n    save: {\r\n      url: '/api/1.0/users/self/products/{0}/app_profile_setting/',\r\n      method: 'POST',\r\n      headers: {\r\n        'content-type': 'application/json',\r\n        'authorization': 'Bearer '\r\n      }\r\n    }\r\n  };\r\n\r\n  function getToken(provider, opt) {\r\n    var args = opt.args;\r\n    if (!args.headers || !args.headers['authorization']) {\r\n      return Promise.resolve(opt);\r\n    }\r\n    return provider.getToken().then(function (r) {\r\n      args.headers['authorization'] = 'Bearer ' + r.token;\r\n      return opt;\r\n    });\r\n  }\r\n  function execQueued(provider, queue, opt) {\r\n    var url = opt.endpoint + opt.cmd.url;\r\n    url = url.replace(/\\{0\\}/ig, opt.sku);\r\n\r\n    var data = opt.data;\r\n    var headers = { };\r\n    var h = opt.cmd.headers || {};\r\n    for (var key in h) {\r\n      headers[key] = h[key];\r\n    }\r\n    \r\n    opt = { url: url, args: { 'method': opt.cmd.method, 'body': data, 'headers': headers } };\r\n    return queue.ready().then(function (r) {\r\n      r = r;\r\n      return getToken(provider, opt);\r\n    }).then(function (opt) {\r\n      return fetchproxy(opt.url, opt.args);\r\n    }).then(function (res) {\r\n      queue.done();\r\n      if (!res.ok) {\r\n        return {};\r\n      }\r\n      return res.json();\r\n    }, function (err) {\r\n      queue.done();\r\n      return Promise.reject(err);\r\n    });\r\n  }\r\n\r\n  /** @constructor */  \r\n  function OnEsna() {\r\n    this.local = true;\r\n    \r\n    this.queue = new PromiseQueue({ max: 1 });\r\n  }\r\n  OnEsna.prototype.init = function (opt) {\r\n    this.sku      = opt.sku || 'kale';\r\n    this.endpoint = opt.endpoint || opt.accountsUrl;\r\n    this.getToken = opt.getToken;\r\n  };\r\n  OnEsna.prototype.shut = function () {\r\n    delete this.sprofile;\r\n    delete this.profile;\r\n    \r\n    this.queue.clear();\r\n  };\r\n\r\n  OnEsna.prototype.checkLicense = function () {\r\n    //var self = this;\r\n    return execQueued(this, this.queue, { endpoint: this.endpoint, sku: this.sku, cmd: commands.check }).then(function (res) {\r\n      res = res;\r\n      return Promise.resolve(true);\r\n    }, function (res) {\r\n      res = res;\r\n      return Promise.resolve(false);\r\n    });\r\n  };\r\n  OnEsna.prototype.loadProfile = function () {\r\n    if (typeof (this.profile) !== 'undefined') {\r\n      return Promise.resolve(this.profile);\r\n    }\r\n\r\n    if (this.local) {\r\n      var r = localStorage.getItem('jsl_onesna');\r\n      r = Utils.safeParse(r) || {};\r\n      this.profile = r;\r\n      this.sprofile = JSON.stringify(r);\r\n      return Promise.resolve(r);\r\n    }\r\n    \r\n    var self = this;\r\n    return execQueued(this, this.queue, { endpoint: this.endpoint, sku: this.sku, cmd: commands.load }).then(function (res) {\r\n      self.profile = res;\r\n      self.sprofile = JSON.stringify(self.profile);\r\n      return Promise.resolve(self.profile);\r\n    });\r\n  };\r\n  OnEsna.prototype.saveProfile = function (data) {\r\n    var profile = JSON.stringify(data);\r\n    if (profile === this.sprofile) {\r\n      return Promise.resolve(data);\r\n    }\r\n    \r\n    if (this.local) {\r\n      this.sprofile = JSON.stringify(this.profile);\r\n      localStorage.setItem('jsl_onesna', this.sprofile);\r\n      return Promise.resolve(this.profile);\r\n    }\r\n\r\n    var self = this;\r\n    return execQueued(this, this.queue, { endpoint: this.endpoint, sku: this.sku, cmd: commands.save, data: profile }).then(function (res) {\r\n      self.profile = data;\r\n      self.sprofile = profile;\r\n      return Promise.resolve(res);\r\n    });\r\n  };\r\n  OnEsna.prototype.loadProfileSection = function (key) {\r\n    return this.loadProfile().then(function (r) {\r\n      return (r || {})[key] || null;\r\n    });\r\n  };\r\n  OnEsna.prototype.saveProfileSection = function (key, val) {\r\n    if (!this.profile) {\r\n      return;\r\n    }\r\n    this.profile[key] = val;\r\n    return this.saveProfile(this.profile);\r\n  };\r\n\r\n  module.exports = OnEsna;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/onesna/model.js\n// module id = 53\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise = require('./promise');\r\n  //var PromiseCancel = require('./promise.cancel');\r\n\r\n  function next(queue) {\r\n    var n = queue.current.length;\r\n    for (var i = n; i < queue.max; i++) {\r\n      var qi = queue.items.shift();\r\n      if (!qi) {\r\n        return;\r\n      }\r\n      queue.current.push(qi.resolve(queue));\r\n    }\r\n  }\r\n\r\n  function PromiseQueue(opt) {\r\n    this.max     = opt.max || 1;\r\n    this.items   = [];\r\n    this.current = [];\r\n  }\r\n  PromiseQueue.prototype.ready = function () {\r\n    var self = this;\r\n    return new Promise(function (resolve, reject) {\r\n      self.items.push({ resolve: resolve, cancel: reject.bind(null, { error: { canceled: true } }) });\r\n      next(self);\r\n    });\r\n  };\r\n  PromiseQueue.prototype.done = function () {\r\n    if (this.current.length) {\r\n      this.current.pop();\r\n      next(this);\r\n    }\r\n  };\r\n  PromiseQueue.prototype.clear = function () {\r\n    var items = this.items;\r\n    var current = this.current;\r\n\r\n    var item;    \r\n    while (item = items.pop()) {\r\n      if (item.cancel) {\r\n        item.cancel();\r\n      }\r\n    }\r\n    while (item = current.pop()) {\r\n      if (item.cancel) {\r\n        item.cancel();\r\n      }\r\n    }\r\n  };\r\n\r\n  module.exports = PromiseQueue;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/promise.queue.js\n// module id = 54\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var channel = require('/lib/jsl/chrome/rpc/server');\r\n\r\n  function Channel() {\r\n    this.onConnect = channel.onConnect;\r\n    this.onDisconnect = channel.onDisconnect;\r\n  }\r\n\r\n  module.exports = new Channel();\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/channel/model.js\n// module id = 55\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var globals = require('../../globals');\r\n  var chrome = require('../chrome');\r\n\r\n  var Event = require('../../event');\r\n\r\n  var RPCPort = require('./port');\r\n  var RPCRouter = require('./router');\r\n  var RPCProxy = require('./proxy');\r\n\r\n  /** @constructor */  \r\n  function RPCServer() {\r\n    this.router = new RPCRouter();\r\n    \r\n    this.onRecv = new Event();\r\n    \r\n    this.onConnectInternal = this.onConnect.bind(this, 'internal');\r\n    //this.onConnectExternal = this.onConnect.bind(this, 'external');\r\n  }\r\n  RPCServer.prototype.connect = function () {\r\n    this.router.init();\r\n    \r\n    chrome.runtime['onConnect']['addListener'](this.onConnectInternal);\r\n    //chrome.runtime['onConnectExternal']['addListener'](this.onConnectExternal);\r\n\r\n    this.onRecv.dispatch({ msg: { open: true }, sender: { server: true } });\r\n  };\r\n  RPCServer.prototype.disconnect = function () {\r\n    this.router.shut();\r\n    \r\n    chrome.runtime['onConnect']['removeListener'](this.onConnectInternal);\r\n    //chrome.runtime['onConnectExternal']['removeListener'](this.onConnectExternal);\r\n\r\n    this.onRecv.dispatch({ msg: { close: true }, sender: { server: true } });\r\n  };\r\n  RPCServer.prototype.onConnect = function (type, port) {\r\n    var rpc = new RPCPort();\r\n    rpc.attach(port);\r\n    this.router.addPort(rpc);\r\n    this.router.addServices(rpc.id, type);\r\n\r\n    var sender = port['sender'] || null;\r\n    if (sender) {\r\n      sender = { id: rpc.id, appId: sender['id'] || null, tabId: (sender['tab'] || {})['id'] || null, frameId: sender['frameId'] || null, url: sender['url'] || null, tls: sender['tlsChannelId'] || null };\r\n    } else {\r\n      sender = { id: rpc.id };\r\n    }\r\n    this.onRecv.dispatch({ msg: { open: true }, sender: sender });\r\n    rpc.send({ open: true, sender: sender });\r\n    \r\n    rpc.onRecv.addListener(function (sender, packet) {\r\n      // disconnected\r\n      if (!packet) {\r\n        this.router.delPort(sender.id);\r\n        this.onRecv.dispatch({ msg: { close: true }, sender: sender });\r\n        return;\r\n      }\r\n\r\n      // subscribe services\r\n      if (packet.msg.services) {\r\n        if (!packet.msg.remove) {\r\n          this.router.addServices(sender.id, packet.msg.services);\r\n        } else {\r\n          this.router.delServices(sender.id, packet.msg.services);\r\n        }  \r\n        return;\r\n      }\r\n\r\n      packet.sender = sender;\r\n      this.onRecv.dispatch(packet);\r\n    }.bind(this, sender));\r\n  };\r\n  RPCServer.prototype.send = function (msg, destination) {\r\n    var ports = this.router.getPorts(destination);\r\n    for (var i = 0; i < ports.length; i++) {\r\n      var port = this.router.ports[ports[i]];\r\n      if (port) {\r\n        port.send(msg);\r\n      }\r\n    }\r\n  };\r\n  RPCServer.prototype.subscribe = function () {\r\n  };\r\n\r\n  module.exports = new RPCProxy(new RPCServer());\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/chrome/rpc/server.js\n// module id = 56\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var globals = require('../../globals');\r\n  var Event = require('../../event');\r\n  var Guid = require('../../guid');\r\n  var chrome = require('../chrome');\r\n\r\n  function RPCPort() {\r\n    this.id       = Guid.NewGuid().toString();\r\n    this.services = [];\r\n    \r\n    this.onRecv   = new Event();\r\n  }\r\n  RPCPort.prototype.attach = function (port) {\r\n    this.port = port;\r\n    var self = this;    \r\n    port['onMessage']['addListener'](function (msg) {\r\n      self.onRecv.dispatch({ msg: msg });\r\n    });\r\n    port['onDisconnect']['addListener'](function () {\r\n      self.onRecv.dispatch(null);\r\n    });\r\n  };\r\n  RPCPort.prototype.connect = function (name) {\r\n    this.attach(chrome.runtime.connect({ 'name': name }));\r\n  };\r\n  RPCPort.prototype.disconnect = function () {\r\n    if (this.port) {\r\n      this.port['disconnect']();\r\n      this.port = null;\r\n    }\r\n  };\r\n  RPCPort.prototype.send = function (msg) {\r\n    if (this.port) {\r\n      this.port['postMessage'](msg);\r\n    }\r\n  };\r\n\r\n  module.exports = RPCPort;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/chrome/rpc/port.js\n// module id = 57\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  function RPCRouter() {\r\n    this.init();\r\n  }\r\n  RPCRouter.prototype.init = function () {\r\n    this.ports = {};\r\n    this.services = {};\r\n  };\r\n  RPCRouter.prototype.shut = function () {\r\n    this.ports = {};\r\n    this.services = {};\r\n  };\r\n  RPCRouter.prototype.addPort = function (port) {\r\n    this.ports[port.id] = port;\r\n  };\r\n  RPCRouter.prototype.delPort = function (portId) {\r\n    var port = this.ports[portId];\r\n    if (port) {\r\n      delete this.ports[portId];\r\n      if (port.services) {\r\n        for (var i = 0; i < port.services.length; i++) {\r\n          var service = this.services[port.services[i]];\r\n          if (service) {\r\n            delete service[portId];\r\n          }\r\n        }\r\n      }\r\n    }\r\n  };\r\n  \r\n  RPCRouter.prototype.addServices = function (portId, services) {\r\n    var port = this.ports[portId];\r\n    if (port) {\r\n      var ps = port.services;\r\n      if (typeof (services) === 'string') {\r\n        services = [services];\r\n      }\r\n      for (var i = 0; i < services.length; i++) {\r\n        var service = services[i];\r\n        if (ps.indexOf(service) < 0) {\r\n          ps.push(service);\r\n\r\n          var all = this.services[service];\r\n          if (!all) {\r\n            all = this.services[service] = {};\r\n          }\r\n          all[portId] = 1;\r\n        }\r\n      }\r\n    }\r\n  };\r\n  RPCRouter.prototype.delServices = function (portId, services) {\r\n    var port = this.ports[portId];\r\n    if (port) {\r\n      var ps = port.services;\r\n      if (typeof (services) === 'string') {\r\n        services = [services];\r\n      }\r\n      for (var i = 0; i < services.length; i++) {\r\n        var service = services[i];\r\n        var n = ps.indexOf(service); \r\n        if (n >= 0) {\r\n          ps.splice(n, 1);\r\n\r\n          var all = this.services[service];\r\n          if (all) {\r\n            delete all[portId];\r\n          }\r\n        }\r\n      }\r\n    }\r\n  };\r\n  \r\n  RPCRouter.prototype.getPorts = function (filter) {\r\n    if (!filter) {\r\n      return [];\r\n    }\r\n    if (typeof (filter) === 'string') {\r\n      return [filter];\r\n    }\r\n    var res = {};\r\n    var fs = filter.services;\r\n    if (fs) {\r\n      for (var i = 0; i < fs.length; i++) {\r\n        var sc = this.services[fs[i]];\r\n        if (sc) {\r\n          var clients = Object.getOwnPropertyNames(sc);\r\n          for (var j = 0; j < clients.length; j++) {\r\n            res[clients[j]] = 1;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    var ports = filter.ports;\r\n    if (ports) {\r\n      for (var k = 0; k < ports.length; k++) {\r\n        res[ports[k]] = 1;\r\n      }\r\n    }\r\n    var exclude = filter.exclude;\r\n    if (typeof (exclude) === 'string') {\r\n      delete res[exclude];\r\n    } else if (exclude) {\r\n      for (var l = 0; l < exclude.length; l++) {\r\n        delete res[exclude[l]];\r\n      }\r\n    }\r\n    return Object.getOwnPropertyNames(res);\r\n  };\r\n\r\n  module.exports = RPCRouter;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/chrome/rpc/router.js\n// module id = 58\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise = require('../../promise');\r\n  var Event = require('../../event');\r\n  \r\n  var RPCSchema = require('./schema');\r\n\r\n  function reportError(proxy, e) {\r\n    proxy.onError.dispatch(e);\r\n  }\r\n\r\n  function bindMethod(proxy, service, method, opt) {\r\n    // if registering non-proxy method, then return original\r\n    if (service.server || (service.service && service.service.rpc) || !opt) {\r\n      var f = service.service[method];\r\n      if (!f) {\r\n        throw new Error('Method is not defined:' + service.id + ':' + method);\r\n      }\r\n      return f;\r\n    }\r\n\r\n    // otherwise proxy method\r\n    return function () {\r\n      var args = Array.prototype.slice.call(arguments);\r\n      var msg = { id: service.id, method: method, args: args };\r\n\r\n      // methods could be one way, or return result either via promise or callback      \r\n      var cb = null;\r\n      var promise;\r\n      if (opt.promise) {\r\n        promise = new Promise(function (resolve, reject) {\r\n          cb = { resolve: resolve, reject: reject };\r\n        });\r\n      } else if (!opt.oneway) {\r\n        cb = (typeof (args[args.length - 1]) === 'function') ? args.pop() : null;\r\n        cb = cb ? { resolve: cb, reject: cb } : null;\r\n      }\r\n\r\n      // register callback if required\r\n      if (cb) {\r\n        msg.rid = service.rid++;\r\n        service.pending[msg.rid] = cb;\r\n      }\r\n      \r\n      proxy.send(msg);\r\n      return promise;\r\n    };\r\n  }\r\n  \r\n  function bindEvent(proxy, service, event, opt) {\r\n    var evt = !service.service ? new Event() : service.service[event];\r\n    if (!evt) {\r\n      throw new Error('Event not defined:' + service.id + ':' + event);\r\n    }\r\n    opt = opt || { notify: evt.notify };\r\n    \r\n    // if registering server event\r\n    if (service.server || (service.service && service.service.rpc)) {\r\n      // bind to server event\r\n      evt.addListener(function () {\r\n        var args = Array.prototype.slice.call(arguments);\r\n        var msg = { id: service.id, event: event, args: args };\r\n\r\n        var dst = { services: [service.id] };\r\n        // if event declared to provide explicit destination\r\n        if (opt.notify) {\r\n          dst = args.shift();\r\n        }\r\n        proxy.send(msg, dst);\r\n      });\r\n    }\r\n    return evt;\r\n  }\r\n\r\n\r\n  function bindService(proxy, serviceId, service) {\r\n    var id = serviceId;\r\n    if (!id) {\r\n      throw new RangeError('Service id not defined');\r\n    }\r\n    var svc = proxy.services[id] = { id: id, rid: 1, service: service, proxy: {}, pending: {} };\r\n    \r\n    var keys = Object.getOwnPropertyNames(service);\r\n    keys = keys.concat(Object.getOwnPropertyNames(service.constructor.prototype));\r\n    for (var i = 0; i < keys.length; i++) {\r\n      var key = keys[i];\r\n      var item = service[key];\r\n\r\n      if (typeof (item) === 'function') {\r\n        svc.proxy[key] = bindMethod(proxy, svc, key, item.rpc);\r\n      } else if (item instanceof Event) {\r\n        svc.proxy[key] = bindEvent(proxy, svc, key);\r\n      }\r\n    }\r\n    return svc.proxy;\r\n  }\r\n  function unbindService(proxy, serviceId) {\r\n    var id = serviceId;\r\n    if (!id) {\r\n      throw new RangeError('Service id not defined');\r\n    }\r\n    delete proxy.services[id];\r\n  }  \r\n  \r\n\r\n  function bindSchema(proxy, schemaId, schema, service) {\r\n    var id = schemaId;\r\n    if (!id) {\r\n      throw new RangeError('Schema id not defined');\r\n    }\r\n    var svc = proxy.services[id] = { id: id, rid: 1, service: service, proxy: {}, pending: {}, server: !!service };\r\n\r\n    var wrap = !svc.server ? schema : {};\r\n    var keys = Object.getOwnPropertyNames(schema);\r\n    for (var i = 0; i < keys.length; i++) {\r\n      var key = keys[i];\r\n      var item = schema[key];\r\n\r\n      if (item === RPCSchema.methodOneWay) {\r\n        wrap[key] = svc.proxy[key] = bindMethod(proxy, svc, key, { oneway: true });\r\n      } else if (item === RPCSchema.methodPromise) {\r\n        wrap[key] = svc.proxy[key] = bindMethod(proxy, svc, key, { promise: true });\r\n      } else if (item === RPCSchema.methodCallback) {\r\n        wrap[key] = svc.proxy[key] = bindMethod(proxy, svc, key, { });\r\n      } else if (item === RPCSchema.eventBroadcast) {\r\n        wrap[key] = svc.proxy[key] = bindEvent(proxy, svc, key, { });\r\n      } else if (item === RPCSchema.eventUnicast) {\r\n        wrap[key] = svc.proxy[key] = bindEvent(proxy, svc, key, { notify: true });\r\n      }\r\n    }\r\n    \r\n    return svc.proxy;\r\n  }\r\n  function unbindSchema(proxy, schemaId, schema) {\r\n    unbindService(proxy, schemaId, schema);\r\n  }\r\n\r\n  function getService(proxy, id) {\r\n    var service = proxy.services[id];\r\n    if (!service) {\r\n      reportError(proxy, { warning: 'getService', id: id });\r\n    }\r\n    return service;\r\n  }\r\n  function invokeOpen(proxy, sender, msg) {\r\n    proxy.onConnect.dispatch(sender || msg.sender);\r\n  }\r\n  function invokeClose(proxy, sender, msg) {\r\n    msg = msg;\r\n    proxy.onDisconnect.dispatch(sender);\r\n  }\r\n  function replyMethod(proxy, sender, msg, args, error) {\r\n    if (msg.rid) {\r\n      msg.reply = true;\r\n      msg.args = args;\r\n      msg.error = error;\r\n      proxy.send(msg, sender.id);\r\n    }\r\n  }\r\n  function invokeMethod(proxy, sender, msg) {\r\n    try {\r\n      var service = getService(proxy, msg.id);\r\n      var method = service ? service.service[msg.method] : null;\r\n      if (!method) {\r\n        throw new Error('Invalid method');\r\n      }\r\n\r\n      service.service.rpcSender = sender;\r\n      var args = msg.args;\r\n      if (!Array.isArray(args)) {\r\n        args = [args];\r\n      }\r\n      var res = method.apply(service.service, args);\r\n      if (res instanceof Promise) {\r\n        res.then(replyMethod.bind(null, proxy, sender, msg), replyMethod.bind(null, proxy, sender, msg, undefined));\r\n      } else {\r\n        replyMethod(proxy, sender, msg, res);\r\n      }\r\n      service.service.rpcSender = null;\r\n    } catch (e) {\r\n      reportError(proxy, { error: 'invokeMethod', e: e, sender: sender, msg: msg });\r\n      replyMethod(proxy, sender, msg, undefined, e);\r\n    }\r\n  }\r\n  function invokeReply(proxy, sender, msg) {\r\n    try {\r\n      var service = getService(proxy, msg.id);\r\n      if (!service) {\r\n        return reportError(proxy, { warning: 'invokeReply', sender: sender, msg: msg });\r\n      }\r\n      var pending = service.pending[msg.rid];\r\n      if (!pending) {\r\n        return reportError(proxy, { warning: 'invokeReply', sender: sender, msg: msg });\r\n      }\r\n      delete service.pending[msg.rid];\r\n      if (msg.error) {\r\n        pending.reject(msg.error);\r\n      } else {\r\n        pending.resolve(msg.args);\r\n      }\r\n    } catch (e) {\r\n      return reportError(proxy, { error: 'invokeReply', e: e, sender: sender, msg: msg });\r\n    }\r\n  }\r\n  function invokeEvent(proxy, sender, msg) {\r\n    try {\r\n      var service = getService(proxy, msg.id);\r\n      if (!service) {\r\n        return reportError(proxy, { warning: 'invokeEvent', sender: sender, msg: msg });\r\n      }\r\n      var event = service.proxy[msg.event];\r\n      if (!event) {\r\n        return reportError(proxy, { warning: 'invokeEvent', sender: sender, msg: msg });\r\n      }\r\n      event.dispatch.apply(event, msg.args);\r\n    } catch (e) {\r\n      return reportError(proxy, { error: 'invokeEvent', e: e, sender: sender, msg: msg });\r\n    }\r\n  }\r\n  function invoke(proxy, packet) {\r\n    //console.info('[RPC]', 'invoke', packet);\r\n    if (!packet) {\r\n      invokeClose(proxy, { }, { });\r\n    } else if (packet.msg.open) {\r\n      invokeOpen(proxy, packet.sender, packet.msg);\r\n    } else if (packet.msg.close) {\r\n      invokeClose(proxy, packet.sender, packet.msg);\r\n    } else if (packet.msg.reply) {\r\n      invokeReply(proxy, packet.sender, packet.msg);\r\n    } else if (packet.msg.event) {\r\n      invokeEvent(proxy, packet.sender, packet.msg);\r\n    } else if (packet.msg.method) {\r\n      invokeMethod(proxy, packet.sender, packet.msg);\r\n    } else {\r\n      reportError(proxy, { warning: 'invoke', packet: packet });\r\n    }\r\n  }\r\n  function logError(e) {\r\n    if (e.error) {\r\n      console.error('[RPC]', e);\r\n    } else {\r\n      console.warn('[RPC]', e);\r\n    }\r\n  }\r\n\r\n  /** @constructor */  \r\n  function RPCProxy(channel) {\r\n    this.channel = channel;\r\n    this.channel.onRecv.addListener(invoke.bind(null, this));\r\n    this.services = {};\r\n\r\n    this.onConnect = new Event();\r\n    this.onDisconnect = new Event();\r\n    this.onError = new Event();\r\n    \r\n    this.onError.addListener(logError);\r\n  }\r\n\r\n  // register service channel\r\n  RPCProxy.prototype.register = function (serviceId, service) {\r\n    return bindService(this, serviceId, service);\r\n  };\r\n  RPCProxy.prototype.unregister = function (serviceId, service) {\r\n    return unbindService(this, serviceId, service);\r\n  };\r\n  RPCProxy.prototype.registerSchema = function (schemaId, schema, service) {\r\n    return bindSchema(this, schemaId, schema, service);\r\n  };\r\n  RPCProxy.prototype.unregisterSchema = function (schemaId, schema) {\r\n    return unbindSchema(this, schemaId, schema);\r\n  };\r\n\r\n  RPCProxy.prototype.connect = function () {\r\n    this.channel.connect();\r\n    this.subscribe();\r\n  };\r\n  RPCProxy.prototype.disconnect = function () {\r\n    this.channel.disconnect();\r\n  };\r\n  RPCProxy.prototype.send = function (msg, destination) {\r\n    this.channel.send(msg, destination);\r\n  };\r\n  \r\n  RPCProxy.prototype.subscribe = function () {\r\n    var services = Object.getOwnPropertyNames(this.services);\r\n    this.channel.subscribe(services);\r\n  };\r\n\r\n  module.exports = RPCProxy;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/chrome/rpc/proxy.js\n// module id = 59\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var schema = require('/lib/jsl/chrome/rpc/schema');\r\n\r\n  var IdentitySchema = {\r\n    onAccount: schema.eventBroadcast,\r\n    onAccounts: schema.eventUnicast,\r\n\r\n    login: schema.methodPromise,\r\n    logout: schema.methodPromise,\r\n\r\n    createAccount: schema.methodPromise,\r\n    removeAccount: schema.methodPromise,\r\n    updateAccount: schema.methodPromise,\r\n  };\r\n\r\n  module.exports = IdentitySchema;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/identity/schema.js\n// module id = 60\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var schema = require('/lib/jsl/chrome/rpc/schema');\r\n\r\n  var PartiesSchema = {\r\n    onParties: schema.eventBroadcast,\r\n    onPartiesType: schema.eventBroadcast,\r\n\r\n    getParties: schema.methodPromise,\r\n    createParty: schema.methodPromise,\r\n    removeParty: schema.methodPromise,\r\n\r\n    getPartiesType: schema.methodPromise,\r\n    setPartiesType: schema.methodPromise,\r\n  };\r\n\r\n  module.exports = PartiesSchema;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/parties/schema.js\n// module id = 61\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise = require('/lib/jsl/promise');\r\n  var fetchproxy = require('/lib/jsl/io/fetchproxy');\r\n\r\n  var methods = {\r\n    fetchUser: {\r\n      url: '/api/users/me',\r\n      method: 'GET',\r\n      authorize: true,\r\n      headers: {\r\n      }\r\n    },\r\n    fetchTopics: {\r\n      url: '/api/users/me/topics?size=100',\r\n      method: 'GET',\r\n      authorize: true,\r\n      headers: {\r\n      }\r\n    },\r\n    createTopic: {\r\n      url: '/api/topics/invite',\r\n      method: 'POST',\r\n      authorize: true,\r\n      json: true,\r\n      headers: {\r\n        'content-type': 'application/json'\r\n      }\r\n    },\r\n    createInvite: {\r\n      url: '/api/topics/{0}/invite',\r\n      method: 'POST',\r\n      authorize: true,\r\n      json: true,\r\n      headers: {\r\n        'content-type': 'application/json'\r\n      }\r\n    },\r\n    updateInvite: {\r\n      url: '/api/topics/invites/{0}',\r\n      method: 'POST',\r\n      authorize: true,\r\n      json: true,\r\n      headers: {\r\n        'content-type': 'application/json'\r\n      }\r\n    },\r\n    removeInvite: {\r\n      url: '/api/topics/invites/{0}',\r\n      method: 'DELETE',\r\n      authorize: true,\r\n      headers: {\r\n        'content-type': 'application/json'\r\n      }\r\n    },\r\n    getTopic: {\r\n      url: '/api/topics/invites/{0}/join',\r\n      method: 'GET',\r\n      authorize: true,\r\n      json: true,\r\n      headers: {\r\n        'content-type': 'application/json'\r\n      }\r\n    },\r\n  };\r\n\r\n  function applyHeaders(request) {\r\n    var keys = Object.getOwnPropertyNames(request.method.headers);\r\n    var headers = request.headers = {};\r\n    for (var i = 0; i < keys.length; i++) {\r\n      headers[keys[i]] = request.method.headers[keys[i]];\r\n    }\r\n  }\r\n  function applyBody(request) {\r\n    if (request.method.json) {\r\n      return JSON.stringify(request.args.json);\r\n    }\r\n  }\r\n  function authorize(request) {\r\n    if (!request.method.authorize) {\r\n      return Promise.resolve(request);\r\n    }\r\n    return request.token().then(function (r) {\r\n      if (r.token && r.token.token) {\r\n        r = r.token;\r\n      }\r\n      request.headers['authorization'] = [r.type, r.token].join(' ');\r\n      return request;\r\n    });\r\n  }\r\n  function convertInviteCreate(self, args) {\r\n    var topic;\r\n    var urlargs = [];\r\n    if (!args.id) {\r\n      topic = { 'title': args.title, 'description': args.description, 'type': 'group' };\r\n    } else {\r\n      urlargs.push(args.id);\r\n    }\r\n\r\n    var parties = args.parties || [];    \r\n    var invitees = [];\r\n    for (var i = 0; i < parties.length; i++) {\r\n      var item = parties[i];\r\n      if (item.email) {\r\n        if (item.email.toLowerCase() !== self.email.toLowerCase()) {\r\n          invitees.push({ 'invitee': item.email, 'inviteeType': 'email', 'role': item.member ? 'member' : 'guest' });\r\n        }\r\n      }\r\n    }\r\n    if (invitees.length === 0) {\r\n      invitees.push({ 'invitee': self.email, 'inviteeType': 'email', 'role': 'admin' });\r\n    }\r\n    var topicrq = { 'invitees': invitees };\r\n    if (topic) {\r\n      topicrq['topic'] = topic;\r\n    }\r\n    if (args.start) {\r\n      topicrq['startDateTime'] = new Date(args.start).toISOString();\r\n    }\r\n    if (args.end) {\r\n      topicrq['endDateTime'] = new Date(args.end).toISOString();\r\n    }\r\n    topicrq['informChannel'] = args.client ? 'outlook' : 'server';\r\n    topicrq['inviteMode'] = 'meet';\r\n\r\n    return { urlargs: urlargs, json: topicrq };\r\n  }\r\n  \r\n  function convertDate(v) {\r\n    if (v) {\r\n      try {\r\n        return new Date(v).valueOf();\r\n      } catch (e) {\r\n      }\r\n    }\r\n    return 0;\r\n  }\r\n  function convertMembers(self, topic, members) {\r\n    for (var i = 0; i < members.length; i++) {\r\n      var m = members[i];\r\n      var p = {};\r\n      p.joined = convertDate(m['joinTime']);\r\n\r\n      p.admin = (m['role'] === 'admin');\r\n      p.member = (m['role'] === 'member');\r\n\r\n      p.name = m['displayname'] || '';\r\n\r\n      p.id = (m['memberType'] === 'userId') ? m['member'] || '' : m['memberType'] + ':' + m['member'];\r\n      p.email = m['username'] || '';\r\n\r\n      p.self = (p.id.toLowerCase() === self.id.toLowerCase()) || (p.email.toLowerCase() === self.email.toLowerCase());\r\n      if (p.self && (p.admin || p.member)) {\r\n        topic.selfMember = true;\r\n      }\r\n      topic.members.push(p);\r\n    }\r\n  }\r\n  function convertInvitees(self, invitees) {\r\n    var res = [];\r\n    for (var i = 0; i < invitees.length; i++) {\r\n      var m = invitees[i];\r\n      var p = {};\r\n      p.admin = (m['role'] === 'admin');\r\n      p.email = (m['inviteeType'] === 'email') ? m['invitee'] || '' : m['inviteeType'] + ':' + m['invitee'];\r\n      p.self = (p.email === self.email); \r\n      res.push(p);\r\n    }\r\n    return res;\r\n  }\r\n  \r\n  function convertTopic(self, topic) {\r\n    var res = { \r\n      id: topic['targetId'] || topic['_id'], own: self.id === topic['cid'], \r\n      title: topic['title'] || '', description: topic['description'] || '', \r\n      pinned: !!topic['isPinned'], selfGuest: topic['role'] === 'guest', type: topic['type'],\r\n      status: topic['status'] || 0, lastAccess: convertDate(topic['lastAccess']), members: [] \r\n    };\r\n\r\n    res.created = convertDate(topic['created']);\r\n\r\n    res.selfMember = !res.selfGuest;\r\n    convertMembers(self, res, topic['members'] || []);\r\n\r\n    //if (res.selfMember !== !res.selfGuest) {\r\n    //  debugger;\r\n    //}\r\n\r\n    return res;\r\n  }\r\n  \r\n  function convert(request, response) {\r\n    var res = null;\r\n    switch (request.method) {\r\n      case methods.fetchUser:\r\n        res = request.response = { };\r\n        res.id = response['_id'];\r\n        res.name = response['displayname'];\r\n        res.email = response['username'];\r\n        break;\r\n      case methods.fetchTopics:\r\n        res = request.response = { next: response['nextPageUrl'], items: [], from: response['from'] - 1, to: response['to'] - 1 };\r\n        var topics = response['data'] || [];\r\n        for (var i = 0; i < topics.length; i++) {\r\n          res.items.push(convertTopic(request.userInfo, topics[i]));\r\n        }\r\n        break;\r\n      case methods.createTopic:\r\n        var topic = (response['data'] || [])[0];\r\n        res = request.response = { id: topic['topicId'], own: true, members: [], title: request.args.json['topic']['title'], description: request.args.json['topic']['description'] };\r\n        if (topic['created']) {\r\n          res.created = convertDate(topic['created']) || 0;\r\n        }\r\n        var content = response['inviteContent'] || {};\r\n        res.invite = { id: topic['_id'], content: { text: content['text'], html: content['html'] } };\r\n        res.members = convertInvitees(request.userInfo, topic['invitees'] || []);\r\n        break;\r\n      case methods.createInvite:\r\n        var invite = (response['data'] || [])[0];\r\n        var inviteContent = response['inviteContent'] || {};\r\n        res = request.response = { id: invite['_id'], topicId: invite['topicId'], content: { text: inviteContent['text'], html: inviteContent['html'] }  };\r\n        break;\r\n      case methods.getTopic:\r\n        res = request.response = { topic: response['topic'] };\r\n        break;\r\n      default:\r\n        //debugger;\r\n        break;\r\n    }\r\n    return res;\r\n  }\r\n  function execUser(request) {\r\n    if (!request.user) {\r\n      return Promise.resolve(request);\r\n    }\r\n    return request.user().then(function (r) {\r\n      request.userInfo = r;\r\n      return request;\r\n    });\r\n  }\r\n  function execRequest(request) {\r\n    applyHeaders(request);\r\n    var url = request.endpoint + (request.url || request.method.url);\r\n\r\n    if (request.args && request.args.urlargs) {\r\n      var urlargs = request.args.urlargs;\r\n      url = url.replace(/\\{[0-9]+\\}/ig, function (key) {\r\n        key = key.substr(1, key.length - 2);\r\n        return urlargs[0 | key];\r\n      });\r\n    }\r\n    \r\n    request.fetch = { url: url, opt: { 'method': request.method.method, 'headers': request.headers, 'body': applyBody(request) } };\r\n    \r\n    return execUser(request).then(function (request) {\r\n      return authorize(request); \r\n    }).then(function (request) {\r\n      return fetchproxy(request.fetch.url, request.fetch.opt); // fetchproxy causes r.status (see below) 500 if no connection \r\n    }).then(function (r) {\r\n      return r.ok ? r.json() : Promise.reject(r.status + ': ' + r.statusText); // if no connection, error is '500: ' (no statusText provided)\r\n    }).then(function (r) {\r\n      return convert(request, r);\r\n    });\r\n  }\r\n\r\n  function ZangSpaces() {\r\n    this.fetchUser = this.fetchUser.bind(this);    \r\n  }\r\n  ZangSpaces.prototype.init = function (opt) {\r\n    this.opt = opt;\r\n    this.opt.url = this.opt.url || 'https://spacesapis.zang.io';\r\n  };\r\n  ZangSpaces.prototype.shut = function () {\r\n    delete this.opt;\r\n  };\r\n\r\n  ZangSpaces.prototype.fetchUser = function () {\r\n    if (this.userInfo) {\r\n      return Promise.resolve(this.userInfo);\r\n    }\r\n    \r\n    var self = this;\r\n    return execRequest({ endpoint: this.opt.url, token: this.opt.token, method: methods.fetchUser }).then(function (r) {\r\n      if (self.opt) {\r\n        self.userInfo = r;\r\n      }\r\n      return r;\r\n    });\r\n  };\r\n  \r\n  ZangSpaces.prototype.fetchTopics = function (args) {\r\n    return execRequest({ endpoint: this.opt.url, url: args ? args.url : null, token: this.opt.token, user: this.fetchUser, method: methods.fetchTopics, args: args });\r\n  };\r\n\r\n  ZangSpaces.prototype.createTopic = function (args) {\r\n    args = convertInviteCreate(this.userInfo, args);\r\n    //return Promise.resolve({});\r\n    return execRequest({ endpoint: this.opt.url, token: this.opt.token, user: this.fetchUser, method: methods.createTopic, args: args });\r\n  };\r\n  ZangSpaces.prototype.updateTopic = function (args) {\r\n  };\r\n  ZangSpaces.prototype.removeTopic = function (args) {\r\n  };\r\n  \r\n  ZangSpaces.prototype.createInvite = function (args) {\r\n    args = convertInviteCreate(this.userInfo, args);\r\n    //return Promise.resolve({});\r\n    return execRequest({ endpoint: this.opt.url, token: this.opt.token, user: this.fetchUser, method: methods.createInvite, args: args });\r\n  };\r\n  ZangSpaces.prototype.updateInvite = function (args) {\r\n    return execRequest({ endpoint: this.opt.url, token: this.opt.token, user: this.fetchUser, method: methods.updateInvite, args: args });\r\n  };\r\n  ZangSpaces.prototype.removeInvite = function (args) {\r\n    args = { urlargs: [args.id] };\r\n    return execRequest({ endpoint: this.opt.url, token: this.opt.token, user: this.fetchUser, method: methods.removeInvite, args: args });\r\n  };\r\n  ZangSpaces.prototype.getTopic = function (args) {\r\n    args = { urlargs: [args.id] };\r\n    return execRequest({ endpoint: this.opt.url, token: this.opt.token, user: this.fetchUser, method: methods.getTopic, args: args });\r\n  };\r\n\r\n  ZangSpaces.prototype.getJoinUrl = function (id) {\r\n    if (!this.opt) {\r\n      return;\r\n    }\r\n    return this.opt.url + '/spaces/' + id;\r\n  };\r\n  ZangSpaces.prototype.getInviteJoinUrl = function (id) {\r\n    if (!this.opt) {\r\n      return;\r\n    }\r\n    return this.opt.url + '/spaces/invites/' + id + '/meet';\r\n  };\r\n  \r\n  module.exports = ZangSpaces;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/spaces/spaces.js\n// module id = 62\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Base      = require('/lib/jsl/base');\r\n  var Event     = require('/lib/jsl/event');\r\n  var Promise   = require('/lib/jsl/promise');\r\n\r\n  /** @constructor */\r\n  function Model() {\r\n    this.onTopic = new Event();\r\n    this.onProgress = new Event();\r\n  }\r\n\r\n  Model.prototype.init = function(opt) {\r\n    return Promise.resolve();\r\n  };\r\n\r\n  Model.prototype.login = function(opt) {\r\n    return Promise.resolve();\r\n  };\r\n\r\n  Model.prototype.logout = function() {\r\n    return Promise.resolve();\r\n  };\r\n\r\n  Model.prototype.shut = function() {\r\n    return Promise.resolve();\r\n  };\r\n\r\n  Model.prototype.pollTopics = function() {\r\n    return Promise.resolve();\r\n  };\r\n\r\n  Model.prototype.checkInvite = function() {\r\n    return Promise.resolve();\r\n  };\r\n\r\n  Model.prototype.getTopics = function() {\r\n    return { items: [] };\r\n  };\r\n  \r\n  Model.prototype.cancel = function() {\r\n  };\r\n\r\n  Model.prototype.setInfo = function(info) {\r\n  };\r\n  \r\n  Model.prototype.compare = function(a, b) {\r\n    return 0;\r\n  };\r\n\r\n  module.exports = Base.extend(Model);\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./sources/model.js\n// module id = 63\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise       = require('/lib/jsl/promise');\r\n\r\n  var invite        = require('../../invite');\r\n\r\n  var Rooms         = require('../../model/rooms/model');\r\n\r\n  var office        = require('../../office');\r\n  var SourceModel   = require('../model');\r\n\r\n  /** @constructor */\r\n  function Model() {\r\n    this.source = 'rooms';\r\n    this.$super();\r\n    this.rooms = Rooms;\r\n  }\r\n\r\n  Model.prototype.init = function(opt) {\r\n    this.configuration = opt.configuration || invite.getConfiguration() || { };\r\n    this.languageId = opt.languageId;\r\n    this.lastError = null;\r\n    return this.rooms.configure(JSON.stringify(this.configuration), this.languageId, opt.i18n);\r\n  };\r\n  \r\n  Model.prototype.login = function(opt) {\r\n    opt = opt || { };\r\n    if (this.password) {\r\n      this.rooms.config.password = this.password;\r\n    }\r\n    if (this.rooms.config.mode !== 'equinox') { // same as !settings.unifiedPortalEnabled\r\n      return Promise.resolve(); // do not try login if !settings.unifiedPortalEnabled\r\n    }\r\n    if (!this.rooms.config.user) {\r\n      return Promise.reject({ error: { credentials: true } }); // do not try login if user is not defined in configuration\r\n    }\r\n    var self = this;\r\n    return this.rooms.login().then(function () {\r\n      return Promise.resolve();\r\n    }, function (e) {\r\n      if (e.error && e.error.fetch) {\r\n        if (opt.forceLogin) {\r\n          return Promise.reject(e);\r\n        }\r\n        self.lastError = e.error;\r\n        return Promise.resolve(); // ignore fetch errors on login (use cached rooms in this case, see below)\r\n      }\r\n      if (self.rooms.config.password && typeof(self.password) === 'undefined') {\r\n        return Promise.reject({ error: { credentials: true } }); // do not ask password if bad password is provided in configuration (SV request)\r\n      }\r\n      if (e.error && (e.error.httpStatus === 400 || e.error.httpStatus === 401)) {\r\n        return Promise.reject({ error: { password: !self.rooms.config.password ? 'empty' : 'bad' }, info: { user: self.rooms.config.user } });\r\n      }\r\n      throw e; // TODO: process some others unhandled errors???\r\n    });\r\n  };\r\n\r\n  Model.prototype.logout = function() {\r\n    delete this.password;\r\n    return this.rooms.logout();\r\n  };\r\n\r\n  Model.prototype.pollTopics = function() {\r\n    // allow use cached rooms if login failed with fetch error (see above)\r\n    var args = (this.lastError && this.lastError.fetch) ? { forceFetch: false, cachedOnly: true } : { forceFetch: true };\r\n    var self = this;\r\n    return this.rooms.getRooms(args).then(function (rooms) {\r\n      if (!rooms || rooms.length === 0) {\r\n        return Promise.reject({ error: { notopics: true } });\r\n      }\r\n      rooms.forEach(function (room) {\r\n        self.onTopic.dispatch({ item: { id: room.id, source: self.source, searchable: true, title: room.name, members: [], icon: 'rooms-item-icon', room: room } });\r\n      });\r\n      return Promise.resolve(rooms);\r\n    });\r\n  };\r\n\r\n  Model.prototype.getTopics = function() {\r\n    var res = { items: [] };\r\n    var topics = this.rooms.getTopics().items || [];\r\n    topics.forEach(function (topic) {\r\n      topic.source = this.source;\r\n      topic.searchable = true;\r\n      topic.icon = 'rooms-item-icon';\r\n      res.items.push(topic);\r\n    }, this);\r\n    return res;\r\n  };\r\n  \r\n  Model.prototype.checkInvite = function() {\r\n    var self = this;\r\n    return invite.getMeetingInfo({ location: true, body: true, type: (office.webAPI ? 'html' : '') }).then(function (r) {\r\n      return (self.rooms.checkInvite(JSON.stringify(self.configuration), self.languageId, r[0], r[1]));\r\n    });\r\n  };\r\n\r\n  Model.prototype.createInvite = function(invite) {\r\n    var self = this;\r\n    return this.rooms.createInvite(invite).catch(function (e) {\r\n      if (e.error && (e.error.httpStatus === 400 || e.error.httpStatus === 401)) {\r\n        return Promise.reject({ error: { password: !self.rooms.config.password ? 'empty' : 'bad' }, info: { user: self.rooms.config.user } });\r\n      }\r\n      throw e; // pass some others unhandled errors to the app\r\n    });\r\n  };\r\n\r\n  Model.prototype.getTopic = function(id) {\r\n    return this.rooms.getTopic(id);\r\n  };\r\n  \r\n  Model.prototype.setInfo = function(info) {\r\n    if (info && info.password) {\r\n      this.password = info.password;\r\n      if (this.rooms.config) {\r\n        this.rooms.config.password = this.password;\r\n      }\r\n    }\r\n  };\r\n\r\n  Model.prototype.compare = function(a, b) {\r\n    var ta = this.rooms.getTopic(a.id);\r\n    var tb = this.rooms.getTopic(b.id);\r\n    if (!ta || !ta.room || !tb || !tb.room) {\r\n      return 0;\r\n    }\r\n    var tamy = ta.room.own ? '1' : '0';\r\n    var tbmy = ta.room.own ? '1' : '0';\r\n\r\n    var tane = (ta.room.type === 'equinox') ? '0' : '1';\r\n    var tbne = (tb.room.type === 'equinox') ? '0' : '1';\r\n\r\n    var tak = tamy + tane;\r\n    var tbk = tbmy + tbne;\r\n\r\n    if (tak < tbk) {\r\n      return -1;\r\n    } else if (tak > tbk) {\r\n      return 1;\r\n    }\r\n    return 0;\r\n  };\r\n  \r\n  module.exports = SourceModel.extend(Model);  \r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./sources/rooms/model.js\n// module id = 64\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise       = require('/lib/jsl/promise');\r\n  var Storage       = require('/lib/jsl/storage');\r\n  var Utils         = require('/lib/jsl/utils');\r\n\r\n  var invite        = require('../../invite');\r\n\r\n  var Identity      = require('../../model/identity/model');\r\n  var AppStates     = require('../../model/identity/states');\r\n  var Spaces        = require('../../model/spaces/model');\r\n\r\n  var States        = require('../../states');\r\n\r\n  var SourceModel   = require('../model');\r\n\r\n  /** @constructor */\r\n  function Model() {\r\n    this.source = 'spaces';\r\n    this.$super();\r\n    this.identity = Identity;\r\n    this.spaces = Spaces;\r\n    this.firstLogin = true;\r\n    this.spaces.onTopic.addListener(this.evSpaceItem, this);\r\n  }\r\n\r\n  Model.prototype.init = function(opt) {\r\n    this.configuration = opt.configuration || invite.getConfiguration() || { };\r\n    invite.setSpacesOpt(this.spaces, this.configuration);\r\n  };\r\n\r\n  Model.prototype.login = function(opt) {\r\n    var logout = opt.logout || !this.firstLogin;\r\n    var noui = opt.noui; // preserve opt.noui\r\n    if (this.firstLogin) {\r\n      noui = false; // SDC 3.4 6. spaces sign-in do not prompt first time\r\n      this.firstLogin = false;\r\n    }\r\n    var optlogin = { noui: noui, asyncui: opt.asyncui, logout: logout };\r\n    var accountsUri = this.configuration['AVAYA_CLOUD_ACCOUNTS_URI'];\r\n    if (accountsUri) {\r\n      optlogin.accountsUrls = { 'esna': accountsUri };\r\n    }\r\n    var self = this;\r\n    return new Promise(function (resolve, reject) {\r\n      var evIdentity = self.evIdentity.bind(self, resolve, reject);\r\n      self.identity.onAccount.addListener(evIdentity);\r\n      var acl0 = Storage.getItem('AVAYA_CLOUD_LOGIN_ID') || '';\r\n      var acl = (self.configuration['AVAYA_CLOUD_LOGIN_ID'] || '').toLowerCase();\r\n      var logout;\r\n      if (acl0 === acl) {\r\n        logout = Promise.resolve();\r\n      } else {\r\n        optlogin.noui = false;\r\n        optlogin.logout = true;\r\n        console.info('Force logout due to user changed in the client');\r\n        Storage.removeItem('zangAgenda'); // force remove cached tokens if user login id changed (ACW-14229)\r\n        Storage.setItem('AVAYA_CLOUD_LOGIN_ID', acl);\r\n        // logout = self.identity.logout(); // identity is not initialized yet, so logout() just returns\r\n        logout = Promise.resolve();\r\n      }\r\n      logout.then(function () {\r\n        self.loggingin = true;\r\n        return self.identity.login(optlogin).then(function(account) {\r\n          self.loggingin = false;\r\n          // nothing to do???\r\n        }, function(err) {\r\n          self.loggingin = false;\r\n          return reject(err);\r\n        });\r\n      }, function (err) {\r\n        // return reject(err);\r\n      });\r\n    });\r\n  };\r\n\r\n  Model.prototype.evIdentity = function(resolve, reject, account) {\r\n    var state;\r\n    switch (account.state) {\r\n      case AppStates.Unauthorized:\r\n        state = States.Src.Unauthorized;\r\n        break;\r\n      case AppStates.Authorizing:\r\n        state = States.Src.Authorizing;\r\n        break;\r\n      case AppStates.Unauthorizing:\r\n        state = States.Src.Unauthorizing;\r\n        break;\r\n      case AppStates.Authorized:\r\n        state = States.Src.Authorized;\r\n        break;\r\n    }\r\n    if (state === States.Src.Unauthorized) {\r\n      this.loggingin = false;\r\n      // reject({ error: { login: true } });\r\n      return;\r\n    }\r\n    if (state === States.Src.Authorized) {\r\n      resolve();\r\n      return;\r\n    }\r\n  };\r\n\r\n  Model.prototype.logout = function() {\r\n    this.firstLogin = true;\r\n    return this.identity.logout();\r\n  };\r\n\r\n  Model.prototype.pollTopics = function() {\r\n    // return this.spaces.pollTopics();\r\n    var self = this;\r\n    this.spaces.pollTopics().then(function () {\r\n      self.onProgress.dispatch(self.source, { fetched: true });\r\n    }, function (err) {\r\n      self.onProgress.dispatch(self.source, { err: err });\r\n    });\r\n    return Promise.resolve();\r\n  };\r\n\r\n  Model.prototype.evSpaceItem = function (space) {\r\n    space.item.source = this.source;\r\n    this.onTopic.dispatch(space);\r\n  };\r\n\r\n  Model.prototype.getTopics = function() {\r\n    var res = { items: [] };\r\n    var topics = this.spaces.getTopics().items || [];\r\n    topics.forEach(function (topic) {\r\n      topic.source = this.source;\r\n      res.items.push(topic);\r\n    }, this);\r\n    return res;\r\n  };\r\n  \r\n  Model.prototype.checkInvite = function(precheck) {\r\n    var self = this;\r\n    return invite.getMeetingInfo({ body: true }).then(function (r) {\r\n      return self.spaces.checkInvite(r[0], precheck);\r\n    });\r\n  };\r\n\r\n  Model.prototype.createInvite = function(invite) {\r\n    return this.spaces.createInvite(invite);\r\n  };\r\n\r\n  Model.prototype.createTopic = function(topic) {\r\n    var self = this;\r\n    return this.spaces.createTopic(topic).then(function (r) {\r\n      r.source = self.source;\r\n      return Promise.resolve(r);\r\n    });\r\n  };\r\n\r\n  Model.prototype.cancel = function() {\r\n    if (this.loggingin) {\r\n      this.logout();\r\n    }\r\n  };\r\n\r\n  Model.prototype.getTopic = function(id) {\r\n    return this.spaces.getTopic(id);\r\n  };\r\n  \r\n  module.exports = SourceModel.extend(Model);  \r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./sources/spaces/model.js\n// module id = 65\n// module chunks = 0","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var dom           = require('/lib/jsl/dom');\r\n  var Action        = require('/lib/jsl/ui/action');\r\n  var ListView      = require('/lib/jsl/ui/listview');\r\n\r\n  var cssItem = 'li spaces-item';\r\n  var cssItemError = 'error-item';\r\n  var cssItemAction = 'li-main spaces-item-action';\r\n  var cssItemIcon = 'li-icon spaces-item-icon';\r\n  var cssItemText = 'li-text';\r\n  var cssItemTitle = 'li-title spaces-item-title';\r\n  var cssItemDesc = 'li-desc spaces-item-desc';\r\n  var cssGroupFirstItem = 'spaces-group'\r\n  \r\n  var _colors = ['#FFEC00', '#EC00FF', '#FFC627', '#27FFC6', '#FFA714', '#A7FF14', '#FB824F', '#4F82FB', '#F16930', '#F13069', '#81CFD5', '#CF81D5', '#CCCCCC', '#888888', '#008800', '#008888'];\r\n  \r\n  function convertToColor(item) {\r\n    if (item.id === SpacesList.NEW) {\r\n      return '#000000';\r\n    }\r\n\r\n    var info = [item.id, item.title || '?'].join('');\r\n\r\n    var crc = 0;\r\n    for (var i = 0; i < info.length; i++) {\r\n      crc = crc ^ info.charCodeAt(i);\r\n    }\r\n    return _colors[crc & 0xf];\r\n  }\r\n\r\n\r\n  function SpacesList(opt) {\r\n    this._setStyles(opt || {});\r\n    this.$super({});\r\n    this.searchValue = '';\r\n  }\r\n\r\n  SpacesList.NEW = 'NEW';\r\n\r\n  SpacesList.prototype.updateItem = function (li, item) {\r\n    var c = li.content;\r\n\r\n    if (!c) {\r\n      li.addClass(this._styles.item);\r\n      if (item.error) {\r\n        li.addClass(this._styles.itemError);\r\n      }\r\n      li.data = item;\r\n      c = li.content = {};\r\n\r\n      li.add(new Action().addClass(this._styles.itemAction).add(\r\n        c.icon = dom.div().addClass(this._styles.itemIcon),\r\n        dom.div().addClass(this._styles.itemText).add(\r\n          c.title = dom.div().addClass(this._styles.itemTitle),\r\n          c.desc = dom.div().addClass(this._styles.itemDesc)\r\n        )\r\n      ));\r\n      if (item.icon) {\r\n        c.icon.add(dom.div().addClass(item.icon));\r\n      }\r\n    }\r\n\r\n    c.title.node.textContent = item.title;\r\n    c.desc.node.textContent = item.desc;\r\n\r\n    var _abbr = item.title.split(' ');\r\n    var abbr = (_abbr[0] || '?').substr(0, 1) + (_abbr[1] || '').substr(0, 1);\r\n\r\n    if (item.id === SpacesList.NEW) {\r\n      abbr = '+';\r\n    }\r\n\r\n    if (!item.icon) {\r\n      c.icon.node.setAttribute('first', abbr.toUpperCase());\r\n      c.icon.node.style.backgroundColor = convertToColor(item);\r\n    }\r\n\r\n    li.data = item;\r\n\r\n    li.toggleClass('hidden', !item.show);\r\n \r\n    var search = this.searchValue.toLowerCase().trim();\r\n    var title = (li.data.title || '').toLowerCase();\r\n\r\n    li.node.style.display = !!search && title.indexOf(search) < 0 ? 'none' : '';\r\n    //this.group();\r\n    this.sort();\r\n };\r\n\r\n  SpacesList.prototype.compare = function (a, b) {\r\n    if (a.data.id === SpacesList.NEW) {\r\n      return -1;\r\n    }\r\n    if (b.data.id === SpacesList.NEW) {\r\n      return 1;\r\n    }\r\n\r\n    function compare_lexically(at, bt) {\r\n      if (at < bt) {\r\n        return -1;\r\n      }\r\n      if (at > bt) {\r\n        return 1;\r\n      }\r\n      return 0;\r\n    }\r\n\r\n    function compare_lastAccess(a, b) {\r\n      var ad = a.data.lastAccess || 0;\r\n      var bd = b.data.lastAccess || 0;\r\n      if (ad < bd) {\r\n        return 1;\r\n      }\r\n      if (ad > bd) {\r\n        return -1;\r\n      }\r\n      return 0;\r\n    }\r\n\r\n    function compare_index(at, bt, s) {\r\n      var ai = at.indexOf(s);\r\n      var bi = bt.indexOf(s);\r\n\r\n      if (ai < 0 && bi < 0) {\r\n        return 0;\r\n      }\r\n\r\n      if (bi < 0) {\r\n        return -1;\r\n      }\r\n\r\n      if (ai < 0) {\r\n        return 1;\r\n      }\r\n\r\n      return (ai - bi);\r\n    }\r\n\r\n    var at = (a.data.title || '').toLowerCase();\r\n    var bt = (b.data.title || '').toLowerCase();\r\n    var search = this.searchValue.toLowerCase().trim();\r\n\r\n    var res = search ? compare_index(at, bt, search) : 0;\r\n    if (res === 0) {\r\n      //res = compare_lastAccess(a,b);\r\n      //if( res === 0) {\r\n      res = compare_lexically(at, bt);\r\n      //}\r\n    }\r\n    return res;\r\n  };\r\n\r\n  SpacesList.prototype.group = function () {\r\n    var search = this.searchValue.toLowerCase().trim();\r\n    var first = false;\r\n\r\n    var len = this.node.children.length;\r\n    for (var i = 0; i < len; i++) {\r\n      var c = this.node.children[i];\r\n      var id = c.getAttribute(this.$itemId);\r\n      var li = this.getItem(id);\r\n\r\n      var hidden = !!search && !li.data.searchable;\r\n      li.toggleClass('hidden', hidden);\r\n      var title = (li.data.title || '').toLowerCase();\r\n      if (!hidden && !first && title.indexOf(search) < 0) {\r\n        li.addClass(this._styles.groupFirstItem);\r\n        first = true;\r\n      } else {\r\n        li.delClass(this._styles.groupFirstItem);\r\n      }\r\n    }\r\n  }\r\n\r\n  SpacesList.prototype._setStyles = function(opt) {\r\n    this._styles = {\r\n      item: opt.cssItem || cssItem,\r\n      itemError: opt.cssItemError || cssItemError,\r\n      itemAction: opt.cssItemAction || cssItemAction,\r\n      itemIcon: opt.cssItemIcon || cssItemIcon,\r\n      itemText: opt.cssItemText || cssItemText,\r\n      itemTitle: opt.cssItemTitle || cssItemTitle,\r\n      itemDesc: opt.cssItemDesc || cssItemDesc,\r\n      groupFirstItem: opt.cssGroupFirstItem || cssGroupFirstItem\r\n    };\r\n  }\r\n\r\n  SpacesList.prototype.test = function () {\r\n    var s = 'abcdefghjiklmnopqrstuvwxyz';\r\n    for (var i = 0; i < 15; i++) {\r\n      this.insert({ id: 'i' + i, title: s[i] + ' test#' + i, desc: 'desc#' + i, /*icon: 'zang',*/ show: true });\r\n    }\r\n  };\r\n\r\n  module.exports = ListView.extend(SpacesList);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/ui/spaces.list.js\n// module id = 66\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  require('../css/main.css');\r\n  var loader = require('/lib/jsl/loader');\r\n  var Promise = require('/lib/jsl/promise');\r\n  var Storage = require('/lib/jsl/storage');\r\n  var controller = require('./ui/controller');\r\n  var model = require('./model');\r\n\r\n  var ui = new controller(model);\r\n\r\n  var called = false;\r\n  \r\n  function ready(opt) {\r\n    // supress context menu in browser with exception of input fields and elements assigned a certain class\r\n    document.addEventListener('contextmenu', function (ev) {\r\n      var el = ev.target || {};\r\n      if (((el.tagName || '').toUpperCase() === 'INPUT') || (el.className.indexOf('contextMenu') >= 0)) {\r\n        return true;\r\n      }\r\n      ev.preventDefault();\r\n      ev.stopPropagation();\r\n      return false;\r\n    });\r\n\r\n    opt = opt || { noui : true };\r\n    model.init(opt);\r\n  }\r\n\r\n  window.appRestart = ready;\r\n  \r\n  //Office.initialize = ready;\r\n  loader.wait(function () {\r\n    if (called) {\r\n      return;\r\n    }\r\n    called = true;\r\n\r\n    if (Promise._setScheduler) {\r\n      console.info('Set Promise custom scheduler'); // this info doesn't appear in the log, (why???)\r\n      var customSchedulerFn = function (flush) {\r\n        // console.info('Promise custom scheduler called'); // but this appears\r\n        return setTimeout(flush, 1);\r\n      };\r\n      Promise._setScheduler(customSchedulerFn);\r\n    }\r\n\r\n    ready();\r\n  });\r\n\r\n  var cache = window.applicationCache;\r\n  var loaded = 0;\r\n  cache.addEventListener('checking', function () {\r\n    console.info('app:appcache:checking');\r\n  });\r\n  cache.addEventListener('noupdate', function () {\r\n    console.info('app:appcache:noupdate');\r\n  });\r\n  cache.addEventListener('downloading', function () {\r\n    console.info('app:appcache:downloading');\r\n  });\r\n  cache.addEventListener('progress', function () {\r\n    // console.info('app:appcache:progress');\r\n    loaded += 1;\r\n  });\r\n  cache.addEventListener('cached', function () {\r\n    console.info('app:appcache:cached:' + loaded);\r\n  });\r\n  cache.addEventListener('updateready', function () {\r\n    console.info('app:appcache:updateready');\r\n    cache.swapCache();\r\n    Storage.enabled = false; // disable storage in order to prevent unexpected modifications on reload\r\n    location.reload();\r\n  });\r\n  cache.addEventListener('obsolete', function () {\r\n    console.info('app:appcache:obsolete');\r\n  });\r\n  cache.addEventListener('error', function (err) {\r\n    err = err || { };\r\n    console.error('app:appcache:error:' + JSON.stringify({ reason: err.reason, url: err.url, status: err.status, message: err.message }));\r\n  });\r\n\r\n  module.exports = { };\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./app.js\n// module id = 67\n// module chunks = 0","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../css/main.css\n// module id = 68\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Log = require('/lib/jsl/log');\r\n\r\n  var dom = require('/lib/jsl/dom');\r\n  var panel = require('/lib/jsl/ui/panel');\r\n  \r\n  var cfgwizard = require('./cfgwizard');\r\n  var progress = require('./progress');\r\n  var meeting  = require('./meeting');\r\n  // var topics   = require('./topics');\r\n  var invited  = require('./invited');\r\n  var popup    = require('./popup');\r\n  var error    = require('./error');\r\n  var links    = require('./links');\r\n\r\n  var States   = require('../states');\r\n\r\n  var i18n     = require('../i18n');\r\n\r\n  var logger = Log.createLogger('CNTRLR');\r\n\r\n  /** @constructor */\r\n  var controller = function controller(model) {\r\n    this.model = model;\r\n    this.model.onState.addListener(this.evState, this);\r\n  };\r\n\r\n  controller.prototype.init = function (retry) {\r\n    if (retry) {\r\n      this.panels.$view.del(true);\r\n    }\r\n    this.panels = {\r\n      $view: new panel(),\r\n      $current: null,\r\n      \r\n      cfgwizard: new cfgwizard({ model: this.model }),\r\n      progress: new progress({ model: this.model }),\r\n      meeting: new meeting({ model: this.model }),\r\n      // topics: new topics({ model: this.model }),\r\n      invited: new invited({ model: this.model }),\r\n      links: new links({ model: this.model }),\r\n      popup: new popup(),\r\n      error: new error(),\r\n    };\r\n    \r\n    this.panels.cfgwizard.addClass('hidden');\r\n    this.panels.progress.addClass('hidden');\r\n    this.panels.meeting.addClass('hidden');\r\n    // this.panels.topics.addClass('hidden');\r\n    this.panels.invited.addClass('hidden');\r\n    this.panels.popup.addClass('hidden');\r\n    this.panels.error.addClass('hidden');\r\n    \r\n    this.panels.$view.add(this.panels.cfgwizard);\r\n    this.panels.$view.add(this.panels.progress);\r\n    this.panels.$view.add(this.panels.meeting);\r\n    // this.panels.$view.add(this.panels.topics);\r\n    this.panels.$view.add(this.panels.invited);\r\n    this.panels.$view.add(this.panels.popup);\r\n    this.panels.$view.add(this.panels.links);\r\n\r\n    this.panels.links.render(); // render links on init as not switchable panel\r\n\r\n    dom.body.add(this.panels.$view);\r\n\r\n    if (!retry) {\r\n      this.model.onError.addListener(this.evError, this);\r\n      // this.evState(this.model.ctxstate);\r\n      this.panels.popup.onHide.addListener(this.refresh, this);\r\n    }\r\n  };  \r\n  \r\n  controller.prototype.evState = function(ctxstate) {\r\n    if (this._init && ctxstate.app === States.App.Unknown) {\r\n      this._init = false;\r\n      this._retry = true;\r\n    }\r\n    if (!this._init) {\r\n      this._init = true;\r\n      // dom.get('splash').del();\r\n      this.init(this._retry);\r\n      this.switch(this.panels, this.panels.progress);\r\n    }\r\n    this.panels.progress.update(ctxstate);\r\n    if (ctxstate.app === States.App.Initializing) {\r\n      this.panels.links.addClass('hidden');\r\n      this.panels.links.update(ctxstate);\r\n    }\r\n    if (!this.model.joinMode && ctxstate.app === States.App.Configured) {\r\n      this.panels.links.delClass('hidden');\r\n      this.panels.links.update(ctxstate);\r\n    }\r\n    if (ctxstate.app === States.App.NotConfigured) {\r\n      this.panels.links.update(ctxstate);\r\n      this.switch(this.panels, this.panels.cfgwizard);\r\n    }\r\n    if (ctxstate.app === States.App.NotInitialized ||\r\n        ctxstate.app === States.App.SrcInitializing) {\r\n      this.switch(this.panels, this.panels.progress);\r\n    }\r\n    if (ctxstate.app !== States.App.Initialized) {\r\n      return;\r\n    }\r\n    var checked = true; // app state is Initialized, so check is already done (except sources under reinitializing)\r\n    // Object.getOwnPropertyNames(this.model.sources).forEach(function (name) {\r\n    //   if (ctxstate.sources[name] !== States.Src.Checked) {\r\n    //     checked = false;\r\n    //   }\r\n    // });\r\n    if (checked) {\r\n      // var invited = ctxstate.invites.length > 0;\r\n      var invited = !!this.model._invite;\r\n      logger.info('State event: app: ' + States.App.names[ctxstate.app] + ', invited: ' + invited);\r\n      this.switch(this.panels, invited ? this.panels.invited : this.panels.meeting);\r\n      if (!invited) {\r\n        // var sources = Object.getOwnPropertyNames(this.model.getValidSources()); // switch to view using successfully initialized sources\r\n        var sources = this.model.cfgSources; // switch to view using sources from configuration\r\n        var meeting = sources.length === 1 && sources[0] === 'rooms';\r\n        var title = meeting ? i18n.i18n.titleMeetingDetails : i18n.i18n.titleMeetingPlaces;\r\n        var selector = meeting ? this.panels.meeting.details : this.panels.meeting.places;\r\n\r\n        this.panels.meeting.toggleClass('panel-meeting-view-equinox', meeting);\r\n        \r\n        this.panels.meeting.update(title, selector);\r\n      } else {\r\n        var invite = this.model._invite;\r\n        var source = invite.source;\r\n        var title = invite.info.topicTitle || i18n.i18n.titleUnknownInvitation;\r\n        var url;\r\n        var details = { };\r\n        switch (source) {\r\n          case 'rooms':\r\n            url = invite.info.joinUrl;\r\n            details[i18n.i18n.titleConferenceAccessNumber] = invite.info.conferenceAccessNumber;\r\n            details[i18n.i18n.titleMeetingId] = invite.info.meetingId;\r\n            details[i18n.i18n.titleConferenceAccessUrl] = invite.info.conferenceAccessUrl;\r\n            break;\r\n          case 'spaces':\r\n            url = invite.info.spaceUrl;\r\n            details[i18n.i18n.titleSpaceUrl] = invite.info.spaceUrl;\r\n            break;\r\n          default:\r\n            break;\r\n        }\r\n        logger.info('Invited: ' + source + ': ' + url + ', host: ' + invite.isHost);\r\n        this.panels.invited.update(source, title, url, invite.isHost, details);\r\n      }\r\n    }\r\n  };\r\n\r\n  controller.prototype.switch = function (panels, p) {\r\n    var c = panels.$current;\r\n    if (c === p) {\r\n      return;\r\n    }\r\n    if (c) {\r\n      c.addClass('hidden');\r\n    }\r\n    p.delClass('hidden');\r\n    panels.$current = p;\r\n    p.render();\r\n  };\r\n\r\n  controller.prototype.refresh = function () {\r\n    this.panels.$current.render();\r\n  };\r\n\r\n  controller.prototype.evError = function(err) {\r\n    var panel = this.panels.error;\r\n    panel.render(err);\r\n    this.panels.popup.render(panel);\r\n    this.panels.popup.delClass('hidden');\r\n  };\r\n\r\n  module.exports = controller;\r\n});\r\n  \n\n\n//////////////////\n// WEBPACK FOOTER\n// ./ui/controller.js\n// module id = 69\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var dom      = require('/lib/jsl/dom');\r\n  var panel    = require('/lib/jsl/ui/panel');\r\n  var action   = require('/lib/jsl/ui/action');\r\n  var Log      = require('/lib/jsl/log');\r\n  var Utils    = require('/lib/jsl/utils');\r\n\r\n  var AemoAPI = require('../model/config/aemoAPI');\r\n  var ZangAPI = require('../model/config/zangAPI');\r\n\r\n  var Rooms    = require('../sources/rooms/model');\r\n  var Spaces   = require('../sources/spaces/model');\r\n\r\n  var roomsConfig  = require('../sources/rooms/srcconfig');\r\n  var spacesConfig = require('../sources/spaces/srcconfig');\r\n\r\n  var invite   = require('../invite');\r\n\r\n  var i18n     = require('../i18n');\r\n\r\n  var AVAYA_CLOUD_ACCOUNTS_URI = 'https://accounts.zang.io';\r\n  var EQUINOX_MEETING_ACCOUNT_DISCOVERY_URL = 'https://meetings.avaya.com';\r\n\r\n  var logger = Log.createLogger('CFG');\r\n\r\n  var CfgWizard = function (opt) {\r\n    this.$super();\r\n    this.delClass('panel').addClass('panel-cfgwizard-view');\r\n    this.model = opt.model;\r\n    this.sources = { 'spaces':  null, 'rooms': null }; // configured sources here\r\n    this.source = 0;\r\n    this.step = 10;\r\n  };\r\n\r\n  CfgWizard.prototype.render = function () {\r\n    if (!this.node.innerHTML) {\r\n      var layout = dom.div({ cssClass: 'panel-cfgwizard-content' });\r\n      layout.add(dom.div().addClass('cfgwizard-logo-panel').add(\r\n        this.addinAds = dom.div().addClass('cfgwizard-logo-ads').add(\r\n          i18n.i18n.titleAddinAds\r\n        ),\r\n        this.image = dom.div().addClass('cfgwizard-image')\r\n      ));\r\n      //layout.add(\r\n      //  this.addinAds = dom.div({ cssClass: 'panel-info-title cfgwizard-ads', text: i18n.i18n.titleAddinAds })\r\n      //);\r\n      layout.add(dom.div().addClass('panel cfgwizard-title-panel').add(\r\n        this.icon = dom.div().addClass('info-icon cfgwizard-info-icon'),\r\n        this.title = dom.div().addClass('panel-info-title cfgwizard-title')\r\n      ));\r\n      layout.add(dom.div().addClass('panel-details').add(\r\n        dom.div().addClass('panel-detail').add(\r\n          this.emailWrap = dom.div().addClass('input-config-wrap').add(\r\n            this.email = dom.input({ hint: i18n.i18n.hintEmailAddress, cssClass: 'input-config cfgwizard-input' }),\r\n            this.emailClear = new action().addClass('icon-base icon-clear').set({ tip: i18n.i18n.actionClear, click: this._evEmailClear.bind(this) })\r\n          )\r\n        ),\r\n        dom.div().addClass('panel-detail').add(\r\n          this.portal = dom.select({ cssClass: 'select-config cfgwizard-select hidden' })\r\n        ),\r\n        this.userPanel = dom.div().addClass('panel-detail hidden').add(\r\n          this.userWrap = dom.div().addClass('input-config-wrap').add(\r\n            this.user = dom.input({ hint: i18n.i18n.hintUsername, cssClass: 'input-config cfgwizard-input' }),\r\n            this.userClear = new action().addClass('icon-base icon-clear').set({ tip: i18n.i18n.actionClear, click: this._evUserClear.bind(this) })\r\n          ),\r\n          this.passwordWrap = dom.div().addClass('input-config-wrap').add(\r\n            this.password = dom.input({ hint: i18n.i18n.hintPassword, '@type': 'password', cssClass: 'input-config cfgwizard-input' }),\r\n            this.passwordClear = new action().addClass('icon-base icon-clear').set({ tip: i18n.i18n.actionClear, click: this._evPasswordClear.bind(this) })\r\n          ),\r\n          this.loginBox = dom.div().add(\r\n            dom.div().add(i18n.i18n.titleOpensInBrowser),\r\n            new action({ text: i18n.i18n.linkClickToLogin, click: this.onOk.bind(this) })\r\n          ).addClass('cfgwizard-login')\r\n        )\r\n      ));\r\n      layout.add(dom.div().addClass('actions-list').add(\r\n        this.ok = new action({ cssClass: 'action-item cfgwizard-action', click: this.onOk.bind(this) }),\r\n        this.cancel = new action({ cssClass: 'action-item action-item-accent', text: i18n.i18n.actionCancel, click: this.onCancel.bind(this) }),\r\n        this.skip = new action({ cssClass: 'action-item action-item-skip', text: i18n.i18n.actionSkip, click: this.onSkip.bind(this) })\r\n      ));\r\n      //layout.add(\r\n      //  this.accountAds = dom.div().add(\r\n      //    dom.div({ cssClass: 'panel-info-title cfgwizard-ads', text: i18n.i18n.titleAccountAds }),\r\n      //    dom.a({ cssClass: 'action link-item', text: i18n.i18n.titleAccountAdsLink, href: 'https://zang.io', target: '_blank' })\r\n      //));\r\n      this.layout = layout;\r\n      this.adjustUI();\r\n      this.add(layout);\r\n      logger.info('Start configuration wizard, email address: ' + this.model.configuration.emailAddress);\r\n\r\n      this.timer = setTimeout(this._evTimer.bind(this), 100);\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  CfgWizard.prototype.showError = function (err) {\r\n    if (!err.message) {\r\n      err = { message: Utils.stringifyJSON(err) };\r\n    }\r\n    var self = this;\r\n    return new Promise(function (resolve, reject) {\r\n      err.resolve = resolve;\r\n      self.model.showError(null, err); // next step after showError OK\r\n    });\r\n  };\r\n\r\n  CfgWizard.prototype.adjustUI = function (opt) {\r\n    opt = opt || { };\r\n    logger.info('Adjust UI, step: ' + this.step + ', opt: ' + JSON.stringify(opt));\r\n    if (this.step === -1) {\r\n      var resolve = this.model.configuration.resolve;\r\n      resolve(this.configuration);\r\n      return;\r\n    }\r\n    var sources = Object.getOwnPropertyNames(this.sources);\r\n    var source = sources[this.source];\r\n    this.layout.delClass('hidden');\r\n    this.icon.toggleClass('hidden', !(opt.error || opt.progress));\r\n    this.icon.toggleClass('cfgwizard-error-icon', opt.error);\r\n    this.icon.toggleClass('cfgwizard-progress-icon', opt.progress);\r\n    this.title.toggleClass('error', opt.error);\r\n\r\n    this.userPanel.addClass('hidden');\r\n    this.userWrap.delClass('hidden');\r\n\r\n    this.passwordWrap.delClass('hidden');\r\n\r\n    this.loginBox.addClass('hidden');\r\n\r\n    if (this.step === 10) {\r\n      this.image.delClass('cfgwizard-setting-image').addClass('cfgwizard-logo-image');\r\n      this.title.delClass('cfgwizard-title-setting');\r\n      var title = opt.error ? i18n.i18n.errorConfigureAccount : i18n.i18n.titleSetupMeetingDetails;\r\n      this.title.node.innerHTML = title;\r\n      \r\n      this.email.node.value = this.email.node.value || this.model.configuration.emailAddress;\r\n      this.email.delClass('disabled');\r\n      this.email.node.removeAttribute('disabled', 1);\r\n\r\n      this.emailWrap.delClass('hidden');\r\n\r\n      this.portal.addClass('hidden');\r\n      this.userPanel.addClass('hidden');\r\n\r\n      this.ok.setText(i18n.i18n.actionNext);\r\n      this.ok.delClass('disabled hidden');\r\n      this.skip.addClass('hidden');\r\n      this.cancel.addClass('hidden');\r\n    } else if (this.step === 52) {\r\n      this.image.delClass('cfgwizard-logo-image').addClass('cfgwizard-setting-image');\r\n      this.title.addClass('cfgwizard-title-setting');\r\n      this.title.node.innerText = i18n.i18n.titleSettingAddin;\r\n      this.portal.addClass('hidden');\r\n      this.ok.addClass('hidden');\r\n      this.addinAds.delClass('hidden');\r\n      //this.accountAds.delClass('hidden');\r\n    } else {\r\n      this.addinAds.addClass('hidden');\r\n      //this.accountAds.addClass('hidden');\r\n      if (source === 'rooms') {\r\n        if (this.step === 11) {\r\n          this.email.addClass('disabled');\r\n          this.email.node.setAttribute('disabled', 1);\r\n\r\n          this.ok.addClass('hidden');\r\n          this.skip.addClass('hidden');\r\n          this.cancel.delClass('hidden');\r\n          this.title.node.innerText = i18n.i18n.titleCheckingEquinoxAccount;\r\n        } else if (this.step === 30) {\r\n          this.title.node.innerText = i18n.i18n.titleChooseEquinoxEnvironment;\r\n          this.emailWrap.addClass('hidden');\r\n          for (var i = this.portal.node.options.length - 1 ; i >= 0 ; i--) {\r\n            this.portal.node.remove(i);\r\n          }\r\n          var portalNames = Object.getOwnPropertyNames(opt.portalUrls);\r\n          portalNames.forEach(function(portalName) {\r\n            this.portal.add(dom.option().add(portalName).set({ '@value':  opt.portalUrls[portalName] }));\r\n          }, this);\r\n          this.portal.delClass('hidden');\r\n          this.ok.setText(i18n.i18n.actionNext);\r\n          this.ok.delClass('disabled hidden');\r\n          this.skip.delClass('hidden');\r\n          this.cancel.addClass('hidden');\r\n        } else if (this.step === 40) {\r\n          var title;\r\n          if (opt.error) {\r\n            title = opt.password ? i18n.i18n.errorBadCredentials : i18n.i18n.errorConfigureAccount;\r\n          } else if (opt.progress) {\r\n            title = opt.aemo ? i18n.i18n.titleLoggingToAEMO : i18n.i18n.titleLoggingToEquinox;\r\n          } else {\r\n            title = opt.aemo ? i18n.i18n.titleEnterAEMOCredentials : i18n.i18n.titleEnterEquinoxCredentials;\r\n          }\r\n          this.title.node.innerHTML = title;\r\n          this.emailWrap.addClass('hidden');\r\n          this.portal.addClass('hidden');\r\n          this.userPanel.delClass('hidden');\r\n          this.user.node.value = opt.user || this.user.node.value;\r\n          this.ok.setText(i18n.i18n.actionNext);\r\n          this.ok.delClass('hidden');\r\n          this.ok.toggleClass('disabled', opt.disabled);\r\n          this.skip.toggleClass('hidden', opt.disabled);\r\n          this.cancel.addClass('hidden');\r\n        }\r\n      } else if (source === 'spaces') {\r\n        if (this.step === 11) {\r\n          this.email.addClass('disabled');\r\n          this.email.node.setAttribute('disabled', 1);\r\n\r\n          this.ok.addClass('hidden');\r\n          this.skip.addClass('hidden');\r\n          this.cancel.delClass('hidden');\r\n          this.title.node.innerText = i18n.i18n.titleCheckingCloudAccount;\r\n        } else if (this.step === 20) {\r\n          this.title.node.innerHTML = i18n.i18n.titleEnterCloudCredentials;\r\n\r\n          this.userPanel.delClass('hidden');\r\n          this.userWrap.addClass('hidden');\r\n\r\n          this.passwordWrap.addClass('hidden');\r\n\r\n          this.loginBox.delClass('hidden');\r\n          \r\n          this.emailWrap.addClass('hidden');\r\n          this.ok.addClass('hidden');\r\n          this.skip.delClass('hidden');\r\n          this.cancel.addClass('hidden');\r\n        } else if (this.step === 21) {\r\n          this.title.node.innerHTML = i18n.i18n.titleLoggingToCloud;\r\n          this.emailWrap.addClass('hidden');\r\n          this.skip.addClass('hidden');\r\n          //!!\r\n          this.cancel.addClass('hidden');\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  CfgWizard.prototype._evTimer = function () {\r\n    var changed;\r\n    if (this.emailText !== this.email.node.value) {\r\n      changed = true;\r\n      this.emailText = this.email.node.value;\r\n      this.emailWrap.toggleClass('input-empty', !this.emailText);\r\n    }\r\n    if (this.userText !== this.user.node.value) {\r\n      changed = true;\r\n      this.userText = this.user.node.value;\r\n      this.userWrap.toggleClass('input-empty', !this.userText);\r\n    }\r\n    if (this.passwordText !== this.password.node.value) {\r\n      changed = true;\r\n      this.passwordText = this.password.node.value;\r\n      this.passwordWrap.toggleClass('input-empty', !this.passwordText);\r\n    }\r\n\r\n    if (changed) {\r\n      var okDisabled = (((this.step === 10) && !this.emailText) ||\r\n                        ((this.step === 40) && !this.userText));\r\n      this.ok.toggleClass('disabled', okDisabled);\r\n      if (okDisabled) {\r\n        this.ok.node.setAttribute('disabled', 1);\r\n      } else {\r\n        this.ok.node.removeAttribute('disabled');\r\n      }\r\n    }\r\n\r\n\r\n    this.timer = setTimeout(this._evTimer.bind(this), 100);\r\n  };\r\n\r\n  CfgWizard.prototype._evEmailClear = function () {\r\n    this.email.node.value = '';\r\n  };\r\n  CfgWizard.prototype._evUserClear = function () {\r\n    this.user.node.value = '';\r\n  };\r\n  CfgWizard.prototype._evPasswordClear = function () {\r\n    this.password.node.value = '';\r\n  };\r\n  \r\n  CfgWizard.prototype.configureSpaces = function (opt) {\r\n    opt = opt || { };\r\n    logger.info('Configuring spaces, opt: ' + JSON.stringify(opt));\r\n    this.step = 11;\r\n    this.adjustUI({ progress: true });\r\n    var spaces;\r\n    var configuration;\r\n    var self = this;\r\n    var cancel = new Promise(function(resolve, reject) {\r\n      self.canceled = { resolve: resolve, reject: reject };\r\n    });\r\n    var check = this.zangAPI.checkUserExist({ userId: this.emailAddress });\r\n    check = Promise.race([check, cancel]);\r\n    logger.info('Checking spaces user');\r\n    return check.then(function (res) {\r\n      logger.info('Spaces user exists, res: ' + JSON.stringify(res));\r\n      // zang account exists\r\n      self.step = 20;\r\n      self.adjustUI();\r\n      return new Promise(function(resolve, reject) {\r\n        self.login = { resolve: resolve, reject: reject };\r\n      });\r\n    }, function (err) { // canceled & not found (initially) goes here\r\n      logger.info('Spaces user check failed, err: ' +  Utils.stringifyJSON(err));\r\n      if (err && err.error && err.error.httpStatus === 404) { // zang account doesn't exist\r\n        logger.info('Spaces user does not exist, skip spaces');\r\n        return Promise.reject({ skipped: true }); // continue with next source\r\n      }\r\n      return Promise.reject(err);\r\n    }).then(function () {\r\n      spaces = new Spaces(); // create spaces model\r\n      spaces.init({ configuration: opt });\r\n      var optlogin = { configuration: opt, logout: true, asyncui: self.model.asyncui };\r\n      logger.info('Spaces login, opt: ' + JSON.stringify(optlogin));\r\n      return spaces.login(optlogin).then(function () {\r\n        logger.info('Spaces login succeeded');\r\n        return Promise.resolve()\r\n      }, function (err) {\r\n        logger.info('Spaces login failed, skip spaces, err: ' +  Utils.stringifyJSON(err));\r\n        return Promise.reject({ skipped: true });\r\n      })\r\n    }).then(function () {\r\n        configuration = { 'ENABLE_AVAYA_CLOUD_ACCOUNTS': 1 };\r\n        logger.info('Setting up spaces configuration: ' + JSON.stringify(configuration));\r\n        for (var key in configuration) {\r\n          self.configuration[key] = configuration[key];\r\n        }\r\n        self.sources['spaces'] = spaces; // store configured spaces model\r\n        return Promise.resolve();\r\n      }, function (err) { // skip & canceled & not found (finally) goes here\r\n      if (err && !err.skipped) {\r\n        logger.info('Spaces configuring failed, err: ' +  Utils.stringifyJSON(err));\r\n        return Promise.reject(err);\r\n      }\r\n      configuration = { 'ENABLE_AVAYA_CLOUD_ACCOUNTS': 0 };\r\n      logger.info('Setting up no spaces configuration: ' + JSON.stringify(configuration));\r\n      for (var key in configuration) {\r\n        self.configuration[key] = configuration[key];\r\n      }\r\n      return Promise.resolve(); // skipped\r\n    });\r\n  }\r\n\r\n  CfgWizard.prototype.loginRooms = function (aemo, portalUrl) {\r\n    var rooms = new Rooms();\r\n    var configuration;\r\n    var self = this;\r\n    return new Promise(function(resolve, reject) {\r\n      self.login = { resolve: resolve, reject: reject };\r\n    }).then(function () {\r\n      return rooms.logout();\r\n    }).then(function () {\r\n      self.step = 40;\r\n      self.adjustUI({ aemo: aemo, progress: true, disabled: true });\r\n      configuration = {\r\n        'CONFERENCE_PORTAL_URI': portalUrl,\r\n        'UNIFIED_PORTAL_USERNAME': self.user.node.value,\r\n        'UNIFIEDPORTALENABLED': 1,\r\n        manual: true\r\n      }\r\n      return rooms.init({ configuration: configuration });\r\n    }).then(function () {\r\n      logger.info('Rooms login, user: ' + self.user.node.value);\r\n      rooms.setInfo({ password: self.password.node.value });\r\n      return rooms.login({ forceLogin: true }).then(function () {\r\n        logger.info('Rooms login succeeded');\r\n        delete configuration['Password'];\r\n        delete configuration['manual'];\r\n        logger.info('Setting up rooms configuration: ' + JSON.stringify(configuration));\r\n        for (var key in configuration) {\r\n          self.configuration[key] = configuration[key];\r\n        }\r\n        self.sources['rooms'] = rooms; // store configured rooms model\r\n        return Promise.resolve();\r\n      }, function (err) {\r\n        logger.info('Rooms login failed, retry login, err: ' + Utils.stringifyJSON(err));\r\n        self.step = 40;\r\n        self.adjustUI({ error: true, password: (err.error || { }).password });\r\n        return self.loginRooms(aemo, portalUrl);\r\n      });\r\n    }, function (err) {\r\n      logger.info('Rooms login failed, err: ' + Utils.stringifyJSON(err));\r\n      return Promise.reject(err);\r\n    });\r\n  }\r\n\r\n  CfgWizard.prototype.configureRooms = function () {\r\n    logger.info('Configuring rooms');\r\n    this.step = 11;\r\n    this.adjustUI({ progress: true });\r\n    var portalUrl;\r\n    var self = this;\r\n    var cancel = new Promise(function (resolve, reject) {\r\n      self.canceled = { resolve: resolve, reject: reject };\r\n    });\r\n    var check = this.aemoAPI.checkUserExist({ userId: this.emailAddress });\r\n    check = Promise.race([check, cancel]);\r\n    logger.info('Checking rooms user');\r\n    return check.then(function (res) {\r\n      logger.info('Rooms user exists, res: ' + JSON.stringify(res));\r\n      // aemo account exists\r\n      return Promise.resolve({ 'aemo': true, url: res && res.conferencePortalUri ? res.conferencePortalUri : '' });\r\n    }, function (err) { // canceled & not found (initially) goes here\r\n      logger.info('Rooms user check failed, err: ' +  Utils.stringifyJSON(err));\r\n      if (err && err.error && err.error.httpStatus === 404) { // aemo account doesn't exist\r\n        logger.info('Rooms user does not exist, continue to portal info');\r\n        return Promise.resolve();  // continue to portal info\r\n      }\r\n      return Promise.reject(err);\r\n    }).then(function (res) {\r\n      if (res) {\r\n        return Promise.resolve(res);\r\n      }\r\n      var optinfo = { emailDomain: self.emailAddress.split('@')[1] };\r\n      var info = self.zangAPI.getPortalInfo(optinfo);\r\n      info = Promise.race([info, cancel]);\r\n      logger.info('Checking portal info, opt: ' + JSON.stringify(optinfo));\r\n      return info.then(function (res) {\r\n        logger.info('Portal info found, res: ' + JSON.stringify(res));\r\n        var portalInfo = ((Utils.safeParse(res.portalInfo) || { })['Meeting_Portal_Settings']) || [];\r\n        var portalSettings = { };\r\n        portalInfo.forEach(function (portalSetting) {\r\n          portalSettings[portalSetting['Meeting_Portal_Name']] = portalSetting['Meeting_Portal_Url'];\r\n        });\r\n        return Promise.resolve(portalSettings);\r\n      }, function (err) { // canceled & no info (initially) goes here\r\n        logger.info('Checking portal info failed, err: ' + Utils.stringifyJSON(err));\r\n        return Promise.reject({ skipped: true }); // skip rooms??? // Promise.reject(err); // restart configuration???\r\n      });\r\n    }).then(function (res) {\r\n      if (res && !res.aemo) {\r\n        logger.info('Selecting portal, portal settings: ' + JSON.stringify(res));\r\n        var portalNames = Object.getOwnPropertyNames(res);\r\n        if (portalNames.length === 0) {\r\n          return Promise.resolve({ 'aemo': false, url: '' });\r\n        }\r\n        if (portalNames.length === 1) {\r\n          return Promise.resolve({ 'aemo': false, url: res[portalNames[0]] });\r\n        }\r\n        self.step = 30;\r\n        self.adjustUI({ portalUrls: res });\r\n        return new Promise(function (resolve, reject) {\r\n          self.selectPortal = { resolve: resolve, reject: reject };\r\n        }).then(function (res) {\r\n          return Promise.resolve({ 'aemo': false, url: res });\r\n        });\r\n      }\r\n      return Promise.resolve(res);\r\n    }).then(function (res) {\r\n      if (!res || !res.url) {\r\n        logger.info('Portal url is not defined, skip rooms');\r\n        return Promise.reject({ skipped: true });\r\n      }\r\n      self.step = 40;\r\n      self.adjustUI({ aemo: res.aemo, user: self.emailAddress.split('@')[0] });\r\n      logger.info('Logging in rooms, portal url: ' + res.url);\r\n      return self.loginRooms(res.aemo, res.url);\r\n    }).then(function (res) {\r\n    }, function (err) { // skip goes here\r\n      if (err && !(err.skipped || err.canceled)) {\r\n        logger.info('Rooms configuring failed, err: ' +  Utils.stringifyJSON(err));\r\n        return Promise.reject(err);\r\n      }\r\n      logger.info('Rooms configuring failed, skip rooms, err: ' +  Utils.stringifyJSON(err));\r\n      return Promise.resolve(); // skipped (or canceled (SV))\r\n    });\r\n  }\r\n\r\n  function normalizeUrl(url) {\r\n    url = url || '';\r\n    if ((url.indexOf('http://') < 0) && (url.indexOf('https://') < 0)) {\r\n      url = 'https://' + url;\r\n    }\r\n    if (url.lastIndexOf('/') === url.length - 1) {\r\n      url = url.slice(0, -1);\r\n    }\r\n    return url;\r\n  }\r\n\r\n  CfgWizard.prototype.configureSources = function (source) {\r\n    this.configuration = { };\r\n    var emailAddress = this.email.node.value;\r\n    logger.info('Configure sources, input: ' + emailAddress);\r\n    var opt = emailAddress.split(';&');\r\n    this.emailAddress = opt.shift();\r\n    opt = opt.reduce(function (res, pair) {\r\n      pair = pair.split('=');\r\n      res[pair[0]] = normalizeUrl(pair[1]);\r\n      return res;\r\n    }, { });\r\n    logger.info('Configure sources, email address: ' + this.emailAddress + ', opt: ' + JSON.stringify(opt));\r\n    this.zangAPI = new ZangAPI(opt['AVAYA_CLOUD_ACCOUNTS_URI'] || AVAYA_CLOUD_ACCOUNTS_URI);\r\n    this.aemoAPI = new AemoAPI(opt['EQUINOX_MEETING_ACCOUNT_DISCOVERY_URL'] || EQUINOX_MEETING_ACCOUNT_DISCOVERY_URL);\r\n    delete opt['EQUINOX_MEETING_ACCOUNT_DISCOVERY_URL']; // ???\r\n    var self = this;\r\n    return this.configureSpaces(opt).then(function () {\r\n      self.source += 1;\r\n      return self.configureRooms();\r\n    });\r\n  }\r\n\r\n  CfgWizard.prototype.checkSources = function () {\r\n    this.step = 52;\r\n    this.adjustUI();\r\n    var self = this;\r\n    logger.info('Checking configured sources');\r\n    return new Promise(function (resolve, reject) {\r\n        var isValid;\r\n        [roomsConfig, spacesConfig].forEach(function (sourceConfig) {\r\n          isValid = isValid || sourceConfig.isValid(self.configuration);\r\n        });\r\n        if (!isValid) {\r\n          logger.info('No configured sources found');\r\n          self.layout.addClass('hidden');\r\n          self.showError({ message: i18n.i18n.errorNoConfiguredAccounts }).then(function () {\r\n            self.source = 0;\r\n            self.step = 10;\r\n            self.adjustUI();\r\n          });\r\n          reject();\r\n        }\r\n        setTimeout(resolve, 300); // force delay???\r\n    });\r\n  }\r\n\r\n  CfgWizard.prototype.onOk = function () {\r\n    var self = this;\r\n    if (this.step === 10) {\r\n      this.configureSources().then(function () {\r\n        self.checkSources().then(function () {\r\n          var resolve = self.model.configuration.resolve;\r\n          logger.info('Created configuration: ' + JSON.stringify(self.configuration));\r\n          resolve(self.configuration);\r\n        }, function () {\r\n        });\r\n      }, function (err) {\r\n        self.model.clearCache();\r\n        for (var source in self.sources) {\r\n          if (self.sources[source]) {\r\n            self.sources[source].logout();\r\n            self.sources[source] = null;\r\n          }\r\n        }\r\n        self.source = 0;\r\n        self.step = 10;\r\n        self.adjustUI(err.canceled ? { } : { error: true });\r\n      });\r\n      return;\r\n    }\r\n    if (this.login) {\r\n      self.step = 21;\r\n      self.adjustUI({ progress: true });\r\n      self.login.resolve();\r\n      delete self.login;\r\n    }\r\n    if (this.selectPortal) {\r\n      this.selectPortal.resolve(this.portal.node.value);\r\n      delete this.selectPortal;\r\n    }\r\n  }\r\n\r\n  CfgWizard.prototype.onSkip = function () {\r\n    if (this.login) {\r\n      this.login.reject({ skipped: true });\r\n      delete this.login;\r\n    }\r\n    if (this.selectPortal) {\r\n      this.selectPortal.reject({ skipped: true });\r\n      delete this.selectPortal;\r\n    }\r\n  }\r\n\r\n  CfgWizard.prototype.onCancel = function () {\r\n    if (this.canceled) {\r\n      this.canceled.reject({ canceled: true });\r\n      delete this.canceled;\r\n    }\r\n  }\r\n\r\n  module.exports = panel.extend(CfgWizard);\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./ui/cfgwizard.js\n// module id = 70\n// module chunks = 0","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var API = require('../api/api');\r\n\r\n  var methods = {\r\n    checkUserExist: {\r\n      uri: '/acs/resources/checkUserExist',\r\n      method: 'POST',\r\n      headers: {\r\n        'content-type': 'application/x-www-form-urlencoded'\r\n      },\r\n      args: {\r\n        userId: { key: '$(userId)', flags: 's' },\r\n      },\r\n      body: {\r\n        'emailaddress': '$(userId)',\r\n      },\r\n      response: {\r\n        conferencePortalUri: { key: 'CONFERENCE_PORTAL_URI', flags: 's' },\r\n        clientSettingsFileUrl: { key: 'clientSettingsFileUrl', flags: 's' }\r\n      }\r\n    }\r\n  };\r\n\r\n  function AemoAPI(serverBase) {\r\n    this.$super(serverBase);\r\n  }\r\n\r\n  Object.getOwnPropertyNames(methods).forEach(function (name) {\r\n    AemoAPI.prototype[name] = function(args) {\r\n      return this._exec(methods[name], args);\r\n    }\r\n  }, this);\r\n  \r\n  module.exports = API.extend(AemoAPI);\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/config/aemoAPI.js\n// module id = 71\n// module chunks = 0","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var API = require('../api/api');\r\n\r\n  var methods = {\r\n    checkUserExist: {\r\n      uri: '/api/1.0/users/exist',\r\n      method: 'POST',\r\n      headers: {\r\n        'content-type': 'application/json'\r\n      },\r\n      args: {\r\n        userId: { key: '$(userId)', flags: 's' },\r\n      },\r\n      body: {\r\n        'username': '$(userId)',\r\n      },\r\n      response: {\r\n      }\r\n    },\r\n    getPortalInfo: {\r\n      uri: '/api/1.0/companies/$(emailDomain)/products/equinoxcloudclient/public_application_setting',\r\n      method: 'GET',\r\n      headers: {\r\n        'content-type': 'application/json'\r\n      },\r\n      args: {\r\n        emailDomain: { key: '$(emailDomain)', flags: 's' },\r\n      },\r\n      response: {\r\n        portalInfo: { key: 'public_profile_setting', flags: 's' }\r\n      }\r\n    }\r\n  };\r\n\r\n  function ZangAPI(serverBase) {\r\n    this.$super(serverBase);\r\n  }\r\n\r\n  Object.getOwnPropertyNames(methods).forEach(function (name) {\r\n    ZangAPI.prototype[name] = function(args) {\r\n      return this._exec(methods[name], args);\r\n    }\r\n  }, this);\r\n  \r\n  module.exports = API.extend(ZangAPI);\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/config/zangAPI.js\n// module id = 72\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var dom = require('/lib/jsl/dom');\r\n  var Panel = require('/lib/jsl/ui/panel');\r\n  var Action = require('/lib/jsl/ui/action');\r\n    \r\n  var i18n = require('../i18n');\r\n  var States = require('../states');\r\n\r\n  function ProgressView(opt) {\r\n    this.$super();\r\n    this.delClass('panel').addClass('panel-progress-view');\r\n\r\n    this.model = opt.model;\r\n  }\r\n\r\n  ProgressView.prototype.render = function () {\r\n    if (this.node.innerHTML) {\r\n       return;\r\n    }\r\n    this.add(\r\n      dom.div().addClass('panel-progress-wrap').add(\r\n        this.noteHead = dom.div({ cssClass: 'panel-progress-head' }),\r\n        this.noteText = dom.div({ cssClass: 'panel-progress-text' })\r\n      ), \r\n      dom.div().addClass('actions-list').add(\r\n        this.actionCancel = new Action().delClass('action').addClass('hidden action-item').set({ click: this.onCancel.bind(this) }),\r\n        this.actionRetry = new Action().delClass('action').addClass('hidden action-item').set({ click: this.onRetry.bind(this) })\r\n      )\r\n    );\r\n    return this;\r\n  };\r\n\r\n  ProgressView.prototype.update = function (ctxstate) {\r\n    if (!ctxstate.source) {\r\n      if (ctxstate.app === States.App.Unknown) {\r\n        this.noteHead.setText('');\r\n        this.noteText.setText('');\r\n        this.actionCancel.setText('');\r\n        this.actionRetry.setText('');\r\n        this.actionCancel.addClass('hidden');\r\n        this.actionRetry.addClass('hidden');\r\n      } else if (ctxstate.app === States.App.Initializing) {\r\n        this.noteHead.setText(i18n.i18n.noteAppInitializing);\r\n        this.noteText.setText(i18n.i18n.notePleaseWait);\r\n        this.actionCancel.setText(i18n.i18n.actionCancel);\r\n        this.actionRetry.setText(i18n.i18n.actionTryAgain);\r\n      } else if (ctxstate.app === States.App.NotInitialized) {\r\n        this.noteHead.setText(i18n.i18n.noteAppNotInitialized);\r\n        this.noteText.setText('');\r\n        this.actionCancel.setText(i18n.i18n.actionCancel);\r\n        this.actionRetry.setText(i18n.i18n.actionTryAgain);\r\n        this.actionCancel.addClass('hidden');\r\n        this.actionRetry.delClass('hidden');\r\n      } else {\r\n        // this.noteText.setText(i18n.i18n[States.App.names[ctxstate.app]]);\r\n      }\r\n      return;\r\n    }\r\n\r\n    this.actionCancel.toggleClass('hidden', !this.model.cancel);\r\n    this.noteHead.setText(i18n.i18n.noteLoading + ' ' + this.model.getSourceName(ctxstate.source));\r\n    this.noteText.setText(i18n.i18n['note' + States.Src.names[ctxstate.sources[ctxstate.source]]]);\r\n    return this;\r\n  };\r\n\r\n  ProgressView.prototype.onCancel = function () {\r\n    if (this.model.cancel) {\r\n      this.model.cancel();\r\n    }\r\n  };\r\n\r\n  ProgressView.prototype.onRetry = function () {\r\n    this.actionRetry.addClass('hidden');\r\n    // location.reload();\r\n    window.appRestart();\r\n  };\r\n  \r\n  module.exports = Panel.extend(ProgressView);  \r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./ui/progress.js\n// module id = 73\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var dom      = require('/lib/jsl/dom');\r\n  var panel    = require('/lib/jsl/ui/panel');\r\n  var action   = require('/lib/jsl/ui/action');\r\n\r\n  var SpacesList = require('../model/ui/spaces.list');\r\n\r\n  var i18n     = require('../i18n');\r\n\r\n  var details  = require('./details');\r\n  // var places   = require('./places');\r\n  var places   = require('./topics');\r\n\r\n  var meeting = function (opt) {\r\n    this.$super();\r\n    this.delClass('panel').addClass('panel-meeting-view');\r\n\r\n    this.model = opt.model;\r\n\r\n    this.details = new details(opt);\r\n    this.places = new places(opt);\r\n    this.addingDetails = false;\r\n  };\r\n\r\n  meeting.prototype.render = function () {\r\n    if (!this.node.innerHTML) {\r\n      this.add(dom.div().addClass('panel-meeting-wrap').add(\r\n        this.title = dom.div().addClass('panel-meeting-title'),\r\n        this.selector = dom.div().addClass('panel-meeting-selector'),\r\n        dom.div().addClass('actions-list').add(\r\n          this.btnAddDetails = new action().delClass('action').addClass('action-item').add(i18n.i18n.actionAddDetails).set({ click: this.onAction.bind(this) })\r\n        )\r\n      ));\r\n    }\r\n    this.updateSelection(this._selection);\r\n    return this;\r\n  };\r\n\r\n  meeting.prototype.update = function (title, selector) {\r\n    this.title.node.innerText = title;\r\n    this._selector = selector;\r\n    this._selector.render();\r\n    this.selector.add(this._selector);\r\n    this.updateSelection(this._selector.getSelectedItem());\r\n    this._selector.onItem.addListener(this.evItem, this);\r\n    if (this._selector.onItem2) {\r\n      this._selector.onItem2.addListener(this.evItem2, this);\r\n    }\r\n    return this;\r\n  };\r\n\r\n  meeting.prototype.updateSelection = function (item) {\r\n    this._selection = item;\r\n    if (this.addingDetails) {\r\n      this.btnAddDetails.node.innerText = i18n.i18n.actionAddingDetails;\r\n      return;\r\n    }\r\n    if (item) {\r\n      this.btnAddDetails.node.innerText = (item.id === SpacesList.NEW) ? i18n.i18n.actionCreateTopic : i18n.i18n.actionAddDetails;\r\n      this.btnAddDetails.delClass('disabled');\r\n    } else {\r\n      this.btnAddDetails.node.innerText = i18n.i18n.actionAddDetails;\r\n      this.btnAddDetails.addClass('disabled');\r\n    }\r\n  };\r\n\r\n  meeting.prototype.evItem = function (item) {\r\n    this.updateSelection(item);\r\n  };\r\n  meeting.prototype.evItem2 = function (item) {\r\n    this.onAction();\r\n  };\r\n\r\n  meeting.prototype.onAction = function () {\r\n    if (!this._selection || this.addingDetails) {\r\n      return;\r\n    }\r\n    this.btnAddDetails.addClass('disabled');\r\n    this.btnAddDetails.node.innerText = i18n.i18n.actionAddingDetails;\r\n    this.addingDetails = true;\r\n    var item = this._selection;\r\n    var schedule = true;\r\n    var createMeeting = item.id === SpacesList.NEW ?\r\n      this.model.createTopic({ source: item.source, title: item.title, client: schedule, parties: null, join: !schedule }) :\r\n      this.model.createInvite({ id: item.id, source: item.source, client: schedule, parties: null, join: !schedule });\r\n    var self = this;\r\n    createMeeting.then(function () {\r\n      self.addingDetails = false;\r\n      self.updateSelection(self._selection);\r\n      // self._selector.clearSelectedItem();\r\n    });\r\n  };\r\n\r\n  module.exports = panel.extend(meeting);\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./ui/meeting.js\n// module id = 74\n// module chunks = 0","define(function (require, exports, module) {\r\n  'use strict';\r\n  \r\n  var Panel   = require('./panel');\r\n  var dom     = require('../dom');\r\n  var Event   = require('../event');\r\n\r\n  function empty () {\r\n  }\r\n  function onclick (list, handler, ev) {\r\n    var src;\r\n    if (ev) {\r\n      ev.preventDefault();\r\n      // ev.stopPropagation(); // allow hide settings popup\r\n      src = ev.srcElement || ev.target;\r\n    }\r\n    if (src) {\r\n      var action;\r\n      for (var el = src; el !== list.node; el = el.parentElement) {\r\n        var id = el.getAttribute(list.$itemId);\r\n        if (el.parentElement === list.node) {\r\n          handler(id, src, action);\r\n          break;\r\n        } else {\r\n          action = action || id || null;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  /** @constructor */\r\n  function ListView (opt) {\r\n    this.$super(opt);\r\n    this.delClass('panel');\r\n\r\n    this.$empty     = '';\r\n    this.$itemId    = 'jslid';\r\n\r\n    this.$items     = {};\r\n\r\n    this.set({ click: onclick.bind(this, this, this.clickItem.bind(this)) });\r\n    this.set({ dblclick: onclick.bind(this, this, this.dblclickItem.bind(this)) });\r\n    \r\n    this.onAction = (opt && opt.onAction) ? opt.onAction : new Event();\r\n    this.onAction2 = (opt && opt.onAction2) ? opt.onAction2 : new Event();\r\n  }\r\n\r\n  ListView.prototype.create = function () {\r\n    return this.node || dom.ul().addClass('listview').node;\r\n  };\r\n  ListView.prototype.clear = function () {\r\n    this.$items = {};\r\n    this.node.innerHTML = this.$empty;\r\n  };\r\n  \r\n  ListView.prototype.getItemId = function (item) {\r\n    return item.id;\r\n  };\r\n  ListView.prototype.insertItem = function (item) {\r\n    return dom.li({ '@jslid': this.getItemId(item) });\r\n  };\r\n  ListView.prototype.insert = function (item) {\r\n    var id = this.getItemId(item);\r\n    var li = this.$items[id];\r\n    if (!li) {\r\n      li = this.$items[id] = this.insertItem(item);\r\n      this.add(li);\r\n    }\r\n    this.update(item);\r\n    return li;\r\n  };\r\n       \r\n  ListView.prototype.updateItem = function (li, item) {\r\n    li.data = item;\r\n    this.sort();\r\n  };\r\n  ListView.prototype.update = function (item) {\r\n    var id = this.getItemId(item);\r\n    var li = this.$items[id];\r\n    if (li) {\r\n      this.updateItem(li, item);\r\n    }\r\n  };\r\n  \r\n  ListView.prototype.clickItem = function (id, src, action) {\r\n    this.onAction.dispatch({ id: id, src: src, list: this, action: action });\r\n  };\r\n  ListView.prototype.dblclickItem = function (id, src, action) {\r\n    this.onAction2.dispatch({ id: id, src: src, list: this, action: action });\r\n  };\r\n  ListView.prototype.getItem = function (id) {\r\n    return this.$items[id];\r\n  };\r\n  ListView.prototype.removeItem = function (id) {\r\n    var li = this.$items[id];\r\n    if (li) {\r\n      delete this.$items[id];\r\n      li.del(true);\r\n    }\r\n  };\r\n  ListView.prototype.sort = function () {\r\n    this.reorder(this.$items, this.compare);\r\n  };\r\n  ListView.prototype.reorder = function (items, compare) {\r\n    var x = [];\r\n    for (var i in items) {\r\n      x.push(items[i]);\r\n    }\r\n    x.sort(compare);\r\n    for (i = 0; i < x.length; i++) {\r\n      var li = x[i];\r\n      if (li) {\r\n        var p = li.node.parentNode;\r\n        if (p.children[i] !== li) {\r\n          p.removeChild(li.node);\r\n          var b = i < x.length - 1 ? p.children[i + 1] : null;\r\n          p.insertBefore(li.node, b || null);\r\n        }\r\n      }\r\n    }\r\n  };\r\n  ListView.prototype.compare = function (a, b) {\r\n    return 0;\r\n  };\r\n  \r\n  module.exports = Panel.extend(ListView);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/ui/listview.js\n// module id = 75\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var dom = require('/lib/jsl/dom');\r\n  var Event = require('/lib/jsl/event');\r\n  var Panel = require('/lib/jsl/ui/panel');\r\n  var Action = require('/lib/jsl/ui/action');\r\n\r\n  var i18n = require('../i18n');\r\n\r\n  function DetailsView(opt) {\r\n    this.$super();\r\n    this.delClass('panel').addClass('panel-details-view');\r\n\r\n    this.model = opt.model;\r\n\r\n    this._items = { };\r\n    this.content = dom.div({ cssClass: 'panel-details' }).add(\r\n      dom.div({ cssClass: 'panel-details-shim' }).add(\r\n        dom.div({ cssClass: 'room-select' }).add(\r\n          this._select = dom.select({ cssClass: 'selectRoom' })//.set({ '^change': this._evItemChange.bind(this) })\r\n        ),\r\n        dom.div({ cssClass: 'panel-info-item' }).add(\r\n          this._titleConferenceAccessNumber = dom.div({ cssClass: 'panel-info-name' }),\r\n          this._conferenceAccessNumber = dom.div({ cssClass: 'panel-info-value' })\r\n        ),\r\n        dom.div({ cssClass: 'panel-info-item' }).add(\r\n          this._titleMeetingId = dom.div({ cssClass: 'panel-info-name' }),\r\n          this._meetingId = dom.div({ cssClass: 'panel-info-value' })\r\n        ),\r\n        dom.div({ cssClass: 'panel-info-item' }).add(\r\n          this._titleConferenceAccessUrl = dom.div({ cssClass: 'panel-info-name' }),\r\n          this._conferenceAccessUrl = dom.div({ cssClass: 'panel-info-value' })\r\n        )\r\n      )\r\n    );\r\n\r\n    this.onItem = new Event();\r\n    this.onItem2 = new Event();\r\n\r\n    this.model.onTopic.addListener(this._evTopics, this);\r\n    //this.model.onState.addListener(this._evState, this);\r\n  }\r\n\r\n  DetailsView.prototype.render = function () {\r\n    if (this.node.innerHTML) {\r\n      return;\r\n    }\r\n\r\n    this._titleConferenceAccessNumber.node.innerText = i18n.i18n.titleConferenceAccessNumber;\r\n    this._titleMeetingId.node.innerText = i18n.i18n.titleMeetingId;\r\n    this._titleConferenceAccessUrl.node.innerText = i18n.i18n.titleConferenceAccessUrl;\r\n    this.add(this.content);\r\n\r\n    var self = this;\r\n    this.model.getTopics().then(function (r) {\r\n      var items = r.items || [];\r\n      for (var i = 0; i < items.length; i++) {\r\n        self._evTopics({ item: items[i] });\r\n      }\r\n      self._selector = RoomSelect(self._select.node, self._evItemChange.bind(self), self._evItemChange2.bind(self));\r\n\r\n      if (!self.model.wasInvited && (items.length === 1)) {\r\n        self._evItemChange2();\r\n      }\r\n    });\r\n    return this;\r\n  };\r\n\r\n  //DetailsView.prototype._evState = function () {\r\n  //  if ((this.model.ctxstate.app === 3) && (!this.node.innerHTML)) {\r\n  //    this.skipAutoInsert = true;\r\n  //  }\r\n  //};\r\n\r\n  DetailsView.prototype._evTopics = function (topic) {\r\n    var item = topic.item;\r\n    if (item.source !== 'rooms' || item.error) {\r\n      return;\r\n    }\r\n    if (this._items[item.id]) {\r\n      return;\r\n    }\r\n    this._items[item.id] = item;\r\n    this._select.add(\r\n      dom.option().add(item.title).set({ '@value': item.id })\r\n    );\r\n    \r\n    if (Object.getOwnPropertyNames(this._items).length === 1) { // first item added\r\n      this._evItemChange(); \r\n    }\r\n  };\r\n\r\n  DetailsView.prototype._evItemChange = function () {\r\n    var item = this.getSelectedItem();\r\n    var room = item.room;\r\n    var isEquinoxRoom = room.type === 'equinox';\r\n\r\n    this._conferenceAccessNumber.node.innerHTML = room.conferenceAccessNumber;\r\n    this._conferenceAccessNumber.node.parentElement.style.display = isEquinoxRoom ? 'none' : '';\r\n    this._meetingId.node.innerHTML = isEquinoxRoom ? room.meetingId : '';\r\n    this._meetingId.node.parentElement.style.display = isEquinoxRoom ? '' : 'none';\r\n    this._conferenceAccessUrl.node.innerHTML = room.conferenceAccessUrl;\r\n    this._conferenceAccessUrl.node.parentElement.style.display = '';\r\n    this.onItem.dispatch(item);\r\n  };\r\n\r\n  DetailsView.prototype._evItemChange2 = function () {\r\n    var item = this.getSelectedItem();\r\n    this.onItem2.dispatch(item);\r\n  };\r\n\r\n  DetailsView.prototype.getSelectedItem = function () {\r\n    return this._items[this._select.node.value];\r\n  };\r\n\r\n  DetailsView.prototype.clearSelectedItem = function () {\r\n    this._select.node.selectedIndex = 0;\r\n    this._selector.refresh();\r\n  };\r\n\r\n  module.exports = Panel.extend(DetailsView);\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./ui/details.js\n// module id = 76\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Event         = require('/lib/jsl/event');\r\n  var Panel         = require('/lib/jsl/ui/panel');\r\n \r\n  var SpacesView    = require('../model/ui/spaces.view'); // spaces.view1 supports splitted lists for sources\r\n\r\n  var i18n          = require('../i18n');\r\n  var States        = require('../states');\r\n\r\n  var _SpacesView = function (model) {\r\n    this.$super({ css: 'meeting-selector-layer', model: model });\r\n    this.delClass('panel layer layer-hidden');\r\n\r\n    this.setPartyType(model.getPartiesType());\r\n    this.model.onFilter.addListener(this.evFilter, this);\r\n  };\r\n\r\n  _SpacesView.prototype.getModel = function () {\r\n    return this.model;\r\n  };\r\n  _SpacesView.prototype.getI18N = function () {\r\n    return i18n;\r\n  };\r\n\r\n  _SpacesView.prototype.applyPartiesType = function () {\r\n    this.setPartyType(this.model.getPartiesType());\r\n  };\r\n  _SpacesView.prototype.applySearchValue = function () {\r\n    return this.find || '';\r\n  };\r\n  _SpacesView.prototype._evTypeChange = function () {\r\n    this.model.setPartiesType(this.getPartyType());\r\n  };\r\n\r\n  _SpacesView.prototype.evPartiesType = function(partiesType) {\r\n    this.setPartyType(partiesType);\r\n  };\r\n  _SpacesView.prototype.evFilter = function(filter) {\r\n    this.find = filter;\r\n  };\r\n\r\n  var _View = SpacesView.extend(_SpacesView);\r\n\r\n\r\n\r\n  var topics = function (opt) {\r\n    this.$super();\r\n    this.delClass('panel').addClass('panel-meeting-selector-wrap');\r\n\r\n    this.content = new _View(opt.model);\r\n    \r\n    this.onItem = new Event();\r\n    this.onItem2 = new Event();\r\n    \r\n    opt.model.onState.addListener(this.evState, this);\r\n    this.content.onState.addListener(this.evItem, this);\r\n    this.content.onState2.addListener(this.evItem2, this);\r\n  };\r\n\r\n  topics.prototype.render = function () {\r\n    if (this.node.childElementCount === 0) {\r\n      this.add(this.content);\r\n    }\r\n    this.content.render();\r\n    return this;\r\n  };\r\n\r\n  topics.prototype.evState = function(ctxstate) {\r\n    // if (ctxstate.source && ctxstate.sources[ctxstate.source] === States.Src.Checked) {\r\n    //   this.content.showListView(ctxstate.source);\r\n    // }\r\n  };\r\n\r\n  topics.prototype.evItem = function(item) {\r\n    this.onItem.dispatch(item);\r\n  };\r\n   topics.prototype.evItem2 = function(item) {\r\n    this.onItem2.dispatch(item);\r\n  };\r\n\r\n  topics.prototype.getSelectedItem = function () {\r\n    return this.content.getSelectedItem();\r\n  };\r\n\r\n  topics.prototype.clearSelectedItem = function () {\r\n    this.content.clearSelectedItem();\r\n  };\r\n\r\n  module.exports = Panel.extend(topics);\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./ui/topics.js\n// module id = 77\n// module chunks = 0","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var dom = require('/lib/jsl/dom');\r\n  var Action = require('/lib/jsl/ui/action');\r\n  var MeetingPanel = require('./meeting.panel');\r\n  var SpacesList = require('./spaces.list');\r\n  var partyType = require('../parties/types');\r\n  var i18n;\r\n  var context;\r\n\r\n  var cssInviteDiv = 'meeting-selector-role';\r\n  var cssInviteLabel = 'meeting-selector-role-label';\r\n  var cssInviteSelect = 'meeting-selector-role-select';\r\n\r\n  var cssSearchDiv = 'meeting-selector-search';\r\n  var cssSearchWrap = 'meeting-selector-search-wrap';\r\n  var cssSearchInput = 'meeting-selector-input';\r\n\r\n  var cssListDiv = 'meeting-selector-listwrap';\r\n\r\n  function SpacesView(opt) {\r\n    this.model = opt.model;\r\n    i18n = this.getI18N();\r\n    context = this.getContext();\r\n\r\n    this._setStyles(opt);\r\n    this.$super(opt);\r\n\r\n    this._evTimer = this._evTimer.bind(this);\r\n    this.refresh = this.refresh.bind(this);\r\n\r\n    this._topics = {};\r\n    this.model.onTopic.addListener(this._evTopics, this);\r\n  }\r\n  \r\n  SpacesView.prototype.init = function () {\r\n    this._addSearchBox();\r\n    this._addListView();\r\n    this._addInviteBox();\r\n\r\n    this._invite.node.style.display = context.schedule ? '' : 'none';\r\n    this._selection = null;\r\n    this._list.onAction.addListener(this._evList, this);\r\n    this._list.onAction2.addListener(this._evList2, this);\r\n    this._searchValue = '';\r\n\r\n    var self = this;\r\n    Object.defineProperty(this._list, 'searchValue', {\r\n      get: function() {return self._search.node.value;}\r\n    });\r\n  };\r\n\r\n  SpacesView.prototype._setStyles = function (opt) {\r\n    this._styles = { \r\n      inviteDiv: opt.cssInviteDiv || cssInviteDiv, \r\n      inviteLabel: opt.cssInviteLabel || cssInviteLabel, \r\n      inviteSelect: opt.cssInviteSelect || cssInviteSelect, \r\n      searchDiv: opt.cssSearchDiv || cssSearchDiv, \r\n      searchWrap: opt.cssSearchWrap || cssSearchWrap, \r\n      searchInput: opt.cssSearchInput || cssSearchInput,\r\n      listDiv: opt.cssListDiv || cssListDiv\r\n    };\r\n  };\r\n\r\n  SpacesView.prototype._addInviteBox = function() {\r\n    this._invite = dom.div().addClass(this._styles.inviteDiv);\r\n    this._inviteLabel = dom.div().addClass(this._styles.inviteLabel);\r\n    this._inviteType = dom.select().addClass(this._styles.inviteSelect);\r\n\r\n    this.add(\r\n      this._invite.add(\r\n        this._inviteLabel.add(i18n.i18n.partyTypeSelectLabel),\r\n        this._inviteType.add(\r\n          dom.option().add(i18n.i18n.partyTypeMembers).set({ '@value': partyType.member }),\r\n          dom.option().add(i18n.i18n.partyTypeGuests).set({ '@value': partyType.guest })\r\n        ).set({ '^change': this._evTypeChange.bind(this) })\r\n      )\r\n    );\r\n    this._updateRoles();\r\n  };\r\n\r\n  SpacesView.prototype._addSearchBox = function() {\r\n    this.add(\r\n      dom.div().addClass(this._styles.searchDiv).add(\r\n        dom.div().addClass(this._styles.searchWrap).add(\r\n          dom.div().addClass('icon-base icon-search'),\r\n          this._search = dom.input({ hint: i18n.i18n.hintSpacesSearch }).addClass(this._styles.searchInput),\r\n          this._searchClear = new Action().addClass('icon-base icon-clear').set({ click: this._evClear.bind(this) })\r\n        )\r\n      )\r\n    );\r\n  };\r\n\r\n  SpacesView.prototype._addListView = function() {\r\n    this._list = new SpacesList();\r\n    this._listcompare = this._list.compare.bind(this._list);\r\n    this._list.compare = this.compare.bind(this);\r\n\r\n    this.add(dom.div().addClass(this._styles.listDiv).add(this._list) );  \r\n  };\r\n\r\n  SpacesView.prototype.applyI18n = function () {\r\n    this._inviteLabel.setText(i18n.i18n.partyTypeSelectLabel);\r\n    this._inviteType.node.options[0].text = i18n.i18n.partyTypeMembers;\r\n    this._inviteType.node.options[1].text = i18n.i18n.partyTypeGuests;\r\n    this._search.node.placeholder = i18n.i18n.hintSpacesSearch;\r\n  };\r\n\r\n  SpacesView.prototype._evTimer = function () {\r\n    var search = this._search.node.value;\r\n    var parties = this.getPartiesCount();\r\n\r\n    var update = (search !== this._searchValue) || (parties !== this._parties);\r\n\r\n    if (update) {\r\n      this.clearSelectedItem();\r\n      this._parties = parties;\r\n\r\n      this._searchValue = search.trim();\r\n      var newTitle = this._searchValue;\r\n\r\n      this._searchClear.node.style.visibility = !!this._searchValue ? '' : 'hidden';\r\n\r\n      var itemNEW = this._list.getItem(SpacesList.NEW);\r\n      if (itemNEW) {\r\n        this._list.removeItem(SpacesList.NEW);\r\n      }\r\n      var keys = Object.getOwnPropertyNames(this._topics);\r\n      for (var i = 0; i < keys.length; i++) {\r\n        var topic = this._topics[keys[i]];\r\n        this._evTopics({ item: topic });\r\n        if (newTitle === topic.title) {\r\n          newTitle = '';\r\n        }\r\n      }\r\n\r\n      var source;\r\n      if (newTitle !== '') {\r\n        var sources = this.model.getValidSources();\r\n        for (var i = 0; i < sources.length; i++) {\r\n          if (this.model.getCapabilities(sources[i]).createTopic) {\r\n            source = sources[i];\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      if (newTitle !== '' && source) {\r\n        // store Create new item in _list only, do not add it to $topics\r\n        var desc = this.model.formatMessage(i18n.i18n.topicCreateNew, { source: this.model.getSourceName(source) });\r\n        var li = this._list.insert({ id: SpacesList.NEW, source: source, searchable: true, title: newTitle, desc: desc, description: '', show: true });\r\n      } else {\r\n        this._list.group();\r\n      }\r\n    }\r\n\r\n    setTimeout(this._evTimer, 250);\r\n  };\r\n\r\n  SpacesView.prototype._evTopics = function (topic) {\r\n    if (!this._topics) {\r\n      return;\r\n    }\r\n\r\n    var item = topic.item;\r\n    if (item.remove) {\r\n      delete this._topics[item.id];\r\n      this._list.removeItem(item.id);\r\n      return;\r\n    }\r\n    if (!item.error && !this.model.isValidSource(item.source)) {\r\n      return;\r\n    }\r\n   this._topics[item.id] = item;\r\n    var n = 0;\r\n    var members = item.members;\r\n    if (members) {\r\n      for (var i = 0; i < members.length; i++) {\r\n        n = n + (members[i].self ? 0 : 1);\r\n      }\r\n    }\r\n\r\n    var desc;\r\n    if (!n) {\r\n      desc = i18n.i18n.partiesMeOnly;\r\n    } else {\r\n      desc = i18n.i18n.partiesMePlus + n + i18n.i18n.partiesOtherMembers;\r\n    }\r\n\r\n    this._list.insert({ id: item.id, source: item.source, error: item.error,\r\n      title: item.title, desc: desc, description: item.description,\r\n      lastAccess: item.lastAccess, icon: item.icon, searchable : ((typeof(item.searchable) !== 'undefined') ? item.searchable : true),\r\n      show: ((typeof(item.show) !== 'undefined') ? item.show : true) \r\n    });\r\n  };\r\n\r\n  SpacesView.prototype._evClear = function () {\r\n    this._search.node.value = '';\r\n  };\r\n\r\n  SpacesView.prototype._evTypeChange = function () {\r\n    throw new Error('not implemented');\r\n  };\r\n\r\n  SpacesView.prototype._updateRoles = function (item) {\r\n    //item = item || { };\r\n    //this._invite.toggleClass('disabled', (item.source !== 'spaces') || item.error);\r\n    this._invite.toggleClass('disabled', true);\r\n  };\r\n\r\n  SpacesView.prototype._evList = function (item) {\r\n    // console.info('click', item);\r\n    if (!item) {\r\n      this._selection = null;\r\n      return;\r\n    }\r\n    var li = this._list.getItem(item.id);\r\n    this._updateRoles((li || {}).data);\r\n\r\n    if (li.data.error) {\r\n      this.model.initSources({ sources: [li.data.source], retry: true });\r\n      return;\r\n    }\r\n    if (this._selection) {\r\n      if (this._selection === item.id) {\r\n        return;\r\n      }\r\n      this._list.getItem(this._selection).delClass('selected');\r\n    }\r\n    li.addClass('selected');\r\n    this._selection = item.id;\r\n    // console.info('item selected, id: ' + li.data.id + ', title: ' + li.data.title);\r\n    this.onState.dispatch(li.data);\r\n  };\r\n\r\n  SpacesView.prototype._evList2 = function (item) {\r\n    if (!item) {\r\n      return;\r\n    }\r\n    var li = this._list.getItem(item.id);\r\n    if (li.data.error) {\r\n      return;\r\n    }\r\n    this.onState2.dispatch(li.data);\r\n  };\r\n\r\n  SpacesView.prototype.render = function () {\r\n    this._searchValue = ''; // force evTimer restore Create new item if needed\r\n    this._evTimer();\r\n\r\n    var self = this;\r\n    this.model.getTopics().then(function (r) {\r\n      var items = r.items || [];\r\n      for (var i = 0; i < items.length; i++) {\r\n        r.item = items[i];\r\n        self._evTopics(r);\r\n      }\r\n    });\r\n\r\n    if (this._first) {\r\n      return;\r\n    }\r\n    this.applyI18n();\r\n    this._search.node.value = this.applySearchValue();\r\n    this.applyPartiesType();\r\n    this._first = true;\r\n  };\r\n\r\n  SpacesView.prototype.refresh = function () {\r\n    this._list.clear();\r\n    \r\n    var self = this;\r\n    this.model.refresh().then(function () { // wait refresh to complete\r\n      self._searchValue = ''; // then force evTimer restore Create new item if needed\r\n    });\r\n  };\r\n\r\n  SpacesView.prototype.getSelectedItem = function () {\r\n    if (!this._selection) {\r\n      return null;\r\n    }\r\n    return this._list.getItem(this._selection).data;\r\n  };\r\n\r\n  SpacesView.prototype.clearSelectedItem = function () {\r\n    if (!this._selection) {\r\n      return null;\r\n    }\r\n    this._list.getItem(this._selection).delClass('selected');\r\n    this._selection = null;\r\n    this.onState.dispatch(null);\r\n  };\r\n\r\n  SpacesView.prototype.applySearchValue = function () {\r\n    return '';\r\n  };\r\n\r\n  SpacesView.prototype.applyPartiesType = function () {\r\n  };\r\n\r\n  SpacesView.prototype.getPartyType = function () {\r\n    return this._inviteType.node.value;\r\n  };\r\n\r\n  SpacesView.prototype.setPartyType = function (value) {\r\n     this._inviteType.node.value = value;\r\n  };\r\n\r\n  SpacesView.prototype.getPartiesCount = function () {\r\n    return 0;\r\n  };\r\n\r\n  SpacesView.prototype.getContext = function () {\r\n    return { schedule: true };\r\n  };\r\n\r\n  SpacesView.prototype.compare = function (a, b) {\r\n    if (a.data.id === SpacesList.NEW) {\r\n      return -1;\r\n    }\r\n    if (b.data.id === SpacesList.NEW) {\r\n      return 1;\r\n    }\r\n    //if (!this._searchValue) {\r\n      var res = this.model.compare(a.data, b.data);\r\n      if (res !== 0) {\r\n        return res;\r\n      }\r\n    //}\r\n    return this._listcompare(a, b); // TODO: sort items with unknown sources by source names?\r\n  };\r\n\r\n  SpacesView.prototype.getModel = function () {\r\n    throw new Error('not implemented');\r\n  };\r\n\r\n  SpacesView.prototype.getI18N = function () {\r\n    throw new Error('not implemented');\r\n  };\r\n\r\n  module.exports = MeetingPanel.extend(SpacesView);\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/ui/spaces.view.js\n// module id = 78\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Panel         = require('/lib/jsl/ui/panel');\r\n  var animate       = require('/lib/jsl/ui/animate');\r\n  var Event         = require('/lib/jsl/event');\r\n\r\n  var cssLayer = 'layer';\r\n  var cssLayerHidden = 'layer-hidden';\r\n\r\n  function MeetingPanel(opt) {\r\n    opt = opt || {};\r\n    this._setPanelStyles(opt);\r\n    this.$super({});\r\n\r\n    this.addClass(opt.css).addClass(this._panel_styles.layer).addClass(this._panel_styles.layerHidden);\r\n    this.init();\r\n\r\n    this.onState = new Event();\r\n    this.onState2 = new Event();\r\n  }\r\n\r\n  MeetingPanel.prototype.init = function () {\r\n    //this.addClass('icon info').add(i18n.warnNotImplemented);\r\n  };\r\n\r\n  MeetingPanel.prototype._setPanelStyles = function(opt) {\r\n    this._panel_styles = {\r\n      layer: opt.cssLayer || cssLayer,\r\n      layerHidden: opt.cssLayerHidden || cssLayerHidden,\r\n    };\r\n  }\r\n\r\n  MeetingPanel.prototype.render = function () {\r\n  };\r\n\r\n  MeetingPanel.prototype.show = function (css) {\r\n    if (!this.node.classList.contains(this._panel_styles.layerHidden)) {\r\n      return;\r\n    }\r\n    this.render();\r\n    this.animate(css, null, this._panel_styles.layerHidden);\r\n    this.onState.dispatch();\r\n    //context.parties.show();\r\n  };\r\n  MeetingPanel.prototype.hide = function (css) {\r\n    if (this.node.classList.contains(this._panel_styles.layerHidden)) {\r\n      return;\r\n    }\r\n    this.animate(css, this._panel_styles.layerHidden, null);\r\n    //context.parties.hide();\r\n  };\r\n  MeetingPanel.prototype.animate = function (stages, finalOn, finalOff) {\r\n    animate(this.node, { stages: stages, finalOn: finalOn, finalOff: finalOff });\r\n  };\r\n\r\n  module.exports = Panel.extend(MeetingPanel);\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/ui/meeting.panel.js\n// module id = 79\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var pending;\r\n  function getContext(node) {\r\n    var n = pending.indexOf(node);\r\n    if (n < 0) {\r\n      return null;\r\n    }\r\n    return pending[n + 1];\r\n  }\r\n  function addContext(opt) {\r\n    pending.push(opt.node);\r\n    pending.push(opt);\r\n  }\r\n  function delContext(opt) {\r\n    var n = pending.indexOf(opt.node);\r\n    if (n >= 0) {\r\n      pending.splice(n, 2);\r\n    }\r\n  }\r\n  function completeContext(context) {\r\n    if (!context || !context.node) {\r\n      return;\r\n    } \r\n    \r\n    delContext(context);\r\n\r\n    var stages = context.stages || [];\r\n    for (var i = 0; i < stages.length; i++) {\r\n      context.node.classList.remove(stages[i]);\r\n    }\r\n    var finalOn = context.finalOn || [];\r\n    for (i = 0; i < finalOn.length; i++) {\r\n      context.node.classList.add(finalOn[i]);\r\n    }\r\n    var finalOff = context.finalOff || [];\r\n    for (i = 0; i < finalOff.length; i++) {\r\n      context.node.classList.remove(finalOff[i]);\r\n    }\r\n\r\n    if (!context.cancel && context.cb) {\r\n      context.cb();\r\n    }\r\n  }\r\n  function prepareContext(context) {\r\n    var c = getContext(context.node);\r\n    completeContext(c);\r\n\r\n    if (context.timeout) {\r\n      context.expire = Date.now() + context.timeout; \r\n    }\r\n\r\n    addContext(context);\r\n\r\n    context.index = 0;\r\n    var css = context.stages[context.index];\r\n    if (css) {\r\n      context.node.classList.add(css);\r\n    } else {\r\n      completeContext(context);\r\n    }\r\n  }\r\n\r\n  function checkPending() {\r\n    return;\r\n    var item;\r\n    var dt = Date.now();\r\n    for (var i = 1; i < pending.length; i += 2) {\r\n      item = pending[i];\r\n      if (item.expiry && (dt > item.expiry)) {\r\n        completeContext(pending[i - 1]);\r\n      }\r\n    }\r\n    //setTimeout(checkPending, 100);\r\n  }  \r\n  \r\n  function animationStart(ev) {\r\n    var context = getContext(ev.target);\r\n    if (context && context.expiry) {\r\n      context.expiry = 0;\r\n    }\r\n  }\r\n  function animationEnd(ev) {\r\n    var context = getContext(ev.target);\r\n    if (context) {\r\n      var css = context.stages[context.index];\r\n      context.node.classList.remove(css);\r\n\r\n      context.index = context.index + 1;\r\n      css = context.stages[context.index];\r\n      if (!css) {\r\n        completeContext(context);\r\n      }\r\n    }\r\n  }\r\n\r\n  function init() {\r\n    if (pending) {\r\n      return;\r\n    }\r\n    pending = [];\r\n\r\n    document.body.addEventListener('animationend', animationEnd);\r\n    document.body.addEventListener('webkitAnimationEnd', animationEnd);\r\n\r\n    document.body.addEventListener('animationstart', animationStart);\r\n    document.body.addEventListener('webkitAnimationStart', animationStart);\r\n\r\n    //checkPending();\r\n  }\r\n\r\n  function toArray(arg) {\r\n    if (Array.isArray(arg)) {\r\n      return arg;\r\n    } else if (typeof (arg) === 'string') {\r\n      return arg.split(' ');\r\n    }\r\n    return [];\r\n  }\r\n  \r\n  function animate(node, opt) {\r\n    init();\r\n    prepareContext({ node: node, cb: opt.cb, stages: toArray(opt.stages), finalOn: toArray(opt.finalOn), finalOff: toArray(opt.finalOff) });\r\n  }\r\n\r\n  module.exports = animate;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/ui/animate.js\n// module id = 80\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var dom = require('/lib/jsl/dom');\r\n  var Panel = require('/lib/jsl/ui/panel');\r\n  var Action = require('/lib/jsl/ui/action');\r\n\r\n  var office = require('../office');\r\n  var i18n = require('../i18n');\r\n\r\n  function InvitedView(opt) {\r\n    this.$super();\r\n    this.delClass('panel').addClass('panel-invited-view');\r\n    this.model = opt.model;\r\n\r\n    this.details = [];\r\n  }\r\n \r\n  InvitedView.prototype.addDetailItem = function () {\r\n    var name, value;\r\n    this.detailsBox.add(\r\n      dom.div({ cssClass: 'panel-info-item' }).add(\r\n        name = dom.div({ cssClass: 'panel-info-name' }),\r\n        value = dom.div({ cssClass: 'panel-info-value' })\r\n      )\r\n    );\r\n    var res = { name: name, value: value };\r\n    this.details.push(res);\r\n    return res;\r\n  };\r\n\r\n  InvitedView.prototype.render = function () {\r\n    if (!this.node.innerHTML) {\r\n      this.add(\r\n        dom.div().addClass('panel-invited-title').add(this.model.joinMode ? i18n.i18n.titleMeetingDetails : i18n.i18n.titleMeetingDetails2),\r\n        this.detailsBox = dom.div().addClass('panel-invited-info').add(\r\n          dom.div().addClass('panel-info-icon').add(\r\n            this.icon = dom.div()\r\n          ),\r\n          this.title = dom.div().addClass('panel-info-title')\r\n        ),\r\n        dom.div().addClass('actions-list').add(\r\n          this.btnStart = new Action().delClass('action').addClass('action-item action-item-join').add(i18n.i18n.actionStart).set({ click: this.onStart.bind(this) }),\r\n          this.btnRemove = new Action().delClass('action').addClass('action-item action-item-accent').add(i18n.i18n.actionRemoveDetails).set({ click: this.onRemove.bind(this) })\r\n        )\r\n      );\r\n    }\r\n    this.btnRemove.toggleClass('hidden', this.model.joinMode);\r\n    this.btnRemove.toggleClass('disabled', !this.model.canRemoveInvite());\r\n    this.btnRemove.node.innerText = i18n.i18n.actionRemoveDetails;\r\n    this.removingDetails = false;\r\n    return this;\r\n  };\r\n\r\n  InvitedView.prototype.update = function (source, title, url, isHost, details) {\r\n    this.icon.set({cssClass: 'invited-icon-' + source});\r\n    this.title.setText(title || '');\r\n    this.btnStart.setText(isHost ? i18n.i18n.actionStart : i18n.i18n.actionJoin);\r\n    this.btnStart.toggleClass('disabled', !url);\r\n    this.btnRemove.toggleClass('disabled', !this.model.canRemoveInvite());\r\n    \r\n    this.details.forEach(function (item) {\r\n      item.name.setText('');\r\n      item.value.node.parentElement.style.display = 'none';\r\n      item.value.setText('');\r\n    });\r\n    var self = this;\r\n    Object.getOwnPropertyNames(details).forEach(function (item, index) {\r\n      var controls = self.details[index] || self.addDetailItem();\r\n\r\n      controls.name.setText(item);\r\n      var v = details[item] || '';\r\n      controls.value.node.parentElement.style.display = v ? '' : 'none';\r\n      controls.value.setText(v);\r\n    });\r\n\r\n    if (this.btnStart.node.href) {\r\n      this.btnStart.node.href = '#';\r\n    }\r\n    delete this.meetingUrl;\r\n    if (!url) {\r\n      return;\r\n    }\r\n    this.btnStart.delClass('disabled');\r\n    if (url.indexOf('http') !== 0) {\r\n      self.btnStart.node.href = url;\r\n      \r\n      // ACMACOS-10782\r\n      if (navigator.vendor.indexOf('Apple') === 0) {\r\n        self.btnStart.node.setAttribute('target', '_blank');\r\n      }\r\n    } else {\r\n      self.meetingUrl = url;\r\n    }\r\n  };\r\n\r\n  InvitedView.prototype.onStart = function () {\r\n    if (this.removingDetails) {\r\n      return;\r\n    }\r\n    if (this.meetingUrl) {\r\n      window.open(this.meetingUrl, '_blank');\r\n      // this.model.startMeeting();\r\n    }\r\n  };\r\n\r\n  InvitedView.prototype.onRemove = function () {\r\n    if (this.removingDetails) {\r\n      return;\r\n    }\r\n    this.btnStart.addClass('disabled');\r\n    this.btnRemove.addClass('disabled');\r\n    this.btnRemove.node.innerText = i18n.i18n.actionRemovingDetails;\r\n    this.removingDetails = true;\r\n    this.model.removeInvite();\r\n  };\r\n  \r\n  module.exports = Panel.extend(InvitedView);  \r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./ui/invited.js\n// module id = 81\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var dom      = require('/lib/jsl/dom');\r\n  var panel    = require('/lib/jsl/ui/panel');\r\n  var Event    = require('/lib/jsl/event');\r\n\r\n  var popup = function create(opt) {\r\n    this.$super({ cssClass: 'panel panel-popup' });\r\n    this.onHide = new Event();\r\n  };\r\n\r\n  popup.prototype.render = function (panel) {\r\n    this.node.innerHTML = '';\r\n    this.add(dom.div().addClass('panel-popup-wrap').set({ click: this.onClick.bind(this) }).add(\r\n      panel)\r\n    );\r\n    panel.delClass('hidden');\r\n    return this;\r\n  };\r\n\r\n  popup.prototype.onClick = function (ev) {\r\n    if (ev.hidePopup) {\r\n      this.addClass('hidden');\r\n      this.node.innerHTML = '';\r\n      this.onHide.dispatch();\r\n    }\r\n  };\r\n\r\n  module.exports = panel.extend(popup);\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./ui/popup.js\n// module id = 82\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var dom      = require('/lib/jsl/dom');\r\n  var panel    = require('/lib/jsl/ui/panel');\r\n  var action   = require('/lib/jsl/ui/action');\r\n\r\n  var i18n = require('../i18n');\r\n\r\n  var error = function create(opt) {\r\n    this.$super({ cssClass: 'panel panel-error' });\r\n  };\r\n  \r\n  error.prototype.render = function (err) {\r\n    this.err = err;\r\n    this.node.innerHTML = '';\r\n\r\n    var img;\r\n    var content;\r\n    var layout = dom.div({ cssClass: 'panel-error-box' }).add(\r\n      content = dom.div({ cssClass: 'panel-error-content' }).add(\r\n        dom.div({ cssClass: 'panel-error-title' }).add(\r\n          img = dom.div().addClass('panel-error-image hidden'),\r\n          dom.div({'$h' : err.message }).addClass('panel-error-text')\r\n    )));\r\n    img.toggleClass('hidden', !err.source);\r\n    if (err.source) {\r\n      img.addClass(err.source);\r\n    }\r\n    if (err.error && err.error.password) {\r\n      content.add(dom.div().addClass('panel-error-info').add(\r\n          dom.div().addClass('panel-error-info-field').add(\r\n            dom.div({ cssClass: '', text: i18n.i18n.titleUserId }),\r\n            dom.div({ cssClass: '', text: err.info.user })\r\n          ),\r\n          dom.div().addClass('panel-error-info-field').add(\r\n            dom.div({ cssClass: '', text: i18n.i18n.titlePassword }),\r\n            this.password = dom.input({ cssClass: 'input-password', '@type': 'password', hint: i18n.i18n.hintPassword })\r\n          )\r\n        )\r\n      );\r\n    }\r\n\r\n    // var re = /(?<=[a-z])(?=[A-Z])|(?<=[A-Z])(?=[A-Z][a-z])/;\r\n    // var buttons = (err.buttons || '').split(re); // 'OkCancel' => ['Ok', 'Cancel']\r\n    var buttons = (err.buttons || '').split('_'); // 'Ok_Cancel' => ['Ok', 'Cancel']\r\n    var textOk = i18n.i18n['action' + (buttons[0] || '')] || i18n.i18n.actionOk;\r\n    var textCancel = i18n.i18n['action' + (buttons[1] || '')] || i18n.i18n.actionCancel;\r\n    var cancel;\r\n    layout.add(dom.div().addClass('actions-list').add(\r\n        new action({ cssClass: 'action-item action-item-accent', text: textOk, click: this.onAction.bind(this, true) }),\r\n        cancel = new action({ cssClass: 'action-item action-item-accent', text: textCancel, click: this.onAction.bind(this, false) })\r\n      )\r\n    );\r\n    if (!this.err.reject) {\r\n      cancel.node.style.display = 'none';\r\n    }\r\n    // if (err.error && err.error.noconfiguration) {\r\n    //   layout.add(dom.div().addClass('panel-links-view').add(\r\n    //     dom.a({ cssClass: 'link-item', text: i18n.i18n.linkEquinoxSettings, href: 'avaya://settings/Accounts' }))\r\n    //   );\r\n    // }\r\n    this.add(layout);\r\n    return this;\r\n  };\r\n\r\n  error.prototype.onAction = function (retry, ev) {\r\n    ev.hidePopup = true;\r\n    if (this.err.reject) {\r\n      var info = { };\r\n      if (retry && this.password) {\r\n        info.password = this.password.node.value;\r\n        this.password.node.value = null;\r\n        this.password.del(true);\r\n        delete this.password;\r\n      }\r\n      setTimeout(function() {  // call reject without timeout doesn't allow popup to hide properly... TODO: check again...\r\n        this.err.reject({ retry: retry, info: info });\r\n      }.bind(this), 1);\r\n    } else if (this.err.resolve) {\r\n      setTimeout(function() {  // see comment about reject above\r\n        this.err.resolve();\r\n      }.bind(this), 1);\r\n    }\r\n    this.addClass('hidden');\r\n    this.node.innerHTML = '';\r\n  };\r\n\r\n  module.exports = panel.extend(error);  \r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./ui/error.js\n// module id = 83\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var dom = require('/lib/jsl/dom');\r\n  var Control = require('/lib/jsl/ui/control');\r\n\r\n  var States = require('../states');\r\n\r\n  var i18n = require('../i18n');\r\n\r\n  var links = function (opt) {\r\n    this.$super();\r\n    this.addClass('panel-links-view contextMenu hidden');\r\n\r\n    this.model = opt.model;\r\n  };\r\n\r\n  links.prototype.render = function () {\r\n    if (this.node.innerHTML) {\r\n      return this;\r\n    }\r\n    this.linkSettings = dom.a({ cssClass: 'link-item hidden', href: 'avaya://settings/Accounts' });\r\n    this.linkReset = dom.a({ cssClass: 'link-item hidden', href: '#', '^click': this.model.resetConfiguration.bind(this.model) });\r\n    // this.linkInvWizard = dom.a({ cssClass: 'link-item hidden', text:  i18n.i18n.linkInvitationWizard, href: '#' }),\r\n    this.add(\r\n      dom.div({ cssClass: 'panel-links-content' }).add(\r\n        this.dropdown = dom.div({ cssClass: 'panel-links-items hidden' }).add(\r\n          this.linkSettings,\r\n          this.linkReset\r\n        ),\r\n        dom.div({ cssClass: 'panel-links-button', '^click': this.toggleDropDown.bind(this) })\r\n      )\r\n    );\r\n    window.onclick = this.hideDropDown.bind(this);\r\n    return this;\r\n  };\r\n\r\n  links.prototype.hideDropDown = function (event) {\r\n    if (event) {\r\n      var hide = false;\r\n      if (event.target.matches) {\r\n        hide = !event.target.matches('.panel-links-button');\r\n      } else if (event.target.msMatchesSelector) {\r\n        hide = !event.target.msMatchesSelector('.panel-links-button');\r\n      }\r\n      if (hide) {\r\n        this.dropdown.addClass('hidden');\r\n      }\r\n    }\r\n  }\r\n\r\n  links.prototype.toggleDropDown = function () {\r\n    if (this.linkSettings.hasClass('hidden')) {\r\n      this.model.resetConfiguration(); // call reset if settings link is not available\r\n    } else {\r\n      this.dropdown.toggleClass('hidden', !this.dropdown.hasClass('hidden'));\r\n    }\r\n  }\r\n\r\n  links.prototype.update = function (ctxstate) {\r\n    if (ctxstate.app === States.App.Initializing) {\r\n      this.linkSettings.node.innerText = i18n.i18n.linkEquinoxSettings;\r\n      this.linkReset.node.innerText = i18n.i18n.linkResetConfiguration;\r\n    }\r\n    if (ctxstate.app === States.App.Configured) {\r\n      // macOS is supressed\r\n      var hideSetting = this.model.configuration.manual || this.model.cfgSources.indexOf('rooms') === -1 || (navigator.platform && navigator.platform.toLowerCase().indexOf('mac') >= 0);\r\n      this.linkSettings.toggleClass('hidden', hideSetting);\r\n      this.linkReset.delClass('hidden');\r\n    }\r\n  };\r\n\r\n  module.exports = Control.extend(links);\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./ui/links.js\n// module id = 84\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Event        = require('/lib/jsl/event');\r\n  var Promise      = require('/lib/jsl/promise');\r\n  var Storage      = require('/lib/jsl/storage');\r\n  var Log          = require('/lib/jsl/log');\r\n  var Utils        = require('/lib/jsl/utils');\r\n\r\n  var Parties      = require('./model/parties/model');\r\n  var PartiesTypes = require('./model/parties/types');\r\n  var Spaces       = require('./sources/spaces/model');\r\n  var Rooms        = require('./sources/rooms/model');\r\n  var Test         = require('./sources/test/model');\r\n\r\n  var Format       = require('./format');\r\n  var i18n         = require('./i18n');\r\n  var office       = require('./office');\r\n  var invite       = require('./invite');\r\n\r\n  var States       = require('./states');\r\n\r\n  var logger = Log.createLogger('APP');\r\n  var loggerUtils = Log.createLogger('UTILS');\r\n\r\n  /** @constructor */\r\n  function Model() {\r\n    this.onState = new Event();\r\n    this.onTopic = new Event();\r\n    this.parties = Parties;\r\n    this.onFilter = new Event();\r\n    this.onError = new Event();\r\n    this.i18n = i18n;\r\n  }\r\n\r\n  Model.prototype.init = function(opt) {\r\n    Utils.showLogInfo = function (point, obj, fields, exclude) {\r\n      var info = Utils.prepareLogInfo(point, obj, fields, exclude);\r\n      if (typeof(info) === 'undefined') {\r\n        return;\r\n      }\r\n      loggerUtils.info(info);\r\n    }\r\n    opt = opt || { };\r\n    opt.precheck = true;\r\n    this.filter = '';\r\n    this._invite = undefined; // invite is not checked yet\r\n    this.ctxstate = { };\r\n    this._setAppState(States.App.Unknown);\r\n    this.sources = { };\r\n    delete this.wasInvited;\r\n    var self = this;\r\n    return office.checkOffice().then(function (res) { // catch office.initialized flag\r\n      if (!res.checkOffice) {\r\n        return Promise.reject({ error: { nooffice: true } });\r\n      }\r\n  \r\n      var languageId = office.getLanguageSync() || 'en'; // default languageId\r\n      logger.info('Office languageId: ' + languageId);\r\n      return i18n.loadI18n(languageId);\r\n    }).then(function(languageId) {\r\n      opt.languageId = languageId;\r\n      opt.i18n = i18n.i18n;\r\n      office.setTranslations(i18n.i18n);\r\n\r\n      // office dialog api is to be used in following cases:\r\n      // 1. on the web (for Safari - ???)\r\n      // 2. in Outlook client web api mode, while running on windows\r\n      var case1 = office.webAPI && (office.hostName !== 'Outlook')/* && (navigator.vendor || '').indexOf('Apple') === 0*/;\r\n      var case2 = office.webAPI && (office.hostName === 'Outlook') && (navigator.vendor || '').indexOf('Apple') !== 0;\r\n      var asyncui = case1 || case2;\r\n      if (asyncui) {\r\n        self.asyncui = {\r\n          hostName: office.hostName,\r\n          open: function (url) {\r\n            if (!office.webAPI) {\r\n              var wnd = window.open(url);\r\n              return Promise.resolve({ value: wnd });\r\n            }\r\n            return office.displayDialog(url, { width: 50, height: 75, requireHTTPS: true });\r\n          }\r\n        }\r\n      }\r\n\r\n      self.joinMode = office.joinMode;\r\n      self._setAppState(States.App.Initializing);\r\n      self.ctxstate.sources = { };\r\n      self.ctxstate.validsources = { };\r\n      self.ctxstate.invites = [ ];\r\n\r\n      self._setAppState(States.App.Configuring);\r\n      self.configuration = invite.getConfiguration();\r\n      // return Promise.resolve(); // skip configuration wizard\r\n      var configuration = self.configuration;\r\n      if (!self.joinMode && (!configuration || // TODO: check no configuration case more correctly\r\n        (Object.getOwnPropertyNames(configuration).length === 0) ||\r\n        (Object.getOwnPropertyNames(configuration).length === 1 &&\r\n         configuration['ENABLE_AVAYA_CLOUD_ACCOUNTS'] === 0))) { // skipped Spaces && Rooms\r\n        logger.info('Configuration not defined or empty, create manual configuration');\r\n        return self._createConfiguration();\r\n      } else {\r\n        return Promise.resolve();\r\n      }\r\n    }).then(function (r) {\r\n      if (r) {\r\n        logger.info('Setting up manual configuration, reset: ' + self.configurationReset);\r\n        if (!self.configurationReset) {\r\n          self.logout(self.getSources());\r\n        }\r\n        self.configuration = r;\r\n        invite.setConfiguration(self.configuration, true);\r\n        invite.updateMeetingInfo();\r\n      }\r\n      self.cfgSources = [];\r\n      try {\r\n        self.cfgSources = invite.getConfiguredSources();\r\n      } catch(e) {\r\n        return Promise.reject({ error: { nosources: true } });\r\n      };\r\n      opt.sources = self.cfgSources.slice(0);\r\n      self._setAppState(States.App.Configured);\r\n    }).then(function() {\r\n      self._setAppState(States.App.SrcInitializing);\r\n      return self.initSources(opt);\r\n    }).then(function () {\r\n      if (self.getValidSources().length !== 0) {\r\n        self._setAppState(States.App.Initialized);\r\n      } else {\r\n        self._setAppState(States.App.NotInitialized); // no valid sources\r\n        if (self.cfgSources.length !== 1) { // skip error message if only one source is configured (SV request)\r\n          self.showError(null, { error: { nosources: true } });\r\n        }\r\n      }\r\n    }).catch(function (err) {\r\n      self._setAppState(States.App.NotInitialized);\r\n      self.showError(null, err);\r\n    });\r\n  };\r\n\r\n  Model.prototype._createConfiguration = function() {\r\n    this.clearCache(); // clear cache before creating new configuration???\r\n    var self = this;\r\n    return new Promise(function (resolve, reject) {\r\n      self.configuration = { emailAddress: office.getEmailAddress(), resolve: resolve, reject: reject };\r\n      self._setAppState(States.App.NotConfigured);\r\n    })\r\n  };\r\n\r\n  Model.prototype.resetConfiguration = function() {\r\n    var self = this;\r\n    new Promise(function (resolve, reject) {\r\n      var err = { message: i18n.i18n.askResetConfiguration, buttons: 'Reset_Cancel', reject: reject };\r\n      self.showError(null, err);\r\n    }).then(null, function (res) {\r\n      if (res.retry) {\r\n        self.clearCache();\r\n        self.logout(self.getSources());\r\n        invite.resetConfiguration();\r\n        invite.updateMeetingInfo();\r\n        self.configurationReset = true;\r\n        //location.reload();\r\n        //!! review\r\n        window.appRestart();\r\n      }\r\n    });\r\n  };\r\n\r\n  Model.prototype._addSource = function(name) {\r\n    if (this.sources[name]) {\r\n      return;\r\n    }\r\n    switch (name) {\r\n      case 'spaces':\r\n        this.sources[name] = new Spaces();\r\n        break;\r\n      case 'rooms':\r\n        this.sources[name] = new Rooms();\r\n        break;\r\n      case 'test':\r\n        this.sources[name] = new Test();\r\n        break;\r\n    }\r\n    this.sources[name].onTopic.addListener(this._evSourceTopic, this);\r\n    this.sources[name].onProgress.addListener(this._evSourceProgress, this);\r\n    this.ctxstate.sources[name] = States.Src.Unknown;\r\n  };\r\n\r\n  Model.prototype._setAppState = function(state) {\r\n    if (this.ctxstate.app !== state || this.ctxstate.app === States.App.Initialized) { // States.App.Initialized occurs on source reinitializing\r\n      logger.info('State changed app: ' + States.App.names[this.ctxstate.app] + ' => ' + States.App.names[state]);\r\n      this.ctxstate.app = state;\r\n      this.onState.dispatch(this.ctxstate);\r\n    }\r\n  };\r\n\r\n  Model.prototype._setSrcState = function(source, state) {\r\n    if (this.ctxstate.sources[source] !== state) {\r\n      logger.info('State changed src ' + source + ': ' + States.Src.names[this.ctxstate.sources[source]] + ' => ' + States.Src.names[state]);\r\n      this.ctxstate.sources[source] = state;\r\n      this.onState.dispatch(this.ctxstate);\r\n    }\r\n  };\r\n\r\n  Model.prototype.initSources = function(opt) {\r\n    logger.info('initSources: ' + opt.sources.toString());\r\n    if (this.joinMode) {\r\n      ['spaces', 'rooms'].forEach(function (name) {\r\n        this.ctxstate.sources[name] = States.Src.Checked; // set Checked state for all sources if joinMode\r\n        this.ctxstate.validsources[name] = true;\r\n      }.bind(this));\r\n      var self = this;\r\n      return invite.getJoinMeetingUrl().then(function (r) {\r\n        r = r || { };\r\n        var info = { };\r\n        if (r.url) {\r\n          if (r.source === 'spaces') {\r\n            info.topicTitle = i18n.i18n.sourceSpaces;\r\n            info.spaceUrl = r.url;\r\n          } else if (r.source === 'rooms') {\r\n            info.topicTitle = i18n.i18n.sourceEquinox;\r\n            info.joinUrl = r.url;\r\n            info.conferenceAccessUrl = r.url;\r\n          }\r\n        } else {\r\n          info.topicTitle = i18n.i18n.notificationNoMeetingLink;\r\n        }\r\n        self._invite = { source: r.source || '', info: info };\r\n        return Promise.resolve();\r\n      });\r\n    }\r\n    opt.sources = opt.sources || this.getInvalidSources();\r\n    if (!opt.retry) {\r\n      opt.sources.forEach(function (name) {\r\n        this._addSource(name); // create sources on first init\r\n      }.bind(this));\r\n    } else {\r\n      if (opt.retry) {\r\n        if (opt.sources[0] === this.ctxstate.source) {\r\n          logger.info('initSources: skip (already in progress)');\r\n          return;\r\n        }\r\n        if (this.ctxstate.validsources[opt.sources[0]]) {\r\n          logger.info('initSources: skip (already initialized)');\r\n          return;\r\n        }\r\n      }\r\n      opt.sources.forEach(function (name) {\r\n        this.ctxstate.sources[name] = States.Src.Unknown; // set Unknown state for reinitialized sources\r\n      }.bind(this));\r\n    }\r\n    return this._initSources(opt);\r\n  };\r\n\r\n  Model.prototype._initSources = function(opt) {\r\n    var sources = opt.sources;\r\n    this.onState.dispatch(this.ctxstate);\r\n    var self = this;\r\n    return sources.reduce(function (step, source) {\r\n      return step.then(function () {\r\n        if (self.ctxstate.validsources[source]) {\r\n          return Promise.resolve(false); // do not intialize source again\r\n        }\r\n        return self._initSource(source, opt).catch(function (err) {\r\n          logger.cred('initSources error:' + Log.getErrInfo(err), (err.info || { })['password']);\r\n          self.onState.dispatch(self.ctxstate);\r\n          var model = self._getModel(source);\r\n          if (err.retry) {\r\n            model.setInfo(err.info);\r\n            return Promise.reject(err); // throw new Error(); // init unitialized sources once again (see catch below)\r\n          } else {\r\n            sources.splice(sources.indexOf(source), 1); // exclude source from the list\r\n          }\r\n        });\r\n      });\r\n    }, Promise.resolve()).then(function (r) {\r\n      if (r) {\r\n        self._setAppState(States.App.Initialized);\r\n      }\r\n      return Promise.resolve();\r\n    }, function (err) { // catch\r\n      logger.cred('initSources error1: ' + Log.getErrInfo(err), (err.info || { })['password']);\r\n      opt.retry = typeof(opt.retry === 'undefined') ? err.retry : opt.retry;\r\n      // init unitialized sources once again\r\n      return self._initSources(opt);\r\n    });\r\n  };\r\n\r\n  Model.prototype.getSources = function() {\r\n    return Object.getOwnPropertyNames(this.sources);\r\n  };\r\n  Model.prototype.isValidSource = function(name) {\r\n    return this.ctxstate.validsources[name];\r\n  };\r\n  Model.prototype.getValidSources = function() {\r\n    return Object.getOwnPropertyNames(this.ctxstate.validsources).filter(function (name) {\r\n      return this.isValidSource(name);\r\n    }.bind(this));\r\n  };\r\n  Model.prototype.getInvalidSources = function() {\r\n    return Object.getOwnPropertyNames(this.sources).filter(function (name) {\r\n      return !this.isValidSource(name);\r\n    }.bind(this));\r\n  };\r\n\r\n  function PromiseCancel() {\r\n    var cancel;\r\n    var promise = new Promise(function (resolve, reject) {\r\n      cancel = reject.bind(null, { error: { canceled: true } });\r\n    });\r\n    promise.cancel = cancel;\r\n    return promise;\r\n  }\r\n\r\n  function exec(cmd, cancel) {\r\n    return Promise.race([cmd, cancel]);\r\n  }\r\n\r\n  Model.prototype.getSourceName = function (source) {\r\n    switch (source) {\r\n      case 'rooms':\r\n        return i18n.i18n.sourceEquinox;\r\n      case 'spaces':\r\n        return i18n.i18n.sourceSpaces;\r\n    }\r\n    return i18n.i18n.sourceTitle + ' ' + source;\r\n  };\r\n\r\n  Model.prototype.clearCache = function() {\r\n    logger.info('clear cache');\r\n    localStorage.clear();\r\n  }\r\n\r\n  Model.prototype.logout = function(sources) {\r\n    sources = sources || this.getValidSources();\r\n    logger.info('logout sources: ' + sources.toString());\r\n    sources.forEach(function (source) {\r\n      var model = this._getModel(source);\r\n      if (model && model.logout) {\r\n        model.logout().then(function () {\r\n          logger.info('logout ' + source + ': done');\r\n        }, function (err) {\r\n          logger.info('logout ' + source + ' error: ' + Log.getErrInfo(err));\r\n        });\r\n      } else {\r\n        logger.info('logout ' + source + ': not implemented');\r\n      }\r\n    }.bind(this));\r\n    invite.clear();\r\n  };\r\n\r\n  Model.prototype._initSource = function(source, opt) {\r\n    var model;\r\n    var cancel;\r\n    var err_id;\r\n    var isProgress;\r\n    opt = opt || { };\r\n    opt.noui = this.ctxstate.sources[source] === States.Src.Unknown ? true : false;\r\n    opt.asyncui = this.asyncui;\r\n  \r\n    logger.info('_initSource: ' + source + ', ' + 'state: ' + this.ctxstate.sources[source] + ', opt: ' + JSON.stringify({ 'opt.retry': opt.retry, 'opt.noui': opt.noui, 'opt.languageId': opt.languageId }));\r\n    var self = this;\r\n    return Promise.resolve().then(function () {\r\n      model = self.sources[source];\r\n      self.ctxstate.source = source;\r\n      self._setSrcState(source, States.Src.Initializing);\r\n      cancel = PromiseCancel();\r\n      self.cancel = cancel.cancel;\r\n      var precheckInvite;\r\n      if (opt.precheck && self.isValidSource('rooms') && source !== 'rooms') {\r\n        precheckInvite = exec(model.checkInvite(true), cancel).then(function (r) {\r\n          return Promise.resolve(r);\r\n        });\r\n      } else {\r\n        precheckInvite = Promise.resolve(true);\r\n      }\r\n      return precheckInvite.then(function (r) {\r\n        err_id = 'ERROR-' + source;\r\n        if (!r) {\r\n          logger.info('_initSource: use delayed source initialization');\r\n          delete self.ctxstate.source;\r\n          delete self.cancel;\r\n          var message = i18n.i18n.noteInitializing + ' ' + self.getSourceName(source);\r\n          self.onTopic.dispatch({ item: { id: err_id, source: source, error: true, searchable: false, title: message, members: [], icon: 'info-icon error-sourceretry-icon', show: true } });\r\n          self.initSources({ sources: [source] });\r\n          return Promise.resolve(false);\r\n        } else {\r\n          if (opt.retry) {\r\n            self.onTopic.dispatch({ item: { id: err_id, remove: true } });\r\n            var message = self.formatMessage(i18n.i18n.retrySourceInitialization, { source: self.getSourceName(source) });\r\n            self.onTopic.dispatch({ item: { id: err_id, source: source, error: true, searchable: false, title: message, members: [], icon: 'info-icon error-sourceretry-icon', show: true } });\r\n          }\r\n          Storage.setStore(Storage.local);\r\n          return exec(model.init(opt), cancel).then(function() {\r\n            self._setSrcState(source, States.Src.Authorizing);\r\n            return exec(model.login(opt), cancel);\r\n          }).then(function () {\r\n            self._setSrcState(source, States.Src.Authorized);\r\n            self._setSrcState(source, States.Src.Fetching);\r\n            return exec(model.pollTopics(), cancel);\r\n          }).then(function (r) {\r\n            if (!r && self.cfgSources.length > 1 || source === 'spaces') {\r\n              isProgress = true;\r\n              var message = i18n.i18n.noteFetching + ' ' + self.getSourceName(source);\r\n              self.onTopic.dispatch({ item: { id: err_id, source: source, error: true, searchable: false, title: message, members: [], icon: 'info-icon error-sourceretry-icon', show: true } });\r\n            }\r\n            self._setSrcState(source, States.Src.Fetched);\r\n            self._setSrcState(source, States.Src.Checking);\r\n            return exec(model.checkInvite(), cancel);\r\n          }).then(function (r) {\r\n            self.ctxstate.validsources[source] = true; // mark source as valid (initialized)\r\n            self._setSrcState(source, States.Src.Checked);\r\n            if (r) {\r\n              var invite = r;\r\n              invite.source = source;\r\n              invite.isHost = typeof(r.isHost) === 'undefined' ? true : r.isHost;\r\n              invite.webAPI = typeof(invite.webAPI) !== 'undefined' ? invite.webAPI : office.webAPI;\r\n              if (!self._invite) {\r\n                self._invite = invite;\r\n              }\r\n              self.ctxstate.invites.push(invite);\r\n            }\r\n            delete self.cancel;\r\n            if (!isProgress) {\r\n              self.onTopic.dispatch({ item: { id: err_id, remove: true } });\r\n            }\r\n            delete self.ctxstate.source;\r\n            return Promise.resolve(true);\r\n          });\r\n        }\r\n      });\r\n    }).catch(function (err) {\r\n      logger.info('_initSource error: ' + Log.getErrInfo(err));\r\n      model.cancel();\r\n      delete self.cancel;\r\n      delete self.ctxstate.source;\r\n      if (err.error && !err.error.noui) { // skip logout if noui error? (spaces logout causes error here...)\r\n        // model.logout(); // TODO: check spaces logout error\r\n      }\r\n      self._setSrcState(source, self.ctxstate.sources[source] + 1); // TODO: set step failed state more correctly?\r\n      if (!(err instanceof Object)) {\r\n        err = new Error(err.toString());\r\n      }\r\n      return new Promise(function(resolve, reject) {\r\n        err.resolve = resolve;\r\n        var meeting = self.cfgSources.length === 1 && self.cfgSources[0] === 'rooms';\r\n        if (meeting || !(err.error && err.error.notopics)) {\r\n          err.reject = reject;\r\n        } else {\r\n          self.onTopic.dispatch({ item: { id: err_id, remove: true } });\r\n          var message = self.formatMessage(i18n.i18n.errorSourceInitialization, { source: self.getSourceName(source) });\r\n          self.onTopic.dispatch({ item: { id: err_id, source: source, error: true, searchable: false, title: message, members: [], icon: 'info-icon error-sourceinit-icon', show: true } });\r\n        }\r\n        self.showError(source, err);\r\n      }).then(function () {\r\n        logger.info('_initSource Ok');\r\n      }, function (err) {\r\n        logger.cred('_initSource error1: ' + Log.getErrInfo(err), (err.info || { })['password']);\r\n        self.onTopic.dispatch({ item: { id: err_id, remove: true } });\r\n        var message = self.formatMessage(i18n.i18n.errorSourceInitialization, { source: self.getSourceName(source) });\r\n        self.onTopic.dispatch({ item: { id: err_id, source: source, error: true, searchable: false, title: message, members: [], icon: 'info-icon error-sourceinit-icon', show: true } });\r\n        return Promise.reject(err);\r\n      });\r\n    });\r\n  };\r\n\r\n  Model.prototype.showError = function (source, err) {\r\n    if (!(err.error && err.error.canceled)) { logger.info('Show error: ' + Log.getErrInfo(err)); }\r\n    if (err.error) {\r\n      if (err.error.canceled) {\r\n        err.reject({ retry: false }); // exclude source from the list???\r\n        return;\r\n      }\r\n      if (!err.message) {\r\n        // err.message = i18n.i18n.errorUnknown; // use errorInternal instead (see below)\r\n        if (Object.getOwnPropertyNames(err.error).length === 1) {\r\n          var reason = Object.getOwnPropertyNames(err.error)[0];\r\n          var sourceName = this.getSourceName(source);\r\n          switch (reason) {\r\n            case 'nooffice':\r\n              err.message = i18n.i18n.errorNoOffice;\r\n              break;\r\n            case 'disabled':\r\n              err.message = i18n.i18n.errorAccountDisabled;\r\n              break;\r\n            case 'blocked':\r\n              err.message = i18n.i18n.errorLoginBlocked;\r\n              err.buttons = 'Retry_Cancel';\r\n              break;\r\n            case 'closed':\r\n              err.message = i18n.i18n.errorLoginClosed;\r\n              err.buttons = 'Retry_Cancel';\r\n              break;\r\n            case 'timeout':\r\n              err.message = i18n.i18n.errorLoginTimeout;\r\n              err.buttons = 'Retry_Cancel';\r\n              break;\r\n            case 'fetch':\r\n              err.message = this.formatMessage(i18n.i18n.errorNetwork, { source: sourceName });\r\n              break;\r\n            case 'noui':\r\n              err.message = this.formatMessage(i18n.i18n.errorSignInRequired, { source: sourceName });\r\n              break;\r\n            case 'login':\r\n              err.message = this.formatMessage(i18n.i18n.errorLoginRequired, { source: sourceName });\r\n              break;\r\n            case 'credentials':\r\n              err.message = i18n.i18n.errorInvalidCredentials;\r\n              break;\r\n            case 'password':\r\n              var message;\r\n              switch (err.error['password']) {\r\n                case 'empty':\r\n                  message = i18n.i18n.titlePasswordDetails; // errorEmptyPassword;\r\n                break;\r\n                default:\r\n                  message = i18n.i18n.titlePasswordDetails; // errorBadPassword;\r\n                break;\r\n              }\r\n              err.info = err.info || { };\r\n              err.info.source = this.getSourceName(source);\r\n              err.message = this.formatMessage(message, err.info);\r\n              err.buttons = 'Login_Cancel';\r\n              break;\r\n            case 'notopics':\r\n              err.message = i18n.i18n.errorNoRooms;\r\n              break;\r\n            case 'fetchTemplate':\r\n              err.message = i18n.i18n.errorTemplate;\r\n              break;\r\n            case 'noconfiguration':\r\n              if (!source) {\r\n                err.message = i18n.i18n.errorNoAppConfiguration;\r\n              } else {\r\n                err.message = this.formatMessage(i18n.i18n.errorNoSourceConfiguration, { source: sourceName });\r\n              }\r\n              break;\r\n            case 'nosources':\r\n              err.message = i18n.i18n.errorNoValidSources;\r\n              break;\r\n          }\r\n        }\r\n        if (!err.message && !reason) {\r\n          reason = Object.getOwnPropertyNames(err.error).map(function (f) {\r\n            return f + ': ' + err.error[f].toString();\r\n          }).join(', ');\r\n        }\r\n      }\r\n    } else {\r\n      if (typeof(err) === 'string') {\r\n        err = { message: err };\r\n      }\r\n      // TODO: ???\r\n    }\r\n    if (!err.message) {\r\n      err.message = i18n.i18n.errorInternal;\r\n      // if (reason) { // ???\r\n      //   err.message += '(' + reason + ')';\r\n      // }\r\n    }\r\n    err.source = err.source || source;\r\n    this.onError.dispatch(err);\r\n  };\r\n\r\n  Model.prototype._evSourceTopic = function (topic) {\r\n    this.onTopic.dispatch(topic);\r\n  }\r\n\r\n  Model.prototype._evSourceProgress = function (source, info) {\r\n    var err_id = 'ERROR-' + source;\r\n    if (info.fetched) {\r\n      this.onTopic.dispatch({ item: { id: err_id, remove: true } });\r\n    }\r\n    if (info.err) {\r\n      var self = this;\r\n      new Promise(function (resolve, reject) {\r\n        self.showError(source, { message: info.err, resolve: resolve });\r\n      }).then(function() {\r\n        self.onTopic.dispatch({ item: { id: err_id, remove: true } }); // ???\r\n        var message = self.formatMessage(i18n.i18n.errorSourceInitialization, { source: self.getSourceName(source) });\r\n        self.onTopic.dispatch({ item: { id: err_id, source: source, error: true, searchable: false, title: message, members: [], icon: 'info-icon error-sourceinit-icon', show: true } });\r\n        delete self.ctxstate.validsources[source];\r\n        var model = self._getModel(source);\r\n        if (model.getTopics().items.length === 0) { // no valid items\r\n          if (self.getValidSources().length === 0) {\r\n            self._setAppState(States.App.NotInitialized); // no valid sources\r\n            if (self.cfgSources.length !== 1) { // skip error message if only one source is configured (SV request)\r\n              self.showError(null, { error: { nosources: true } });\r\n            }\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  Model.prototype._getModel = function (source) {\r\n    var model = this.sources[source];\r\n    return model;\r\n  };\r\n\r\n  Model.prototype.getModel = function (source) {\r\n    var model = this._getModel(source);\r\n    return model ? Promise.resolve(model) : Promise.reject(i18n.i18n.errorUnknownSource);\r\n  };\r\n\r\n  Model.prototype.getTopics = function() {\r\n    var res = { items: [] };\r\n    var self = this;\r\n   this.getValidSources().forEach(function (source) {\r\n      var model = self._getModel(source);\r\n      var topics = model.getTopics().items || [];\r\n      topics.forEach(function (topic) {\r\n        topic.source = topic.source || source;\r\n        topic.members = topic.members || [];\r\n        res.items.push(topic);\r\n      });\r\n    });\r\n    return Promise.resolve(res);\r\n  };\r\n\r\n  Model.prototype.getPartiesType = function() {\r\n    return this.parties.getPartiesType();\r\n  };\r\n\r\n  Model.prototype.setPartiesType = function(type) {\r\n    this.parties.setPartiesType(type);\r\n  };\r\n\r\n  Model.prototype.getCapabilities = function (source) {\r\n    var model = this.isValidSource(source) ? this._getModel(source) : null;\r\n    return {\r\n      createInvite: model ? !!model.createInvite : false,\r\n      removeInvite: model ? !!model.removeInvite : false,\r\n      createTopic: model ? !!model.createTopic : false, // TODO: enable createTopic?\r\n      refresh: model ? !!model.refresh : false\r\n    };\r\n  };\r\n\r\n  Model.prototype.createInvite = function(invite) {\r\n    var model;\r\n    var source = invite.source;\r\n    var self = this;\r\n    return this.getModel(source).then(function (r) {\r\n      model = r;\r\n      return office.getParties(self.getPartiesType() === PartiesTypes.member);\r\n    }).then(function(parties) {\r\n      invite.parties = parties;\r\n      return model.createInvite(invite);\r\n    }).then(function(r) {\r\n      if (!r.content || (!r.content.html && !r.content.text)) {\r\n        throw new Error(i18n.i18n.errorInviteContentEmpty);\r\n      }\r\n      r.source = source;\r\n      r.isHost = typeof(r.isHost === 'undefined') ? true : r.isHost;\r\n      r.type = r.type || source;\r\n      return self._insertInvite(r);\r\n    }).catch(function(err) {\r\n      if (err.error && err.error.password) {\r\n        return new Promise(function(resolve, reject) {\r\n          err.resolve = resolve;\r\n          err.reject = reject;\r\n          err.buttons = \"Login_Cancel\";\r\n          self.showError(source, err);\r\n        }).catch(function (err) {\r\n          if (err.info.password) {\r\n            model.setInfo(err.info);\r\n            return self.createInvite(invite);\r\n          }\r\n        });\r\n      }\r\n      self.showError(source, err);\r\n    });\r\n  };\r\n\r\n  Model.prototype.removeInvite = function(fallBack) {\r\n    if (!this._invite) {\r\n      return Promise.reject(new Error(i18n.i18n.errorNoInvite));\r\n    }\r\n    this.wasInvited = true;\r\n    \r\n    var source = this._invite.source;\r\n    var type = fallBack ? 'text' : 'html';//office.webAPI ? 'html' : (this.isOutlook16Plus() ? 'html' : 'rtf'); // 'html'; // office.webAPI ? 'html' : 'rtf'; // office.webAPI ? 'html' : (this.isOutlook16Plus() ? 'html' : 'rtf');\r\n    var self = this;\r\n    // TODO(?): model.removeInvite({ id: this._invite.inviteId }).then(function() { // inviteId may be undefined\r\n    return office.getDescription(type).then(function(r) {\r\n      var res = Format.clearInviteInfo(source, r, type);\r\n      if (res) {\r\n        return office.setDescription(res, type);\r\n      }\r\n    }).then(function () {\r\n      return office.setLocation('');\r\n    }).then(function () {\r\n      var title = (self._invite.info || { }).topicTitle;\r\n      if (!title) {\r\n        return Promise.resolve(); // do nothing if title is not defined\r\n      }\r\n      return Promise.resolve().then(function () {\r\n        return office.getSubject().then(function (subject) {\r\n          if (subject !== title) {\r\n            return Promise.resolve(); // do not clear custom subject\r\n          }\r\n          return office.setSubject('');\r\n        });\r\n      }).catch(function () {\r\n        return Promise.resolve(); // ignore subject errors???\r\n      });\r\n    }).then(function () {\r\n      self.ctxstate.invites.splice(0, 1); // TODO: check for other invites once again?\r\n      self._invite = self.ctxstate.invites[0];\r\n      self.onState.dispatch(self.ctxstate);\r\n    }).catch(function(err) {\r\n      logger.info('removeInvite failed, type = ' + type + ', error: ' + JSON.stringify(err));\r\n      // retry to insert text invite on Outlook + Web\r\n      if (office.webAPI && (office.hostName === 'Outlook') && !fallBack) {\r\n        return self.removeInvite(true);\r\n      }\r\n      self.showError(source, err);\r\n      // return Promise.reject(err); // ???\r\n    });\r\n  };\r\n\r\n  Model.prototype._insertInvite = function(invite, fallBack) {\r\n    var info;\r\n    var type = fallBack ? 'text' : 'html';\r\n    if (type === 'html') {\r\n      var formatTextContent = false;\r\n      formatTextContent = formatTextContent || !invite.content.html;\r\n      // formatTextContent = formatTextContent || invite.source === 'spaces';\r\n      // formatTextContent = formatTextContent  || (invite.source === 'rooms' && invite.type !== 'equinox');\r\n      info = formatTextContent ? Format.formatTextContent(invite.id, invite.content.text) : invite.content.html;\r\n      var markContent = false;\r\n      markContent = markContent || (invite.source === 'rooms' && invite.type !== 'equinox');\r\n      info = Format.formatInviteInfo(invite.source, info, markContent);\r\n    } else {\r\n      info = Format.formatInviteText(invite.content.text);\r\n    }\r\n    var location = invite.location;\r\n    var self = this;\r\n    return Promise.all([typeof(location) !== 'undefined' ? office.setLocation(location) : Promise.resolve(), office.insertDescription(info, type)]).then(function() {\r\n      self._invite = { inviteId: invite.id, source: invite.source, isHost: invite.isHost, info: invite.info, webAPI: !!office.webAPI };\r\n      self.ctxstate.invites.push(self._invite);\r\n      self.onState.dispatch(self.ctxstate);\r\n      if (invite.source === 'rooms') {\r\n        return Promise.resolve(); // do not set room title in subject (even if empty)\r\n      }\r\n      return Promise.resolve().then(function () {\r\n        return office.getSubject().then(function(subject) {\r\n          var title = invite.info.topicTitle;\r\n          if (subject || !title) {\r\n            return Promise.resolve(); // do not change custom subject\r\n          }\r\n          return office.setSubject(title);\r\n        });\r\n      }).catch(function () {\r\n        return Promise.resolve(); // ignore subject errors???\r\n      });\r\n    }, function (err) {\r\n      logger.info('_insertInvite failed, type = ' + type + ', error: ' + JSON.stringify(err));\r\n      // retry to insert text invite on Outlook + Web\r\n      if (office.webAPI && (office.hostName === 'Outlook') && !fallBack) {\r\n        return self._insertInvite(invite, true);\r\n      }\r\n      return Promise.reject(err);\r\n    });\r\n  };\r\n\r\n  Model.prototype.canRemoveInvite = function() {\r\n    return !this.joinMode && this._invite && this._invite.isHost && this._invite.webAPI === office.webAPI;\r\n  };\r\n\r\n  Model.prototype.createTopic = function(topic) {\r\n    var model;\r\n    var source = topic.source;\r\n    var self = this;\r\n    return this.getModel(source).then(function (r) {\r\n      model = r;\r\n      return office.getParties(self.getPartiesType() === PartiesTypes.member);\r\n    }).then(function(parties) {\r\n      topic.parties = parties;\r\n      return model.createTopic(topic);\r\n    }).then(function(r) {\r\n      self.onTopic.dispatch({ item: r });\r\n      if (!r.invite) {\r\n        throw new Error(i18n.i18n.errorInviteEmpty);\r\n      }\r\n      r = r.invite;\r\n      if (!r.content || (!r.content.html && !r.content.text)) {\r\n        throw new Error(i18n.i18n.errorInviteContentEmpty);\r\n      }\r\n      r.source = source;\r\n      r.type = r.type || source;\r\n      r.isHost = typeof(r.isHost === 'undefined') ? true : r.isHost;\r\n      return self._insertInvite(r);\r\n    }).catch(function(err) {\r\n      self.showError(source, err);\r\n      // return Promise.reject(err); // ???\r\n    });\r\n  };\r\n\r\n  Model.prototype.startMeeting = function() {\r\n    var source = this._invite.source;\r\n    var self = this;\r\n    invite.getJoinMeetingUrl().then(function (info) {\r\n      var wnd;\r\n      var message;\r\n      var url = (info || { }).url;\r\n      if (url) {\r\n        wnd = window.open(url, '_blank');\r\n        if (!wnd) {\r\n          var message = i18n.i18n.notificationMeetingNotJoined + ': ' + i18n.i18n.errorPopupBlocked;\r\n        }\r\n      } else {\r\n        message = i18n.i18n.notificationMeetingNotJoined + ': ' + i18n.i18n.notificationNoMeetingLink;\r\n      }\r\n      if (message) {\r\n        self.showError(source, message);\r\n      }\r\n    });\r\n  };\r\n\r\n  Model.prototype.compare = function(a, b) {\r\n    if (!a.source || !b.source) {\r\n      return 0;\r\n    }\r\n    if (a.source === b.source) {\r\n      if (a.error && b.error) {\r\n        return 0;\r\n      } else if (a.error) {\r\n        return -1;\r\n      } else if (b.error) {\r\n        return 1;\r\n      } else { // no errors\r\n        var model = this._getModel(a.source);\r\n        if (model) {\r\n          var res = model.compare(a, b);\r\n          if (res !== 0) {\r\n            return res;\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      var aidx = this.cfgSources.indexOf(a.source);\r\n      var bidx = this.cfgSources.indexOf(b.source);\r\n      if (aidx !== bidx) {\r\n        return aidx < bidx ? -1 : 1;\r\n      }\r\n    }\r\n    return 0;\r\n  };\r\n\r\n  Model.prototype.formatMessage = function (message, info) {\r\n    Object.getOwnPropertyNames(info).forEach(function (name) {\r\n      message = message.replace('$' + name, info[name]);\r\n    });\r\n    return message;\r\n  }\r\n\r\n  module.exports = new Model();\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model.js\n// module id = 85\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise   = require('/lib/jsl/promise');\r\n\r\n  var invite    = require('../../invite');\r\n\r\n  var SourceModel = require('../model');\r\n  var States = require('../../states');\r\n\r\n  /** @constructor */\r\n  function Model() {\r\n    this.source = 'test';\r\n    this.$super();\r\n    this.items = { 't0': { id: 't0', source: this.source, title: 'Test 0', members: [] } };\r\n  }\r\n\r\n  Model.prototype.init = function(opt) {\r\n    return Promise.resolve();\r\n  };\r\n  \r\n  Model.prototype.login = function(opt) {\r\n    var self = this;\r\n    if (opt.noui) {\r\n      return new Promise(function (resolve, reject) {\r\n        setTimeout(function () {\r\n          // reject({ error: { canceled: true } });\r\n          reject({ error: { login: true } });\r\n        }, 1000);\r\n      });\r\n    }\r\n    return new Promise(function (resolve, reject) {\r\n      setTimeout(function () {\r\n        resolve();\r\n      }, 3000);\r\n    });\r\n  };\r\n\r\n  Model.prototype.pollTopics = function() {\r\n    var self = this;\r\n    return new Promise(function (resolve, reject) {\r\n      setTimeout(function () {\r\n        setTimeout(function () {\r\n          var n = Object.getOwnPropertyNames(self.items).length;\r\n          var item = { id: 't' + n, source: self.source, title: 'Test ' + n, members: [] };\r\n          self.items[item.id] = item;\r\n          self.onTopic.dispatch({ item: item });\r\n        }, 1000);\r\n        resolve();\r\n      }, 3000);\r\n    });\r\n  };\r\n\r\n  Model.prototype.getTopics = function() {\r\n    var res = { items: [] };\r\n    Object.getOwnPropertyNames(this.items).forEach(function (id) {\r\n      res.items.push(this.items[id]);\r\n    }, this);\r\n    return res;\r\n  };\r\n  \r\n  Model.prototype.checkInvite = function() {\r\n    var self = this;\r\n    return invite.getMeetingInfo({ location: true, body: true }).then(function (r) {\r\n      return new Promise(function (resolve, reject) {\r\n        var ids = Object.getOwnPropertyNames(self.items);\r\n        var body = r[1] || '';\r\n        var invite;\r\n        for (var i = 0; i < ids.length; i++) {\r\n          var id = ids[i];\r\n          var idx = body.indexOf(self.items[id].title);\r\n          if (idx !== -1) {\r\n            invite = { inviteId: id };\r\n            break;\r\n          }\r\n        }\r\n        setTimeout(function () {\r\n          resolve(invite);\r\n        }, 3000);\r\n      });\r\n    });\r\n  };\r\n\r\n  Model.prototype.createInvite = function(invite) {\r\n    // return Promise.reject(new Error('Not implemented'));\r\n    invite.content = { html: '<html><body>' + this.items[invite.id].title + '</body></html>' };\r\n    invite.location = 'Location: ' + invite.id;\r\n    return Promise.resolve(invite);\r\n  };\r\n\r\n  Model.prototype.getTopic = function(id) {\r\n    return this.items[id];\r\n  };\r\n\r\n  module.exports = SourceModel.extend(Model);  \r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./sources/test/model.js\n// module id = 86\n// module chunks = 0","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Log          = require('/lib/jsl/log');\r\n\r\n  var office       = require('./office');\r\n\r\n  var logger = Log.createLogger('FORMAT');\r\n\r\n  var SV_MARKER = '================================================================';\r\n  var SV_WRAPPER = '~' + SV_MARKER;\r\n\r\n  function Format() {\r\n  }\r\n\r\n  Format.prototype.formatTextContent = function (id, content) {\r\n    var lines = content.split('\\n');\r\n    lines = lines.map(function (line) {\r\n      if (line.indexOf('http') === 0) {\r\n        line = '<a href=\"' + line + '\">' + line + '</a>';\r\n      }\r\n      return line ? '<div>' + line + '</div>' : '<div>&nbsp;</div>';\r\n    });\r\n    return lines.join('');\r\n  };\r\n\r\n  Format.prototype._markInviteInfo = function (inviteInfo) {\r\n    return '<p>' + SV_MARKER + '</p>' + inviteInfo  + '<p>' + SV_MARKER + '</p>';\r\n  };\r\n\r\n  Format.prototype._wrapInviteInfo = function (source, inviteInfo) {\r\n    var labelBegin = SV_WRAPPER + '<a name=\"EquinoxMeetingBegin_' + source + '\"></a></p></td></tr>';\r\n    var labelEnd =   SV_WRAPPER + '<a name=\"EquinoxMeetingEnd_'   + source + '\"></a></p></td></tr>';\r\n    var wrapPrefix = '';\r\n    wrapPrefix += '<p>&nbsp;</p><p>';\r\n    wrapPrefix += '<table border=0 cellspacing=0 cellpadding=0 width=\"100%\" style=\"width:100.0%;border-collapse:collapse;background: #f2f4f6;\">';\r\n    wrapPrefix += '<tr style=\"height:0.05in\"><td><p style=\"font-size:0pt;color:#f2f4f6;\">' + labelBegin;\r\n    wrapPrefix += '<tr><td width=\"100%\" valign=top style=\"width:100.0%;padding:0 1in 0 1in;\">';\r\n\r\n    var wrapSuffix = '';\r\n    wrapSuffix += '</td></tr>';\r\n    wrapSuffix += '<tr style=\"height:0.05in\"><td><p style=\"font-size:0pt;color:#f2f4f6;\">' + labelEnd;\r\n    wrapSuffix += '</table></p>';\r\n    \r\n/*    \r\n    var imgUri = location.protocol + '//' + location.hostname + location.pathname;\r\n    var re = /[^\\/]*\\/[^\\.\\/]*\\.html/ig;\r\n    imgUri = imgUri.replace(re, '');\r\n    imgUri = imgUri.replace('https://manage2.', 'https://manage1.');\r\n\r\n    var bannerUri = imgUri + 'img/banner.jpg';\r\n    var logoUri = imgUri + 'img/logo2.png';\r\n\r\n    var banner = '<tr><td style=\\'text-align:center;\\'><img src=\\'' + bannerUri + '\\' style=\\'width:100%;\\'></td></tr>';\r\n    var logotype = '<tr><td style=\\'text-align:right;\\'><img src=\\'' + logoUri + '\\'/></td></tr>';\r\n    if (room.type !== 'equinox') {\r\n      banner = '';\r\n      logotype = '';\r\n    }\r\n\r\n    var wrapPrefix = '<p align=\\'center\\' style=\\'text-align:center;\\'>';\r\n    wrapPrefix += '<table cellspacing=\\'0\\' cellpadding=\\'0\\' style=\\'width:495pt; border-collapse:collapse; border: solid 1px #cc0000;\\' summary=\\'equinoxMarkup\\'><tbody>';\r\n    wrapPrefix += banner + '<tr><td style=\\'padding:10pt\\'>';\r\n\r\n    var wrapSuffix = '</td></tr>' + logotype + '</tbody></table></p>';\r\n*/\r\n    return wrapPrefix + inviteInfo + wrapSuffix;\r\n  };\r\n\r\n  Format.prototype._isOutlook16Plus = function () {\r\n    if (!office.webAPI && office.version) {\r\n      var parts = office.version.split('.');\r\n      var major = parseInt(parts[0]);\r\n      return major >= 16;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  Format.prototype.formatInviteInfo = function (source, inviteInfo, markInvite) {\r\n    var wrapInvite = !markInvite;//this._isOutlook16Plus();\r\n    if (wrapInvite) {\r\n      inviteInfo = this._wrapInviteInfo(source, inviteInfo);\r\n    } else {\r\n      inviteInfo = this._markInviteInfo(inviteInfo);\r\n    }\r\n\r\n    var prefix = '<html><head><meta charset=\\'UTF-8\\'/></head><body>';\r\n    var suffix = '</body></html>';\r\n    return prefix + inviteInfo + suffix;\r\n  };\r\n\r\n  Format.prototype.formatInviteText = function (inviteInfo) {\r\n    return '\\n' + SV_MARKER + '\\n' + inviteInfo  + '\\n' + SV_MARKER + '\\n';\r\n  }\r\n\r\n  Format.prototype._clearInviteInfoOpenXML = function (source, body) {\r\n    var re = /<[^\\:]*\\:tbl>.*<[^\\:]*\\:tblDescription [^\\:]*\\:val\\=\\\"equinoxMarkup\\\"\\/>.*<\\/[^\\:]*\\:tbl>/i;\r\n    var r, m = re.exec(body);\r\n    if (m) {\r\n      r = body.replace(re, '');\r\n      return r;\r\n    }\r\n\r\n    var labelBegin = '\\\\\"' + 'EquinoxMeetingBegin_' + source + '\\\\\"';\r\n    var labelEnd =   '\\\\\"' + 'EquinoxMeetingEnd_'   + source + '\\\\\"';\r\n    re = new RegExp('<[^\\\\/\\\\:]*?\\\\:tbl>[^_]*?<[^\\\\:]*?\\\\:bookmarkStart[^>]*?name=' + labelBegin + '.*?<[^\\\\:]*?\\\\:bookmarkStart[^>]*?name=' + labelEnd + '.*?<\\\\/[^\\\\:]*?\\\\:tbl>', 'ig');\r\n    m = re.exec(body);\r\n    if (m) {\r\n      r = body.replace(re, '');\r\n      logger.info('clearInviteInfoOpenXML OK1, body: ' + r.length);\r\n      return r;\r\n    }\r\n\r\n    labelBegin = 'EquinoxMeetingBegin_' + source;\r\n    labelEnd =   'EquinoxMeetingEnd_'   + source;\r\n    // TODO: use more exact regexp\r\n    re = /<\\w\\:p[^~]*?~.*?bookmarkStart.*?EquinoxMeetingBegin_.*?bookmarkStart.*?EquinoxMeetingEnd_.*?<\\/[^\\:]*?\\:p>/ig;\r\n    body = body.replace(/[\\r\\n]/g, '');\r\n    for (; !!(m = re.exec(body)); ) {\r\n      if (m[0].indexOf(labelBegin) !== -1 && m[0].indexOf(labelBegin) !== -1) {\r\n        r = body.replace(m[0], '');\r\n        logger.info('clearInviteInfoOpenXML OK2, body: ' + r.length);\r\n        return r;\r\n      }\r\n    }\r\n\r\n    if (!DOMParser || !XMLSerializer) {\r\n      return;\r\n    }\r\n    var parser = new DOMParser();\r\n    var xdoc = parser.parseFromString(body, 'text/xml');\r\n\r\n/*\r\n    var xstart, xend;\r\n\r\n    var xitems = xdoc.getElementsByTagNameNS('*', 'bookmarkStart');\r\n    for (var i = 0; i < xitems.length; i++) {\r\n      var xitem = xitems[i];\r\n      var prefix = xitem.prefix ? xitem.prefix + ':' : '';\r\n      var xname = xitem.getAttribute(prefix + 'name');\r\n      if ((xname === 'EquinoxMeetingBegin') && !xstart) {\r\n        xstart = xitem;\r\n      }\r\n      if ((xname === 'EquinoxMeetingEnd') && !xend) {\r\n        xend = xitem;\r\n      }\r\n    }\r\n\r\n    if (xstart && xend) {\r\n      for (var xsp = xstart; xsp && (xsp !== xdoc.documentElement); xsp = xsp.parentNode) {\r\n        for (var xep = xend; xep && (xep !== xdoc.documentElement); xep = xep.parentNode) {\r\n          if (xep === xsp) {\r\n            xep.parentNode.removeChild(xep);\r\n            var serializer = new XMLSerializer();\r\n            var xres = serializer.serializeToString(xdoc);\r\n\r\n            debugger;\r\n            xres = '<?xml version=\"1.0\" standalone=\"yes\"?>\\n<?mso-application progid=\"Word.Document\"?>\\n' + xres;\r\n\r\n            return xres;\r\n          }\r\n        }\r\n      }\r\n    }\r\n*/\r\n\r\n    var xitems = xdoc.getElementsByTagNameNS('*', 'p');\r\n    var from = -1, to = -1;\r\n    for (var i = xitems.length - 1; i >= 0; i--) {\r\n      var xitem = xitems[i];\r\n      var text = xitem.textContent;\r\n      if (to === -1) {\r\n        if (text && text.indexOf(SV_MARKER.substring(0, 32)) !== -1) {\r\n          to = i; // end marker paragraph\r\n        }\r\n      } else {\r\n        if (text && text.indexOf(SV_MARKER.substring(0, 32)) !== -1) {\r\n          from = i; // start marker paragraph\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    if ((to !== -1) && (from !== -1)) {\r\n      body = body.replace(/[\\r\\n]/g, '');\r\n      // re = /(.*?)(<[^\\:]*?\\:p\\s.*?>.*?<\\/[^\\:]*?\\:p>)/g;\r\n      re = /(.*?)(<[^\\:]*?\\:p(\\s[^<]*?\\/>|\\s.*?>.*?<\\/[^\\:]*?\\:p>))/g;\r\n      i = 0;\r\n      var r = '';\r\n      while ((m = re.exec(body))) {\r\n        var prefix = m[1]; // add start of the body (before first paragraph)\r\n        var para = (i < from || i > to) ? m[2] : ''; // exclude markers paragraphs and paragraphs (<w:p>...</w:p> between them\r\n        r += prefix + para;\r\n        if (i === to) {\r\n          var suffix = body.substring(m.index + m[0].length);\r\n          r += suffix;  // add all subsequent paragraphs and end of body\r\n          break;\r\n        }\r\n        i += 1;\r\n      }\r\n      logger.info('clearInviteInfoOpenXML OK3, body: ' + r.length);\r\n      return r;\r\n    }\r\n    return;\r\n  };\r\n\r\n  var extractMeetingInfoStatic; // TODO!!!\r\n\r\n  Format.prototype._clearInviteInfoHTML = function (source, body) {\r\n    // first try to remove invite from document\r\n    if (extractMeetingInfoStatic) {\r\n      var parser = new DOMParser();\r\n      var xdoc = parser.parseFromString(body, 'text/html');\r\n      var xitems = xdoc.getElementsByTagNameNS('*', 'table');\r\n      for (var i = 0; i < xitems.length; i++) {\r\n\r\n        var xitem = xitems[i];\r\n        var xhtml = xitem.innerHTML;\r\n\r\n        var reBegin = /<a[^>]*EquinoxMeetingBegin/ig;\r\n        var reEnd = /<a[^>]*EquinoxMeetingEnd/ig;\r\n        if (reBegin.exec(xhtml) && reEnd.exec(xhtml)) {\r\n          xitem.parentNode.removeChild(xitem);\r\n          return xdoc.documentElement.innerHTML;\r\n        }\r\n\r\n        var innerText = xitem.innerText;\r\n        var info = extractMeetingInfoStatic({ body: innerText});\r\n        if (info.url && info.isHost) {\r\n          xitem.parentNode.removeChild(xitem);\r\n          return xdoc.documentElement.innerHTML;\r\n        }\r\n      }\r\n    }\r\n    // then try to remove invite via regex\r\n    // var re = /<table[^>]*?summary=\\\"equinoxMarkup\\\".*?<\\/table>/i;\r\n    var labelBegin = 'EquinoxMeetingBegin_' + source;\r\n    var labelEnd =   'EquinoxMeetingEnd_'   + source;\r\n    var re = /<table.*?EquinoxMeetingBegin_.*?EquinoxMeetingEnd_.*?<\\/table>/ig;\r\n    body = body.replace(/[\\r\\n]/g, '');\r\n    for (var m; !!(m = re.exec(body)); ) {\r\n      if (m[0].indexOf(labelBegin) !== -1 && m[0].indexOf(labelBegin) !== -1) {\r\n        var r = body.replace(m[0], '');\r\n        logger.info('clearInviteInfoHTML OK, body: ' + r.length);\r\n        return r;\r\n      }\r\n    }\r\n    return;\r\n  };\r\n\r\n  var re_sv_marker_rtf  = new RegExp('\\\\{[^\\\\{]*?={50,}[^\\\\}]*?\\\\}' + '.*?' + '\\\\{[^\\\\{]*?={50,}[^\\\\}]*?\\\\}');\r\n  var re_sv_marker_html = new RegExp('<[^>]*?>[^<]*?={32,}.*?<[^>]*?>' + '.*?' + '<[^>]*?>.*?={32,}.*?<[^>]*?>');\r\n\r\n  Format.prototype._clearInviteInfoDumb = function (body, type) {\r\n    var re_sv_marker = type === 'html' ? re_sv_marker_html : re_sv_marker_rtf;\r\n    body = body.replace(/[\\r\\n]/g, '');\r\n    var m = re_sv_marker.exec(body);\r\n    if (m) {\r\n      var r = body.replace(m[0], '');\r\n      logger.info('clearInviteInfoDumb OK, body: ' + r.length);\r\n      return r;\r\n    }\r\n  };\r\n\r\n  var re_sv_marker_text = /~?={50,}[\\s\\S]*?={50,}/im;\r\n\r\n  Format.prototype._clearInviteInfoText = function (body) {\r\n    var m = re_sv_marker_text.exec(body);\r\n    if (m) {\r\n      var r = body.replace(m[0], '');\r\n      logger.info('clearInviteInfoText OK, body: ' + r.length);\r\n      return r;\r\n    }\r\n  };\r\n\r\n  Format.prototype.clearInviteInfo = function (source, body, type) {\r\n    var isOpenXML = body.indexOf('<?xml') === 0;\r\n    logger.info('clearInviteInfo ' + source + ', webAPI: ' + office.webAPI + ', body: ' + body.length + ', type: ' + type + ', Open XML: ' + isOpenXML);\r\n    var res;\r\n    if (type === 'text') {\r\n      res = this._clearInviteInfoText(body);\r\n    } else {\r\n      if (!office.webAPI && isOpenXML) {\r\n        res = this._clearInviteInfoOpenXML(source, body);\r\n      } else {\r\n        res = this._clearInviteInfoHTML(source, body);\r\n      }\r\n      if (!res) {\r\n        res = this._clearInviteInfoDumb(body, type);\r\n      }\r\n    }\r\n    if (!res) {\r\n      logger.info('clearInviteInfo failed: invite not found');\r\n    }\r\n    return res;\r\n  };\r\n  \r\n  module.exports = new Format();\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./format.js\n// module id = 87\n// module chunks = 0"],"sourceRoot":""}