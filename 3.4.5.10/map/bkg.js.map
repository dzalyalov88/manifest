{"version":3,"sources":["webpack:///webpack/bootstrap f4b3f8edada7bfe26fec","webpack:///../lib/jsl/promise.js","webpack:///../lib/jsl/utils.js","webpack:///../lib/jsl/event.js","webpack:///../lib/jsl/log.js","webpack:///../lib/jsl/globals.js","webpack:///./i18n.js","webpack:///../lib/jsl/chrome/chrome.js","webpack:///../lib/jsl/base.js","webpack:///../lib/jsl/io/fetchproxy.js","webpack:///../lib/jsl/storage.js","webpack:///./office.js","webpack:///../lib/jsl/loader.js","webpack:///../lib/jsl/timer.js","webpack:///../lib/jsl/chrome/rpc/schema.js","webpack:///../lib/jsl/id/oauth.provider.js","webpack:///./invite.js","webpack:///./model/parties/types.js","webpack:///./model/identity/model.js","webpack:///./model/identity/states.js","webpack:///./model/api/api.js","webpack:///(webpack)/buildin/global.js","webpack:///../lib/jsl/maps/literal.js","webpack:///../lib/jsl/guid.js","webpack:///./sources/rooms/srcconfig.js","webpack:///./sources/spaces/srcconfig.js","webpack:///./model/rooms/model.js","webpack:///./model/spaces/model.js","webpack:///./model/parties/model.js","webpack:///./office.native.js","webpack:///./storage.js","webpack:///./model/rooms/settings.js","webpack:///./model/rooms/api.js","webpack:///./model/rooms/tom.js","webpack:///./model/rooms/templates.js","webpack:///./model/spaces/schema.js","webpack:///../lib/jsl/promise.cancel.js","webpack:///../lib/jsl/id/oauth.js","webpack:///../lib/jsl/id/oauth.storage.js","webpack:///../lib/jsl/id/oauth.provider.google.js","webpack:///../lib/jsl/io/fetch.js","webpack:///../lib/jsl/io/fetch.const.js","webpack:///../lib/jsl/id/jwt.js","webpack:///../lib/jsl/id/oauth.interactive.js","webpack:///../lib/jsl/chrome/window.js","webpack:///../lib/jsl/chrome/chrome.tabs.js","webpack:///../lib/jsl/id/oauth.provider.salesforce.js","webpack:///../lib/jsl/id/oauth.provider.esna.js","webpack:///../lib/jsl/id/oauth.provider.microsoft.js","webpack:///./model/onesna/model.js","webpack:///../lib/jsl/promise.queue.js","webpack:///./model/channel/model.js","webpack:///../lib/jsl/chrome/rpc/server.js","webpack:///../lib/jsl/chrome/rpc/port.js","webpack:///../lib/jsl/chrome/rpc/router.js","webpack:///../lib/jsl/chrome/rpc/proxy.js","webpack:///./model/identity/schema.js","webpack:///./model/parties/schema.js","webpack:///./model/spaces/spaces.js","webpack:///./bkg.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;AC7DA,qEAAO;AACP;;AAEA,eAAe,mBAAO,CAAC,EAAU;;AAEjC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC7BF,qEAAO;AACP;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,6D;AACA,6CAA6C,UAAU;AACvD,mC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mCAAmC,SAAS;AAC5C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA,mBAAmB,6BAA6B;AAChD,OAAO,oC;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL,qBAAqB;AACrB;AACA;AACA;;AAEA;AACA,iCAAiC,yBAAyB;AAC1D;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,2BAA2B,wBAAwB,WAAW,EAAE,EAAE;AAClE;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oG;AACA,S;AACA,gDAAgD,SAAS;AACzD;AACA,uC;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,kCAAkC,wEAAwE;AAC1G;AACA;AACA;AACA,OAAO,mCAAmC;AAC1C;AACA;AACA;AACA,gCAAgC,sDAAsD;AACtF;AACA,OAAO,sCAAsC;AAC7C;AACA,gCAAgC,oDAAoD;AACpF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,eAAe,kCAAkC;AACjD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,MAAM;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,mBAAmB;AACxC;AACA;AACA,uBAAuB,kBAAkB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,gBAAgB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,mBAAmB;AACtC;AACA;AACA;AACA,eAAe,mBAAmB;AAClC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACjSF,qEAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,cAAc;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,yB;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACtCF,qEAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,kBAAkB;AAClB;AACA;;AAEA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;;ACrEF,mHAAO;AACP;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,oBAAoB;AACpB,CAAC;AAAA,oGAAC,C;;;;;;;;ACxBF,qEAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,aAAa;;AAEb;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA,WAAW;AACX;AACA;AACA,SAAS;AACT;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC/MF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAY;;AAEpC;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACdF,qEAAO;AACP;;AAEA;AACA;;AAEA;AACA,6CAA6C;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,qBAAqB;AAC5D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,2DAA2D,eAAe,wCAAwC,UAAU,2CAA2C,EAAE;AACzK;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA;AACA,cAAc;AACd,eAAe,cAAc;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,I;AACA;AACA;AACA;AACA;AACA;AACA,I;;AAEA,0CAA0C;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,CAAC;AAAA,oGAAC,C;;;;;;;ACtGF,qEAAO;AACP;;AAEA,eAAe,mBAAO,CAAC,CAAkB;AACzC,cAAc,mBAAO,CAAC,EAAS;;AAE/B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,8B;AACA,CAAC;AAAA,oGAAC;;;;;;;AClBF,qEAAO;AACP;;AAEA;AACA,WAAW;AACX;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACnEF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C,YAAY,mBAAO,CAAC,CAAc;AAClC,cAAc,mBAAO,CAAC,EAAgB;;AAEtC,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C;;AAEA,qBAAqB,mBAAO,CAAC,EAAiB;AAC9C,sBAAsB,mBAAO,CAAC,EAAW;;AAEzC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,kCAAkC;AACrD,SAAS;AACT;AACA;AACA;AACA,qBAAqB,mCAAmC;AACxD,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,8DAA8D;AAC9D,KAAK;AACL;;AAEA;AACA;AACA;AACA,+EAA+E;AAC/E;AACA,uBAAuB,wBAAwB;AAC/C,wBAAwB,uEAAuE;AAC/F;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,sBAAsB;AACtB;AACA,KAAK;AACL;;AAEA;AACA;AACA,sBAAsB;AACtB;AACA,KAAK;AACL;;AAEA;AACA;AACA,sBAAsB;AACtB;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,4DAA4D,EAAE;AAC9D,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA,wEAAwE,gFAAgF;AACxJ;;AAEA;AACA,wEAAwE,yCAAyC;AACjH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D,UAAU,WAAW,aAAa,cAAc,4CAA4C,gBAAgB;AACtK;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD,eAAe,oBAAoB,gBAAgB,sCAAsC,WAAW,UAAU,mBAAmB;;AAEpL;AACA;AACA;AACA,0DAA0D,oBAAoB,cAAc,6BAA6B,iBAAiB,eAAe,oBAAoB,oBAAoB;;AAEjM;AACA,8DAA8D,qBAAqB,wBAAwB;AAC3G;;AAEA;AACA,uDAAuD,cAAc;;AAErE;AACA;AACA,6DAA6D,cAAc,cAAc,iBAAiB,mDAAmD,iBAAiB,mBAAmB,qBAAqB,kCAAkC,sCAAsC;AAC9R;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW;;AAEX;AACA;AACA,6DAA6D,cAAc,cAAc,iBAAiB,mDAAmD,iBAAiB,mBAAmB,qBAAqB,kCAAkC,sCAAsC;AAC9R;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW;;AAEX;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA,oBAAoB;AACpB,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW;AACX,2BAA2B,wBAAwB;;AAEnD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,yBAAyB,eAAe;AACxC;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA,oBAAoB;AACpB;AACA,4BAA4B;AAC5B,kBAAkB;AAClB;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,+BAA+B,SAAS,iBAAiB,EAAE;AAC3D;AACA,wCAAwC;AACxC;AACA;;AAEA;AACA;AACA;AACA;AACA,kCAAkC,SAAS,iBAAiB,EAAE;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,SAAS,iBAAiB,EAAE;AACnD,cAAc;AACd,8CAA8C;AAC9C,c;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP,+BAA+B,SAAS,iBAAiB,EAAE;AAC3D,OAAO;AACP,0CAA0C;AAC1C;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,0B;AACA,CAAC;AAAA,oGAAC;;;;;;;ACjfF,qEAAO;AACP;;AAEA,cAAc,mBAAO,CAAC,EAAS;;AAE/B,iBAAiB,G;AACjB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,gBAAgB;AACnC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mBAAmB,gBAAgB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,qB;AACA,sC;AACA,sB;AACA,gB;AACA,0B;AACA,G;;;AAGA;AACA;AACA;AACA;AACA;AACA,4BAA4B;AAC5B;AACA,UAAU,KAA2C;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;;AAEA;AACA,mBAAmB,gBAAgB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,kCAAkC;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB,qBAAqB;AACxC;AACA;AACA,eAAe,iBAAiB;AAChC;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,qBAAqB;AACpC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC9JF,oCAAE,mCAAO;AACT;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACvBF,qEAAO;AACP;;AAEA,cAAc,mBAAO,CAAC,CAAa;;AAEnC;AACA;AACA;AACA;AACA;AACA;;AAEA,sC;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACzBF,qEAAO;AACP;;AAEA,aAAa,mBAAO,CAAC,CAAS;AAC9B,mBAAmB,mBAAO,CAAC,EAAiB;AAC5C,aAAa,mBAAO,CAAC,EAAS;AAC9B,gBAAgB,mBAAO,CAAC,CAAY;AACpC,cAAc,mBAAO,CAAC,CAAU;AAChC,mBAAmB,mBAAO,CAAC,EAAkB;;AAE7C,eAAe,mBAAO,CAAC,CAAkB;;AAEzC,YAAY,mBAAO,CAAC,EAAO;AAC3B,yBAAyB,mBAAO,CAAC,EAAqB;;AAEtD;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA,G;AACA;AACA;AACA;AACA;AACA;AACA,mEAAmE,sBAAsB;AACzF;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,qFAAqF,EAAE;AACvF,eAAe,6CAA6C,oDAAoD,gBAAgB,G;AAChI;AACA;AACA;AACA,OAAO;AACP;AACA,+BAA+B,SAAS,cAAc,EAAE;AACxD;AACA,KAAK;AACL;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,gBAAgB;AAChB,mGAAmG,EAAE;AACrG;AACA,yBAAyB,SAAS,SAAS,0BAA0B,EAAE;AACvE;AACA,gCAAgC;AAChC;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,gGAAgG,EAAE;AAClG;AACA;AACA;AACA;;AAEA;AACA;;AAEA,6BAA6B,4KAA4K;AACzM;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,G;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8EAA8E,sCAAsC,EAAE,yCAAyC,EAAE,UAAU;AAC3K,SAAS;AACT;AACA;AACA;AACA;AACA,8EAA8E,gCAAgC,EAAE,UAAU;AAC1H;AACA;AACA;AACA;AACA;AACA,+EAA+E,2EAA2E;AAC1J;AACA,yEAAyE,8DAA8D;AACvI,KAAK;AACL;AACA;AACA,eAAe,SAAS,gBAAgB;AACxC;AACA;AACA;AACA;AACA,qFAAqF,EAAE;AACvF;AACA;AACA;AACA;AACA,8BAA8B,mBAAmB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,uBAAuB;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,6C;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,gBAAgB;;AAEhB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsC,8B;AACtC;AACA;AACA,sCAAsC,4B;AACtC;AACA;AACA,sCAAsC,4B;AACtC;AACA;AACA,I;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,SAAS,gBAAgB;AAC5C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA,8C;AACA,CAAC;AAAA,oGAAC,C;;;;;;;AC3YF,qEAAO;AACP;;AAEA,qBAAqB,mBAAO,CAAC,CAAkB;AAC/C,qBAAqB,mBAAO,CAAC,CAAc;;AAE3C,qBAAqB,mBAAO,CAAC,CAAQ;AACrC,qBAAqB,mBAAO,CAAC,EAAU;;AAEvC,qBAAqB,mBAAO,CAAC,EAA2B;AACxD,qBAAqB,mBAAO,CAAC,EAA4B;;AAEzD,qBAAqB,mBAAO,CAAC,EAAqB;AAClD,qBAAqB,mBAAO,CAAC,EAAsB;;AAEnD;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,gBAAgB,SAAS,iBAAiB,EAAE;AAC5C;AACA;AACA;AACA;;AAEA;AACA,mCAAmC;AACnC;AACA;AACA;;AAEA;AACA;AACA;AACA,4BAA4B;AAC5B;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;;AAEA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,wBAAwB;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;;AAEP;AACA;AACA,oCAAoC;AACpC;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,iBAAiB;AACtC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,0BAA0B;AAC1B,kDAAkD;AAClD;AACA;AACA;AACA,wFAAwF;AACxF;AACA;AACA;AACA;AACA;AACA,KAAK,oBAAoB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,KAAK;AACL;AACA,qBAAqB,oBAAoB;AACzC,qBAAqB,gCAAgC;AACrD;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,mFAAmF,6BAA6B,EAAE;AAClH,qBAAqB,cAAc;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK,wBAAwB;AAC7B,sBAAsB;AACtB,cAAc;AACd;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,wEAAwE,6BAA6B,EAAE;AACvG,qBAAqB,cAAc;AACnC;AACA;AACA;AACA;AACA,kCAAkC,2BAA2B;AAC7D;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AAAA,oGAAC;;;;;;;AC3QF,qEAAO;AACP;;AAEA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;;ACTF,qEAAO;AACP;;AAEA,cAAc,mBAAO,CAAC,CAAgB;AACtC,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C,sBAAsB,mBAAO,CAAC,EAAyB;AACvD,cAAc,mBAAO,CAAC,CAAgB;;AAEtC,cAAc,mBAAO,CAAC,EAAmB;AACzC;AACA,oBAAoB,mBAAO,CAAC,EAAmC;AAC/D,wBAAwB,mBAAO,CAAC,EAAuC;AACvE,kBAAkB,mBAAO,CAAC,EAAiC;AAC3D,uBAAuB,mBAAO,CAAC,EAAsC;;AAErE,eAAe,mBAAO,CAAC,EAAiB;;AAExC,gBAAgB,mBAAO,CAAC,EAAkB;;AAE1C,eAAe,mBAAO,CAAC,EAAU;AACjC,eAAe,mBAAO,CAAC,EAAU,E;;AAEjC;AACA;AACA,wDAAwD,iCAAiC;AACzF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,kCAAkC;;AAElC;AACA,4BAA4B,yCAAyC;AACrE;;AAEA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,sBAAsB;AACtB;AACA,8CAA8C;AAC9C;AACA;AACA;AACA;AACA;AACA,WAAW,mDAAmD,6LAA6L,kCAAkC;AAC7R;AACA,WAAW,sDAAsD,gMAAgM,EAAE;AACnQ;AACA,aAAa,yDAAyD,+JAA+J,EAAE;AACvO;AACA,aAAa,0DAA0D,+JAA+J,EAAE;AACxO;AACA,2CAA2C;AAC3C,OAAO;AACP;AACA;AACA,+BAA+B,wIAAwI,EAAE,oFAAoF;AAC7P;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,gBAAgB;AACjD,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD;AAChD;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,iBAAiB,SAAS,eAAe;AACzC;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,gBAAgB,yJ;AAChB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,iBAAiB,gBAAgB,2GAA2G;AAC5I;AACA;;AAEA;AACA;AACA,6BAA6B,SAAS,iBAAiB,EAAE;AACzD;;AAEA;AACA,gBAAgB;AAChB;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,O;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,uBAAuB,gBAAgB;AACvC;AACA;AACA,gCAAgC,iBAAiB;AACjD;AACA;AACA;AACA;;AAEA;;AAEA;AACA,0BAA0B,8CAA8C,gBAAgB,iCAAiC;AACzH;AACA,8EAA8E,EAAE,gBAAgB,EAAE;;AAElG;AACA,WAAW;AACX,WAAW;;AAEX,mCAAmC,kBAAkB;;AAErD;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,6BAA6B,SAAS,eAAe,EAAE;AACvD;;AAEA;AACA;AACA;AACA;AACA,iCAAiC,0BAA0B;AAC3D,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,wDAAwD,0BAA0B;AAClF;AACA;AACA;AACA;;AAEA,gB;AACA;AACA;AACA,6BAA6B,SAAS,eAAe,EAAE;AACvD;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,gBAAgB,qF;AAChB;;AAEA;AACA;AACA;AACA;AACA,6BAA6B,mBAAmB;;AAEhD;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA,4DAA4D,EAAE;AAC9D,OAAO;AACP;AACA,mCAAmC,iBAAiB;AACpD;AACA;AACA,2BAA2B,SAAS,eAAe,EAAE,EAAE;AACvD;;AAEA;AACA;AACA,8BAA8B,aAAa;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,qFAAqF;AACpH;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,mBAAmB,kBAAkB;AACrC;AACA;;AAEA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;AC5YF,qEAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACfF,qEAAO;AACP;;AAEA,aAAa,mBAAO,CAAC,CAAe;AACpC,YAAY,mBAAO,CAAC,CAAc;;AAElC;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK,GAAG,EAAE;AACV;AACA;AACA;AACA,uBAAuB,IAAI,2BAA2B;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,KAAK,GAAG,EAAE;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;;AAEA;AACA,uBAAuB,iBAAiB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAK,IAAI;AACT;;AAEA;AACA;;AAEA;AACA;AACA,kCAAkC,mBAAmB;;AAErD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;;AAEA,eAAe,0DAA0D;AACzE;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,eAAe,SAAS;AACxB;AACA;AACA,KAAK;AACL;AACA,aAAa,SAAS;AACtB,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACpNF;;AAEA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;;AAEA;AACA;AACA,4CAA4C;;AAE5C;;;;;;;ACpBA,qEAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kEAAkE,cAAc,EAAE,8BAA8B;AAChH;AACA;AACA,kEAAkE,cAAc,EAAE,+BAA+B;AACjH;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AChCF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAW;;AAEnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,cAAc;AACjC;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,gBAAgB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,EAAE;AAC/C;AACA;AACA;AACA;AACA;AACA,qBAAqB,QAAQ;AAC7B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACxDF,qEAAO;AACP;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACdF,qEAAO;AACP;;AAEA,eAAe,mBAAO,CAAC,EAAc;;AAErC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,uEAAuE;AACvE;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;AC3DF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C,gBAAgB,mBAAO,CAAC,EAAkB;AAC1C,gBAAgB,mBAAO,CAAC,CAAc;;AAEtC,sBAAsB,mBAAO,CAAC,EAAY;AAC1C,iBAAiB,mBAAO,CAAC,EAAO;AAChC,YAAY,mBAAO,CAAC,EAAO;AAC3B,kBAAkB,mBAAO,CAAC,EAAa;;AAEvC;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sCAAsC;AACtC;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,cAAc;AACd;;AAEA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,mCAAmC;AACnC;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA,2BAA2B,EAAE;AAC7B,yCAAyC;AACzC;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA,uCAAuC;AACvC,SAAS;AACT;AACA,wCAAwC;AACxC,SAAS;AACT,OAAO;AACP,sCAAsC;AACtC;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL,6BAA6B,yBAAyB;AACtD,KAAK;AACL,eAAe;AACf;AACA;AACA;AACA,KAAK,oBAAoB;AACzB;AACA,KAAK;AACL;;AAEA;AACA;AACA,+BAA+B;AAC/B,KAAK;AACL;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C;AAC3C;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,gBAAgB,kOAAkO;;AAElP;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;;AAEA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,8BAA8B,YAAY;AAC1C;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,YAAY;AAC5C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA,oBAAoB;AACpB;AACA;AACA,OAAO;;AAEP;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,iE;AACA,6C;AACA;;AAEA;AACA;AACA;AACA;;AAEA,oDAAoD,U;AACpD;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,8DAA8D;AAC9D;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,+EAA+E;;AAE/E,yBAAyB;AACzB;AACA;AACA,KAAK;AACL;;AAEA;AACA,mBAAmB,eAAe;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,0DAA0D;AAC1D;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,2BAA2B,EAAE;AAC7B;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,qBAAqB,4CAA4C;AACjE;AACA,KAAK,GAAG,gCAAgC;AACxC,YAAY;AACZ;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;;AAEA;AACA;AACA;AACA,6BAA6B,4KAA4K;AACzM,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,+DAA+D,uDAAuD;AACvI;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,EAAE;AAC/B,KAAK;AACL;AACA;AACA,gBAAgB;AAChB,OAAO;AACP,KAAK;AACL;AACA;AACA,KAAK;AACL,qBAAqB;AACrB;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,gBAAgB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,KAAK;AACL;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACzpBF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C,gBAAgB,mBAAO,CAAC,CAAc;AACtC,gBAAgB,mBAAO,CAAC,CAAgB;AACxC,gBAAgB,mBAAO,CAAC,EAAgB;AACxC,gBAAgB,mBAAO,CAAC,CAAgB;;AAExC,eAAe,mBAAO,CAAC,EAAU;;AAEjC,iBAAiB,mBAAO,CAAC,EAAmB;AAC5C,uBAAuB,mBAAO,CAAC,EAAoB;;AAEnD,qBAAqB,mBAAO,CAAC,EAAkB;AAC/C,0BAA0B,mBAAO,CAAC,EAAkB;;AAEpD,mBAAmB,mBAAO,CAAC,EAAU;;AAErC;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,sBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,6BAA6B;AAC7B;AACA,oDAAoD,qDAAqD;AACzG;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA,uDAAuD,8CAA8C;AACrG;AACA;AACA,6BAA6B,aAAa;AAC1C,8BAA8B,aAAa;AAC3C;AACA;AACA;AACA;AACA;AACA,+BAA+B,aAAa;AAC5C,gCAAgC,aAAa;AAC7C;AACA;AACA;;AAEA;AACA,mBAAmB,oBAAoB;AACvC;AACA;AACA;AACA,uCAAuC,cAAc;AACrD;AACA,2BAA2B,aAAa;AACxC,4BAA4B,aAAa;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,cAAc;AACzC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK,GAAG,kCAAkC;AAC1C,YAAY;AACZ;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,qBAAqB,iBAAiB;AACtC,gBAAgB,mEAAmE;AACnF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sEAAsE,EAAE;AACxE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,qBAAqB,iBAAiB;AACtC,gBAAgB,mEAAmE;AACnF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,+DAA+D,EAAE;AACjE;AACA,6CAA6C;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,qCAAqC;AACrC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,oBAAoB,mBAAmB;AACvC;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,kCAAkC,iBAAiB;AACnD,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,oBAAoB;AACxD;AACA;AACA;AACA;AACA;AACA,oCAAoC,sCAAsC;AAC1E,OAAO;AACP,gCAAgC,iCAAiC,2BAA2B,EAAE;AAC9F,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACpSF,qEAAO;AACP;;AAEA,cAAc,mBAAO,CAAC,CAAgB;;AAEtC,eAAe,mBAAO,CAAC,EAAU;;AAEjC,sBAAsB,mBAAO,CAAC,EAAmB;AACjD,kBAAkB,mBAAO,CAAC,EAAS;;AAEnC;;AAEA;AACA,oBAAoB;AACpB;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8B;AACA;AACA;AACA;AACA,4B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,UAAU;AAC3C;AACA;AACA;AACA;AACA,6BAA6B,cAAc;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,yBAAyB;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,iCAAiC,yBAAyB;AAC1D;;AAEA;AACA;AACA,6BAA6B,gBAAgB;AAC7C;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;;AClFF,qEAAO;AACP;;AAEA,sBAAsB;;AAEtB;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACVF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,yBAAyB,+BAA+B;AACxD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA,iBAAiB;;AAEjB;AACA,CAAC;AAAA,oGAAC;;;;;;;AChDF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,EAAiB;;AAEzC,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C,gBAAgB,mBAAO,CAAC,EAAkB;AAC1C,gBAAgB,mBAAO,CAAC,CAAc;;AAEtC;;AAEA;;AAEA;AACA;AACA;AACA,mBAAmB,qBAAqB;AACxC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB,cAAc;AACjC;AACA;;AAEA,yEAAyE;AACzE;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA,6BAA6B,SAAS,wBAAwB,EAAE;AAChE;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;AACL;;AAEA;AACA,kBAAkB;AAClB;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;;AAEA,oBAAoB;AACpB,CAAC;AAAA,oGAAC;;;;;;;AClKF,qEAAO;AACP;;AAEA,YAAY,mBAAO,CAAC,EAAY;;AAEhC;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,mBAAmB,4EAA4E;AAC/F,gBAAgB;AAChB,OAAO;AACP;AACA,wBAAwB,oCAAoC;AAC5D,sBAAsB,kCAAkC;AACxD,qBAAqB,iCAAiC;AACtD,oBAAoB,4CAA4C;AAChE;AACA;AACA,oBAAoB,iCAAiC;AACrD,wBAAwB,oCAAoC;AAC5D,uBAAuB,mCAAmC;AAC1D,qBAAqB,iCAAiC;AACtD,2BAA2B,uCAAuC;AAClE,6BAA6B;AAC7B;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,mBAAmB,4EAA4E;AAC/F,gBAAgB,qDAAqD;AACrE,iBAAiB,+BAA+B;AAChD,uBAAuB,qCAAqC;AAC5D,kBAAkB;AAClB,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,gBAAgB,4BAA4B;AAC5C,kBAAkB,oCAAoC;AACtD,uBAAuB;AACvB;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,mBAAmB,4EAA4E;AAC/F,kBAAkB,oDAAoD;AACtE,iBAAiB,+BAA+B;AAChD,mBAAmB;AACnB,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,gBAAgB,4BAA4B;AAC5C,kBAAkB,oCAAoC;AACtD,uBAAuB;AACvB;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,mBAAmB,4EAA4E;AAC/F,kBAAkB,oDAAoD;AACtE,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA,gBAAgB,4BAA4B;AAC5C,kBAAkB,oCAAoC;AACtD,uBAAuB;AACvB;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,mBAAmB,4EAA4E;AAC/F,kBAAkB,oDAAoD;AACtE,gBAAgB,qDAAqD;AACrE,iBAAiB,2CAA2C;AAC5D,mBAAmB,8CAA8C;AACjE,iBAAiB;AACjB,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,qBAAqB,iCAAiC;AACtD;AACA,eAAe,kDAAkD;AACjE,iBAAiB,yCAAyC;AAC1D,mBAAmB,2CAA2C;AAC9D,mBAAmB,2CAA2C;AAC9D,sBAAsB,0DAA0D;;AAEhF,uBAAuB,+CAA+C;AACtE,wBAAwB,gDAAgD;AACxE,sBAAsB,4CAA4C;AAClE,4BAA4B,oDAAoD;AAChF,yBAAyB,gDAAgD;AACzE,+BAA+B,sDAAsD;AACrF,qBAAqB,6CAA6C;AAClE,qBAAqB,2CAA2C;AAChE,0BAA0B,kDAAkD;AAC5E,8BAA8B,sDAAsD;AACpF,4BAA4B,oDAAoD;AAChF,wBAAwB,gDAAgD;;AAExE,0BAA0B,kDAAkD;AAC5E,2BAA2B,mDAAmD;AAC9E,2BAA2B,mDAAmD;;AAE9E,8BAA8B,wEAAwE;AACtG,qCAAqC,+EAA+E;AACpH,iCAAiC,2EAA2E;;AAE5G,wBAAwB,oEAAoE;AAC5F,oBAAoB,gEAAgE;AACpF,yBAAyB,qEAAqE;AAC9F,oBAAoB;AACpB,SAAS;AACT;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,mBAAmB,4EAA4E;AAC/F,gBAAgB,oDAAoD;;AAEpE,oBAAoB,kCAAkC;AACtD,kBAAkB,gCAAgC;AAClD,yBAAyB,wCAAwC;AACjE,kBAAkB,gCAAgC;AAClD,mBAAmB,iCAAiC;AACpD,wBAAwB,sCAAsC;AAC9D,4BAA4B,0CAA0C;AACtE,iBAAiB,+BAA+B;AAChD,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,0BAA0B,6CAA6C;AACvE,0BAA0B,mDAAmD;AAC7E,mBAAmB,8CAA8C;AACjE,oBAAoB,+BAA+B;AACnD,iBAAiB;AACjB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,CAAC;AAAA,oGAAC;;;;;;;ACnNF,qEAAO;AACP;;AAEA,YAAY,mBAAO,CAAC,CAAc;;AAElC;;AAEA;AACA,iEAAiE,KAAK;;AAEtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,6BAA6B;AAC5C,iBAAiB;AACjB;AACA,iDAAiD;AACjD;AACA,+CAA+C;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,eAAe,qBAAqB;AACpC;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,YAAY;AACZ;AACA;AACA;AACA;AACA;;AAEA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK,GAAG,gDAAgD;AACxD;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,wCAAwC;AACxC,KAAK;AACL,qDAAqD;AACrD;;AAEA;AACA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;;AAEA,cAAc;AACd;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK,GAAG,gDAAgD;AACxD;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA,mEAAmE;AACnE,kDAAkD;AAClD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,qBAAqB;AACrB,0BAA0B;AAC1B;AACA,sBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC7YF,qEAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,6CAA6C;AAC7C;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL,aAAa,SAAS,sBAAsB;AAC5C,KAAK;AACL;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACvGF,qEAAO;AACP;;AAEA,eAAe,mBAAO,CAAC,EAA4B;;AAEnD;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACxBF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAW;;AAEnC;AACA,gBAAgB;AAChB;AACA,uCAAuC,SAAS,iBAAiB,EAAE;AACnE,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACzBF,qEAAO;AACP;;AAEA,aAAa,mBAAO,CAAC,CAAS,E;AAC9B,gBAAgB,mBAAO,CAAC,CAAY;AACpC,cAAc,mBAAO,CAAC,CAAU;AAChC,qBAAqB,mBAAO,CAAC,EAAiB;;AAE9C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mBAAmB,sBAAsB;AACzC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,6BAA6B,SAAS,iBAAiB,EAAE;AACzD;;AAEA;AACA;AACA;AACA;AACA;AACA,6BAA6B,SAAS,iBAAiB,EAAE;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,SAAS,iBAAiB,EAAE;AACzD;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC5DF,qEAAO;AACP;;AAEA,aAAa,mBAAO,CAAC,CAAS;AAC9B,gBAAgB,mBAAO,CAAC,EAAY;AACpC,cAAc,mBAAO,CAAC,CAAU;;AAEhC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC7EF,qEAAO;AACP;;AAEA,sBAAsB,mBAAO,CAAC,EAAkB;AAChD,mBAAmB,mBAAO,CAAC,EAAkB;;AAE7C;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB,gHAAgH;AACnI;AACA;AACA;AACA;;AAEA,eAAe,8BAA8B,gDAAgD;AAC7F;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AClCF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAY;AACpC;AACA,kBAAkB,mBAAO,CAAC,EAAe;;AAEzC,eAAe,mBAAO,CAAC,EAAW;;AAElC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACtBF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAY;;AAEpC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,8BAA8B;AAC9B,qDAAqD;;AAErD;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACpEF,qEAAO;AACP;;AAEA,mBAAmB,mBAAO,CAAC,EAAiB;;AAE5C;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC3BF,qEAAO;AACP;;AAEA,cAAc,mBAAO,CAAC,EAAU,E;AAChC,gBAAgB,mBAAO,CAAC,CAAY;AACpC,cAAc,mBAAO,CAAC,CAAU;AAChC,eAAe,mBAAO,CAAC,CAAkB;AACzC,eAAe,mBAAO,CAAC,EAAkB;;AAEzC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB,sBAAsB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,G;AACA;AACA;AACA;;AAEA;AACA,0BAA0B,SAAS,iBAAiB,EAAE;AACtD;;AAEA,8CAA8C;AAC9C;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;;AAEA;AACA;AACA,iCAAiC,cAAc;AAC/C;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK,a;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;AACA,iBAAiB,SAAS,mBAAmB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,oCAAoC;;AAEpC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,iBAAiB,SAAS,aAAa;AACvC;AACA;AACA;AACA;AACA;AACA,iDAAiD;AACjD;AACA;AACA;AACA,wCAAwC;AACxC,mFAAmF;AACnF;AACA;AACA;AACA;AACA,mBAAmB,SAAS,gBAAgB;AAC5C;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,SAAS,gBAAgB,EAAE;AACxD;AACA;AACA;AACA;AACA;AACA,2BAA2B,SAAS,eAAe,EAAE;AACrD,aAAa;AACb;AACA,YAAY,oDAAoD;AAChE,+DAA+D;AAC/D,2DAA2D;AAC3D;AACA;AACA;AACA,8BAA8B,SAAS,gBAAgB,EAAE;AACzD;AACA,OAAO;AACP,8BAA8B,SAAS,gBAAgB,EAAE;AACzD,OAAO;AACP;AACA,qEAAqE;AACrE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,O;AACA;AACA;AACA;AACA;AACA;AACA;AACA,O;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA,SAAS;AACT,wBAAwB;AACxB;AACA;AACA;AACA,0B;AACA,qBAAqB,SAAS,eAAe;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,SAAS,gBAAgB;AAC1C;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;AC/SF,qEAAO;AACP;;AAEA,mBAAmB,mBAAO,CAAC,EAAe;;AAE1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,oBAAoB;AACpB,CAAC;AAAA,oGAAC;;;;;;;ACfF,qEAAO;AACP;;AAEA;AACA,sDAAsD;AACtD,sBAAsB;AACtB;AACA;;AAEA,eAAe,mBAAO,CAAC,CAAU;AACjC,cAAc,mBAAO,CAAC,CAAU;;AAEhC;;AAEA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,+CAA+C;AAC/C;AACA,KAAK;AACL;;AAEA;AACA,kBAAkB;AAClB;AACA,wBAAwB,aAAa;AACrC;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC;;;;;;;ACnDF,qEAAO;AACP;;AAEA,sBAAsB,mBAAO,CAAC,EAAkB;;AAEhD;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACvBF,qEAAO;AACP;;AAEA,sBAAsB,mBAAO,CAAC,EAAkB;AAChD,cAAc,mBAAO,CAAC,CAAU;AAChC,mBAAmB,mBAAO,CAAC,EAAkB;;AAE7C;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,eAAe,8BAA8B,gDAAgD;AAC7F;AACA;AACA;AACA,OAAO;AACP;AACA,+BAA+B,SAAS,cAAc,EAAE;AACxD;AACA,KAAK;AACL,uBAAuB;AACvB,yC;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC9EF,qEAAO;AACP;;AAEA,sBAAsB,mBAAO,CAAC,EAAkB;;AAEhD;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACvBF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C,qBAAqB,mBAAO,CAAC,EAAwB;AACrD,mBAAmB,mBAAO,CAAC,EAAwB;AACnD,cAAc,mBAAO,CAAC,CAAgB;;AAEtC;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,0CAA0C,EAAE;AAC5C;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,0CAA0C,EAAE;AAC5C;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,0CAA0C,EAAE;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,yBAAyB,GAAG;;AAE5B;AACA,mBAAmB;AACnB;AACA;AACA;AACA;;AAEA,WAAW,kBAAkB,6DAA6D;AAC1F;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA,mCAAmC,SAAS;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,yCAAyC,8DAA8D;AACvG;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,yCAAyC,6DAA6D;AACtG;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,yCAAyC,4EAA4E;AACrH;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,qBAAqB;AACrB,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AC/JF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAW;AACnC;;AAEA;AACA;AACA,mBAAmB,eAAe;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,8CAA8C,SAAS,iBAAiB,EAAE,GAAG;AACpG;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,a;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACrDF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,EAA4B;;AAEpD;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACXF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAe;AACvC,eAAe,mBAAO,CAAC,CAAW;;AAElC,cAAc,mBAAO,CAAC,CAAa;;AAEnC,gBAAgB,mBAAO,CAAC,EAAQ;AAChC,kBAAkB,mBAAO,CAAC,EAAU;AACpC,iBAAiB,mBAAO,CAAC,EAAS;;AAElC;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,0BAA0B,OAAO,aAAa,WAAW,eAAe,EAAE;AAC1E;AACA;AACA;;AAEA;AACA;;AAEA,0BAA0B,OAAO,cAAc,WAAW,eAAe,EAAE;AAC3E;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,gBAAgB,qEAAqE;AACrF,KAAK;AACL,gBAAgB;AAChB;AACA,0BAA0B,OAAO,aAAa,kBAAkB;AAChE,cAAc,6BAA6B;;AAE3C;AACA;AACA;AACA;AACA,8BAA8B,OAAO,cAAc,kBAAkB;AACrE;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,S;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACvFF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAe;AACvC,cAAc,mBAAO,CAAC,CAAa;AACnC,aAAa,mBAAO,CAAC,EAAY;AACjC,eAAe,mBAAO,CAAC,CAAW;;AAElC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,oB;AACA;AACA,4BAA4B,WAAW;AACvC,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,wCAAwC,eAAe;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACxCF,qEAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,0BAA0B;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,qBAAqB;AAC1C;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,qBAAqB;AAC1C;AACA,oC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,eAAe;AACpC;AACA;AACA;AACA,yBAAyB,oBAAoB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,kBAAkB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,qBAAqB,oBAAoB;AACzC;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;ACjHF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAe;AACvC,cAAc,mBAAO,CAAC,CAAa;;AAEnC,kBAAkB,mBAAO,CAAC,EAAU;;AAEpC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAiB;;AAEjB;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB,SAAS;AACT,OAAO;AACP;AACA,mBAAmB,0BAA0B;AAC7C;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,kBAAkB;;AAElB;AACA;AACA;AACA;AACA;AACA,mBAAmB;;AAEnB,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,oCAAoC,4CAA4C,aAAa;;AAE7F;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G;;;AAGA;AACA;AACA;AACA;AACA;AACA,oCAAoC,4CAA4C,aAAa;;AAE7F;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;;AAEA;AACA,kEAAkE,eAAe;AACjF,OAAO;AACP,kEAAkE,gBAAgB;AAClF,OAAO;AACP,kEAAkE,EAAE;AACpE,OAAO;AACP,iEAAiE,EAAE;AACnE,OAAO;AACP,iEAAiE,eAAe;AAChF;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,0BAA0B,gCAAgC;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK;AACL,0BAA0B,wDAAwD;AAClF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,mDAAmD;AACtF;AACA;AACA;AACA,mCAAmC,mDAAmD;AACtF;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL,iCAAiC,uDAAuD;AACxF;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,mDAAmD;AACtF;AACA;AACA;AACA,mCAAmC,mDAAmD;AACtF;AACA;AACA,KAAK;AACL,iCAAiC,uDAAuD;AACxF;AACA;AACA;AACA;AACA;AACA,0BAA0B,EAAE,GAAG,EAAE;AACjC,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL,0BAA0B,oCAAoC;AAC9D;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AClSF,qEAAO;AACP;;AAEA,eAAe,mBAAO,CAAC,EAA4B;;AAEnD;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AClBF,qEAAO;AACP;;AAEA,eAAe,mBAAO,CAAC,EAA4B;;AAEnD;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;AClBF,qEAAO;AACP;;AAEA,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C,mBAAmB,mBAAO,CAAC,EAAwB;;AAEnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,yBAAyB,EAAE;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,iCAAiC,EAAE;AACnC;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,iCAAiC,EAAE;AACnC;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,iCAAiC,EAAE;AACnC;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,eAAe;AACf,KAAK;AACL;AACA;;AAEA,qC;AACA;AACA,mBAAmB,oBAAoB;AACvC;AACA;AACA;AACA,yBAAyB,0FAA0F;AACnH;AACA;AACA;AACA;AACA,qBAAqB,iEAAiE;AACtF;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,YAAY;AACZ;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,mBAAmB,oBAAoB;AACvC;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,qBAAqB;AACxC;AACA;AACA;AACA;AACA,wC;AACA;AACA;AACA;AACA;;AAEA;AACA,e;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,kCAAkC;AAClC;AACA;AACA;AACA;AACA;AACA,kCAAkC;AAClC;AACA,uBAAuB,mBAAmB;AAC1C;AACA;AACA;AACA;AACA;AACA,kCAAkC;AAClC;AACA;AACA;AACA;AACA,sBAAsB,6BAA6B,+CAA+C;AAClG;AACA;AACA;AACA;AACA;AACA,kCAAkC,0DAA0D,2DAA2D;AACvJ;AACA;AACA,kCAAkC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA,2BAA2B,QAAQ;AACnC;AACA;AACA,OAAO;AACP;;AAEA,qBAAqB,iBAAiB,0FAA0F;;AAEhI;AACA,gC;AACA,KAAK;AACL,8DAA8D;AAC9D,KAAK;AACL,8EAA8E;AAC9E,KAAK;AACL;AACA,KAAK;AACL;;AAEA;AACA,+C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,wBAAwB,2EAA2E;AACnG;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,wBAAwB,4IAA4I;AACpK;;AAEA;AACA;AACA,+BAA+B;AAC/B,wBAAwB,+GAA+G;AACvI;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,+BAA+B;AAC/B,wBAAwB,gHAAgH;AACxI;AACA;AACA,wBAAwB,gHAAgH;AACxI;AACA;AACA,YAAY;AACZ,wBAAwB,gHAAgH;AACxI;AACA;AACA,YAAY;AACZ,wBAAwB,4GAA4G;AACpI;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;AAAA,oGAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChVF,qEAAO;AACP;;AAEA,eAAe,mBAAO,CAAC,EAAiB;AACxC,gBAAgB,mBAAO,CAAC,CAAkB;AAC1C,YAAY,mBAAO,CAAC,CAAc;;AAElC,eAAe,mBAAO,CAAC,EAAU;AACjC,eAAe,mBAAO,CAAC,EAAU,EAAE;;AAEnC,aAAa,mBAAO,CAAC,CAAQ;;AAE7B;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,2CAA2C;AAC3C;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,sCAAsC,4CAA4C;AAClF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,SAAS;;AAET;AACA;;AAEA;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,0BAA0B,EAAE;AAC5B;AACA,kBAAkB,6CAA6C;AAC/D;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA,kBAAkB;AAClB,0DAA0D,6EAA6E;AACvI,GAAG;;AAEH,oBAAoB;AACpB,CAAC;AAAA,oGAAC","file":"bkg.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 89);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap f4b3f8edada7bfe26fec","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var loader = require('./loader');\r\n\r\n  var _Promise = window.Promise;\r\n  var Promise = _Promise;\r\n\r\n  if (!Promise) {\r\n    /** @constructor */\r\n    Promise = function Promise(resolver) {\r\n      if (this instanceof Promise) {\r\n        return new _Promise(resolver);\r\n      }\r\n      return _Promise(resolver);\r\n    };\r\n\r\n    loader.load('/lib/contrib/es6-promise.auto.min.js', 'Promise', function () {\r\n      _Promise = window.Promise;\r\n      Promise.accept = _Promise['accept'];\r\n      Promise.all = _Promise['all'];\r\n      Promise.defer = _Promise['defer'];\r\n      Promise.race = _Promise['race'];\r\n      Promise.reject = _Promise['reject'];\r\n      Promise.resolve = _Promise['resolve'];\r\n    });\r\n  }\r\n\r\n  module.exports = Promise;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/promise.js\n// module id = 0\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  function safeParse(jso) {\r\n    try {\r\n      return JSON.parse(jso);\r\n    } catch (e) {\r\n    }\r\n  }\r\n  \r\n  function errmsg(e) {\r\n    if (typeof(e) === 'undefined') {\r\n      return 'undefined';\r\n    }\r\n    return JSON.stringify(e, Object.getOwnPropertyNames(e));\r\n  }\r\n  \r\n  function stringifyJSON(o) {\r\n    return (typeof(o) === 'undefined' || o instanceof Error) ? errmsg(o) : JSON.stringify(o);\r\n  }\r\n  \r\n  function getProperties(o, properties) {\r\n    var keyvalues = [];\r\n    properties = properties || Object.getOwnPropertyNames(o); \r\n    for (var i = 0, ilen = properties.length; i < ilen; i++) {\r\n      var property = properties[i]; \r\n      keyvalues.push(property + ': ' + stringifyProperties(o[property]));\r\n    }\r\n    return keyvalues;\r\n  }\r\n  \r\n  function getValues(a) {\r\n    var values = [];\r\n    for (var i = 0, len = a.length; i < len; i++) {\r\n      var elem = a[i];\r\n      values.push(stringifyProperties(elem));\r\n    }\r\n    return values;\r\n  }\r\n\r\n  function stringifyProperties(o, properties) {\r\n    var result;\r\n    var otype = typeof o;\r\n    if (otype === 'number') {\r\n      result = o.toString();\r\n    } else if (otype === 'string') {\r\n      result = '\\'' + o.toString() + '\\'';\r\n    } else if (otype === 'undefined') {\r\n      result = 'undefined';\r\n    } else if (o === null) {\r\n      result = 'null';\r\n    } else if (o) {\r\n      if (o.constructor === Object) {\r\n        var keyvalues = getProperties(o, properties);\r\n        result = '{' + keyvalues.join(', ') + '}';\r\n      } else if (o.constructor === Array) { \r\n        var values = getValues(o);\r\n        result = '[' + values.join(', ') + ']';\r\n      } else {\r\n        result = o.toString();\r\n      }\r\n    } else {\r\n      result = '???'; // should never get here...\r\n    }\r\n    return result;\r\n  }\r\n    \r\n  function getArraysDiff(a, b) {\r\n    return a.filter(function(i) {return b.indexOf(i) < 0;});\r\n  }\r\n  \r\n  function getArraysSymmDiff(a, b) {\r\n    var diffAdded = getArraysDiff(a, b);\r\n    var diffRemoved = getArraysDiff(b, a);\r\n    var diff = diffAdded.concat(diffRemoved);\r\n    return diff;\r\n  }\r\n  \r\n  function getArraysUnion(a, b) \r\n  {\r\n    var r = a.slice(0);\r\n    b.forEach(function(i) { if (r.indexOf(i) < 0) { r.push(i); } });\r\n    return r;\r\n  }\r\n  \r\n  function compareObjects(a, b, properties) {\r\n    var propertyChanges = [];\r\n    var propertyPath = [];\r\n    var compare = function (a, b, properties) {\r\n      var aconstructor = a.constructor;\r\n      if (aconstructor === Object ||\r\n         (aconstructor !== Number && \r\n          aconstructor !== String &&\r\n          aconstructor !== Date && \r\n          aconstructor !== RegExp &&\r\n          aconstructor !== Boolean &&\r\n          aconstructor !== Array &&\r\n          aconstructor !== Function)) {\r\n        if (!properties) {\r\n          properties = getArraysUnion(Object.getOwnPropertyNames(a), Object.getOwnPropertyNames(b)); \r\n        }  \r\n        for (var i = 0, len = properties.length; i < len; i++) {\r\n        // for (var property in a) {\r\n          var property = properties[i]; \r\n          propertyPath.push(propertyPath.length === 0 ? property : '.' + property);\r\n          if (a[property] && b[property]) {\r\n            if (a[property].constructor !== Function) {\r\n              compare(a[property], b[property]);\r\n            }\r\n          } else if (a[property] !== b[property]) {\r\n            propertyChanges.push({ 'property': propertyPath.join(''), 'a': a[property], 'b': b[property] });\r\n          }\r\n          propertyPath.pop();\r\n        }\r\n      } else if (aconstructor === Array) { // use special comparison for Arrays\r\n        var da = getArraysDiff(a, b);\r\n        var db = getArraysDiff(b, a);\r\n        if (da.length > 0 || db.length > 0) {\r\n          propertyChanges.push({ 'property': propertyPath.join(''), 'a': da, 'b': db });\r\n        }\r\n      } else if (aconstructor !== Function) { // skip comparison for Functions\r\n        if (a !== b) {\r\n          propertyChanges.push({ 'property': propertyPath.join(''), 'a': a, 'b': b });\r\n        }\r\n      }\r\n    };\r\n    compare(a, b, properties);\r\n    return propertyChanges;\r\n  }\r\n\r\n  function extractUrlArg(context, item) {\r\n    item = item.split('=');\r\n    var key = item.shift();\r\n    if (key) {\r\n      context[key] = decodeURIComponent(item.join('=')).replace(/\\+/g, ' ');\r\n    }\r\n    return context;\r\n  }\r\n  function extractUrlInfo(s, bag) {\r\n    return s.substr(1).split('&').reduce(extractUrlArg, bag);\r\n  }\r\n  \r\n  function updateDescription(odesc, ndesc, id) {\r\n    var re = /(^|\\s)=====+[^=]+\\[Zang\\:[^\\]]*\\]\\s*=====+(\\s|$)/im;\r\n\r\n    if (ndesc) {\r\n      var pre = '==================================================';\r\n      var pos = '[Zang:' + id + ']\\n' + pre;\r\n      ndesc = pre + '\\n\\n' + ndesc + '\\n\\n' + pos + '\\n';\r\n    }\r\n\r\n    var done = false;\r\n    var desc = odesc.replace(re, function () {\r\n      if (!done || !ndesc) {\r\n        done = true;\r\n        return ndesc;\r\n      }\r\n    });\r\n\r\n    if (!done && ndesc) {\r\n      desc = odesc + '\\n' + ndesc;\r\n    }\r\n    return desc;\r\n  }\r\n\r\n  function getObjectInfo(obj, fields) {\r\n    if (typeof(obj) === 'object') {\r\n      return '{ ' + getLogInfo(obj, fields) + ' }';\r\n    }\r\n    return getLogInfo(obj, fields);\r\n  }\r\n\r\n  function getLogInfo(obj, fields) {\r\n    if (typeof(obj) === 'string') {\r\n      return '\"' + obj + '\"';\r\n    }\r\n    if (!obj) {\r\n      return (String(obj));\r\n    }\r\n    if (typeof(obj) === 'function') {\r\n      // return (String(obj));\r\n      return 'function() { ... }';\r\n    }\r\n    if (typeof(obj) === 'object') {\r\n      if (Object.getOwnPropertyNames(obj).length === 0) {\r\n        return '';\r\n      }\r\n      fields = fields || Object.getOwnPropertyNames(obj);\r\n      var res = '';\r\n      for (var i = 0; i < fields.length; i++) {\r\n        var names = fields[i].split('.');\r\n        var val = obj;\r\n        for (var j = 0; j < names.length; j++) {\r\n          val = val[names[j]];\r\n          if (!val) {\r\n            break;\r\n          }\r\n        }\r\n        if (val instanceof Array) {\r\n          var arr = '[ ';\r\n          for (var k = 0; k < val.length; k++) {\r\n            if (k !== 0) {\r\n              arr += ', ';\r\n            }\r\n            arr += getObjectInfo(val[k]);\r\n          }\r\n          arr += ' ]';\r\n          val = arr;\r\n        } else {\r\n          val = getObjectInfo(val);\r\n        }\r\n        if (i !== 0) {\r\n          res += ', ';\r\n        }\r\n        res += fields[i] + ': ' + val;\r\n      }\r\n      return res;\r\n    }\r\n    return '' + obj;\r\n  }\r\n\r\n  function prepareLogInfo(point, obj, fields, exclude) {\r\n    // return;\r\n    if (typeof(obj) === 'undefined') {\r\n      return point;\r\n    }\r\n    if (fields && exclude) {\r\n      var ofields = Object.getOwnPropertyNames(obj);\r\n      fields.forEach(function (field) {\r\n        var index = ofields.indexOf(field);\r\n        if (index !== -1) {\r\n          ofields.splice(index, 1);\r\n        }\r\n      });\r\n      fields = ofields;\r\n    }\r\n    var info = point + ': ' + getObjectInfo(obj, fields);\r\n    return info;\r\n  }\r\n\r\n  function showLogInfo(point, obj, fields, exclude) {\r\n    var info = prepareLogInfo(point, obj, fields, exclude);\r\n    if (typeof(info) === 'undefined') {\r\n      return;\r\n    }\r\n    console.info(info);\r\n  }\r\n\r\n  function mergeConfigs(config1, config2) {\r\n    if (!config1 && !config2) {\r\n      return {};\r\n    }\r\n    if (!config1) {\r\n      return config2;\r\n    }\r\n    if (!config2) {\r\n      return config1;\r\n    }\r\n    var config = {};\r\n    var fields = Object.getOwnPropertyNames(config1);\r\n    for (var i = 0; i < fields.length; i++) {\r\n      config[fields[i]] = config1[fields[i]];\r\n    }\r\n    fields = Object.getOwnPropertyNames(config2);\r\n    for (i = 0; i < fields.length; i++) {\r\n      config[fields[i]] = config2[fields[i]];\r\n    }\r\n    return config;\r\n  }\r\n\r\n  var utils = {\r\n    safeParse: safeParse,\r\n    errmsg: errmsg,\r\n    stringifyJSON: stringifyJSON,\r\n    getArraysDiff: getArraysDiff,\r\n    getArraysSymmDiff: getArraysSymmDiff,\r\n    getArraysUnion: getArraysUnion,\r\n    compareObjects : compareObjects,\r\n    stringifyProperties: stringifyProperties,\r\n    extractUrlInfo: extractUrlInfo,\r\n    updateDescription: updateDescription,\r\n    getObjectInfo: getObjectInfo,\r\n    getLogInfo: getLogInfo,\r\n    prepareLogInfo: prepareLogInfo,\r\n    showLogInfo: showLogInfo,\r\n    mergeConfigs: mergeConfigs\r\n  };\r\n\r\n  module.exports = utils;\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/utils.js\n// module id = 1\n// module chunks = 0 1 4","define(function (require, exports, module) {\r\n  'use strict';\r\n  \r\n  /** @constructor */\r\n  function Event() {\r\n    this.clear();\r\n  }\r\n  Event.prototype.clear = function () {\r\n    this._handlers = [];\r\n    return this;\r\n  };\r\n  Event.prototype.dispatch = function () {\r\n    var i;\r\n    var h = this._handlers;\r\n    for (i = 0; i < h.length; i += 2) {\r\n      h[i].apply(h[i + 1], arguments);\r\n    }\r\n    return this;\r\n  };\r\n  Event.prototype.addListener = function (cb, context) {\r\n    if (cb) {\r\n      var h = this._handlers;\r\n      h.push(cb);\r\n      h.push(context || null);\r\n    }\r\n    return this;\r\n  };\r\n  Event.prototype.removeListener = function (cb) {\r\n    var h = this._handlers;\r\n    var n = h.indexOf(cb);\r\n    if (n >= 0) {\r\n      h.splice(n, 2);\r\n      this.removeListener(cb);\r\n    }\r\n    return this;\r\n  };\r\n  \r\n  module.exports = Event; \r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/event.js\n// module id = 2\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n  function noop() {\r\n  }\r\n\r\n  function wrapLogger(c, f, tag, lev) {\r\n    if (!f) {\r\n      return noop;\r\n    }\r\n    return f.bind(c, tag, lev);\r\n  }\r\n\r\n  function Log() {\r\n  }\r\n\r\n  Log.prototype.createLogger = function (tag) {\r\n    if (window && window.location) {\r\n      var path = (window.location.pathname || '').split('/');\r\n      var app = path[path.length - 1].split('.')[0];\r\n      if (app) {\r\n        tag = app.toUpperCase() + ':' + tag;\r\n      }\r\n      tag = '[' + tag + ']';\r\n    }\r\n    var logger = {\r\n      _info: wrapLogger(console, console.info || noop, tag, '[i]'),\r\n      _log: wrapLogger(console, console.log || noop, tag, '[l]'),\r\n      _warn: wrapLogger(console, console.warn || noop, tag, '[w]'),\r\n      _error: wrapLogger(console, console.error || noop, tag, '[e]'),\r\n      _debug: wrapLogger(console, console.debug || noop, tag, '[d]'),\r\n      _assert: wrapLogger(console, console.assert || noop, tag, '[a]'),\r\n      _trace: wrapLogger(console, console.trace || noop, tag, '[t]'),\r\n      _cred: wrapLogger(null, function () {\r\n        var args = Array.prototype.slice.apply(arguments);\r\n        var last = (args.pop() || '').replace(/[^a-z0-9]/ig, '\\\\$&');\r\n        if (last) {\r\n          var re = new RegExp(last, 'ig');\r\n          args = args.map(function (item) {\r\n            return item.replace(re, '********');\r\n          });\r\n        }\r\n        console.info.apply(console, args);\r\n      }, tag, '[i]'),\r\n      _empty: noop,\r\n      enable: function (v) {\r\n        this.cred = v ? this._cred : this._empty;\r\n        this.info = v ? this._info : this._empty;\r\n        this.log = v ? this._log : this._empty;\r\n        this.warn = v ? this._warn : this._empty;\r\n        this.error = v ? this._error : this._empty;\r\n        this.debug = v ? this._debug : this._empty;\r\n        this.assert = v ? this._assert : this._empty;\r\n        this.trace = v ? this._trace : this._empty;\r\n      }\r\n    };\r\n    logger.enable(true);\r\n    return logger;\r\n  };\r\n\r\n  Log.prototype.getErrInfo = function (err) {\r\n    err = err || { };\r\n    return err.message ? (err.message + ', ' + err.stack) : JSON.stringify(err);\r\n  }\r\n\r\n  Log.prototype.getInfo = function (o) {\r\n    return typeof(o) === 'undefined' ? 'undefined' : JSON.stringify(o);\r\n  }\r\n\r\n  module.exports = new Log();\r\n});\r\n\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/log.js\n// module id = 3\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var global = window;\r\n\r\n  function hasKey(key, object) {\r\n    object = object || global;\r\n    return (key in object);\r\n  }\r\n  function safeProp(key, def, object) {\r\n    object = object || global;\r\n    if (key in object) {\r\n      return object[key];\r\n    }\r\n    return def;\r\n  }\r\n  function wrapString(v) {\r\n    if (typeof (v) !== 'string') {\r\n      v = String(v);\r\n    }\r\n    return v;\r\n  }\r\n\r\n  module.exports = { hasKey: hasKey, safeProp: safeProp, wrapString: wrapString, global: global };\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/globals.js\n// module id = 4\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  \"use strict\";\r\n\r\n  var strings = {\r\n    \"sourceTitle\": \"Source\",\r\n    \"sourceEquinox\": \"Equinox Rooms\",\r\n    \"sourceSpaces\": \"Spaces\",\r\n    \"actionOk\": \"Ok\",\r\n    \"actionCancel\": \"Cancel\",\r\n    \"hintPassword\": \"Password\",\r\n    \"titleUnknownInvitation\": \"Unknown invitation\",\r\n    \"titleSpaceUrl\": \"Space URL\",\r\n    \"titleMeetingPlaces\": \"Places to Meet\",\r\n    \"actionCreateTopic\": \"Create Topic\",\r\n    \"titleMeetingDetails2\": \"Your meeting details have been added!\",\r\n    \"errorSourceInitialization\": \"Could not retrieve your $source meeting information\",\r\n    \"retrySourceInitialization\": \"Retrying retrieve your $source meeting information\",\r\n    \"hintSpacesSearch\": \"Search\",\r\n    \"noteAppInitializing\": \"Initializing application\",\r\n    \"notePleaseWait\": \"Please wait...\",\r\n    \"noteLoading\": \"Loading\",\r\n    \"noteAppNotInitialized\": \"Application not initialized\",\r\n    \"noteUnknown\": \"Unknown\",\r\n    \"noteInitializing\": \"Initializing\",\r\n    \"noteNotInitialized\": \"Not initialized\",\r\n    \"noteInitialized\": \"Initialized\",\r\n    \"noteAuthorizing\": \"Authorizing\",\r\n    \"noteNotAuthorized\": \"Not authorized\",\r\n    \"noteAuthorized\": \"Authorized\",\r\n    \"noteUnauthorizing\": \"Unauthorizing\",\r\n    \"noteNotUnauthorized\": \"Not unauthorized\",\r\n    \"noteUnauthorized\": \"Unauthorized\",\r\n    \"noteFetching\": \"Fetching\",\r\n    \"noteNotFetched\": \"NotFetched\",\r\n    \"noteFetched\": \"Fetched\",\r\n    \"noteChecking\": \"Checking\",\r\n    \"noteNotChecked\": \"Not checked\",\r\n    \"noteChecked\": \"Checked\",\r\n    \"partyTypeSelectLabel\": \"Invite participants as:\",\r\n    \"partyTypeMembers\": \"Members\",\r\n    \"partyTypeGuests\": \"Guests\",\r\n    \"partiesMeOnly\": \"Me only\",\r\n    \"partiesMePlus\": \"Me + \",\r\n    \"partiesOtherMembers\": \" member(s)\",\r\n    \"topicCreateNew\": \"Create new $source\",\r\n    \"errorUnknown\": \"Unknown error\",\r\n    \"errorNoOffice\": \"Office is not initialized...\",\r\n    \"errorAccountDisabled\": \"Account disabled\",\r\n    \"errorLoginBlocked\": \"Login window blocked\",\r\n    \"errorLoginClosed\": \"Login window closed\",\r\n    \"errorLoginTimeout\": \"Login timed out\",\r\n    \"errorNoInvite\": \"No invite\",\r\n    \"errorNetwork\": \"Network error while accessing $source\",\r\n    \"errorSignInRequired\": \"Please sign-in in your browser to access $source\",\r\n    \"errorLoginRequired\": \"Please login to access $source\",\r\n    \"errorNoAppConfiguration\": \"Please provide configuration to start application\",\r\n    \"errorNoSourceConfiguration\": \"Please provide configuration to access $source\",\r\n    \"errorNoValidSources\": \"No valid sources\",\r\n    \"errorUnknownSource\": \"Unknown source\",\r\n    \"errorInviteEmpty\": \"Invite is empty\",\r\n    \"errorInviteContentEmpty\": \"Invite content is empty\",\r\n    \"errorTemplate\": \"The template could not be accessed.\",\r\n    \"notificationMeetingJoined\": \"Joined meeting\",\r\n    \"notificationMeetingNotJoined\": \"Failed to join meeting\",\r\n    \"notificationNoMeetingLink\": \"Meeting link not found\",\r\n    \"errorPopupBlocked\" : \"Popup blocked\",\r\n\r\n    \"askResetConfiguration\": \"Reset the configuration?\",\r\n    \"actionReset\": \"Reset\",\r\n    \"titleAddinAds\": \"Schedule Avaya Equinox and Avaya Spaces meetings.\",\r\n    \"titleSetupMeetingDetails\": \"Let’s setup your meeting details!<br/>Enter your email address.\",\r\n    \"hintEmailAddress\": \"Email address\",\r\n    \"titleAccountAds\": \"Don't have an Avaya Equinox or Avaya Spaces account?\",\r\n    \"titleAccountAdsLink\": \"Get a demo, purchase or learn more about our services here\",\r\n    \"actionNext\": \"Next\",\r\n    \"actionSkip\": \"Skip\",\r\n    \"actionClear\": \"Clear\",\r\n    \"titleCheckingCloudAccount\": \"Checking your Avaya Cloud account...\",\r\n    \"titleEnterCloudCredentials\": \"Enter your credentials<br/>for Avaya Cloud\",\r\n    \"titleOpensInBrowser\": \"(Opens in separate browser window)\",\r\n    \"linkClickToLogin\": \"Click here to login\",\r\n    \"titleLoggingToCloud\": \"Logging in to Avaya Cloud\",\r\n    \"hintUsername\": \"Username\",\r\n    \"titleCheckingEquinoxAccount\": \"Checking your Equinox account...\",\r\n    \"titleChooseEquinoxEnvironment\": \"Choose your environment\",\r\n    \"titleEnterAEMOCredentials\": \"Enter your credentials<br/>for Equinox Meetings Online\",\r\n    \"titleEnterEquinoxCredentials\": \"Enter your credentials<br/>for Equinox Meetings\",\r\n    \"titleLoggingToAEMO\": \"Logging in to Equinox Meetings Online\",\r\n    \"titleLoggingToEquinox\": \"Logging in to Equinox Meetings\",\r\n    \"errorBadCredentials\": \"Incorrect Username or Password\",\r\n    \"errorConfigureAccount\": \"Unable to configure account at this time.\",\r\n    \"errorNoConfiguredAccounts\": \"Sorry, your account could not be found.<br/>You may want to:<ul><li>check your email address and try again</li><li>check with your organization to see if you have a Equinox Meetings Online or Equinox Conferencing account</li><li><a href=\\\"https://spaces.zang.io\\\" target=\\\"_blank\\\">sign up</a> for a Spaces account.</li></ul>\",\r\n    \"titleSettingAddin\": \"Setting up your add-in...\",\r\n\r\n    \"titleRequestInfo\": \"Retrieving Portal Info...\",\r\n    \"titleMeetingDetails\": \"Your Meeting Details\",\r\n\r\n    \"titleConferenceAccessNumber\": \"Conference Access Number\",\r\n    \"titleMeetingId\": \"Meeting ID\",\r\n    \"titleConferenceAccessUrl\": \"Conference Access URL\",\r\n\r\n    \"actionAddDetails\": \"Add Details\",\r\n    \"actionAddingDetails\": \"Adding Details...\",\r\n    \"actionStart\": \"Start Meeting\",\r\n    \"actionJoin\": \"Join Meeting\",\r\n    \"actionRemoveDetails\": \"Remove Details\",\r\n    \"actionRemovingDetails\": \"Removing Details...\",\r\n    \"actionLogin\": \"Login\",\r\n    \"actionRetry\": \"Retry\",\r\n    \"actionAllow\": \"Allow\",\r\n    \"actionIgnore\": \"Ignore\",\r\n    \"actionTryAgain\": \"Try Again\",\r\n\r\n    \"linkEquinoxSettings\": \"Go to Equinox Settings\",\r\n    \"linkResetConfiguration\": \"Reset Add-in Configuration\",\r\n\r\n    \"additionalNumbersTitle\": \"Additional numbers:\",\r\n    \"titlePasswordDetails\": \"Specify your password:\",\r\n    \"titleUserId\": \"User name:\",\r\n    \"titlePassword\": \"Password:\",\r\n\r\n    \"aacRoomName\": \"Default AAC\",\r\n    \"aacLabel\": \"Avaya Aura Conferencing\",\r\n\r\n    \"ipoRoomName\": \"Default IP Office\",\r\n    \"ipoLabel\": \"Avaya IP Office Conferencing\",\r\n\r\n    \"statusOffline\": \"Add-in is running in offline mode\",\r\n    \"statusCached\": \"Only cached rooms information is currently available.\",\r\n\r\n    \"errorNoConfiguration\": \"Configuration settings are incomplete. Go to your portal settings to reconfigure.\",\r\n    \"errorPortal\": \"The Portal could not be accessed.\",\r\n    \"errorInvalidCredentials\": \"Your user credentials were invalid. Check your Equinox Settings or contact support for details.\",\r\n    \"errorNoRooms\": \"Error while fetching conference rooms.\",\r\n    \"errorInternal\": \"Internal application error.\",\r\n\r\n    \"promptDisplayNewWindow\": \"$1 wants to display a new window\",\r\n  };\r\n\r\n\r\n  var i18n = {\r\n    ready: false,\r\n    languageId: \"en-US\", // default\r\n\r\n    i18n: strings\r\n  };\r\n\r\n  i18n.loadI18n = function (id) {\r\n    if (i18n.ready) {\r\n      return Promise.resolve(i18n.languageId);\r\n    }\r\n    if (i18n.loading) {\r\n      return i18n.loading;\r\n    }\r\n    i18n.loading = new Promise(function(resolve, reject) {\r\n      var setReady = function(failed) {\r\n        i18n.ready = true;\r\n        delete i18n.loading;\r\n        if (!failed) {\r\n          i18n.languageId = id;\r\n        }\r\n        resolve(i18n.languageId);\r\n      };\r\n\r\n      try {\r\n        id = id.toLowerCase();\r\n        var langid = id.split('-')[0];\r\n        switch (id) {\r\n          case 'pt-br':\r\n          case 'zh-cn':\r\n          case 'zh-tw':\r\n            langid = id.replace('-', '_');\r\n        }\r\n        var url = 'i18n.json';\r\n        fetch(url).then(function (r) {\r\n          if (!r.ok) {\r\n            throw null;\r\n          }\r\n          return r.text();\r\n        }).then(function (text) {\r\n          try {\r\n            var langstrings = JSON.parse(text);\r\n            Object.getOwnPropertyNames(langstrings).forEach(function (lcid) {\r\n              langstrings[lcid.toLowerCase()] = langstrings[lcid];\r\n            });\r\n            \r\n            var ln_strings = langstrings[langid] || {};\r\n            var en_strings = langstrings['en'] || {};\r\n            \r\n            Object.getOwnPropertyNames(en_strings).forEach(function(key) {\r\n              strings[key] = ln_strings[key] || en_strings[key];\r\n            });\r\n            setReady(false);\r\n          } catch (e) {\r\n            setReady(true);\r\n          }\r\n        }, function () {\r\n          setReady(true);\r\n        });\r\n      } catch (e) {\r\n        setReady(true);\r\n      }\r\n    });\r\n    return i18n.loading;\r\n  };\r\n\r\n  module.exports = i18n;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./i18n.js\n// module id = 6\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var globals = require('../globals');\r\n  \r\n  var _chrome = globals.safeProp('chrome');\r\n  if (!_chrome || !('runtime' in _chrome)) {\r\n    _chrome = globals.safeProp('browser');\r\n  }\r\n  if (!_chrome || !('runtime' in _chrome)) {\r\n    _chrome = { };\r\n  }\r\n  \r\n  module.exports = _chrome;\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/chrome/chrome.js\n// module id = 7\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  function empty() {\r\n  }\r\n  \r\n  function keys(o) {\r\n    return Object.getOwnPropertyNames(o || {});\r\n  }\r\n  function mergeKey(context, key) {\r\n    if (key !== 'constructor') {\r\n      context.dst[key] = context.src[key];\r\n    }\r\n    return context;\r\n  }\r\n  function merge(src, dst) {\r\n    return keys(src).reduce(mergeKey, { src: src, dst: dst }).dst;\r\n  }\r\n\r\n  function declare(constructor, instance, statics) {\r\n    constructor = constructor || empty;\r\n    instance    = instance    || constructor.prototype;\r\n    merge(instance, constructor.prototype);\r\n    merge(statics, constructor);\r\n    return constructor;\r\n  }\r\n  function extend(base, constructor, instance, statics) {\r\n    statics = statics || {};\r\n    return derive(constructor, base, instance, statics);\r\n  }\r\n  function derive(constructor, base, instance, statics) {\r\n    var proto;\r\n    constructor = constructor || empty;\r\n    proto       = constructor.prototype;\r\n    base        = base || Object;\r\n    statics     = statics  || base.statics || {};\r\n    \r\n    constructor.prototype = Object.create(base.prototype, { constructor: { value: constructor, enumerable: false }, $base: { value: base.prototype, enumerable: false } });\r\n    merge(proto, constructor.prototype);\r\n    merge(instance, constructor.prototype);\r\n    merge(statics, constructor);\r\n    constructor.extend = extend.bind(null, constructor);\r\n    constructor.statics = constructor.statics || {};\r\n    merge(statics, constructor.statics);\r\n    return constructor;\r\n  }\r\n  function mix(constructor) {\r\n    constructor = constructor || empty;\r\n    var i, len;\r\n    for (i = 1, len = arguments.length; i < len; i++) {\r\n      merge(arguments[i], constructor.prototype);\r\n    }\r\n    return constructor;\r\n  }\r\n  function reverseMap(o) {\r\n    var r = {}, k = keys(o), i;\r\n    for (i = 0; i < k.length; i++) {\r\n      r[o[k[i]]] = k[i];\r\n    }\r\n    return r;\r\n  }\r\n  function reduce(bag, f, context) {\r\n    if (!Array.isArray(bag)) {\r\n      bag = keys(bag);\r\n    }\r\n    bag.reduce(f, context);\r\n  }\r\n  function findFunction(o, f) {\r\n    var key;\r\n    for (key in o) {\r\n      if (o[key] === f) {\r\n        return key;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n  \r\n  /** @constructor */\r\n  function Base() {\r\n    //console.info('base', this);\r\n  }\r\n  Base.prototype.$call = function (f, args) {\r\n    f = f;\r\n    args = args;\r\n    //var k = this.$this;\r\n  }; \r\n  Base.prototype.$super = function () {\r\n    var t = this.$this;\r\n    this.$this = (t || this).$base;\r\n    this.$this.constructor.apply(this, arguments);\r\n    this.$this = t;\r\n  }; \r\n  \r\n  module.exports = derive(Base, Object, {}, {\r\n    empty: empty,\r\n    declare: declare,\r\n    derive: derive,\r\n    mix: mix,\r\n    keys: keys,\r\n    reduce: reduce,\r\n    reverseMap: reverseMap,\r\n  });\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/base.js\n// module id = 8\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var chrome = require('../chrome/chrome');\r\n  var fetch = require('./fetch');\r\n\r\n  function fetchproxy(url, opt) {\r\n    if (!chrome || !chrome.runtime || !chrome.runtime.id) {\r\n      //var proxypath = location.href.replace(/(.*)\\/.*\\/.*(\\.html)($|\\??.*)/i, '$1/proxy/proxy.ashx?url=');\r\n      var proxypath = '../proxy/proxy.ashx?url=';\r\n      url = proxypath + url;\r\n\r\n      console.log('fetchproxy:' + url);\r\n    }\r\n    return fetch(url, opt);\r\n  }\r\n  \r\n  module.exports = fetchproxy;  \r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/io/fetchproxy.js\n// module id = 10\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n  \r\n  var _empty = {\r\n    bag: {},\r\n    set: function (key, val) {\r\n      this.bag[key] = val;\r\n    },\r\n    get: function (key) {\r\n      return this.bag[key];\r\n    },\r\n    del: function (key) {\r\n      delete this.bag[key];\r\n    }\r\n  };\r\n  var _local = {\r\n    set: function (key, val) {\r\n      localStorage.setItem(key, val);\r\n    },\r\n    get: function (key) {\r\n      return localStorage.getItem(key);\r\n    },\r\n    del: function (key) {\r\n      localStorage.removeItem(key);\r\n    }\r\n  };\r\n\r\n  /** @constructor */\r\n  function Storage() {\r\n    this.enabled = true;\r\n    this.empty = _empty;\r\n    this.local = _local;\r\n    this._store = _local;\r\n  }\r\n  \r\n  Storage.prototype.setStore = function (store) {\r\n    if (store) {\r\n      this._store = store;\r\n    }\r\n  };\r\n\r\n  Storage.prototype.getItem = function (key) {\r\n    if (!this.enabled) {\r\n      return null;\r\n    }\r\n    return this._store.get(key);\r\n  };\r\n\r\n  Storage.prototype.setItem = function(key, val) {\r\n    if (!this.enabled) {\r\n      return;\r\n    }\r\n    if ((val === null) || (typeof (val) === 'undefined')) {\r\n      this.removeItem(key);\r\n      return;\r\n    }\r\n    this._store.set(key, val);\r\n  };\r\n\r\n  Storage.prototype.removeItem = function (key) {\r\n    if (!this.enabled) {\r\n      return;\r\n    }\r\n    this._store.del(key);\r\n  };\r\n\r\n  module.exports = new Storage();\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/storage.js\n// module id = 11\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise = require('/lib/jsl/promise');\r\n  var Log = require('/lib/jsl/log');\r\n  var Timer = require('/lib/jsl/timer');\r\n\r\n  var globals = require('/lib/jsl/globals');\r\n  var Office = globals.safeProp('Office');\r\n\r\n  var officeNative = require('./office.native');\r\n  var officeStorage = require('./storage');\r\n\r\n  var logger = Log.createLogger('OFFICE');\r\n\r\n  var office = {\r\n    getStore: officeStorage.getStore\r\n  };\r\n  var strings_defaults = {\r\n    appName: '',\r\n    actionAllow: 'Allow',\r\n    actionIgnore: 'Ignore',\r\n    promptDisplayNewWindow:  '$1 wants to display a new window.'\r\n  };\r\n  var strings = {\r\n  };\r\n\r\n  if (officeNative.missing) {\r\n    Office.initialize = function (reason) {\r\n      logger.info('Office.initialize: ' + reason);\r\n      office.webAPI = true;\r\n      office.initialized = true;\r\n      office.hostName = Office.context.mailbox.diagnostics.hostName;\r\n      office.joinMode = typeof(Office.context.mailbox.item.itemId) !== 'undefined';\r\n    };\r\n  } else {\r\n    office.webAPI = false;\r\n    office.initialized = true;\r\n    Office = officeNative;\r\n    office.hostName = Office.context.mailbox.diagnostics.hostName;\r\n    if ('apiVersion' in Office.context.mailbox.diagnostics) {\r\n      office.apiVersion = Office.context.mailbox.diagnostics.apiVersion;\r\n    }\r\n  }\r\n\r\n  function callback(action, resolve, reject) {\r\n    return function(result) {\r\n      if (result.error) {\r\n        reject(result.error);\r\n        return;\r\n      }\r\n      try {\r\n        var value = result.value;\r\n        if (action) {\r\n          value = action(value);\r\n        }\r\n        resolve(value);\r\n      } catch (e) {\r\n        reject(e);\r\n      }\r\n    };\r\n  }\r\n\r\n  function checkOffice() {\r\n    return new Promise(function(resolve, reject) {\r\n      var timer;\r\n      var delay = 0;\r\n      var interval = 100;\r\n      var wait = 15000;\r\n      var checkInitialized = function () {\r\n        if (office.initialized) {\r\n          timer.reset();\r\n          office.version = Office.context.mailbox.diagnostics.hostVersion.toString() || '';\r\n          logger.info('Office initialized, webAPI: ' + office.webAPI + ', version: ' + office.version + ', apiVersion: ' + office.apiVersion + ', delay: ' + delay);\r\n          logger.info('Office userProfile displayName: ' + office.getDisplayName() + ', emailAddress: ' + office.getEmailAddress());\r\n          officeStorage.init(Office.context.roamingSettings);\r\n          resolve({ checkOffice: true, delay: delay });\r\n        } else {\r\n          if (delay >= wait) {\r\n            timer.reset();\r\n            logger.info('Office not initialized, delay: ' + delay);\r\n            resolve({ checkOffice: false, delay: delay });\r\n          } else {\r\n            timer.start(interval);\r\n            delay += interval;\r\n          }\r\n        }\r\n      };\r\n      timer = new Timer(checkInitialized, 0);\r\n    });\r\n  }\r\n\r\n  function getDialogApi() {\r\n    try {\r\n      return Office.context.requirements.isSetSupported('DialogAPI', '1.1');\r\n    } catch (ex) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  function setTranslations(s) {\r\n    s = s || {};\r\n    strings.actionAllow = s.actionAllow;\r\n    strings.actionIgnore = s.actionIgnore;\r\n    strings.appName = s.manifest_DisplayName;\r\n    strings.promptDisplayNewWindow = strings.promptDisplayNewWindow;\r\n  }\r\n\r\n  function getDisplayName() {\r\n    var displayName;\r\n\r\n    var mailbox = Office.context.mailbox;\r\n    if ('userProfile' in mailbox) {\r\n      var userProfile = mailbox.userProfile;\r\n      if ('displayName' in userProfile) {\r\n        displayName = userProfile.displayName;\r\n      }\r\n    }\r\n    return typeof(displayName) === 'string' ?  displayName : null;\r\n  }\r\n\r\n  function getEmailAddress() {\r\n    var emailAddress;\r\n\r\n    var mailbox = Office.context.mailbox;\r\n    if ('userProfile' in mailbox) {\r\n      var userProfile = mailbox.userProfile;\r\n      if ('emailAddress' in userProfile) {\r\n        emailAddress = userProfile.emailAddress;\r\n      }\r\n    }\r\n\r\n    return typeof(emailAddress) === 'string' ?  emailAddress : null;\r\n  }\r\n\r\n  function getSubject() {\r\n    return new Promise(function(resolve, reject) {\r\n      var action = function (subject) {\r\n        return subject || '';\r\n      };\r\n      Office.context.mailbox.item.subject.getAsync(callback(action, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function setSubject(subject) {\r\n    return new Promise(function(resolve, reject) {\r\n      Office.context.mailbox.item.subject.setAsync(subject, {}, callback(null, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function getParties(member) {\r\n    return new Promise(function(resolve, reject) {\r\n      var action = function (recipients) {\r\n        var _recipients = typeof(recipients) === 'string' ? recipients.split(';') : recipients;\r\n        var parties = [];\r\n        for (var i = 0; i < _recipients.length; i++) {\r\n          parties.push({ email: _recipients[i].emailAddress || _recipients[i], member: member });\r\n        }\r\n        return parties;\r\n      };\r\n      Office.context.mailbox.item.requiredAttendees.getAsync(callback(action, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function getDescription(type) {\r\n    return new Promise(function(resolve, reject) {\r\n      var action = function (desc) {\r\n        return(desc);\r\n      };\r\n      var coercion = type || 'text';\r\n      Office.context.mailbox.item.body.getAsync(coercion, callback(action, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function setDescription(desc, type) {\r\n    return new Promise(function(resolve, reject) {\r\n      var coercion = { coercionType: type || 'text' };\r\n      Office.context.mailbox.item.body.setAsync(desc, coercion, callback(null, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function prependDescription(desc, type) {\r\n    return new Promise(function(resolve, reject) {\r\n      var coercion = { coercionType: type || 'text' };\r\n      Office.context.mailbox.item.body.prependAsync(desc, coercion, callback(null, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function insertDescription(desc, type) {\r\n    return new Promise(function(resolve, reject) {\r\n      var coercion = { coercionType: type || 'text' };\r\n      if ('setSelectedDataAsync' in Office.context.mailbox.item.body) {\r\n        Office.context.mailbox.item.body.setSelectedDataAsync(desc, coercion, callback(null, resolve, reject));\r\n      } else {\r\n        Office.context.mailbox.item.body.prependAsync(desc, coercion, callback(null, resolve, reject));\r\n      }\r\n    });\r\n  }\r\n\r\n  function setLocation(value) {\r\n    return new Promise(function(resolve, reject) {\r\n      Office.context.mailbox.item.location.setAsync(value, { }, callback(null, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function getLocation() {\r\n    return new Promise(function(resolve, reject) {\r\n      var action = function (value) {\r\n        return(value);\r\n      };\r\n      if (typeof(Office.context.mailbox.item.location) === 'string') {\r\n        resolve(action(Office.context.mailbox.item.location));\r\n      } else {\r\n        Office.context.mailbox.item.location.getAsync(callback(action, resolve, reject));\r\n      }\r\n    });\r\n  }\r\n\r\n  function getLanguageSync() {\r\n    var language = Office.context.displayLanguage;\r\n    return typeof(language) === 'string' ?  language : null;\r\n  }\r\n\r\n  function notifyInfo(key, icon, message) {\r\n    Office.context.mailbox.item.notificationMessages.replaceAsync(key, { type: 'informationalMessage', icon: icon, message: message, persistent: false });\r\n  }\r\n\r\n  function notifyError(key, message) {\r\n    Office.context.mailbox.item.notificationMessages.replaceAsync(key, { type: 'errorMessage', message: message });\r\n  }\r\n\r\n  function displayDialog2016RTM(url, opt) {\r\n    Microsoft.Office.WebExtension.EventType = Microsoft.Office.WebExtension.EventType || {};\r\n    Microsoft.Office.WebExtension.EventType.DialogEventReceived = 'dialogEventReceived';\r\n    Microsoft.Office.WebExtension.EventType.DialogMessageReceived = 'dialogMessageReceived';\r\n\r\n    return new Promise(function (resolve, reject) {\r\n      var elBkg, elDlg;\r\n\r\n      function clearPrompt() {\r\n        if (elDlg) {\r\n          elDlg.parentElement.removeChild(elDlg);\r\n          elDlg = null;\r\n        }\r\n        if (elBkg) {\r\n          elBkg.parentElement.removeChild(elBkg);\r\n          elBkg = null;\r\n        }\r\n      }\r\n      function createPrompt(cb) {\r\n        if (!elBkg) {\r\n          elBkg = document.createElement('div');\r\n          elBkg.setAttribute('style', 'position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; background-color: rgba(198, 198, 198, 0.5); z-index: 99998;');\r\n          document.body.appendChild(elBkg);\r\n        }\r\n        if (!elDlg) {\r\n          elDlg = document.createElement('div');\r\n          elDlg.id = 'newWindowNotificaiton';\r\n          elDlg.setAttribute('role', 'dialog');\r\n          elDlg.setAttribute('style', 'width: 100%; height: 190px; position: absolute; z-index: 99999; background-color: rgb(255, 255, 255); left: 0px; top: 50%; margin-top: -95px;');\r\n\r\n          var elHead, elText, elAct, elAccept, elIgnore;\r\n          elHead = document.createElement('div');\r\n          elHead.id = 'dialogNotificationTextPanel';\r\n          elHead.setAttribute('style', 'margin: 20px 14px; font-family: &quot;Segoe UI&quot;, Arial, Verdana, sans-serif; font-size: 14px; height: 100px; line-height: 100px; padding-left: 30px;');\r\n\r\n          elText = document.createElement('span');\r\n          elText.setAttribute('style', 'display: inline-block; line-height: normal; vertical-align: middle;');\r\n          elText.textContent = (strings.promptDisplayNewWindow || strings_defaults.promptDisplayNewWindow || '').replace('$1', strings.appName || strings_defaults.appName || '');\r\n\r\n          elAct = document.createElement('div');\r\n          elAct.setAttribute('style', 'margin: 0px 9px; float: right;');\r\n\r\n          elAccept = document.createElement('input');\r\n          elAccept.type = 'button';\r\n          elAccept.setAttribute('style', 'text-align: center; width: 100px; height: 25px; font-size: 14px; font-family: Segoe UI, Arial, Verdana, sans-serif; margin: 0px 5px; border-width: 1px; border-style: solid; border-color: rgb(171, 171, 171); background-color: rgb(255, 255, 255);');\r\n          elAccept.value = strings.actionAllow || strings_defaults.actionAllow || '';\r\n          elAccept.addEventListener('click', function (ev) {\r\n            ev.preventDefault();\r\n            ev.stopPropagation();\r\n\r\n            clearPrompt();\r\n            cb(true);\r\n          });\r\n\r\n          elIgnore = document.createElement('input');\r\n          elIgnore.type = 'button';\r\n          elIgnore.setAttribute('style', 'text-align: center; width: 100px; height: 25px; font-size: 14px; font-family: Segoe UI, Arial, Verdana, sans-serif; margin: 0px 5px; border-width: 1px; border-style: solid; border-color: rgb(171, 171, 171); background-color: rgb(255, 255, 255);');\r\n          elIgnore.value = strings.actionIgnore || strings_defaults.actionIgnore || '';\r\n          elIgnore.addEventListener('click', function (ev) {\r\n            ev.preventDefault();\r\n            ev.stopPropagation();\r\n\r\n            clearPrompt();\r\n            cb(false);\r\n          });\r\n\r\n          elDlg.appendChild(elHead);\r\n          elDlg.appendChild(elAct);\r\n\r\n          elHead.appendChild(elText);\r\n\r\n          elAct.appendChild(elAccept);\r\n          elAct.appendChild(elIgnore);\r\n\r\n          document.body.appendChild(elDlg);\r\n        }\r\n      }\r\n      function checkWindow(context) {\r\n        if (context.stop) {\r\n          return;\r\n        }\r\n        if (!context.wnd || context.wnd.closed) {\r\n          context.cb();\r\n        } else {\r\n          setTimeout(checkWindow, 100, context);\r\n        }\r\n      }\r\n\r\n      opt = opt || { width: 100, height: 100, requireHTTPS: true };\r\n      var result = { value: null, status: Office.AsyncResultStatus.Failed, error: null };\r\n      createPrompt(function (res) {\r\n        if (res) {\r\n          var t, l, w, h;\r\n          w = 0 | (opt.width*window.screen.availWidth/100);\r\n          h = 0 | (opt.height*window.screen.availHeight/100);\r\n          l = 0 | ((window.screen.availWidth - w)/2);\r\n          t = 0 | ((window.screen.availHeight - h)/2);\r\n\r\n          var wnd = window.open(url, 'DialogAPI', 'width=' + w + ',height=' + h + ',top=' + t + ',left=' + l + ',resizable,scrollbars=yes');\r\n          if (!wnd) {\r\n            // result update;\r\n            reject(result);\r\n          } else {\r\n            var context = { wnd: wnd, stop: false }, handler;\r\n\r\n            result.value = {\r\n              close: function () {\r\n                context.stop = true;\r\n                if (context.wnd) {\r\n                  context.wnd.close();\r\n                  context.wnd = null;\r\n                }\r\n\r\n                handler = null;\r\n              },\r\n              addEventHandler: function (name, h) {\r\n                if (name === Microsoft.Office.WebExtension.EventType.DialogEventReceived) {\r\n                  handler = h;\r\n                }\r\n              }\r\n            };\r\n\r\n            context.cb = function () {\r\n              if (handler) {\r\n                handler({ error: 12006 });\r\n              }\r\n            };\r\n            checkWindow(context);\r\n            \r\n            result.status = Office.AsyncResultStatus.Succeeded;\r\n            resolve(result);\r\n          }\r\n        } else {\r\n          // result update;\r\n          reject(result);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  function displayDialog(url, opt) {\r\n    if (!('ui' in Office.context) || !('displayDialogAsync' in Office.context.ui)) {\r\n      return displayDialog2016RTM(url, opt);\r\n    }\r\n\r\n    return new Promise(function (resolve, reject) {\r\n      opt = opt || { width: 100, height: 100, requireHTTPS: true };\r\n      Office.context.ui.displayDialogAsync(url, opt, function (result) {\r\n        result = result || { };\r\n        result = { value: result.value, status: result.status, error: result.error };\r\n        logger.info('displayDialogAsync, opt: ' + JSON.stringify(opt) + ', result: ' + JSON.stringify(result));\r\n        if (result.status !== Office.AsyncResultStatus.Succeeded) {\r\n          reject(result);\r\n        } else {\r\n          resolve(result);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  function getCustomProp(name) {\r\n    return new Promise(function(resolve, reject) {\r\n      var action = function (customProps) {\r\n        var value = customProps.get(name);\r\n        if (!value) {\r\n          return value;\r\n        }\r\n        return JSON.parse(value);\r\n      };\r\n      Office.context.mailbox.item.loadCustomPropertiesAsync(callback(action, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function setCustomProp(name, value) {\r\n    if (typeof(value) === 'undefined') {\r\n      return delCustomProp(name);\r\n    }\r\n    return new Promise(function(resolve, reject) {\r\n      var action = function (customProps) {\r\n        customProps.set(name, JSON.stringify(value));\r\n        customProps.saveAsync(callback(null, resolve, reject));\r\n      };\r\n      Office.context.mailbox.item.loadCustomPropertiesAsync(callback(action, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function delCustomProp(name) {\r\n    return new Promise(function(resolve, reject) {\r\n      var action = function (customProps) {\r\n        customProps.remove(name);\r\n        customProps.saveAsync(callback(null, resolve, reject));\r\n      };\r\n      Office.context.mailbox.item.loadCustomPropertiesAsync(callback(action, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function save() {\r\n    return new Promise(function(resolve, reject) {\r\n      Office.context.mailbox.item.saveAsync(callback(null, resolve, reject));\r\n    });\r\n  }\r\n\r\n  function invokeCallback(type, data) {\r\n    Office.context.mailbox.item.location.callback(type, data);\r\n  }\r\n\r\n  function execCmd0(cmd) {\r\n    return function () {\r\n      if (!office.initialized) {\r\n        return Promise.reject({ error: { nooffice: true } });\r\n      }\r\n      return cmd.apply(this, arguments); // pass provided arguments to cmd itself\r\n    };\r\n  }\r\n\r\n  function execCmd(cmd) {\r\n    var args = arguments;\r\n    return function () {\r\n      if (office.initialized === undefined) {\r\n        // return Promise.reject({ error: { nooffice: true } });\r\n        // sometimes Office.initialize is called later than checkInvite in case of auto login, \r\n        // so we need to wait a bit before reject 'not intitialized' error\r\n        return new Promise(function(resolve, reject) \r\n        {\r\n          setTimeout(function()\r\n          {\r\n             if (!office.initialized) {\r\n               reject({ error: { nooffice: true } });\r\n             } else {\r\n               resolve(cmd.apply(this, args)); // pass provided arguments to cmd itself\r\n             } \r\n          }, 500);\r\n        });\r\n      } else if (!office.initialized) {\r\n        return Promise.reject({ error: { nooffice: true } });\r\n      } else {\r\n        return cmd.apply(this, arguments); // pass provided arguments to cmd itself\r\n      }\r\n    };\r\n  }\r\n\r\n  office.checkOffice = checkOffice;\r\n  office.getDialogApi = getDialogApi;\r\n  office.getDisplayName = execCmd(getDisplayName);\r\n  office.getEmailAddress = execCmd(getEmailAddress);\r\n  office.getSubject = execCmd(getSubject);\r\n  office.setSubject = execCmd(setSubject);\r\n  office.getParties = execCmd(getParties);\r\n  office.getDescription = execCmd(getDescription);\r\n  office.setDescription = execCmd(setDescription);\r\n  office.prependDescription = execCmd(prependDescription);\r\n  office.insertDescription = execCmd(insertDescription);\r\n  office.getLocation = execCmd(getLocation);\r\n  office.setLocation = execCmd(setLocation);\r\n  office.getLanguageSync = execCmd(getLanguageSync);\r\n  office.notifyInfo = execCmd(notifyInfo);\r\n  office.notifyError = execCmd(notifyError);\r\n  office.displayDialog = execCmd(displayDialog);\r\n  office.getCustomProp = execCmd(getCustomProp);\r\n  office.setCustomProp = execCmd(setCustomProp);\r\n  office.delCustomProp = execCmd(delCustomProp);\r\n  office.save = execCmd(save);\r\n  office.invokeCallback = execCmd(invokeCallback);\r\n  office.setTranslations = setTranslations;\r\n  \r\n  module.exports = office;  \r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./office.js\n// module id = 12\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var Timer = require('./timer');\r\n\r\n  var modules = { }; \r\n  var lmodules = [];\r\n  var monitors = [];\r\n  var timer = new Timer(onTimer, 10);\r\n  \r\n  var pageUrl = location.href;\r\n  var rootUrl = getRootUrl();\r\n  var baseUrl = getBaseUrl(rootUrl, pageUrl);\r\n\r\n  function getBaseUrl(root, page) {\r\n    var url = page.replace(root, '').replace(/(\\#|\\?).*/ig, '').split('/');\r\n    // remove leading /\r\n    url.shift();\r\n    // remove trailing /\r\n    url.pop();\r\n    for (var i = 0; i < url.length; i++) {\r\n      url[i] = '..';\r\n    }\r\n    return url.join('/');\r\n  }\r\n  \r\n  function getRootUrl() {\r\n    var re = /\\/?boot\\.js/i;\r\n    var els = document.getElementsByTagName('script');\r\n    for (var i = 0; i < els.length; i++) {\r\n      var url = els[i].src;\r\n      if (re.exec(url)) {\r\n        return commonUrl(pageUrl, url);\r\n      }\r\n    }\r\n  }\r\n  function commonUrl(url1, url2) {\r\n    for (var i = 0; i < url1.length; i++) {\r\n      if (url1[i] !== url2[i]) {\r\n        return url1.substr(0, url1[i - 1] === '/' ? i - 1 : i);\r\n      }\r\n    }\r\n    return '';\r\n  }\r\n  function adjustUrl(base, url) {\r\n    if ((url[0] === '/') && (url[1] !== '/')) {\r\n      if (base === '') {\r\n        url = url.substr(1);\r\n      }\r\n      return base + url;\r\n    }\r\n    return url;\r\n  }\r\n  \r\n  function loadScript(url, isAsync) {\r\n    url = adjustUrl(baseUrl, url);\r\n    var d = document; \r\n    var j = d.createElement('script'); \r\n    j.async = isAsync; \r\n    j.src = url; \r\n    d.head.appendChild(j); \r\n  }  \r\n\r\n  \r\n  function load(url, check, cb) {\r\n    console.info('load', url);\r\n    var key = adjustUrl(rootUrl, url);\r\n    var mod = modules[key];\r\n    if (!mod) {\r\n      mod = modules[key] = { url: url, notify: [], check: check, loaded: false };\r\n      lmodules.push(mod);\r\n      if (typeof(__webpack_require__) === 'undefined') {\r\n        loadScript(url, true);\r\n      }\r\n    }\r\n    if (cb) {\r\n      mod.notify.push(cb);\r\n    }\r\n    onTimer();\r\n  }\r\n  function wait(cb) {\r\n    monitors.push(cb);\r\n    onTimer();\r\n  }\r\n  function loadMany(items, cb) {\r\n    var item = items.shift();\r\n    if (!item) {\r\n      return;\r\n    }\r\n    var i = items.length;\r\n    load(item.url, item.name, function () {\r\n      if (i) {\r\n        loadMany(items, cb);\r\n      } else {\r\n        cb();\r\n      }\r\n    });\r\n  }\r\n  \r\n  function exec(lcb) {\r\n    for (var i = 0; i < lcb.length; i++) {\r\n      lcb[i]();\r\n    }\r\n    return [];\r\n  }\r\n  function checkObject(o) {\r\n    var p = window;\r\n    for (o = o.split('.'); o.length && !!(p = p[o.shift()]);) {\r\n      p = p;\r\n    }\r\n    return !!p;\r\n  }\r\n  function checkLoaded(mod) {\r\n    if (!mod.loaded) {\r\n      var c = mod.check;\r\n      if (typeof (c) === 'function') {\r\n        mod.loaded = c();\r\n      } else if (typeof (c) === 'string') {\r\n        mod.loaded = checkObject(c);\r\n      }\r\n    }\r\n    return mod.loaded;\r\n  }\r\n  \r\n  function onTimer() {\r\n    var i, mod, mods = [];\r\n    for (var i = 0; i < lmodules.length; i++) {\r\n      mods.push(lmodules[i]);\r\n    }\r\n    for (i = 0; i < mods.length; i++) {\r\n      mod = mods[i];\r\n      if (checkLoaded(mod)) {\r\n        mod.notify = exec(mod.notify);\r\n      }\r\n    }\r\n    mods = [];\r\n    for (i = 0; i < lmodules.length; i++) {\r\n      mod = lmodules[i];\r\n      if (!mod.loaded) {\r\n        mods.push(mod);\r\n      }\r\n    }\r\n    lmodules = mods;\r\n\r\n    if (lmodules.length === 0) {\r\n      monitors = exec(monitors);\r\n    } else {\r\n      timer.start(25);\r\n    }\r\n  }\r\n  \r\n  function Loader() {\r\n  }\r\n  Loader.prototype.load = load;\r\n  Loader.prototype.loadMany = loadMany;\r\n  Loader.prototype.wait = wait;\r\n\r\n  module.exports = new Loader();\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/loader.js\n// module id = 13\n// module chunks = 0 1","  define(function (require, exports, module) {\r\n  'use strict';\r\n  \r\n  /** @constructor */\r\n  function Timer(cb, delay, arg) {\r\n    this._cb = cb;\r\n    this.start(delay, arg);\r\n  }\r\n  Timer.prototype.start = function (delay, arg) {\r\n    this.reset();\r\n    if (!delay && delay !== 0) {\r\n      return;\r\n    }\r\n    \r\n    this._timer = setTimeout(this._cb, delay, arg);\r\n  };\r\n  Timer.prototype.reset = function () {\r\n    if (this._timer) {\r\n      this._timer = clearTimeout(this._timer) || null;\r\n    }\r\n  };\r\n  \r\n  module.exports = Timer;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/timer.js\n// module id = 14\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Event = require('../../event');\r\n\r\n  function rpcMethodOneWay() {\r\n  }\r\n  function rpcMethodCallback() {\r\n  }\r\n  function rpcMethodPromise() {\r\n  }\r\n \r\n  var rpcEventBroadcast = new Event(); \r\n  var rpcEventUnicast = new Event();\r\n\r\n  var RPCSchemaDefs = {\r\n    methodOneWay: rpcMethodOneWay,\r\n    methodCallback: rpcMethodCallback,\r\n    methodPromise: rpcMethodPromise,\r\n\r\n    eventBroadcast: rpcEventBroadcast,\r\n    eventUnicast: rpcEventUnicast\r\n  };\r\n\r\n  module.exports = RPCSchemaDefs;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/chrome/rpc/schema.js\n// module id = 15\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var Base = require('../base');\r\n  var LiteralMap = require('../maps/literal');\r\n  var Guid = require('../guid');\r\n  var Promise = require('../promise');\r\n  var Utils = require('../utils');\r\n  var fetchproxy = require('../io/fetchproxy');\r\n\r\n  var chrome = require('../chrome/chrome');\r\n\r\n  var JWT = require('./jwt');\r\n  var OAuthInteractive = require('./oauth.interactive');\r\n\r\n  var authMap = new LiteralMap({\r\n    state: 'state', clientUrl: 'redirect_uri', responseType: 'response_type', clientId: 'client_id', resource: 'resource',\r\n    scope: 'scope', prompt: 'prompt', accessType: 'access_type', approvalPrompt: 'approval_prompt', loginHint: 'login_hint',\r\n    nonce: 'nonce', incremental: 'include_granted_scopes', clientSecret: 'client_secret', grantType: 'grant_type',\r\n    code: 'code', refreshToken: 'refresh_token'\r\n  });\r\n  var responseMap = new LiteralMap({\r\n    token: 'access_token', tokenType: 'token_type', idToken: 'id_token', expiry: 'expires_in', scope: 'scope', state: 'state',\r\n    accountIndex: 'authuser', accountDomain: 'hd', prompt: 'prompt', sessionState: 'session_state', code: 'code', refreshToken: 'refresh_token',\r\n  });\r\n\r\n  function encode(s) {\r\n    //return encodeURIComponent(s);\r\n    return s;\r\n  }  \r\n  function applyArgument(context, key) {\r\n    context.args.push(key + '=' + encode(context.opt[key]));\r\n    return context;\r\n  }\r\n  function prepareArgs(args) {\r\n    args = Object.getOwnPropertyNames(args).reduce(applyArgument, { args: [], opt: args }).args;\r\n    return args.join('&');\r\n  }\r\n  function prepareUrl(url, args) {\r\n    args = prepareArgs(args);\r\n    if (url.indexOf('?') === -1) {\r\n      return url + '?' + args;\r\n    } else {\r\n      return url + encodeURIComponent('?' + args);\r\n    }\r\n  }\r\n  function prepareMappedUrl(url, args) {\r\n    args = authMap.mapDirect(args);\r\n    return prepareUrl(url, args);\r\n  }\r\n\r\n  function getToken(provider, args) {\r\n    args = authMap.mapDirect(args);\r\n    args = prepareArgs(args);\r\n    Utils.showLogInfo('identity: OAuthProvider.getToken, provider: ' + (provider || { }).clientType + ', args', args);\r\n    var opt = { 'method': 'POST', 'body': args, 'headers': { 'content-type': 'application/x-www-form-urlencoded;charset=UTF-8' } }; \r\n    return fetchproxy(provider.urlToken, opt).then(function (r) {\r\n      try {\r\n        return r.json();\r\n      } catch (e) {\r\n        Utils.showLogInfo('identity: OAuthProvider.getToken, error: ' + e.message + ', r: ' + r.toString());\r\n        return Promise.reject({ error: { fetch: true } });\r\n      }\r\n    });\r\n  }\r\n  function getTokenByCode(provider, code, state) {\r\n    var args = { clientId: provider.clientId, clientSecret: provider.clientSecret, clientUrl: provider.clientUrl, grantType: 'authorization_code', code: code, state: state };\r\n    return getToken(provider, args).then(function (r) {\r\n      //debugger;\r\n      r = responseMap.mapReverse(r);\r\n      r = provider.extractInteractiveResult(r);\r\n      return r;\r\n    });\r\n  }\r\n  function getTokenByRefreshToken(provider, refreshToken) {\r\n    var args = { clientId: provider.clientId, clientSecret: provider.clientSecret, clientUrl: provider.clientUrl, grantType: 'refresh_token', refreshToken: refreshToken };\r\n    Utils.showLogInfo('identity: OAuthProvider.getTokenByRefreshToken, provider: ' + (provider || { }).clientType + ', args', args);\r\n    return getToken(provider, args).then(function (r) {\r\n      if (r && r.error) { // r = { error: { message: ..., code: ... } } if refreshToken is bad\r\n        Utils.showLogInfo('identity: OAuthProvider.getTokenByRefreshToken error', r);\r\n        return Promise.reject(); // reject no result\r\n      }\r\n      r = responseMap.mapReverse(r);\r\n      r = provider.extractInteractiveResult(r);\r\n      return r;\r\n    });\r\n  }\r\n  function getTokenInteractive(provider, opt) {\r\n    Utils.showLogInfo('identity: OAuthProvider.getTokenInteractive, provider: ' + (provider || { }).clientType + ', opt', opt, ['cancelToken'], true);\r\n    var args = provider.getInteractiveArgs(opt);\r\n    var url = opt.logout ?  provider.urlLogout : provider.urlLogin;\r\n    url = url || provider.urlLogin;\r\n    url = prepareMappedUrl(url, args);\r\n\r\n    //!! adjust no ui\r\n    opt.nosilent = true;\r\n\r\n    return OAuthInteractive({ url: url, redirect: provider.clientUrl, state: args.state, cancelToken: opt.cancelToken, noui: opt.noui, nosilent: opt.nosilent, asyncui: opt.asyncui, logout: opt.logout }).then(function (r) {\r\n      Utils.showLogInfo('identity: OAuthProvider getTokenInteractive resolved', r);\r\n      r = responseMap.mapReverse(r);\r\n      if (r.code) {\r\n        return getTokenByCode(provider, r.code, args.state);\r\n      }\r\n      r = provider.extractInteractiveResult(r);\r\n      Utils.showLogInfo('identity: OAuthProvider getTokenInteractive, extractInteractiveResult', r);\r\n      return r;\r\n    });\r\n  }\r\n  \r\n  function exec(cmd, cancel) {\r\n    var ap = [cmd];\r\n    if (cancel) {\r\n      ap.push(cancel);\r\n    }\r\n    return Promise.race(ap);\r\n  } \r\n\r\n  function validateCache(provider, opt) {\r\n    Utils.showLogInfo('identity: OAuthProvider.validateCache');\r\n    var info;\r\n    if (provider.storage) {\r\n      if (opt.primary) {\r\n        info = provider.storage.getPrimary();\r\n      } else if (opt.userId) {\r\n        info = provider.storage.getByType(provider.clientType, opt.userId);\r\n      }\r\n    }\r\n    if (info) {\r\n      if (info.accountsUrl && info.accountsUrl === provider.urlRoot) {\r\n        var dt = Date.now();\r\n        if (opt.login) {\r\n          if ((info.identity && (new Date(info.identity.expiry).valueOf() > dt + 10000)) &&\r\n            (info.token && (info.token.expiry.valueOf() > dt + 10000)))\r\n          {\r\n            Utils.showLogInfo('identity: OAuthProvider.validateCache resolve', info);\r\n            return Promise.resolve(info);\r\n          }\r\n          Utils.showLogInfo('identity: OAuthProvider.validateCache expired', { 'identityExpiry': (info.identity || { }).expiry, 'tokenExpiry': (info.token || { }).expiry });\r\n        } else {\r\n          if (info.token && (info.token.expiry.valueOf() > dt + 10000)) {\r\n            Utils.showLogInfo('identity: OAuthProvider.validateCache resolve', info);\r\n            return Promise.resolve(info);\r\n          }\r\n          Utils.showLogInfo('identity: OAuthProvider.validateCache expired', { 'tokenExpiry': (info.token || { }).expiry });\r\n        }\r\n        if (provider.supportsOffline() && info.refreshToken) {\r\n          var cmd = getTokenByRefreshToken(provider, info.refreshToken);\r\n          return exec(cmd, opt.cancelToken);\r\n        }\r\n        Utils.showLogInfo('identity: OAuthProvider.validateCache no refresh', { 'offline': provider.supportsOffline(), 'refreshToken': info.refreshToken });\r\n      }\r\n      Utils.showLogInfo('identity: OAuthProvider.validateCache no url', { 'accounts': info.accountsUrl, 'provider':  provider.urlRoot });\r\n    } else {\r\n      Utils.showLogInfo('identity: OAuthProvider.validateCache no info');\r\n    }\r\n    var err = { error: { nocache: true } };\r\n    Utils.showLogInfo('identity: OAuthProvider.validateCache reject', err);\r\n    return Promise.reject(err);\r\n  }\r\n  function validate(provider, opt) {\r\n    Utils.showLogInfo('identity: OAuthProvider.validate, provider: ' + (provider || { }).clientType + ', opt: ', opt, ['cancelToken'], true);\r\n    if (opt.token) {\r\n      if (opt.token.error) {\r\n        return Promise.reject(new Error(opt.token.error));\r\n      }\r\n      return Promise.resolve({ token: opt.token });\r\n    }\r\n    return validateCache(provider, opt).then(null, function (res) {\r\n      if (res && res.error && res.cancel) {\r\n        return Promise.reject(res);\r\n      }\r\n      var cmd = getTokenInteractive(provider, opt);\r\n      return exec(cmd, opt.cancelToken);\r\n    }).then(null, function (res) {\r\n      return Promise.reject(res);\r\n    });\r\n  }\r\n  \r\n  /** @constructor */  \r\n  function OAuthProvider() {\r\n  }\r\n  OAuthProvider.prototype.setStorage = function (storage) {\r\n    this.storage = storage;\r\n  };\r\n  OAuthProvider.prototype.initUrls = function (opt) {\r\n    opt = opt || {};\r\n    this.urlRoot = opt.urlRoot || '';\r\n    this.urlLogin = opt.urlLogin || '';\r\n    this.urlLogout = opt.urlLogout || '';\r\n    this.urlToken = opt.urlToken || '';\r\n  };\r\n  OAuthProvider.prototype.initClient = function (opt) {\r\n    opt = opt || {};\r\n    this.clientType = opt.clientType || this.clientType;\r\n    this.clientId = opt.clientId || '';\r\n    this.clientSecret = opt.clientSecret || '';\r\n    this.clientUrl = opt.clientUrl || '';\r\n  };\r\n  OAuthProvider.prototype.supportsOffline = function () {\r\n    return !!this.clientSecret;\r\n  };\r\n  OAuthProvider.prototype.supportsIncremental = function () {\r\n    return true;\r\n  };\r\n  OAuthProvider.prototype.supportsOpenId = function () {\r\n    return true;\r\n  };\r\n\r\n  OAuthProvider.prototype.applyPrompt = function (opt, args) {\r\n    var prompt = [];\r\n    if (!opt.userId) {\r\n      prompt.push('select_account');\r\n      //prompt.push('login');\r\n    }\r\n    if (opt.consent) {\r\n      prompt.push('consent');\r\n    }\r\n    prompt = prompt.join(' ');\r\n    //if (!prompt) {\r\n    //  prompt = 'none';\r\n    //}\r\n    if (prompt) {\r\n      args.prompt = prompt;\r\n    }\r\n  };\r\n  OAuthProvider.prototype.applyOffline = function (opt, args) {\r\n    if (this.supportsOffline() && opt.offline) {\r\n      args.accessType = 'offline';\r\n    }\r\n  };\r\n  OAuthProvider.prototype.applyIncremental = function (opt, args) {\r\n    if (this.supportsIncremental()) {\r\n      args.incremental = true;\r\n    }\r\n  };\r\n  OAuthProvider.prototype.applyLoginHint = function (opt, args) {\r\n    if (opt.userId) {\r\n      args.loginHint = opt.userId;\r\n    }\r\n  };\r\n  OAuthProvider.prototype.applyResponseType = function (opt, args) {\r\n    if (this.supportsOffline()) {\r\n      args.responseType = 'code';\r\n    } else if (opt.login && this.supportsOpenId()) {\r\n      args.responseType = 'token id_token';\r\n    } else {\r\n      args.responseType = 'token';\r\n    }\r\n  };\r\n  OAuthProvider.prototype.applyLoginScope = function (scope) {\r\n    scope.push('openid');\r\n    scope.push('profile');\r\n    scope.push('email');\r\n  };\r\n  OAuthProvider.prototype.applyScope = function (opt, args) {\r\n    var scopes = [];\r\n    if (opt.scopes) {\r\n      for (var i = 0; i < opt.scopes.length; i++) {\r\n        scopes.push(opt.scopes[i]);\r\n      }\r\n    }\r\n    if (opt.login) {\r\n      this.applyLoginScope(scopes);\r\n    }\r\n    args.scope = scopes.join(' ');\r\n  };\r\n  OAuthProvider.prototype.applyState = function (opt, args) {\r\n    if (opt.state) {\r\n      args.state = opt.state;\r\n    } else {\r\n      args.state = Guid.NewGuid().toString(); \r\n    }\r\n\r\n    var id = location.hostname;\r\n    if (chrome && chrome.runtime && chrome.runtime.id) {\r\n      id = chrome.runtime.id;\r\n    }\r\n\r\n    if (location.protocol === 'moz-extension:') {\r\n      id = 'MOZ:' + id;\r\n    }\r\n    if (location.protocol === 'ms-browser-extension:') {\r\n      id = 'MSE:' + id;\r\n    }\r\n    if (location.protocol === 'https:') {\r\n      var page = location.protocol + '//' + location.hostname + location.pathname;\r\n      id = page.replace(/\\/[^\\/]*\\.html/i, '/auth.html');\r\n    }\r\n\r\n    args.state = args.state + '---' + id + '---';\r\n  };\r\n  OAuthProvider.prototype.applyNonce = function (opt, args) {\r\n    args.nonce = Guid.NewGuid().toString();\r\n  };\r\n  \r\n  OAuthProvider.prototype.getInteractiveArgs = function (opt) {\r\n    var args = { clientId: this.clientId, clientUrl: this.clientUrl };\r\n\r\n    this.applyResponseType(opt, args);\r\n    this.applyLoginHint(opt, args);\r\n    this.applyIncremental(opt, args);\r\n    this.applyOffline(opt, args);\r\n    this.applyPrompt(opt, args);\r\n    this.applyScope(opt, args);\r\n    this.applyState(opt, args);\r\n    this.applyNonce(opt, args);\r\n    \r\n    return args;\r\n  };\r\n  \r\n  OAuthProvider.prototype.login = function (opt) {\r\n    opt.login = true;\r\n    return validate(this, opt);\r\n  };\r\n  OAuthProvider.prototype.logout = function (opt) {\r\n    var self = this;\r\n    if (self.storage) {\r\n      self.storage.remove(opt);\r\n    }\r\n  };\r\n\r\n  OAuthProvider.prototype.extractInteractiveResult = function (args) {\r\n    var res = { };\r\n    if (args.scope) {\r\n      res.scope = args.scope.split(' ');\r\n    }\r\n    if (args.token) {\r\n      var expiry = Date.now() + (0 | (args.expiry || 3600)) * 1000;\r\n      res.token = { token: args.token, type: args.tokenType || 'Bearer', expiry: expiry };\r\n    }\r\n    if (args.refreshToken) {\r\n      res.refreshToken = args.refreshToken;\r\n    }\r\n    if (args.idToken) {\r\n      res.identity = new JWT(args.idToken);\r\n    }\r\n    if (args.accountDomain) {\r\n      (res.account = res.account || {}).domain = args.accountDomain;  \r\n    }\r\n    if (args.accountIndex) {\r\n      (res.account = res.account || {}).index = args.accountIndex;  \r\n    }\r\n    if (args.sessionState) {\r\n      (res.account = res.account || {}).state = args.sessionState;  \r\n    }\r\n    return res;\r\n  };  \r\n\r\n  OAuthProvider.prototype.getUserInfo = function (r) {\r\n    return Promise.resolve(r);\r\n  };\r\n\r\n  OAuthProvider.prototype._getUserInfo = function (r) {\r\n    if (!r.userInfo) {\r\n      return this.getUserInfo(r);\r\n    } else {\r\n      return Promise.resolve(r);\r\n    }\r\n  };\r\n  OAuthProvider.prototype._saveUserInfo = function (r) {\r\n    if (this.storage) {\r\n      r.userId = r.userInfo.user;\r\n      r.accountsUrl = this.urlRoot;\r\n      this.storage.add(r);\r\n    }\r\n  };\r\n  OAuthProvider.prototype._applyUserInfo = function (r) {\r\n    var self = this;\r\n    return self._getUserInfo(r).then(function (r) {\r\n      self._saveUserInfo(r);\r\n      return r;\r\n    });\r\n  };\r\n\r\n  OAuthProvider.prototype.getToken = function (opt) {\r\n    Utils.showLogInfo('identity: OAuthProvider.getToken', opt, ['cancelToken'], true);\r\n    var self = this;\r\n    return validate(this, opt).then(function (r) {\r\n      Utils.showLogInfo('identity: OAuthProvider.getToken resolved', r);\r\n      if (!r.token || !r.token.token) {\r\n        var err = { error: { notoken: true } };\r\n        Utils.showLogInfo('identity: OAuthProvider.getToken reject', err);\r\n        return Promise.reject(err);\r\n      }\r\n      r.type = opt.type;\r\n      r.primary = opt.primary;\r\n\r\n      if (!opt.login) {\r\n        return r.token.token;\r\n      }\r\n      return self._applyUserInfo(r);\r\n    });\r\n  };\r\n  \r\n  module.exports = Base.extend(OAuthProvider);  \r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/id/oauth.provider.js\n// module id = 16\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise      = require('/lib/jsl/promise');\r\n  var Log          = require('/lib/jsl/log');\r\n\r\n  var i18n         = require('./i18n');\r\n  var office       = require('./office');\r\n\r\n  var roomsConfig  = require('./sources/rooms/srcconfig');\r\n  var spacesConfig = require('./sources/spaces/srcconfig');\r\n\r\n  var rooms        = require('./model/rooms/model');\r\n  var spaces       = require('./model/spaces/model');\r\n\r\n  var SOURCE_SPACES = 'spaces';\r\n  var SOURCE_ROOMS = 'rooms';\r\n  var KNOWN_SOURCES = [SOURCE_SPACES, SOURCE_ROOMS];\r\n\r\n  var logger = Log.createLogger('INVITE');\r\n\r\n  var store;\r\n  var configuration;\r\n  var configuredSources;\r\n\r\n  function getStore() {\r\n    if (!store) {\r\n      store = office.getStore();\r\n      if (!store) {\r\n        throw ({ error: { nooffice: true } });\r\n      }\r\n    }\r\n    return store;\r\n  }\r\n\r\n  function getStoreItem(key) {\r\n    var item = getStore().get(key); // store: office, Storage.getItem(key);\r\n    logger.info('Get store item \\'' + key + '\\': ' + ((typeof(item) === 'undefined' || item === null) ? 'not defined' : (item && item.length ? 'length = ' + item.length : '\\'' + item.toString() + '\\'')));\r\n    return item;\r\n  }\r\n\r\n  function delStoreItem(key) {\r\n    logger.info('Remove store item \\'' + key + '\\'');\r\n    // getStore().del(key);\r\n    getStore().set(key, ''); // set empty string instead of deleting key to avoid settings.remove() call\r\n  }\r\n\r\n  function setStoreItem(key, item) {\r\n    logger.info('Set store item \\'' + key + '\\': ' + 'length = ' + item.length);\r\n    getStore().set(key, item);\r\n  }\r\n\r\n  function getConfiguration(force) {\r\n    var manual = false;\r\n    if (force) {\r\n      configuration = null;\r\n    }\r\n    if (!configuration) {\r\n      var configurationItem = getStoreItem('configuration');\r\n      if (!configurationItem) {\r\n        configurationItem = getStoreItem('configuration-manual');\r\n        manual = true;\r\n      }\r\n      if (configurationItem) {\r\n        try {\r\n          configuration = JSON.parse(configurationItem);\r\n          configuration['manual'] = manual;\r\n        } catch (e) {\r\n          logger.error('Configuration parse error: ' + e.message);\r\n        }\r\n      }\r\n      if (!configuration) {\r\n        configuration = { };\r\n      }\r\n      logger.cred('Use stored configuration: ' + JSON.stringify(configuration), configuration['Password']);\r\n    } else {\r\n      logger.cred('Use cached configuration');\r\n    }\r\n    return configuration;\r\n  }\r\n\r\n  function setConfiguration(cfg, save) {\r\n    configuration = cfg;\r\n    configuredSources = null;\r\n    if (save) {\r\n      setStoreItem('configuration-manual', JSON.stringify(configuration));\r\n    }\r\n    configuration['manual'] = true;\r\n  }\r\n\r\n  function updateMeetingInfo() {\r\n    logger.info('Force meeting info update');\r\n    office.getLocation().then(function (res) {\r\n      office.setLocation(res);\r\n    }, function (err) {\r\n      logger.error('Force meeting info update error: ', Log.getErrInfo(err));\r\n    })\r\n  }\r\n\r\n  function resetConfiguration() {\r\n    configuration = { };\r\n    configuredSources = null;\r\n    delStoreItem('configuration');\r\n    delStoreItem('configuration-manual');\r\n  }\r\n\r\n  function getConfiguredSources(force) {\r\n    if (force || !configuredSources) {\r\n      getConfiguration(force);\r\n      configuredSources = [];\r\n      var srcConfigs = { };\r\n      srcConfigs[SOURCE_ROOMS] = roomsConfig;\r\n      srcConfigs[SOURCE_SPACES] = spacesConfig;\r\n      Object.getOwnPropertyNames(srcConfigs).forEach(function (source) {\r\n        try {\r\n          var isValid = srcConfigs[source].isValid(configuration);\r\n          logger.info(source + ' configuration validation: ' + isValid);\r\n          if (isValid) {\r\n            configuredSources.push(source);\r\n          }\r\n        } catch (err) {\r\n          logger.error(source + ' configuration validation error: ', Log.getErrInfo(err));\r\n        }\r\n      });\r\n\r\n      logger.info('Use configured sources: [ ' + configuredSources.toString() + ' ]');\r\n      if (configuredSources.length === 0) {\r\n        // configuredSources = null; // need retry???\r\n        throw new Error('nosources');\r\n      }\r\n    } else {\r\n      logger.info('Use cached configured sources');\r\n    }\r\n    return configuredSources;\r\n  };\r\n\r\n  function setSpacesOpt(spaces, cfg) {\r\n    if (!cfg) {\r\n      getConfiguration();\r\n      cfg = configuration;\r\n    }\r\n    var spacesUri = cfg['AVAYA_CLOUD_SPACES_API_URI'] || cfg['AVAYA_CLOUD_SPACES_URI'];\r\n    if (spacesUri) {\r\n      spacesUri = spacesUri.replace('spaces.zang.io', 'spacesapis.zang.io');\r\n      spaces.setOpt({ url: spacesUri });\r\n    }\r\n  };\r\n\r\n function getMeetingInfo(opt) {\r\n    var getInfo = [];\r\n    if (opt.location) {\r\n      getInfo.push(office.getLocation());\r\n    }\r\n    if (opt.body) {\r\n      var type = opt.type || '';\r\n      getInfo.push(office.getDescription(type));\r\n    }\r\n    return Promise.all(getInfo);\r\n  };\r\n\r\n  function extractMeetingInfo(extractor) {\r\n    logger.info('extractMeetingInfo extractor: ' + extractor);\r\n    var sources;\r\n    var languageId = 'en'; // default languageId\r\n    return office.checkOffice().then(function () { // catch office.initialized flag\r\n      ////sources = getConfiguredSources(true);\r\n      ////if (sources.indexOf(SOURCE_SPACES) > 0) {\r\n      ////  sources = sources.slice(0);\r\n      ////  sources = sources.splice(sources.indexOf(SOURCE_SPACES), 1).concat(sources); // set spaces extractor first\r\n      ////}\r\n      sources = KNOWN_SOURCES;\r\n      logger.info('extractMeetingInfo sources: [ ' + sources.join(', ') + ' ]');\r\n      languageId = office.getLanguageSync() || languageId;\r\n      return i18n.loadI18n(languageId);\r\n    }).then(function(r) { // languageId\r\n      languageId = r;\r\n      var getters = [office.getLocation(), office.getDescription('')];\r\n      if (office.webAPI) {\r\n        getters.push(office.getDescription('html'));\r\n      }\r\n      return Promise.all(getters);\r\n    }).then(function (r) {\r\n      var location = r[0];\r\n      var bodyText = r[1];\r\n      var bodyHtml = r[2];\r\n      var extractors = [ ];\r\n      ////sources.forEach(function (name) {\r\n      ////  switch (name) {\r\n      ////    case SOURCE_SPACES:\r\n            setSpacesOpt(spaces);\r\n            extractors.push(spaces[extractor](bodyText));\r\n      ////      break;\r\n      ////    case SOURCE_ROOMS:\r\n            extractors.push(rooms[extractor](JSON.stringify(getConfiguration()), languageId, location, office.webAPI ? bodyHtml : bodyText));\r\n      ////      break;\r\n      ////  }\r\n      ////});\r\n      return Promise.all(extractors);\r\n    }).then(function (r) {\r\n      var result = [];\r\n      for (var i = 0; i < sources.length; i++) {\r\n        result.push({ source: sources[i], info: r[i]});\r\n      }\r\n      return Promise.resolve(result);\r\n    });\r\n  }\r\n\r\n  function extractMeetingInfoNative() {\r\n    logger.info('extractMeetingInfoNative');\r\n    return extractMeetingInfo('getInviteInfo').then(function (r) {\r\n      logger.info('extractMeetingInfoNative meetings: [ ' + r.map(function (info) { return JSON.stringify(info); }).join(', ') + ' ]');\r\n      for (var i = 0; i < r.length; i++) {\r\n        var info = r[i].info;\r\n        if (info && info.type !== 'empty') {\r\n           info.type = info.type || r[i].source;\r\n           info.isHost = typeof(info.isHost) === 'undefined' ? true : info.isHost;\r\n           return info;\r\n        }\r\n      }\r\n    }).catch (function (err) {\r\n      logger.error('extractMeetingInfoNative error: ', Log.getErrInfo(err));\r\n    }).then(function (info) { // finally\r\n      info = info || { };\r\n      info = { url: info.url || '', dial: info.dial || '', room: info.room || '', pin: info.pin || '', isHost: info.isHost || false, type: info.type || 'empty' };\r\n      logger.info('extractMeetingInfoNative, info: ' + JSON.stringify(info));\r\n      office.invokeCallback('meetingInfo', info);\r\n    });\r\n  }\r\n\r\n  function getJoinMeetingUrl() {\r\n    return extractMeetingInfo('getInviteUrl').then(function (r) {\r\n      logger.info('getJoinMeetingUrl urls: [ ' + r.map(function (info) { return JSON.stringify(info); }).join(', ') + ' ]');\r\n      for (var i = 0; i < r.length; i++) {\r\n        var url = r[i].info;\r\n        if (url) {\r\n          var source = r[i].source;\r\n          logger.info('getJoinMeetingUrl url: ' + url + ', source: ' + source);\r\n          return Promise.resolve({ source: source, url: url });\r\n        }\r\n      }\r\n      throw new Error('nomeetingurl');\r\n    }).catch (function (err) {\r\n      logger.error('getJoinMeetingUrl error: ' + Log.getErrInfo(err));\r\n      return Promise.resolve();\r\n    });\r\n  }\r\n\r\n  window.extractMeetingInfoNative = extractMeetingInfoNative;\r\n\r\n  function clear() {\r\n    configuration = null;\r\n    configuredSources = null;\r\n  }\r\n\r\n  document.title = 'bkgLoaded';\r\n\r\n  module.exports = {\r\n    getConfiguration: getConfiguration,\r\n    setConfiguration: setConfiguration,\r\n    resetConfiguration: resetConfiguration,\r\n    getConfiguredSources: getConfiguredSources,\r\n    updateMeetingInfo: updateMeetingInfo,\r\n    setSpacesOpt: setSpacesOpt,\r\n    getMeetingInfo: getMeetingInfo,\r\n    getJoinMeetingUrl: getJoinMeetingUrl,\r\n    clear: clear\r\n  };\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./invite.js\n// module id = 18\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var partyType = {\r\n    member: 'member',\r\n    guest: 'guest'\r\n  };\r\n\r\n  module.exports = partyType;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/parties/types.js\n// module id = 19\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Event = require('/lib/jsl/event');\r\n  var Promise = require('/lib/jsl/promise');\r\n  var PromiseCancel = require('/lib/jsl/promise.cancel');\r\n  var Utils = require('/lib/jsl/utils');\r\n  \r\n  var OAuth = require('/lib/jsl/id/oauth');\r\n  //var OAuthGeneric = require('/lib/jsl/id/oauth.provider');\r\n  var OAuthGoogle = require('/lib/jsl/id/oauth.provider.google');\r\n  var OAuthSalesforce = require('/lib/jsl/id/oauth.provider.salesforce');\r\n  var OAuthEsna = require('/lib/jsl/id/oauth.provider.esna');\r\n  var OAuthMicrosoft = require('/lib/jsl/id/oauth.provider.microsoft');\r\n\r\n  var OnEsna = require('../onesna/model');\r\n\r\n  var channel = require('../channel/model');\r\n\r\n  var schema = require('./schema');\r\n  var states = require('./states'); \r\n  \r\n  function updateState(identity, account, state) {\r\n    if (account.state !== state) {\r\n      Utils.showLogInfo('Identity: model.updateState', { account: account, state: state });\r\n      account.state = state;\r\n      identity.onAccount.dispatch(account);\r\n    }\r\n  }\r\n  function cancelCommand(pending, id) {\r\n    var p = pending[id];\r\n    if (!p) {\r\n      return Promise.resolve();\r\n    }\r\n    delete pending[id];\r\n    // return p.cancel();\r\n    p.cancel();\r\n    return p;\r\n  }\r\n\r\n  \r\n  /** @constructor */\r\n  function Identity() {\r\n    this.accounts = {};\r\n    this.pending = {};\r\n    this.tokens = {};\r\n\r\n    this.onesna = new OnEsna();\r\n\r\n    this.onAccount = new Event();\r\n    this.onAccounts = new Event();\r\n\r\n    this.onPrimary = new Event();\r\n\r\n    channel.onConnect.addListener(this.evConnect, this);\r\n  }\r\n  Identity.prototype._schema = schema;\r\n  Identity.prototype.state = states;\r\n  Identity.prototype.providers = { google: OAuthGoogle, esna: OAuthEsna, salesforce: OAuthSalesforce, microsoft: OAuthMicrosoft };\r\n\r\n  Identity.prototype.init = function (opt) {\r\n    this.oauth = new OAuth({ key: opt.app, allowSave: opt.allowSave });\r\n    var items = opt.providers || [];\r\n    \r\n    for (var i = 0; i < items.length; i++) {\r\n      var item = items[i];\r\n      var provider = new item.provider();\r\n      provider.init(item);\r\n      this.oauth.registerProvider(provider);\r\n    }\r\n  };\r\n  Identity.prototype.shut = function () {\r\n    this.logout();\r\n  };\r\n\r\n    \r\n  Identity.prototype.evConnect = function (portInfo) {\r\n    if (portInfo.id) {\r\n      this.onAccounts.dispatch(portInfo.id, this.accounts);\r\n    }\r\n  };\r\n\r\n  // login  \r\n  Identity.prototype.login = function (opt) {\r\n    if (!this.oauth) { // not initialized yet... (init moved from loading to get ready storage in Office case)\r\n      var providers = service.providers;\r\n      var accountsUrls = opt.accountsUrls || { };\r\n      service.init({\r\n        app: 'zangAgenda',\r\n        allowSave: true,\r\n        providers: [\r\n          // onesna\r\n          { primary: true, provider: providers.esna, client: { clientUrl: 'https://manage1.esna.com/oauth/token.redirect', clientId: '7edbde34c699f670da574d047a6d409bb74d7cfad40980d3a3d1826495548428', clientSecret: '7375341cc70b0bb02463ca2ad78782a2' }, accountsUrl: accountsUrls.esna },\r\n          // google\r\n          { primary: false, provider: providers.google, client: { clientUrl: 'https://manage1.esna.com/oauth/token.redirect', clientId: '132802444345-nni4g5350ou4afgddedcc4shofjbja70.apps.googleusercontent.com' /*clientSecret: 'HZHq0ZAzmzijXsXmSo7IQBE3'*/ } },\r\n          // office 365\r\n          //{ primary: false, provider: providers.microsoft, client: { clientUrl: 'https://manage1.esna.com/oauth/token.redirect', clientId: '472976097227.apps.googleusercontent.com' /*clientSecret: 'eXC0s4A36ONswicIvN8HNws_'*/ } },\r\n          // salesforce\r\n          //{ primary: false, provider: providers.salesforce, client: { clientUrl: 'https://manage1.esna.com/oauth/token.redirect', clientId: '472976097227.apps.googleusercontent.com' /*clientSecret: 'eXC0s4A36ONswicIvN8HNws_'*/ } },\r\n        ],\r\n        accountsUrls: opt.accountsUrls || { }\r\n      });\r\n    }\r\n    opt = opt || {};\r\n    return this.createAccount({ type: this.providers.esna.clientType, primary: true, scopes: ['https://www.onesna.com/auth/logan'], accountsUrl: (opt.accountsUrls || { }).esna, noui: opt.noui, asyncui: opt.asyncui, logout: opt.logout, token: opt.token });\r\n  };\r\n  // Logout\r\n  Identity.prototype.logout = function () {\r\n    Utils.showLogInfo('Identity: model.logout');\r\n    this.onesna.shut();\r\n    if (this.oauth) {\r\n      this.oauth.storage.clear();\r\n      return this.removeAccount({ primary: true });\r\n    } else {\r\n      return Promise.resolve();\r\n    }\r\n  };\r\n\r\n  // get token\r\n  Identity.prototype.getToken = function (opt) {\r\n    Utils.showLogInfo('Identity: model.getToken', opt);\r\n    var id = opt.primary ? 'primary' : (opt.id || ('' + Date.now()));\r\n    var account = this.accounts[id];\r\n    if (account) {\r\n      if (account.state !== states.Authorized) { // exclude state switch if Authorized (due to periodic poll requests)\r\n        updateState(this, account, states.Authorizing);\r\n      }\r\n      if (this.pending[id]) {\r\n        return this.pending[id];\r\n      }\r\n    } else {\r\n      var err = { error: { noitem: true } };\r\n      Utils.showLogInfo('Identity: model.getToken reject', err);\r\n      return Promise.reject(err);\r\n    }\r\n    \r\n    var token = this.tokens[account.id];\r\n    if (token) {\r\n      var dtn = Date.now();\r\n      token = token.token;\r\n      \r\n      if (token && (dtn < (token.expiry - 60000))) {\r\n        Utils.showLogInfo('Identity: model.getToken resolve', token);\r\n        return Promise.resolve(token);\r\n      }\r\n    }\r\n\r\n    var pc = new PromiseCancel();\r\n    var args = { type: account.info.type, primary: opt.primary, login: true, noui: true, userId: account.info.user, scopes: account.info.scopes, cancelToken: pc.token };  \r\n    var self = this;\r\n    \r\n    var cmd = this.oauth.getToken(args);\r\n    // var pending = this.pending[id] = pc.exec(cmd);\r\n    var pending = this.pending[id] = pc.exec(cmd).then(function (res) {\r\n      Utils.showLogInfo('Identity: model.getToken resolved', res);\r\n      delete self.pending[account.id];\r\n      self.tokens[account.id] = res;\r\n      updateState(self, account, states.Authorized);\r\n      Utils.showLogInfo('Identity: model.getToken resolve', res.token);\r\n      return Promise.resolve(res.token);\r\n    }, function (err) {\r\n      Utils.showLogInfo('Identity: model.getToken rejected', err);\r\n      delete self.pending[account.id];\r\n      delete self.tokens[account.id];\r\n\r\n      if (account.primary) {\r\n        self.removePrimaryAccount();\r\n      }\r\n      updateState(self, account, states.Unauthorized);\r\n      Utils.showLogInfo('Identity: model.getToken reject', err);\r\n      return Promise.reject(err);\r\n    });\r\n    return pending;\r\n  };\r\n\r\n  // providers\r\n  Identity.prototype.getProviders = function () {\r\n  };\r\n\r\n  // accounts\r\n  Identity.prototype.getPrimaryAccount = function () {\r\n    return this.accounts['primary'];\r\n  };\r\n  Identity.prototype.getAccounts = function () {\r\n    return this.accounts;\r\n  };\r\n\r\n  // account operations\r\n  Identity.prototype.createAccount = function (opt) {\r\n    Utils.showLogInfo('Identity: model.createAccount', opt);\r\n    var id = opt.primary ? 'primary' : (opt.id || ('' + Date.now()));\r\n    var account = this.accounts[id];\r\n    if (account) {\r\n      if (this.pending[id]) {\r\n        return this.pending[id];\r\n      }\r\n    } else {\r\n      var enabled = typeof (opt.enabled) === 'undefined' ? true : opt.enabled;\r\n      account = { id: id, info: { type: opt.type, primary: !!opt.primary, user: opt.user || '', enabled: enabled, scopes: opt.scopes || [] }, state: states.Unknown };\r\n      this.accounts[id] = account;\r\n    }\r\n\r\n    if (!account.info.enabled) {\r\n      updateState(this, account, states.Unauthorized);\r\n      return Promise.reject({ error: { disabled: true } });\r\n    }\r\n\r\n    var pc = new PromiseCancel();\r\n    var args = { type: account.info.type, primary: account.info.primary, login: true, noui: opt.noui, asyncui: opt.asyncui, logout: opt.logout, token: opt.token, userId: account.info.user, scopes: account.info.scopes, cancelToken: pc.token, offline: true };\r\n    var self = this;\r\n    \r\n    updateState(this, account, states.Authorizing);\r\n\r\n    var cmd = this.oauth.getToken(args);\r\n    var pending = this.pending[id] = pc.exec(cmd);\r\n    \r\n    return pending.then(function (res) {\r\n      Utils.showLogInfo('Identity: model.createAccount resolved', res);\r\n      account.info.enabled = true;\r\n      delete self.pending[account.id];\r\n\r\n      if (res.identity) {\r\n        account.info.user = res.identity.email || account.info.user;\r\n      }      \r\n      if (res.userInfo) {\r\n        account.userInfo        = account.userInfo || {};\r\n        account.userInfo.name   = res.userInfo.name;\r\n        account.userInfo.user   = res.userInfo.user;\r\n        account.userInfo.image  = res.userInfo.image;\r\n        account.info.user       = account.info.user || res.userInfo.user;\r\n      }\r\n\r\n      if (!account.info.primary) {\r\n        var ids = Object.getOwnPropertyNames(self.accounts);\r\n        for (var i = 0; i < ids.length; i++) {\r\n          var user = self.accounts[ids[i]];\r\n          if ((user.info.type === account.info.type) && (user.info.user === account.info.user) && (user.id !== account.id)) {\r\n            self.removeAccount({ id: account.id });\r\n            account = user;\r\n          }\r\n        }\r\n      }\r\n\r\n      self.tokens[account.id] = res;\r\n \r\n      if (account.info.primary) {\r\n        self.onesna.init({ sku: '', getToken: self.getToken.bind(self, { primary: true }), accountsUrl: opt.accountsUrl });\r\n        return self.onesna.loadProfileSection('accounts').then(function (r) {\r\n          //self.onesna.saveProfileSection('accounts', []).then(function (r) { }, function (r) { });\r\n\r\n          self.restoreAccounts(r).then(function (r) {\r\n          }, function (e) {\r\n          });\r\n          \r\n          self.onPrimary.dispatch({ connected: true });\r\n          \r\n          updateState(self, account, states.Authorized);\r\n          return res;\r\n        });\r\n      } else {\r\n        self.saveAccounts();\r\n      }\r\n\r\n      updateState(self, account, states.Authorized);\r\n      return Promise.resolve(res);\r\n    }, function (err) {\r\n      Utils.showLogInfo('Identity: model.createAccount rejected', err);\r\n      delete self.pending[account.id];\r\n      delete self.tokens[account.id];\r\n\r\n      if (account.primary) {\r\n        self.removePrimaryAccount();\r\n      } else if (account.info.user) {\r\n        account.info.enabled = false;\r\n        self.saveAccounts();\r\n      } else {\r\n        self.removeAccount(account);\r\n        return Promise.reject(err);\r\n      }\r\n      \r\n      updateState(self, account, states.Unauthorized);\r\n      return Promise.reject(err);\r\n    });\r\n  };\r\n  \r\n  Identity.prototype.updateAccount = function (opt) {\r\n    Utils.showLogInfo('Identity: model.getToken updateAccount', opt);\r\n    var account = this.accounts[opt.id];\r\n    if (!account) {\r\n      return Promise.reject({ error: { noitem: true } });\r\n    }\r\n\r\n    if (opt.enabled && !account.info.enabled) {\r\n      account.info.enabled = true;\r\n      account.state = states.Unknown;\r\n      updateState(this, account, states.Unauthorized);\r\n      return this.createAccount({ id: opt.id, noui: false });\r\n    } else if (!opt.enabled && account.info.enabled) {\r\n      account.info.enabled = false;\r\n      account.state = states.Unknown;\r\n      delete this.tokens[account.id];\r\n      updateState(this, account, states.Unauthorized);\r\n      this.saveAccounts();\r\n      return cancelCommand(this.pending, account.id);\r\n    }\r\n\r\n    updateState(this, account, account.state);\r\n    return Promise.resolve(account);\r\n  };\r\n  \r\n  Identity.prototype.removeAccount = function (opt, logout) {\r\n    Utils.showLogInfo('Identity: model.removeAccount', {opt: opt, logout: logout });\r\n    var id, account;\r\n    if (opt.primary) {\r\n      return this.removePrimaryAccount();\r\n    }\r\n\r\n    id = opt.id;    \r\n    account = this.accounts[id];\r\n    if (!account) {\r\n      return Promise.reject({ error: { noitem: true } });\r\n    }\r\n    \r\n    Utils.showLogInfo('Identity: model.removeAccount delete', account);\r\n    delete this.accounts[id];\r\n    account.deleted = true;\r\n    account.state = states.Unknown;\r\n\r\n    updateState(this, account, states.Unauthorized);\r\n    if (!logout) {\r\n      this.saveAccounts();\r\n    }\r\n\r\n    var args = { type: account.info.type, primary: account.info.primary, userId: account.info.user };  \r\n    this.oauth.logout(args);\r\n\r\n    return cancelCommand(this.pending, id);\r\n  };\r\n  Identity.prototype.removePrimaryAccount = function () {\r\n    Utils.showLogInfo('Identity: model.removePrimaryAccount');\r\n    this.onPrimary.dispatch({ connected: false });\r\n    \r\n    var id, account, primary;\r\n    var keys = Object.getOwnPropertyNames(this.accounts);\r\n    for (var i = 0; i < keys.length; i++) {\r\n      id = keys[i];\r\n      account = this.accounts[id];\r\n      if (!account.info.primary) {\r\n        this.removeAccount(account, true).then(function () { });\r\n      } else {\r\n        primary = account;\r\n        return this.removeAccount({ id: primary.id }, true);\r\n      }\r\n    }\r\n    return Promise.reject({ error: { noitem: true } }); // ???\r\n  };\r\n\r\n  Identity.prototype.restoreAccounts = function (accounts) {\r\n    if (!accounts) {\r\n      return Promise.resolve({ done: true });\r\n    }\r\n    var item = accounts.shift();\r\n    if (!item) {\r\n      return this.saveAccounts();\r\n    }\r\n    var self = this;\r\n    return this.createAccount({ user: item.user, type: item.type, enabled: item.enabled, scopes: item.scopes || [] }).then(function (r) {\r\n      r = r;\r\n      self.restoreAccounts(accounts);\r\n    }, function (e) {\r\n      e = e;\r\n      self.restoreAccounts(accounts);\r\n    });\r\n  };\r\n  \r\n  Identity.prototype.saveAccounts = function () {\r\n    var items = Object.getOwnPropertyNames(this.accounts);\r\n    var p = [];\r\n    for (var i = 0; i < items.length; i++) {\r\n      var item = items[i];\r\n      item = this.accounts[item];\r\n      \r\n      if (item && !item.info.primary) {\r\n        var info = { type: item.info.type, enabled: item.info.enabled, user: item.info.user, scopes: item.info.scopes };\r\n        if (info.user) {\r\n          p.push(info);\r\n        }\r\n      }\r\n    }\r\n    return this.onesna.saveProfileSection('accounts', p);\r\n  };\r\n\r\n\r\n  var service = new Identity();\r\n\r\n  module.exports = service;\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/identity/model.js\n// module id = 21\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var states = {\r\n    Unknown: 0,\r\n    Unauthorized: 1,\r\n    Authorizing: 2,\r\n    Authorized: 3,\r\n    Unauthorizing: 4,\r\n    LicenseCheck: 5,\r\n    AcceptLicense: 6,\r\n    LoadProfile: 7\r\n  };\r\n\r\n  module.exports = states;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/identity/states.js\n// module id = 22\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var Base = require('/lib/jsl/base');\r\n  var Log = require('/lib/jsl/log');\r\n\r\n  var logger = Log.createLogger('API');\r\n\r\n  function API(serverBase) {\r\n    this.serverBase = serverBase;\r\n  }\r\n  \r\n  API.prototype._prepareValue = function (def, value) {\r\n    var flags = def.flags;\r\n    if (typeof(value) === 'undefined') {\r\n      value = def.default;\r\n    }\r\n    \r\n    for (var i = 0; i < flags.length; i++) {\r\n      var flag = flags[i];\r\n      switch (flag) {\r\n        case 's':\r\n          // if (typeof(value) !== 'string') {\r\n          //   logger.warn(def.key + ': should be valid string');\r\n          // }\r\n          if (typeof(value) !== 'undefined') {\r\n            value = '' + value;\r\n          }\r\n          break;\r\n        case 'S':\r\n          // if (typeof(value) !== 'string') {\r\n          //   logger.warn(def.key + ': should be valid string');\r\n          // }\r\n          if (typeof(value) !== 'undefined') {\r\n            value = '' + value;\r\n            // if (value.length === 0) {\r\n            //   logger.warn(def.key + ': should be non-empty string');\r\n            // }\r\n          }\r\n          break;\r\n        case 'b':\r\n          // if (typeof(value) !== 'boolean') {\r\n          //   logger.warn(def.key + ': should be valid boolean');\r\n          // }\r\n          break;\r\n        case 'B':\r\n          // if (typeof(value) !== 'string') {\r\n          //   logger.warn(def.key + ': should be base64 string');\r\n          // }\r\n          if (value) {\r\n            value = atob(value);\r\n          }\r\n          value = value || '';\r\n          break;\r\n        case 'i':\r\n          if (typeof(value) !== 'number') {\r\n            // logger.warn(def.key + ': should be valid number');\r\n            value = 0 | value;\r\n          }\r\n          break;\r\n        case 'e':\r\n          // if (typeof(value) !== 'string') {\r\n          //   logger.warn(def.key + ': should be valid string');\r\n          // }\r\n          break;\r\n        case 'r':\r\n          // if (typeof(value) === 'undefined') {\r\n          //   logger.error(def.key + ': value is required');\r\n          // }\r\n          break;\r\n        case 'D':\r\n          // if (typeof(value) !== 'string') {\r\n          //   logger.warn(def.key + ': should be valid string');\r\n          // }\r\n          break;\r\n      }\r\n    }\r\n\r\n    if (def.format && (typeof(value) !== 'undefined')) {\r\n      value = def.format.replace(/\\$0/ig, value);\r\n    }\r\n\r\n    return value;\r\n  };\r\n  API.prototype._prepareArgs = function (command, args) {\r\n    var argsDefs = command.args;\r\n    var argsKeys = Object.getOwnPropertyNames(argsDefs);\r\n\r\n    var self = this;\r\n    return argsKeys.reduce(function (res, key) {\r\n      var def = argsDefs[key];\r\n      res[def.key] = self._prepareValue(def, args[key]);\r\n      return res;\r\n    }, { });\r\n  };\r\n  API.prototype._extractVars = function (template) {\r\n    var re = /\\$\\([^\\)]*\\)/ig;\r\n    for (var items = {}, m; !!(m = re.exec(template)); ) {\r\n      items[m[0]] = 1;\r\n    }\r\n    return Object.getOwnPropertyNames(items);\r\n  };\r\n  API.prototype._replaceAll = function (s, f, r) {\r\n    var re = new RegExp(f.replace(/([^a-z0-9])/ig, '\\\\$1'), 'ig');\r\n    return s.replace(re, r);\r\n  };\r\n  API.prototype._substitute = function (template, args) {\r\n    if (!template) {\r\n      return null;\r\n    }\r\n\r\n    var self = this;\r\n    var keys = Object.getOwnPropertyNames(template);\r\n    return keys.reduce(function (res, key) {\r\n      var t = template[key];\r\n      res[key] = self._extractVars(t).reduce(function (r, key) {\r\n        var v = args[key];\r\n        if (r === key) {\r\n          return v;\r\n        }\r\n        return self._replaceAll(r, key, v);\r\n      }, t);\r\n      if (typeof(res[key]) === 'undefined') {\r\n        delete res[key];\r\n      }\r\n      return res;\r\n    }, { });\r\n  };\r\n  API.prototype._extractData = function (schema, data, index) {\r\n    var self = this;\r\n    var keys = Object.getOwnPropertyNames(schema);\r\n    return keys.reduce(function (res, key) {\r\n      if (typeof(res) === 'undefined') {\r\n        return;\r\n      }\r\n\r\n      var def = schema[key];\r\n\r\n      if (Array.isArray(def)) {\r\n        res[key] = [];\r\n        var item, ndx = 0;\r\n        while (!!(item = self._extractData(def[0], data, ndx++))) {\r\n          res[key].push(item);\r\n        }\r\n      } else if (def.$v) {\r\n        res[key] = self._extractData(def.$v, data);\r\n      } else {\r\n        var path = def.key.replace(/\\.\\#\\./ig, '.' + index + '.').split('.');\r\n\r\n        var c = data;\r\n        for (var j = 0; j < path.length; j++) {\r\n          c = c[path[j]];\r\n          if (typeof(c) === 'undefined') {\r\n            if (('' + index) === path[j]) {\r\n              return;\r\n            }\r\n            break;\r\n          }\r\n        }\r\n        c = self._prepareValue(def, c);\r\n        if (typeof (c) !== 'undefined') {\r\n          res[key] = c;\r\n        }\r\n      }\r\n\r\n      return res;\r\n    }, {});\r\n  };\r\n\r\n  API.prototype._exec = function (command, args) {\r\n    var _args = this._prepareArgs(command, args);\r\n\r\n    var _body = this._substitute(command.body, _args);\r\n    var _hdrs = this._substitute(command.headers, _args);\r\n    var _uri  = this._substitute({ uri: command.uri }, _args);\r\n\r\n    var uri  = this.serverBase + _uri.uri;\r\n    var hdrs = _hdrs || {};\r\n    var body = null;\r\n    if (command.headers['content-type'] === 'application/x-www-form-urlencoded') {\r\n      body = Object.getOwnPropertyNames(_body).reduce(function (r, key) {\r\n        r.push(key + '=' + _body[key]);\r\n        return r;\r\n      }, []).join('&');\r\n    } else {\r\n      body = _body ? JSON.stringify(_body) : null;\r\n    }\r\n\r\n    var opt = { method: command.method, mode: 'cors', headers: hdrs || {}, body: body };\r\n    if (!body) {\r\n      delete opt.body;\r\n    }\r\n\r\n    var self = this;\r\n    logger.info('fetch: ' + uri);\r\n    return fetch(uri, opt).then(function (r) {\r\n      logger.info('fetch:result: ' + r.ok);\r\n      if (!r.ok) {\r\n        throw { error: { httpStatus: r.status, httpStatusText: r.statusText }};\r\n      }\r\n      return r.json();\r\n    }, function (e) {\r\n      logger.error('fetch:error: ' + e.message);\r\n      throw { error: { fetch: true }};\r\n    }).then(function (r) {\r\n      logger.info('fetch:payload: ' + JSON.stringify(r));\r\n      var res = self._extractData(command.response, r);\r\n      return res;\r\n    });\r\n  };\r\n\r\n  module.exports = Base.extend(API);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/api/api.js\n// module id = 23\n// module chunks = 0 1","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/global.js\n// module id = 24\n// module chunks = 0 1 2","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  function reverse(context, key) {\r\n    context.reverse[context.direct[key]] = key;\r\n    return context;\r\n  }\r\n  function applyProperty(context, key) {\r\n    var _key = context.map[key];\r\n    if (_key) {\r\n      var val = context.src[key];\r\n      if (typeof (val) !== 'undefined') {\r\n        context.dst[_key] = val;\r\n      }\r\n    }\r\n    return context;\r\n  }\r\n\r\n  /** @constructor */  \r\n  function LiteralMap(map) {\r\n    this.direct = map;\r\n    this.reverse = {};\r\n    Object.getOwnPropertyNames(map).reduce(reverse, this);\r\n  }\r\n  LiteralMap.prototype.mapDirect = function (src, dst) {\r\n    return Object.getOwnPropertyNames(src).reduce(applyProperty, { dst: dst || { }, src: src, map: this.direct }).dst;\r\n  };\r\n  LiteralMap.prototype.mapReverse = function (src, dst) {\r\n    return Object.getOwnPropertyNames(src).reduce(applyProperty, { dst: dst || { }, src: src, map: this.reverse }).dst;\r\n  };\r\n\r\n  module.exports = LiteralMap;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/maps/literal.js\n// module id = 25\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var globals = require('./globals');\r\n  \r\n  function hex(v) {\r\n    var n = Math.abs(v).toString(16);\r\n    return (n.length === 1) ? '0' + n : n;\r\n  }\r\n  function toUid(v) {\r\n    var r = Array.prototype.map.call(v, hex);\r\n    return r.join('').toUpperCase();\r\n  }\r\n  function toHex(s) {\r\n    var r = [];\r\n    for (var i = 0; i < s.length; i++) {\r\n      r.push(hex(s.charCodeAt(i)));\r\n    }\r\n    return r.join('');\r\n  }\r\n  function formatUid(uid) {\r\n    var s = '';\r\n    for (var i = 0; i < uid.length; i++) {\r\n      s += hex(uid[i]);\r\n      if ((i === 5) || (i === 7) || (i === 9) || (i === 11)) {\r\n        s += '-';\r\n      }\r\n    }\r\n    return s.toUpperCase();\r\n  }\r\n  function getUid() {\r\n    var r;\r\n    var crypto = globals.safeProp('crypto', { });\r\n    if (globals.hasKey('getRandomValues', crypto)) {\r\n      r = crypto.getRandomValues(new Int8Array(16));\r\n    }\r\n    if (!r) {\r\n      r = [];\r\n      for (var i = 0; i < 16; i++) {\r\n        r.push(Math.ceil(Math.random() * 255));\r\n      }\r\n    }\r\n    return r;\r\n  }\r\n\r\n  function Guid(r) {\r\n    this.guid = r;\r\n  }\r\n  Guid.prototype.toString = function () {\r\n    return formatUid(this.guid);\r\n  };\r\n  Guid.NewGuid = function () {\r\n    return new Guid(getUid());\r\n  };\r\n  \r\n  module.exports = Guid;\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/guid.js\n// module id = 26\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  /** @constructor */\r\n  function SrcConfig() {\r\n  }\r\n\r\n  SrcConfig.prototype.isValid = function(configuration) {\r\n    return !!configuration['UNIFIEDPORTALENABLED'] ||\r\n      !!configuration['CONFERENCE_MODERATOR_URL'] ||\r\n      !!configuration['CONFERENCE_PARTICIPANT_URL'];\r\n  };\r\n\r\n  module.exports = new SrcConfig();\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./sources/rooms/srcconfig.js\n// module id = 27\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var office = require('../../office');\r\n\r\n  /** @constructor */\r\n  function SrcConfig(configuration) {\r\n  }\r\n\r\n  function checkMinVersion(version, major, minor) {\r\n    console.info('checkMinVersion:', version, major, minor);\r\n    if (!version || typeof(version) !== 'string') {\r\n      return false;\r\n    }\r\n    var nums = version.split('.').map(function (num) {\r\n      return parseInt(num);\r\n    });\r\n    var numMajor = nums[0] || 0;\r\n    if (major < numMajor) {\r\n      return true;\r\n    }\r\n    if (major > numMajor) {\r\n      return false;\r\n    }\r\n    if (major < numMajor) {\r\n      return true;\r\n    }\r\n    var numMinor = nums[1] || 0;\r\n    return minor <= numMinor;\r\n  }\r\n\r\n  SrcConfig.prototype.isValid = function(configuration) {\r\n    // uncomment before 3.4 release\r\n    if (true) {\r\n    // if (office.webAPI || checkMinVersion(office.apiVersion, 3, 4)) { // check apiVersion major/minor\r\n      // this is deprecated but was referenced in SRAD\r\n      //var eac = configuration['ENABLE_AVAYA_CLOUD'];\r\n      //if (typeof(eac) === 'undefined') {\r\n      //  eac = true;\r\n      //}\r\n\r\n      // this is new way of zang enablement control\r\n      var eaca = configuration['ENABLE_AVAYA_CLOUD_ACCOUNTS'];\r\n      if (typeof(eaca) === 'undefined') {\r\n        eaca = true;\r\n      }\r\n\r\n      if (eaca) {\r\n        // SRAD change Feb 01 2018\r\n        var acl = configuration['AVAYA_CLOUD_LOGIN_ID'];\r\n        if ((typeof(acl) === 'undefined') || !!acl) {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  };\r\n\r\n  module.exports = new SrcConfig();\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./sources/spaces/srcconfig.js\n// module id = 28\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise = require('/lib/jsl/promise');\r\n  var Storage = require('/lib/jsl/storage');\r\n  var Log     = require('/lib/jsl/log');\r\n\r\n  var RoomsSettings = require('./settings');\r\n  var RoomsAPI = require('./api');\r\n  var TOM = require('./tom');\r\n  var Templates = require('./templates');\r\n\r\n  var logger = Log.createLogger('ROOMS');\r\n\r\n  function Rooms() {\r\n    this.rooms = {};\r\n  }\r\n\r\n  Rooms.prototype.setConfig = function (config) {\r\n    logger.info('setConfig, refresh: ' + config.forceRefresh);\r\n    this.config = config;\r\n    this.config.cacheKey = 'rooms.v2';\r\n    \r\n    var portalInfo = this._extractPortalInfo(this.config.portalUri);\r\n    this.config.serverBase = portalInfo.serverBase;\r\n    this.config.tenantId = portalInfo.tenantId;\r\n\r\n    this.config.conferenceRoomName = 'Default';\r\n    if (this.config.conferenceType === 'aac') {\r\n      this.config.conferenceRoomName = this.i18n.aacRoomName || 'Default AAC';\r\n      this.config.locationFormatConference = '$(bridgeNumber),,,$(room), $(conferenceJoinUrl)';\r\n    } else if (this.config.conferenceType === 'ipo') {\r\n      this.config.conferenceRoomName = this.i18n.ipoRoomName || 'Default IP Office';\r\n      this.config.locationFormatConference = '$(bridgeNumber),,,$(room), $(conferenceJoinUrl)';\r\n    }\r\n\r\n    this.config.locationFormatEquinox = '$(portalJoinUrl)$(room)$(pinE164)';\r\n\r\n    if (this.config.forceRefresh) {\r\n      this._updateTokenInfo(null);\r\n      this._updateCachedRooms(null);\r\n    }\r\n    this.roomsAPI = new RoomsAPI(config.serverBase);\r\n  };\r\n\r\n  Rooms.prototype.configure = function (configuration, languageId, i18n) {\r\n    if (this.config) {\r\n      return Promise.resolve(this.config);\r\n    }\r\n    logger.info('configure, languageId: ' + languageId);\r\n    this.i18n = i18n || this.i18n || { };\r\n    var self = this;\r\n    return RoomsSettings.getAPIConfig(configuration, languageId).then(function (config) {\r\n      self.setConfig(config);\r\n      return Promise.resolve(config);\r\n    });\r\n  };\r\n\r\n  Rooms.prototype._safeJSONParse = function (s) {\r\n    try {\r\n      return JSON.parse(s);\r\n    } catch (e) {\r\n      return {};\r\n    }\r\n  };\r\n\r\n  Rooms.prototype._extractPortalInfo = function (url) {\r\n    var re = /(https?\\:\\/\\/)?([^\\/\\:]*):?([0-9]*)?\\/?(.*tenants\\/([^\\/]*))?/i;\r\n    var m = re.exec(url);\r\n    var proto = m[1] || 'https://';\r\n    var server = m[2];\r\n\r\n    var port = m[3] || '443';\r\n    port = (port === '443') ? '' : ':' + port;\r\n\r\n    var tenantId = m[5] || 'default';\r\n      return { serverBase: proto + server + port, tenantId: tenantId };\r\n  };\r\n\r\n  Rooms.prototype._fetchTokenInfo = function () {\r\n    var key = 'token:' + this.config.user;\r\n    var stokenInfo = Storage.getItem(key);\r\n    logger.info('token, use cached token ' + key + ':' + stokenInfo);\r\n    var tokenInfo = stokenInfo ? this._safeJSONParse(stokenInfo) : null;\r\n    return tokenInfo; // comment this to skip token check & refresh\r\n    var dtn = Date.now();\r\n    if (tokenInfo && (tokenInfo.expires || 0) - dtn < 60 * 1000) {\r\n      logger.info('token, expired cached token ' + key + ':' + stokenInfo);\r\n      tokenInfo = null;\r\n      this._updateTokenInfo(null);\r\n    }\r\n    return tokenInfo;\r\n  };\r\n  Rooms.prototype._updateTokenInfo = function (info) {\r\n    var key = 'token:' + this.config.user;\r\n    if (!info) {\r\n      if (Storage.getItem(key)) {\r\n        logger.info('token, remove cached token ' + key);\r\n      }\r\n    } else {\r\n      var stokenInfo = JSON.stringify(info);\r\n      if (Storage.getItem(key) !== stokenInfo) {\r\n        Storage.setItem(key, stokenInfo);\r\n        logger.info('token, update cached token ' + key + ':' + stokenInfo);\r\n      }\r\n    }\r\n  };\r\n\r\n  Rooms.prototype.resources = function (args) {\r\n    args.tenantId = args.tenantId || this.config.tenantId;\r\n    if (args.token && this._infoUser) {\r\n      return Promise.resolve(this._infoUser);\r\n    }\r\n    if (!args.token && this._infoGuest) {\r\n      return Promise.resolve(this._infoGuest);\r\n    }\r\n    logger.info('resources: get API info args: ', Log.getInfo(args));\r\n    var self = this;\r\n    return this.roomsAPI.info(args).then(function (r) {\r\n      logger.info('resources: get API info result (' + (args.token ? 'user' : 'guest') + '):', Log.getInfo(r));\r\n      if (args.token) {\r\n        return (self._infoUser = r);\r\n      }\r\n      return (self._infoGuest = r);\r\n    }, function (e) {\r\n      logger.info('resources: get API info error: ', Log.getErrInfo(e));\r\n      if (args.token) {\r\n        self._updateTokenInfo(null);\r\n        self._infoUser = null;\r\n      } else {\r\n        self._infoGuest = null;\r\n      }\r\n      throw e;\r\n    });\r\n  };\r\n\r\n  Rooms.prototype._login = function (args) {\r\n    var info = this._infoGuest || { };\r\n    var dfd;\r\n    if (info.iwaEnabled) {\r\n      logger.info('login: API loginIWA');\r\n      dfd = self.roomsAPI.loginIWA(args);\r\n    } else {\r\n      dfd = Promise.reject();\r\n    }\r\n    var self = this;\r\n    return dfd.then(function (r) {\r\n      return r;\r\n    }, function () {\r\n    logger.info('login: API login');\r\n    return self.roomsAPI.login(args);\r\n  });\r\n  };\r\n\r\n  Rooms.prototype._getToken = function () {\r\n    var tokenInfo;\r\n    var self = this;\r\n    // always start with resources call\r\n    return this.resources({ }).then(function () {\r\n      tokenInfo = self._fetchTokenInfo(); // allows to skip token check & refresh (see above)\r\n      if (tokenInfo) {\r\n        var args = { tenantId: self.config.tenantId, token: tokenInfo.token, userId: self.config.user, passwordHash: tokenInfo.passwordHash, aliasId: self.config.tenantId };\r\n        // check vaild token or refresh expired one via password hash\r\n        return self.roomsAPI.refreshToken(args).then(function (r) {\r\n          logger.info('getToken: cached token is valid');\r\n          if (tokenInfo.token !== r.token) {\r\n            // store refreshed token\r\n            tokenInfo = { token: r.token, expires: new Date(r.expires).valueOf(), passwordHash: r.passwordHash };\r\n            logger.info('getToken: token refresh result: ', Log.getInfo(tokenInfo));\r\n            self._updateTokenInfo(tokenInfo);\r\n          }\r\n          return Promise.resolve(true); // valid token, no login required\r\n        }, function (e) {\r\n          logger.info('getToken: cached token is invalid, error: ', Log.getErrInfo(e));\r\n          return Promise.resolve(false); // invalid token, try login with user credentials\r\n        })\r\n      } else {\r\n        return Promise.resolve(false); // no token info, try login with user credentials\r\n      }\r\n    }).then( function (r) {\r\n      if (r) {\r\n        return Promise.resolve();\r\n      }\r\n      // perform login\r\n      var args = { userId: self.config.user, password: self.config.password, tenantId: self.config.tenantId, aliasId: self.config.tenantId };\r\n      logger.cred('getToken: login: ' + Log.getInfo(args), args['password']);\r\n      return self._login(args).then(function (r) {\r\n        // store new token\r\n        tokenInfo = { token: r.token, expires: new Date(r.expires).valueOf(), passwordHash: r.passwordHash };\r\n        logger.info('getToken: login result: ', Log.getInfo(tokenInfo));\r\n        self._updateTokenInfo(tokenInfo);\r\n      }, function (e) {\r\n        logger.error('getToken: login error: ', Log.getErrInfo(e));\r\n        self._updateTokenInfo(null);\r\n        return Promise.reject(e, true);\r\n      });\r\n    }).then(function (r) {\r\n      return self.resources({ token: tokenInfo.token });\r\n    }, function (e, f) {\r\n      if (!f) { // just skip already logged errors\r\n        logger.error('getToken: error: ', Log.getErrInfo(e));\r\n      }\r\n      throw e;\r\n    }).then(function () { // should never get here without without valid token\r\n      return tokenInfo.token;\r\n    });\r\n  };\r\n\r\n  Rooms.prototype.login = function () {\r\n    return this._getToken().then(function () {\r\n      return Promise.resolve(); // just to not return token as result\r\n    }, function (err) {\r\n      throw err;\r\n    });\r\n  };\r\n\r\n  Rooms.prototype.logout = function () {\r\n    delete this.config;\r\n    RoomsSettings.clear();\r\n    return Promise.resolve();\r\n  }\r\n\r\n  var _cacheVersion = 20170622;\r\n  Rooms.prototype._fetchCachedRooms = function () {\r\n    var srooms = Storage.getItem(this.config.cacheKey + ':' + this.config.user);\r\n    var rooms = this._safeJSONParse(srooms) || {};\r\n    var dtn = Date.now();\r\n    if ((rooms.expires || 0) - dtn > 60*1000) {\r\n      if (!rooms.version || (rooms.version < _cacheVersion)) {\r\n        return null;\r\n      }\r\n      return rooms;\r\n    }\r\n    return null;\r\n  };\r\n  Rooms.prototype._updateCachedRooms = function (rooms) {\r\n    if (rooms) {\r\n      rooms.expires = Date.now() + 30*60*1000;\r\n      rooms.version = _cacheVersion;\r\n    }\r\n    var srooms = JSON.stringify(rooms || {});\r\n    Storage.setItem(this.config.cacheKey + ':' + this.config.user, srooms);\r\n  };\r\n  \r\n  Rooms.prototype._addConferenceRoom = function (rooms) {\r\n    var url = this.config.conferenceParticipantUrl || this.config.conferenceModeratorUrl || '';\r\n    var pin = this.config.conferenceParticipantPIN || this.config.conferenceModeratorPIN || '';\r\n\r\n    if (!url) {\r\n      logger.info('getRooms: no conference room with empty conference url');\r\n      return rooms;\r\n    }\r\n\r\n    var room = pin || ((/(\\/|participantCode=)([0-9]+)/i.exec(url) || [])[2]) || '';\r\n    this.config.conferenceParticipantPIN = room;\r\n    \r\n    rooms.push({ id: room || 'default', name: this.config.conferenceRoomName, meetingId: room || '', number: room || '', conferenceAccessUrl: url, type: this.config.conferenceType, conferenceAccessNumber: this.config.bridgeNumber, own: true });\r\n\r\n    return rooms;\r\n  };\r\n\r\n  var _delegateMapping = {\r\n    // test ones\r\n    'sergeyv': ['georgeu'],\r\n  };\r\n\r\n  Rooms.prototype.__getRooms = function (args) {\r\n    if (!args._users) {\r\n      var delegateName = this.config.delegateName;\r\n      if (delegateName) {\r\n        args._users = [ delegateName, args.userId ];\r\n      } else {\r\n        args._users = (_delegateMapping[args.userId] || []).concat(args.userId);\r\n      }\r\n    }\r\n\r\n    args.userId = args._users.shift();\r\n\r\n    var self = this;\r\n    logger.info('getRooms: API getRooms');\r\n    return this.roomsAPI.getRooms(args).then(function (r) {\r\n      r.rooms = r.rooms.map(function (room) {\r\n        room.userId = args.userId;\r\n        return room;\r\n      });\r\n\r\n      if (!args._result) {\r\n        args._result = r;\r\n      } else {\r\n        args._result.rooms = args._result.rooms.concat(r.rooms);\r\n      }\r\n\r\n      if (!args._users.length) {\r\n        return args._result;\r\n      }\r\n\r\n      return self.__getRooms(args);\r\n    });\r\n  };\r\n\r\n  Rooms.prototype._getRooms = function (args) {\r\n    logger.info('getRooms: ' + JSON.stringify(args));\r\n    if (this.config.mode !== 'equinox') {\r\n      logger.info('getRooms resolve: no virtual rroms in non-equinox mode');\r\n      return Promise.resolve({ rooms: [] });\r\n    }\r\n\r\n    if (!args.forceFetch) {\r\n      var rooms = this._fetchCachedRooms();\r\n      if (rooms) {\r\n        logger.info('getRooms resolve: cached rooms');\r\n        return Promise.resolve(rooms);\r\n      }\r\n      if (args.cachedOnly) {\r\n        return Promise.resolve({ rooms: [] });\r\n      }\r\n    }\r\n    \r\n    var self = this;\r\n    return this._getToken().then(function (r) {\r\n      args.token = r;\r\n      args.tenantId = self.config.tenantId;\r\n      args.aliasId = self.config.tenantId;\r\n      args.userId = self.config.user;\r\n      return self.__getRooms(args);\r\n    }).then(function (r) {\r\n      self._updateCachedRooms(r);\r\n      logger.info('getRooms resolve: fetched rooms');\r\n      return r;\r\n    }, function (err) {\r\n      logger.error('getRooms error: ' + Log.getErrInfo(err));\r\n      self._updateCachedRooms(null);\r\n      self._updateTokenInfo(null);\r\n      if (!args.retry && (err.error && !(err.error.httpStatus === 400 || err.error.httpStatus === 401))) {\r\n        args.retry = true;\r\n        return self.getRooms(args);\r\n      }\r\n      throw err;\r\n    });\r\n  };\r\n\r\n  Rooms.prototype.getRooms = function (args) {\r\n    var self = this;\r\n    return this._getRooms(args).then(function (r) {\r\n      var rooms = r.rooms.map(function (room) {\r\n        var ruserId = (room.userId || '').toLowerCase();\r\n        var cuserId = (self.config.user || '').toLowerCase();\r\n\r\n        return {\r\n          id: room.id, name: room.name, conferenceAccessNumber: '',\r\n          meetingId: room.number, conferenceAccessUrl: room.url || self.config.portalUri,\r\n          accessPIN: room.accessPIN, type: 'equinox', own: (ruserId === cuserId), userId: room.userId,\r\n        };\r\n      });\r\n      rooms = self._addConferenceRoom(rooms);\r\n\r\n      self.rooms = { };\r\n      rooms.forEach(function (room) {\r\n        self.rooms[room.id] = room;\r\n      });\r\n\r\n      return Promise.resolve(rooms);\r\n    });\r\n  };\r\n\r\n  Rooms.prototype._replaceAll = function (s, f, r) {\r\n    var re = new RegExp(f.replace(/([^a-z0-9])/ig, '\\\\$1'), 'ig');\r\n    return s.replace(re, r);\r\n  };\r\n\r\n  Rooms.prototype._patchDialInfo = function (dialingInfo, args) {\r\n    var bridgeNumber = this.config.bridgeNumber || '';\r\n    var location = args.conference ? this.config.locationFormatConference : this.config.locationFormatEquinox;\r\n    location = this._replaceAll(location, '$(bridgePrefix)', (this.config.bridgePrefix || ''));\r\n    location = this._replaceAll(location, '$(bridgeNumber)', (bridgeNumber || ''));\r\n\r\n    if (args.conference) {\r\n      var room = args.dialableNumber || '';\r\n      if (room && (room[room.length - 1] !== '#')) {\r\n        room += '#';\r\n      }\r\n      location = this._replaceAll(location, '$(room)', room);\r\n\r\n      location = this._replaceAll(location, '$(conferenceJoinUrl)', (this.config.conferenceParticipantUrl || ''));\r\n    } else {\r\n      location = this._replaceAll(location, '$(room)', (args.dialableNumber || ''));\r\n      location = this._replaceAll(location, '$(pinE164)', (args.accessPIN ? '***' + atob(args.accessPIN) : ''));\r\n      location = this._replaceAll(location, '$(pin)', (args.accessPIN ? atob(args.accessPIN) : ''));\r\n\r\n      var portal = this.config.serverBase + '/portal/tenants/' + this.config.tenantId + '/?ID=';\r\n      location = this._replaceAll(location, '$(portalJoinUrl)', (portal || ''));\r\n    }\r\n    if (!bridgeNumber) {\r\n      location = location.substr(location.indexOf('http'));\r\n    }\r\n    location = location.trim();\r\n    dialingInfo.location = location;\r\n\r\n    var numbers = args.conference ? this.config.additionalNumbers : '';\r\n    if (!numbers) {\r\n      return;\r\n    }\r\n\r\n    dialingInfo.dialingInfoText = typeof(dialingInfo.dialingInfoText) === 'undefined' ? '' : (dialingInfo.dialingInfoText + '\\n');\r\n    dialingInfo.dialingInfoHTML  = '<div>' + dialingInfo.dialingInfoHTML;\r\n    dialingInfo.dialingInfoHTML += '<div><br/>';\r\n\r\n    if (args.additionalNumbersTitle) {\r\n      dialingInfo.dialingInfoText += args.additionalNumbersTitle;\r\n      dialingInfo.dialingInfoText += '\\n';\r\n\r\n      dialingInfo.dialingInfoHTML += args.additionalNumbersTitle;   \r\n      dialingInfo.dialingInfoHTML += '<br/>';   \r\n    }\r\n\r\n    numbers.split(',').forEach(function (item) {\r\n      var kv = item.split(':');\r\n      dialingInfo.dialingInfoText += kv[0] + ' ' + kv[1];\r\n      dialingInfo.dialingInfoText += '\\n';\r\n\r\n      dialingInfo.dialingInfoHTML += kv[0] + '&nbsp;' + kv[1];   \r\n      dialingInfo.dialingInfoHTML += '<br/>';\r\n    });\r\n    dialingInfo.dialingInfoHTML += '</div>';\r\n    dialingInfo.dialingInfoHTML += '</div>';\r\n  };\r\n\r\n  Rooms.prototype.getDialInfoCustom = function (args) {\r\n    logger.info('getDialInfoCustom');\r\n    var self = this;\r\n    var type = (args.conference ? 'aac' : 'scopia');\r\n    var langId = self.config.languageId;\r\n    var opt = { html: true, logger: logger, i18n: self.i18n, langId: langId };\r\n    return new Templates(opt).getTemplate(type).then(function (r) {\r\n      var content = r;\r\n      var bridgeNumber = self.config.bridgeNumber || '';\r\n      content = self._replaceAll(content, '$(bridgePrefix)', (self.config.bridgePrefix || ''));\r\n      content = self._replaceAll(content, '$(bridgeNumber)', (bridgeNumber || ''));\r\n\r\n      if (args.conference) {\r\n        var room = args.dialableNumber || '';\r\n        if (room && (room[room.length - 1] !== '#')) {\r\n          room += '#';\r\n        }\r\n        content = self._replaceAll(content, '$(room)', room);\r\n\r\n        var typeLabel = '';\r\n        if (self.config.conferenceType === 'aac') {\r\n          typeLabel = self.i18n.aacLabel;\r\n        } else if (self.config.conferenceType === 'ipo') {\r\n          typeLabel = self.i18n.ipoLabel;\r\n        }\r\n        content = self._replaceAll(content, '$(conferenceType)', (typeLabel || ''));\r\n      } else {\r\n        content = self._replaceAll(content, '$(room)', (args.dialableNumber || ''));\r\n        content = self._replaceAll(content, '$(pinE164)', (args.accessPIN ? '***' + atob(args.accessPIN) : ''));\r\n        content = self._replaceAll(content, '$(pin)', (args.accessPIN ? atob(args.accessPIN) : ''));\r\n        content = self._replaceAll(content, '$(roomName)', (args.name || ''));\r\n      }\r\n      var portal = self.config.serverBase + '/portal/tenants/' + self.config.tenantId + '/?ID=';\r\n      content = self._replaceAll(content, '$(portalJoinUrl)', (portal || ''));\r\n\r\n      var scopiaUrl = (self._infoUser || self._infoGuest || {}).scopiaUrl;\r\n      scopiaUrl = null;\r\n      if (!scopiaUrl) {\r\n        scopiaUrl = self.config.serverBase + '/portal/tenants/' + self.config.tenantId + '/';\r\n      }\r\n      var scopiaBaseUrl = (/https?\\:\\/\\/[^\\/]*/i.exec(scopiaUrl) || [])[0] || '';\r\n      var scopiaJoinUrl = scopiaUrl + '?ID=';\r\n\r\n      content = self._replaceAll(content, '$(conferenceJoinUrl)', (self.config.conferenceParticipantUrl || ''));\r\n      content = self._replaceAll(content, '$(scopiaBaseUrl)', scopiaBaseUrl);\r\n      content = self._replaceAll(content, '$(scopiaJoinUrl)', scopiaJoinUrl);\r\n      content = self._replaceAll(content, '$(autojoin)', args.autojoin ? '&amp;autojoin' : '');\r\n  \r\n      var dialingInfo = { };\r\n      dialingInfo.dialingInfoHTML = content;\r\n      return Promise.resolve(dialingInfo);\r\n    });\r\n  };\r\n\r\n  Rooms.prototype._compareVersion = function (v1, v2) {\r\n    for (var i = 0; i < v1.length; i++) {\r\n      var xv1 = 0 | (v1[i] || '0');\r\n      var xv2 = 0 | (v2[i] || '0');\r\n      var x = xv1 - xv2;\r\n      if (x) {\r\n        return x;\r\n      }\r\n    }\r\n    return 0;\r\n  };\r\n\r\n  \r\n  Rooms.prototype._isGetDialInfoFromPortalSupported = function (args) {\r\n    if (args.conference) {\r\n      return false;\r\n    }\r\n    var version = (this._infoGuest || this._infoUser || {}).portalVersion || '';\r\n    var versionBase = '3.2.0.0.228';\r\n    if (this._compareVersion(version.split('.'), versionBase.split('.')) < 0) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  Rooms.prototype.getDialInfo = function (args) {\r\n    if (args.accessPIN) {\r\n      args.accessPIN = btoa(args.accessPIN);\r\n    }\r\n    return this.getDialInfoPatched(args);\r\n  };\r\n\r\n  Rooms.prototype.getDialInfoPatched = function (args) {\r\n    var self = this;\r\n    if (self.config.mode !== 'equinox') {\r\n      return self.getDialInfoWithRetry(args, true);\r\n    }\r\n    return self.resources({ }).then(function (r) {\r\n      if (!self._isGetDialInfoFromPortalSupported(args)) {\r\n        return self.getDialInfoWithRetry(args, true);\r\n      }\r\n\r\n      return self._getToken().then(function (r) {\r\n        args.token = r;\r\n        args.tenantId = self.config.tenantId;\r\n        return self.getDialInfoWithRetry(args);\r\n      }, function (e) {\r\n        self._updateTokenInfo(null);\r\n        if (!args.retry) {\r\n          args.retry = true;\r\n          return self.getDialInfoPatched(args);\r\n        }\r\n        throw e;\r\n      });\r\n    }, function (e) {\r\n      return self.getDialInfoWithRetry(args, true);\r\n    });\r\n    \r\n  };\r\n  Rooms.prototype.getDialInfoWithRetry = function (args, fallBack) {\r\n    var deferred;\r\n    if (fallBack) {\r\n      deferred = this.getDialInfoCustom(args);\r\n    } else {\r\n      logger.info('getDialInfo: API getDialInfo');\r\n      deferred = this.roomsAPI.getDialInfo(args);\r\n    }\r\n\r\n    var self = this;\r\n    return deferred.then(function (r) {\r\n      if (!r.location) {\r\n        self._patchDialInfo(r, args);\r\n      }\r\n      return r;\r\n    }, function (e) {\r\n      if (!fallBack) {\r\n        return self.getDialInfoWithRetry(args, true);\r\n      }\r\n      throw e;\r\n    });\r\n  };\r\n\r\n  Rooms.prototype.getTopics = function () {\r\n    var res = Object.getOwnPropertyNames(this.rooms).reduce(function (r, key) {\r\n      var room = r.rooms[key];\r\n      r.result.push({ id: room.id, title: room.name, room: room });\r\n      return r;\r\n    }, { result: [], rooms: this.rooms }).result;\r\n    return { items: res };\r\n  };\r\n  Rooms.prototype.getTopic = function (id) {\r\n    var room = this.rooms[id];\r\n    if (room) {\r\n      return { id: room.id, title: room.name, room: room };\r\n    }\r\n  };\r\n\r\n  Rooms.prototype.createInvite = function (invite) {\r\n    var room = this.rooms[invite.id];\r\n    var self = this;\r\n    return this.getDialInfo({ name: room.name, accessPIN: room.accessPIN, dialableNumber: room.meetingId, conference: room.type !== 'equinox', additionalNumbersTitle: this.i18n.additionalNumbersTitle }).then(function (r) {\r\n      var meeting = { 'location': r.location, 'body': r.dialingInfoText || r.dialingInfoHTML };\r\n      var meetingInfo = TOM.extractMeetingInfo(self.config.settings, self.rooms, meeting);\r\n      var joinUrl = TOM.getJoinMeetingUri(meetingInfo);\r\n      var info = {\r\n        topicId: invite.id,\r\n        topicTitle: room.name,\r\n        conferenceAccessNumber: room.conferenceAccessNumber,\r\n        meetingId: room.type === 'equinox' ? room.meetingId : '',\r\n        conferenceAccessUrl: room.conferenceAccessUrl,\r\n        joinUrl: joinUrl\r\n      };\r\n      var res = { id: room.id, type: room.type, location: r.location, content: { 'text': r.dialingInfoText, 'html': r.dialingInfoHTML }, info: info};\r\n      logger.info('createInvite res: ' + JSON.stringify(res));\r\n      return Promise.resolve(res);\r\n    });\r\n  };\r\n\r\n  Rooms.prototype.getInviteInfo = function (configuration, languageId, location, body) {\r\n    var config;\r\n    var self = this;\r\n    var rooms;\r\n    return this.configure(configuration, languageId).then(function (r) {\r\n      config = r;\r\n      return self._getRooms({ });\r\n    }).then(function (r) {\r\n      rooms = (r.rooms || []).map(function (room) {\r\n        var pin = room.accessPIN;\r\n        return { id: room.id, name: room.name, meetingId: room.number, conferenceAccessUrl: room.url, accessPIN: pin || '', moderatorPIN: room.moderatorPIN };\r\n      });\r\n    }, function (err) {\r\n      logger.error('getInviteInfo error: ' + Log.getErrInfo(err));\r\n      rooms = [];\r\n    }).then(function () {\r\n      var meeting = { 'location': location, 'body': body };\r\n      var res = TOM.extractMeetingInfo(config.settings, rooms, meeting)\r\n      logger.info('getInviteInfo res: ' + JSON.stringify(res));\r\n      return Promise.resolve(res);\r\n    });\r\n  };\r\n\r\n  Rooms.prototype.getInviteUrl = function (configuration, languageId, location, body) {\r\n    var self = this;\r\n    return this.getInviteInfo(configuration, languageId, location, body).then(function (r) {\r\n      return Promise.resolve(TOM.getJoinMeetingUri(r));\r\n    });\r\n  };\r\n\r\n  Rooms.prototype.checkInvite = function (configuration, languageId, location, body) {\r\n    var self = this;\r\n    return this.getInviteInfo(configuration, languageId, location, body).then(function (r) {\r\n      if (!r || r.type === 'empty') {\r\n        return Promise.resolve(null);\r\n      }\r\n      var inviteId;\r\n      var ids = Object.getOwnPropertyNames(self.rooms);\r\n      for (var i = 0; i < ids.length; i++) {\r\n        var id = ids[i];\r\n        if ((self.rooms[id].meetingId === r.room) || (r.url && self.rooms[id].conferenceAccessUrl === r.url)) {\r\n          inviteId = id;\r\n          break;\r\n        }\r\n      }\r\n      if (!inviteId) {\r\n        return Promise.resolve(null);\r\n      }\r\n      var room = self.rooms[inviteId];\r\n      var joinUrl = TOM.getJoinMeetingUri(r);\r\n      var info = {\r\n        topicId: inviteId,\r\n        topicTitle: room.name,\r\n        conferenceAccessNumber: room.conferenceAccessNumber,\r\n        meetingId: room.type === 'equinox' ? room.meetingId : '',\r\n        conferenceAccessUrl: room.conferenceAccessUrl,\r\n        joinUrl: joinUrl\r\n      };\r\n      var res = { id: inviteId, isHost: r.isHost, info: info };\r\n      logger.info('checkInvite res: ' + JSON.stringify(res));\r\n      return Promise.resolve(res);\r\n    });\r\n  };\r\n\r\n  module.exports = new Rooms();\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/rooms/model.js\n// module id = 29\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise = require('/lib/jsl/promise');\r\n  var Log     = require('/lib/jsl/log');\r\n  var Event   = require('/lib/jsl/event');\r\n  var Timer   = require('/lib/jsl/timer');\r\n  var Utils   = require('/lib/jsl/utils');\r\n\r\n  var schema = require('./schema');\r\n\r\n  var identity = require('../identity/model');\r\n  var identityStates = require('../identity/states');\r\n\r\n  var modelParties = require('../parties/model');\r\n  var modelPartiesTypes = require('../parties/types');\r\n\r\n  var ZangSpaces = require('./spaces');\r\n\r\n  var logger = Log.createLogger('SPACES');\r\n\r\n  function Spaces() {\r\n    this.onTopic = new Event();\r\n    this.onReady = new Event();\r\n    this.onSearch = new Event();\r\n\r\n    this.service = new ZangSpaces();\r\n    this.evTimer = this.evTimer.bind(this);\r\n    this.reschedule = this.reschedule.bind(this);\r\n    this.pollTopics = this.pollTopics.bind(this);\r\n\r\n    identity.onAccount.addListener(this.evAccount, this);\r\n  }\r\n  Spaces.prototype._schema = schema;\r\n  \r\n  Spaces.prototype.setOpt = function (opt) {\r\n    logger.info('setOpt: ' + JSON.stringify(opt));\r\n    this.opt = opt || {};\r\n  };\r\n  Spaces.prototype.init = function (opt) {\r\n    logger.info('init: ' + JSON.stringify(opt));\r\n    this.opt = opt || {};\r\n    this.topics = {};\r\n    this.service.init(opt);\r\n    this.timer = new Timer(this.evTimer);\r\n    this.lastUpdate = 0;\r\n\r\n    // this.refresh(); // do not start pollTopics on init\r\n  };\r\n  Spaces.prototype.shut = function () {\r\n    this.topics = {};\r\n    this.service.shut();\r\n    if (this.timer) {\r\n      this.timer.reset();\r\n      this.timer = null;\r\n    }\r\n    this.lastUpdate = 0;\r\n  };\r\n  Spaces.prototype.evAccount = function (account) {\r\n    if (!account || account.info.type !== 'esna') {\r\n      return;\r\n    }\r\n    // so far supporting only primary account\r\n    if (!account.info.primary) {\r\n      return;\r\n    }\r\n\r\n    if (account.state === identityStates.Authorized) {\r\n      var opt = this.opt || { };\r\n      opt.user = account.info.user;\r\n      opt.token = identity.getToken.bind(identity, { id: account.id, primary:  account.id === 'primary' });\r\n      this.init(opt);\r\n    } else {\r\n      this.shut();\r\n    }\r\n  };\r\n\r\n  Spaces.prototype.pollTopics = function (r) {\r\n    Utils.showLogInfo('spaces: model.pollTopics', r ? { next: r.next, items: (r.items || []).length } : r);\r\n    if (!this.service.opt) {\r\n      Utils.showLogInfo('spaces: model.pollTopics skip', 'service not configured or shutted down');\r\n      this.onReady.dispatch({ skip: true });\r\n      return Promise.resolve({ skip: true });\r\n    }\r\n    if (!r) {\r\n      var dtn = Date.now();\r\n      if (dtn - this.lastUpdate < 5 * 60000) {\r\n        Utils.showLogInfo('spaces: model.pollTopics skip', 'topics are up to date');\r\n        this.onReady.dispatch({ skip: true });\r\n        return Promise.resolve({ skip: true });\r\n      }\r\n      return this.service.fetchTopics().then(this.pollTopics);\r\n    }\r\n    \r\n    this.lastUpdate = Date.now();\r\n    for (var i = 0; i < r.items.length; i++) {\r\n      this.reportTopic(r.items[i]);\r\n    }\r\n    if (r.next) {\r\n      return this.service.fetchTopics({ url: r.next }).then(this.pollTopics);\r\n    }\r\n    this.onReady.dispatch({ done: true });\r\n    return Promise.resolve({ done: true });\r\n  };\r\n  Spaces.prototype.reportTopic = function (topic) {\r\n    if (!topic.selfMember) {\r\n      Utils.showLogInfo('spaces: model.reportTopic skip', 'role: guest, id: ' + topic.id);\r\n      return;\r\n    }\r\n    this.topics[topic.id] = topic;\r\n    this.onTopic.dispatch({ item: topic });\r\n  };\r\n  \r\n  Spaces.prototype.reschedule = function () {\r\n    // periodic polling switched off\r\n    //if (this.timer) {\r\n    //  this.timer.start(60000);\r\n    //}\r\n  };\r\n  Spaces.prototype.evTimer = function () {\r\n    if (this.timer) {\r\n      Utils.showLogInfo('spaces: model.evTimer');\r\n      this.timer.reset();\r\n      return this.pollTopics().then(this.reschedule, this.reschedule);\r\n    }\r\n  };\r\n\r\n  \r\n  Spaces.prototype.refresh = function () {\r\n    Utils.showLogInfo('spaces: model.refresh');\r\n    this.lastUpdate = 0;\r\n    return this.evTimer();\r\n  };\r\n  Spaces.prototype.getTopics = function () {\r\n    Utils.showLogInfo('spaces: model.getTopics');\r\n    var res = Object.getOwnPropertyNames(this.topics).reduce(function (r, key) {\r\n      r.result.push(r.topics[key]);\r\n      return r;\r\n    }, { result: [], topics: this.topics }).result;\r\n    return { items: res };\r\n  };\r\n  Spaces.prototype.getTopic = function (id) {\r\n    return this.topics[id];\r\n  };\r\n\r\n  Spaces.prototype.searchTopics = function () {\r\n  };\r\n\r\n  Spaces.prototype.createTopic = function (topic) {\r\n    if (!topic.parties) {\r\n      var parties = modelParties.getParties();\r\n      var partiesType = modelParties.getPartiesType();\r\n      modelParties.clear();\r\n\r\n      var keys = Object.getOwnPropertyNames(parties);\r\n      var p = [];\r\n      for (var i = 0; i < keys.length; i++) {\r\n        p.push({ email: keys[i], member: partiesType === modelPartiesTypes.member });\r\n      }\r\n      topic.parties = p;\r\n    }\r\n    \r\n    var self = this;\r\n    return this.service.createTopic(topic).then(function (r) {\r\n      self.reportTopic(r);\r\n      if (topic.join) {\r\n        self.joinTopic(r.id);\r\n      }\r\n      if (!r.invite) {\r\n        return r;\r\n      }\r\n      r.invite.topicId = r.id;\r\n      var inviteUrl = (self._getInviteInfo(r.invite.content.text) || { }).url;\r\n      r.invite.location = inviteUrl;\r\n      var info = {\r\n        topicId: r.id,\r\n        topicTitle: r.title,\r\n        spaceUrl: inviteUrl\r\n      };\r\n      r.invite.info = info;\r\n      return r;\r\n    });\r\n  };\r\n  Spaces.prototype.removeTopic = function () {\r\n  };\r\n\r\n  Spaces.prototype.createInvite = function (invite) {\r\n    if (!invite.parties) {\r\n      var parties = modelParties.getParties();\r\n      var partiesType = modelParties.getPartiesType();\r\n      modelParties.clear();\r\n\r\n      var keys = Object.getOwnPropertyNames(parties);\r\n      var p = [];\r\n      for (var i = 0; i < keys.length; i++) {\r\n        p.push({ email: keys[i], member: partiesType === modelPartiesTypes.member });\r\n      }\r\n      invite.parties = p;\r\n    }\r\n    \r\n    var self = this;\r\n    return this.service.createInvite(invite).then(function (r) {\r\n      if (invite.join) {\r\n        self.joinInvite(r.id);\r\n      }\r\n      var inviteUrl = (self._getInviteInfo(r.content.text) || { }).url;\r\n      r.location = inviteUrl;\r\n      var topic = self.topics[invite.id] || { };\r\n      var info = {\r\n        topicId: invite.id,\r\n        topicTitle: topic.title,\r\n        spaceUrl: inviteUrl\r\n      };\r\n      r.info = info;\r\n      return r;\r\n    });\r\n  };\r\n  \r\n  Spaces.prototype.removeInvite = function (inviteId) {\r\n    return this.service.removeInvite(inviteId);\r\n  };\r\n\r\n  Spaces.prototype._getInviteInfo = function (body) {\r\n    function escapeRegExp(v) {\r\n      v = v.replace(/([./:])/ig, '\\\\$1');\r\n      return v;\r\n    }\r\n\r\n    // var endpoint = (this.opt || {}).url || 'https://spaces.zang.io';\r\n    // var reText = escapeRegExp(endpoint) + '\\/spaces\\/invites\\/(.*?)\\/(join|meet)';\r\n    var reText = 'https:\\/\\/[^\\/]*\\/spaces\\/invites\\/(.*?)\\/(join|meet)';\r\n    logger.info('getInviteInfo search: ' + reText);\r\n\r\n    var re = new RegExp(reText, 'i');\r\n    var result = re.exec(body) || [];\r\n    var id = result[1];\r\n    var url = result[0];\r\n    var res = id ? { id: id, url: url } : null;\r\n    logger.info('getInviteInfo res: ' + JSON.stringify(res));\r\n    return res;\r\n  };\r\n\r\n  Spaces.prototype.getInviteInfo = function (body) {\r\n    return Promise.resolve(this._getInviteInfo(body));\r\n  };\r\n\r\n  Spaces.prototype.getInviteUrl = function (body) {\r\n    return this.getInviteInfo(body).then(function (r) {\r\n      return Promise.resolve(r? r.url : null);\r\n    });\r\n  };\r\n\r\n  Spaces.prototype.checkInvite0 = function (body) {\r\n    return this.getInviteInfo(body).then(function (r) {\r\n      return Promise.resolve(r ? { inviteId: r.id } : null);\r\n    });\r\n  };\r\n\r\n  Spaces.prototype.checkInvite = function (body, precheck) {\r\n    var inviteInfo;\r\n    var self = this;\r\n    return this.getInviteInfo(body).then(function (r) {\r\n      if (precheck) {\r\n        return Promise.resolve(!!r);\r\n      }\r\n      if (!r) {\r\n        return Promise.resolve(null);\r\n      }\r\n      inviteInfo = r;\r\n      return self.service.getTopic({ id: inviteInfo.id }).then(function (r) {\r\n        var info = {\r\n          topicId: r.topic._id,\r\n          topicTitle: r.topic.title,\r\n          spaceUrl: inviteInfo.url\r\n        };\r\n        return Promise.resolve(r ? { inviteId: inviteInfo.id, info: info } : null);\r\n      }, function (err) {\r\n        return Promise.resolve({ inviteId: inviteInfo.id, info: { spaceUrl: inviteInfo.url } });\r\n      });\r\n    });\r\n  };\r\n\r\n  Spaces.prototype.joinTopic = function (id) {\r\n    var url = this.service.getJoinUrl(id);\r\n    // Window.open(url, '_blank');\r\n  };\r\n  Spaces.prototype.joinInvite = function (id) {\r\n    var url = this.service.getInviteJoinUrl(id);\r\n    Window.open(url, '_blank');\r\n  };\r\n\r\n  module.exports = new Spaces();\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/spaces/model.js\n// module id = 30\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Event = require('/lib/jsl/event');\r\n\r\n  var schema = require('./schema');\r\n\r\n  var modelIdentity = require('../identity/model');\r\n  var partyType = require('./types');\r\n\r\n  var _storageKey = 'spaces:partiesType';\r\n\r\n  function Parties() {\r\n    this.parties = { };\r\n    this.partiesType = localStorage.getItem(_storageKey) || partyType.member;\r\n\r\n    this.onParties = new Event();\r\n    this.onPartiesType = new Event();\r\n\r\n    modelIdentity.onPrimary.addListener(this.evIdentity, this);\r\n  }\r\n  Parties.prototype._schema = schema;\r\n  \r\n  Parties.prototype.evIdentity = function (info) {\r\n    if (!info.connected) {\r\n      this.clear();\r\n    } else {\r\n      this.parties = {};\r\n    }\r\n  };\r\n  \r\n  Parties.prototype.getParties = function () {\r\n    return this.parties;\r\n  };\r\n  Parties.prototype.createParty = function (party) {\r\n    var p = this.parties[party.id];\r\n    if (p) {\r\n      var update = false;\r\n      if (party.image && (p.image !== party.image)) {\r\n        update = true;\r\n        p.image = party.image; \r\n      }\r\n      if (party.name && (p.name !== party.name)) {\r\n        update = true;\r\n        p.name = party.name; \r\n      }\r\n      if (party.member) {\r\n        update = true;\r\n        p.member = true;\r\n      }\r\n      if (update) {\r\n        this.onParties.dispatch({ item: p });\r\n      }\r\n      return;\r\n    }\r\n    this.parties[party.id] = party;\r\n    this.onParties.dispatch({ item: party });\r\n  };\r\n  Parties.prototype.removeParty = function (id) {\r\n    var p = this.parties[id];\r\n    if (!p) {\r\n      return;\r\n    }\r\n    delete this.parties[id];\r\n    this.onParties.dispatch({ deleted: true, item: p });\r\n  };\r\n  Parties.prototype.getPartiesType = function () {\r\n    return this.partiesType;\r\n  };\r\n  Parties.prototype.setPartiesType = function (type) {\r\n    this.partiesType = type;\r\n    localStorage.setItem(_storageKey, this.partiesType);\r\n\r\n    this.onPartiesType.dispatch({ type: this.partiesType });\r\n  };\r\n\r\n  Parties.prototype.clear = function () {\r\n    this.parties = {};\r\n    this.onParties.dispatch({ cleared: true });\r\n  };\r\n\r\n  module.exports = new Parties();\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/parties/model.js\n// module id = 31\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var officeNative = { missing: true };\r\n\r\n  if (window.external && ('context' in window.external)) {\r\n    officeNative = window.external;\r\n  }\r\n\r\n  module.exports = officeNative;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./office.native.js\n// module id = 33\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n  \r\n  var globals = require('/lib/jsl/globals');\r\n  var Office = globals.safeProp('Office');\r\n\r\n  var _settings;\r\n  var store;\r\n\r\n  function save() {\r\n    var cb = function() {};\r\n    _settings.saveAsync(cb);\r\n  }\r\n  function get(key) {\r\n    return _settings.get(key);\r\n  }\r\n  function set(key, val) {\r\n    _settings.set(key, val);\r\n    save();\r\n  }\r\n  function del(key) {\r\n    _settings.remove(key);\r\n    save();\r\n  }\r\n\r\n  function init(settings) {\r\n    _settings = settings;\r\n    store = _settings ? { get: get, set: set, del: del } : null;\r\n  }\r\n\r\n  function getStore() {\r\n    if (typeof(store) !== 'undefined') {\r\n      return store;\r\n    }\r\n    if (typeof(Office) === 'undefined' ||\r\n        !Office.context || \r\n        !Office.context.roamingSettings) {\r\n      _settings = null;\r\n    } else {\r\n      _settings = Office.context.roamingSettings;\r\n    }\r\n    init();\r\n    return store;\r\n  }\r\n\r\n  var storage = { init: init, getStore: getStore };\r\n\r\n  module.exports = storage;\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./storage.js\n// module id = 34\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var loader  = require('/lib/jsl/loader');\r\n\r\n  var Promise = require('/lib/jsl/promise');\r\n  var Storage = require('/lib/jsl/storage');\r\n  var Log     = require('/lib/jsl/log');\r\n\r\n  var logger = Log.createLogger('SETTINGS');\r\n\r\n  var settings = null;\r\n\r\n  function toHexString(buffer) {\r\n    var hexCodes = [];\r\n    var view = new DataView(buffer);\r\n    for (var i = 0; i < view.byteLength; i += 4) {\r\n      var value = view.getUint32(i);\r\n      var stringValue = value.toString(16);\r\n      var padding = '00000000';\r\n      var paddedValue = (padding + stringValue).slice(-padding.length);\r\n      hexCodes.push(paddedValue);\r\n    }\r\n\r\n    // Join all the hex strings into one\r\n    return hexCodes.join('');\r\n  }\r\n\r\n  function getHash(v) {\r\n    v = v || '';\r\n\r\n  if (!window.crypto && window.md5) {\r\n    return Promise.resolve(window.md5(v));\r\n  }\r\n\r\n    var buffer = new ArrayBuffer(v.length * 2);\r\n    var bufView = new Uint16Array(buffer);\r\n    for (var i = 0; i < v.length; i++) {\r\n      bufView[i] = v.charCodeAt(i);\r\n    }\r\n\r\n    //var buffer = String.fromCharCode.apply(null, new Uint16Array(buf));new TextEncoder('utf-8').encode(v);\r\n    return window.crypto.subtle.digest('SHA-256', buffer).then(function (hash) {\r\n      return toHexString(hash);\r\n    });\r\n  }\r\n\r\n  function loadSettings(configuration, languageId) {\r\n    if (settings !== null) {\r\n      return Promise.resolve(settings);\r\n    }\r\n\r\n    if (!configuration) {\r\n      return Promise.reject({ error: { noconfiguration: true } });\r\n    }\r\n\r\n    configuration = JSON.parse(configuration);\r\n    settings = {\r\n      languageId: languageId,\r\n      manual: configuration.manual || Object.getOwnPropertyNames(configuration).length === 0,\r\n      outlookCallContact: configuration['OUTLOOK_CALL_CONTACT'] || '',\r\n      conferenceAccessNumber: configuration['CONFERENCE_ACCESS_NUMBER'] || '',\r\n      conferenceAdditionalNumbers: configuration['ADDITIONAL_CONFERENCE_ACCESS_NUMBER_LIST'] || '',\r\n\r\n      unifiedPortalEnabled: !!configuration['UNIFIEDPORTALENABLED'],\r\n\r\n      // equinox properties\r\n      unifiedPortalUri: configuration['UNIFIED_PORTAL_URI'] || '', // to be removed\r\n      unifiedPortalUsername: configuration['UNIFIED_PORTAL_USERNAME'] || '',\r\n      unifiedPortalSSO: !!configuration['UNIFIED_PORTAL_SSO'],\r\n      unifiedPortalPassword: configuration['Password'] || '',\r\n\r\n      unifiedPortalDelegateName: configuration['delegateName'] || '',\r\n\r\n      conferenceFQDNSIPDialList: configuration['CONFERENCE_FQDN_SIP_DIAL_LIST'] || '',\r\n      uccpEnabled: !!configuration['UCCPENABLED'],\r\n      sipEnabled: !!configuration['SIP_ENABLED'],\r\n      conferencePortalUri: configuration['CONFERENCE_PORTAL_URI'] || '',\r\n\r\n      // conference properties\r\n      conferenceModeratorCode: configuration['CONFERENCE_MODERATOR_CODE'] || '',\r\n      conferenceModeratorUrl: configuration['CONFERENCE_MODERATOR_URL'] || '',\r\n      conferenceParticipantCode: configuration['CONFERENCE_PARTICIPANT_CODE'] || '',\r\n      conferenceParticipantUrl: configuration['CONFERENCE_PARTICIPANT_URL'] || '',\r\n\r\n      conferenceType: configuration['ENABLE_IPO'] ? 'ipo' : 'aac',\r\n    };\r\n\r\n    var validateArray = [\r\n      settings.conferenceAccessNumber,\r\n      settings.conferenceAdditionalNumbers,\r\n      settings.unifiedPortalEnabled,\r\n      settings.unifiedPortalUri,\r\n      settings.unifiedPortalUsername,\r\n      settings.unifiedPortalSSO,\r\n      settings.unifiedPortalPassword,\r\n      settings.unifiedPortalDelegateName,\r\n      settings.conferenceFQDNSIPDialList,\r\n      settings.conferencePortalUri,\r\n      settings.conferenceModeratorCode,\r\n      settings.conferenceModeratorUrl,\r\n      settings.conferenceParticipantCode,\r\n      settings.conferenceParticipantUrl,\r\n      settings.conferenceType,\r\n    ];\r\n    var sValidate = validateArray.join(',');\r\n\r\n    return getHash(sValidate).then(function (hash) {\r\n      var oldHash = Storage.getItem('equinox-config-hash') || '';\r\n      logger.info('compare-config:' + hash + ':' + oldHash);\r\n\r\n      settings.forceRefresh = oldHash !== hash;\r\n      Storage.setItem('equinox-config-hash', hash);\r\n\r\n      return Promise.resolve(settings);\r\n    }, function () {\r\n\r\n      settings.forceRefresh = true;\r\n      return Promise.resolve(settings);\r\n    });\r\n  }\r\n\r\n  function buildAPIConfig(settings) {\r\n    var config = { };\r\n    config.mode = settings.unifiedPortalEnabled ? 'equinox' : settings.conferenceType;\r\n\r\n    config.languageId = settings.languageId;\r\n\r\n    config.bridgeNumber = settings.conferenceAccessNumber;\r\n    config.additionalNumbers = settings.conferenceAdditionalNumbers;\r\n\r\n    config.portalUri = settings.unifiedPortalUri || settings.conferencePortalUri;\r\n    config.user = settings.unifiedPortalUsername;\r\n    config.password = settings.unifiedPortalPassword;\r\n    config.delegateName = settings.unifiedPortalDelegateName;\r\n\r\n    config.conferenceModeratorPIN = settings.conferenceModeratorCode;\r\n    config.conferenceModeratorUrl = settings.conferenceModeratorUrl;\r\n    config.conferenceParticipantPIN = settings.conferenceParticipantCode;\r\n    config.conferenceParticipantUrl = settings.conferenceParticipantUrl;\r\n    config.conferenceType = settings.conferenceType;\r\n\r\n    config.forceRefresh = settings.forceRefresh;\r\n\r\n    return config;\r\n  }\r\n\r\n  function getAPIConfig(configuration, languageId) {\r\n    return loadSettings(configuration, languageId).then(function (settings) {\r\n      var config = buildAPIConfig(settings);\r\n      config.settings = settings;\r\n      return Promise.resolve(config);\r\n    });\r\n  }\r\n\r\n  function clear() {\r\n    settings = null;\r\n  }\r\n\r\n  loader.load('/lib/contrib/webcrypto-shim.js', 'crypto');\r\n\r\n  module.exports = { getAPIConfig: getAPIConfig, clear: clear };\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/rooms/settings.js\n// module id = 35\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var API = require('../api/api');\r\n\r\n  var methods = {\r\n    info: {\r\n      uri: '/ups/resources/$(tenantId)',\r\n      method: 'GET',\r\n      headers: {\r\n        'authorization': '$(token)'\r\n      },\r\n      body: null,\r\n      args: {\r\n        tenantId: { key: '$(tenantId)', flags: 's', format: 'tenants/$0/', default: 'default' },\r\n        token: { key: '$(token)', flags: 's', format: 'UPToken $0' }\r\n      },\r\n      response: {\r\n        portalVersion: { key: 'portalVersion', flags: 'Sr' },\r\n        multitenant: { key: 'multitenant', flags: 'br' },\r\n        iwaEnabled: { key: 'iwaEnabled', flags: 'br' },\r\n        scopiaUrl: { key: 'scopiaDesktopServerURL', flags: 's' },\r\n        self: {\r\n          $v: {\r\n            email: { key: 'self.email', flags: 'sr' },\r\n            firstName: { key: 'self.firstName', flags: 's' },\r\n            lastName: { key: 'self.lastName', flags: 's' },\r\n            userId: { key: 'self.userId', flags: 's' },\r\n            scopiaUserId: { key: 'self.scopiaUserId', flags: 's' },\r\n            scopiaTenantId: { key: 'self.scopiaMemberId', flags: 's' }\r\n          }\r\n        }\r\n      },\r\n    },\r\n    refreshToken: {\r\n      uri: '/ups/resources/$(tenantId)authentication/login',\r\n      method: 'POST',\r\n      headers: {\r\n        'content-type': 'application/json',\r\n        'authorization': '$(token)'\r\n      },\r\n      args: {\r\n        tenantId: { key: '$(tenantId)', flags: 's', format: 'tenants/$0/', default: 'default' },\r\n        token: { key: '$(token)', flags: 'Sr', format: 'UPToken $0' },\r\n        userId: { key: '$(userId)', flags: 's' },\r\n        passwordHash: { key: '$(passwordHash)', flags: 's' },\r\n        aliasId: { key: '$(aliasId)', flags: 's', default: 'default' }\r\n      },\r\n      body: {\r\n        'login': '$(userId)',\r\n        'encryptedPassword': '$(passwordHash)',\r\n        'organizationAlias': '$(aliasId)'\r\n      },\r\n      response: {\r\n        token: { key: 'token', flags: 'Sr' },\r\n        expires: { key: 'expirationTime', flags: 'D' },\r\n        passwordHash: { key: 'encryptedPassword', flags: 's' }\r\n      }\r\n    },\r\n    login: {\r\n      uri: '/ups/resources/$(tenantId)authentication/login',\r\n      method: 'POST',\r\n      headers: {\r\n        'content-type': 'application/json'\r\n      },\r\n      args: {\r\n        tenantId: { key: '$(tenantId)', flags: 's', format: 'tenants/$0/', default: 'default' },\r\n        aliasId: { key: '$(aliasId)', flags: 's', default: 'default' },\r\n        userId: { key: '$(userId)', flags: 's' },\r\n        password: { key: '$(password)', flags: 's' }\r\n      },\r\n      body: {\r\n        'login': '$(userId)',\r\n        'organizationAlias': '$(aliasId)',\r\n        'password': '$(password)'\r\n      },\r\n      response: {\r\n        token: { key: 'token', flags: 'Sr' },\r\n        expires: { key: 'expirationTime', flags: 'D' },\r\n        passwordHash: { key: 'encryptedPassword', flags: 's' }\r\n      }\r\n    },\r\n    loginIWA: {\r\n      uri: '/ups/resources/$(tenantId)authentication/login?useSSO=true',\r\n      method: 'POST',\r\n      credentials: true,\r\n      headers: {\r\n        'content-type': 'application/json'\r\n      },\r\n      args: {\r\n        tenantId: { key: '$(tenantId)', flags: 's', format: 'tenants/$0/', default: 'default' },\r\n        aliasId: { key: '$(aliasId)', flags: 's', default: 'default' },\r\n      },\r\n      body: {\r\n        'organizationAlias': '$(aliasId)',\r\n      },\r\n      response: {\r\n        token: { key: 'token', flags: 'Sr' },\r\n        expires: { key: 'expirationTime', flags: 'D' },\r\n        passwordHash: { key: 'encryptedPassword', flags: 's' }\r\n      }\r\n    },\r\n    getRooms: {\r\n      uri: '/ups/resources/$(tenantId)conference/virtual_room',\r\n      method: 'POST',\r\n      headers: {\r\n        'content-type': 'application/vnd.avaya.portal.conference.virtual_room.v1+json',\r\n        'authorization': '$(token)'\r\n      },\r\n      args: {\r\n        tenantId: { key: '$(tenantId)', flags: 's', format: 'tenants/$0/', default: 'default' },\r\n        aliasId: { key: '$(aliasId)', flags: 's', default: 'default' },\r\n        token: { key: '$(token)', flags: 'Sr', format: 'UPToken $0' },\r\n        offset: { key: '$(offset)', flags: 'i', default: 1 },\r\n        pageSize: { key: '$(pageSize)', flags: 'i', default: 20 },\r\n        userId: { key: '$(userId)', flags: 'Sr' }\r\n      },\r\n      body: {\r\n        memberId: '$(aliasId)',\r\n        offset: '$(offset)',\r\n        pageSize: '$(pageSize)',\r\n        loginId: '$(userId)'\r\n      },\r\n      response: {\r\n        totalCount: { key: 'totalCount ', flags: 'i' },\r\n        rooms: [{\r\n          id: { key: 'virtualRoom.#.virtualRoomId', flags: 'Sr' },\r\n          name: { key: 'virtualRoom.#.name', flags: 'Sr' },\r\n          number: { key: 'virtualRoom.#.number', flags: 'Sr' },\r\n          userId: { key: 'virtualRoom.#.userId', flags: 'Sr' },\r\n          accessPIN: { key: 'virtualRoom.#.accessPIN', flags: 'B', default: '' },\r\n          \r\n          autoExtend: { key: 'virtualRoom.#.autoExtend', flags: 'br' },\r\n          blockDialIn: { key: 'virtualRoom.#.blockDialIn', flags: 'br' },\r\n          isDefault: { key: 'virtualRoom.#.default', flags: 'br' },\r\n          maxParticipants: { key: 'virtualRoom.#.maxParticipants', flags: 'ir' },\r\n          moderatorPIN: { key: 'virtualRoom.#.moderatorPIN', flags: 'B' },\r\n          oneTimePINRequired: { key: 'virtualRoom.#.oneTimePINRequired', flags: 'b' },\r\n          priority: { key: 'virtualRoom.#.priority', flags: 'er' },\r\n          isPublic: { key: 'virtualRoom.#.public', flags: 'br' },\r\n          servicePrefix: { key: 'virtualRoom.#.servicePrefix', flags: 'sr' },\r\n          serviceTemplateId: { key: 'virtualRoom.#.serviceTemplateId', flags: 'sr' },\r\n          streamingStatus: { key: 'virtualRoom.#.streamingStatus', flags: 'er' },\r\n          waitingRoom: { key: 'virtualRoom.#.waitingRoom', flags: 'br' },\r\n          \r\n          allowKnocking: { key: 'virtualRoom.#.allowKnocking', flags: 'br' },\r\n          allowRecording: { key: 'virtualRoom.#.allowRecording', flags: 'er' },\r\n          allowStreaming: { key: 'virtualRoom.#.allowStreaming', flags: 'er' },\r\n\r\n          durationAfterLeft: { key: 'virtualRoom.#.advancedProperties.durationAfterLeft', flags: 'T' },\r\n          minutesBeforeTermination: { key: 'virtualRoom.#.advancedProperties.minutesBeforeTermination', flags: 'T' },\r\n          terminationCondition: { key: 'virtualRoom.#.advancedProperties.terminationCondition', flags: 'e' },\r\n\r\n          portsFullHD: { key: 'virtualRoom.#.reservedPorts.fullHD', flags: 'i', default: 0 },\r\n          portsHD: { key: 'virtualRoom.#.reservedPorts.hd', flags: 'i', default: 0 },\r\n          portsRegular: { key: 'virtualRoom.#.reservedPorts.regular', flags: 'i', default: 0 },\r\n          portsSD: { key: 'virtualRoom.#.reservedPorts.sd', flags: 'i', default: 0 }\r\n        }]\r\n      }\r\n    },\r\n    getDialInfo: {\r\n      uri: '/ups/resources/$(tenantId)conference/dialing_info',\r\n      method: 'POST',\r\n      headers: {\r\n        'authorization': '$(token)',\r\n        'content-type': 'application/vnd.avaya.portal.conference.dialing_info.v1+json'\r\n      },\r\n      args: {\r\n        tenantId: { key: '$(tenantId)', flags: 's', format: 'tenants/$0/', default: 'default' },\r\n        token: { key: '$(token)', flags: 'S', format: 'UPToken $0' },\r\n\r\n        accessPIN: { key: '$(accessPIN)', flags: 's' },\r\n        confGID: { key: '$(confGID)', flags: 's' },\r\n        dialableNumber: { key: '$(dialableNumber)', flags: 'Sr' },\r\n        loginId: { key: '$(loginId)', flags: 's' },\r\n        memberId: { key: '$(memberId)', flags: 's' },\r\n        servicePrefix: { key: '$(servicePrefix)', flags: 's' },\r\n        serviceTemplateId: { key: '$(serviceTemplateId)', flags: 's' },\r\n        userId: { key: '$(userId)', flags: 's' },\r\n      },\r\n      body: {\r\n        'AccessPIN': '$(accessPIN)',\r\n        'ConfGID': '$(confGID)',\r\n        'DialableNumber': '$(dialableNumber)',\r\n        'LoginId': '$(loginId)',\r\n        'MemberId': '$(memberId)',\r\n        'ServicePrefix': '$(servicePrefix)',\r\n        'ServiceTemplateId': '$(serviceTemplateId)',\r\n        'UserId': '$(userId)',\r\n      },\r\n      response: {\r\n        dialingInfoText: { key: 'DialingInfo.Description', flags: 's' },\r\n        dialingInfoHTML: { key: 'DialingInfo.DescriptionOfHTML', flags: 's' },\r\n        location: { key: 'DialingInfo.LocationInfo', flags: 's' },\r\n        requestId: { key: 'RequestID', flags: 's' },\r\n        result: { key: 'ReturnValue', flags: 'er' }\r\n      }\r\n    }\r\n  };\r\n\r\n  function RoomsAPI(serverBase) {\r\n    this.$super(serverBase);\r\n  }\r\n\r\n  Object.getOwnPropertyNames(methods).forEach(function (name) {\r\n    RoomsAPI.prototype[name] = function(args) {\r\n      return this._exec(methods[name], args);\r\n    }\r\n  }, this);\r\n\r\n  module.exports = API.extend(RoomsAPI);\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/rooms/api.js\n// module id = 36\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Log = require('/lib/jsl/log');\r\n\r\n  var logger = Log.createLogger('TOM');\r\n\r\n  var reUri = /(https?\\:\\/\\/)(([^\\. ]+(\\.[^\\. \\/\\:]+)*)(\\:[0-9]+)?)(\\/[^\\,\\.\\!\\?\\r\\n]?[^\\? \\r\\n]*)?((\\?[^ \\r\\n\"<>]*))?/igm;\r\n  var reTel = /([\\=\\&]?(\\+[0-9])?((?:[- .()]*)[0-9](?:[- .()]*)){8,20})((?:[ ]*)?([\\,0-9\\*\\#]+))?/igm;\r\n\r\n  function unquote(v) {\r\n    if (v && v[v.length - 1] === '\"') {\r\n      return v.substr(0, v.length - 1);\r\n    }\r\n    return v;\r\n  }\r\n  function extractUrls(s) {\r\n    var r = [];\r\n    for (var m; (m = reUri.exec(s)) && m[3]; ) {\r\n      var uri = { proto: m[1] || 'http://', serverName: m[3].toLowerCase(), port: m[5] || '', path: m[6] || '', query: m[7] || '' };\r\n      uri.server = unquote(uri.server);\r\n      uri.query = uri.query.replace(/[\\,\\. \\?\\!\\;]$/ig, '');\r\n      uri.query = unquote(uri.query);\r\n      uri.path = uri.path.replace(/[\\,\\. \\?\\!\\;]$/ig, '');\r\n      uri.path = unquote(uri.path);\r\n      uri.url = [uri.proto, uri.serverName, uri.port, uri.path, uri.query].join('');\r\n      r.push(uri);\r\n    }\r\n    return r;\r\n  }\r\n  function extractTels(s) {\r\n    var r = [];\r\n\r\n    for (var m; (m = reTel.exec(s)); ) {\r\n      if (m[1] && ((m[1].indexOf('=') === 0) || (m[1].indexOf('&') === 0))) {\r\n        continue;\r\n      }\r\n      var tel = { phone: m[1], pin: m[4] || '' };\r\n      tel.tel = tel.phone.replace(/[^0-9\\+\\*\\#]/ig, '');\r\n      r.push(tel);\r\n    }\r\n    return r;\r\n  }\r\n  function parseUrl(url) {\r\n    url = url || '';\r\n    if ((url.indexOf('http://') < 0) && (url.indexOf('https://') < 0)) {\r\n      url += 'https://';\r\n    }\r\n    return extractUrls(url)[0];\r\n  }\r\n\r\n  // Equinox validation\r\n  function validateEquinoxMeetingUrl(config, url) {\r\n    var path = url.path;\r\n    var query = url.query;\r\n\r\n    var reQuery = /^\\?ID=([0-9]+)(\\*+([0-9]+)?)?/ig;\r\n    var room, pin;\r\n    var mQuery = reQuery.exec(query);\r\n    if (mQuery) {\r\n      room = mQuery[1];\r\n      pin = mQuery[3] || '';\r\n    }\r\n\r\n    var rePath = /recording\\/?$/ig;\r\n    var mPath = rePath.exec(path);\r\n    if (mPath) {\r\n      return null;\r\n    }\r\n\r\n    return { url: url, room: room, pin: pin };\r\n  }\r\n  function validateEquinoxMeetingCode(info) {\r\n    var reRoom = /VirtualRoom([: -,.]*)([0-9]*)/ig;\r\n    var rePIN = /VirtualRoomPin([: -,.]*)([0-9\\#\\*]*)/ig;\r\n    var location = info.location.value;\r\n\r\n    var res = { room: '', pin: '' };\r\n    var mRoom = reRoom.exec(location);\r\n    if (mRoom && mRoom[2]) {\r\n      res.room = mRoom[2];\r\n    }\r\n    var mPIN = rePIN.exec(location);\r\n    if (mPIN && mPIN[2]) {\r\n      res.pin = mPIN[2];\r\n    }\r\n\r\n    return res;\r\n  }\r\n  function validateEquinoxMeetingInfo(config, rooms, info) {\r\n    var confInfo = { type: 'equinox', url: '', tel: '', room: '', dial: '', isHost: false, clientUrl: !config.manual };\r\n    confInfo = info.urls.reduce(function (r, item) {\r\n      if (r.room) {\r\n        return r;\r\n      }\r\n      var res = validateEquinoxMeetingUrl(config, item);\r\n      if (res) {\r\n        if (res.room) {\r\n          r.url = res.url.url;\r\n          r.room = res.room;\r\n          r.pin = res.pin || '';\r\n        } else {\r\n          r.url = r.url || res.url.url;\r\n        }\r\n      }\r\n      return r;\r\n    }, confInfo);\r\n\r\n    var res = validateEquinoxMeetingCode(info);\r\n    if (!confInfo.room && res) {\r\n      confInfo.room = res.room;\r\n      confInfo.pin = res.pin;\r\n    } else if (!confInfo.pin && res) {\r\n      confInfo.pin = res.pin;\r\n    }\r\n\r\n    var telInfo = info.tels.reduce(function (r, item){\r\n      var pin = item.pin.replace(/[^0-9*#]/ig, '');\r\n      var tel = item.tel.replace(/[^0-9*#]/ig, '');\r\n\r\n      if (tel === r.room) {\r\n        return r;\r\n      }\r\n\r\n      if (pin && (pin.indexOf(r.room) === 0)) {\r\n        r.telRoom = r.telRoom || item.tel;\r\n      } else {\r\n        r.telFirst = r.telFirst || item.tel;\r\n      }\r\n      return r;\r\n    }, { room: confInfo.room.replace(/[^0-9*#]/ig, '') });\r\n    confInfo.tel = telInfo.telRoom || telInfo.telFirst || '';\r\n\r\n    if (!confInfo.room) {\r\n      logger.info('validateEquinoxMeetingInfo (no room): ' + JSON.stringify(confInfo));\r\n      return null;\r\n    }\r\n    \r\n    var sipFQDNS = (config.conferenceFQDNSIPDialList || '').split(',');\r\n    var sipUrls = sipFQDNS.map(function (item) {\r\n      if ((item.indexOf('http://') !== 0) && (item.indexOf('https://') !== 0)) {\r\n        item = 'https://' + item;\r\n      }\r\n      return (parseUrl(item || '') || {}).serverName || '';\r\n    });\r\n    var confUrl = (parseUrl(confInfo.url || '') || {}).serverName;\r\n    var sipDial = confUrl && (sipUrls.indexOf(confUrl) >= 0);\r\n\r\n    var pin = confInfo.pin;\r\n    for (var i = 0; i < rooms.length; i++) {\r\n      if (rooms[i].meetingId === confInfo.room) {\r\n        confInfo.id = rooms[i].id;\r\n        confInfo.isHost = true;\r\n        // ACMACOS-10934, ACW-11836\r\n        //if (rooms[i].moderatorPIN) {\r\n        //  confInfo.pin = pin = rooms[i].moderatorPIN;\r\n        //}\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (sipDial) {\r\n      confInfo.dial = confInfo.room + (pin ? '***' + pin : '');\r\n      confInfo.bridge = confInfo.room || '';\r\n    } else {\r\n      if (!confInfo.tel) {\r\n        logger.info('validateEquinoxMeetingInfo (no tel): ' + JSON.stringify(confInfo));\r\n        return null;\r\n      }\r\n      // ACMACOS-10934, ACW-11836 - should we add moderator code for non-sipDial case?\r\n      confInfo.dial = confInfo.tel ? confInfo.tel + ',,,' + (confInfo.room || '') + (pin ? '***' + pin : '') : '';\r\n      confInfo.bridge = confInfo.tel || '';\r\n    }\r\n\r\n    return confInfo;\r\n  }\r\n  // Equinox validation\r\n\r\n  // Cponference Validation\r\n  function getConferenceInfoFromCodeAdjusted(code) {\r\n    code = (code || '').replace(/^\\,+/ig, '').replace(/\\,+$/, '');\r\n    var av = code.split(',');\r\n    var room = av.shift().replace(/\\#+$/, '');\r\n    var pin = av.join(',');\r\n    if (pin) {\r\n      pin = ',' + pin;\r\n    }\r\n    return { room: room, pin: pin.replace(/^\\,+/ig, ''), pinOrig: pin };\r\n  }\r\n  function validateConferenceMeetingUrl(config, url) {\r\n    //if ((config.conferenceFQDNSIPDialList || '').indexOf(url.serverName) < 0) {\r\n    //  return null;\r\n    //}\r\n\r\n    var q = url.path + url.query;\r\n    var re = /(\\/|\\?participantCode=)(\\d+)$/ig;\r\n    var m = re.exec(q);\r\n    if (m && m[2]) {\r\n      var info = getConferenceInfoFromCodeAdjusted(m[2]);\r\n      return { url: url, room: info.room || '', pin: info.pin || '' };\r\n    }\r\n  }\r\n  function validateConferenceMeetingCode(info) {\r\n    var reCode = /(PC|PIN|Passcode)([\\#\\:])?[ ]*([0-9\\#\\*\\,]+)/ig;\r\n\r\n    var _info;\r\n    var mlCode = reCode.exec(info.location.value);\r\n    if (mlCode && mlCode[3]) {\r\n      _info = getConferenceInfoFromCodeAdjusted(mlCode[3]);\r\n      return { room: _info.room, _info: info.pin };\r\n    }\r\n    var mbCode = reCode.exec(info.body.value);\r\n    if (mbCode && mbCode[3]) {\r\n      _info = getConferenceInfoFromCodeAdjusted(mbCode[3]);\r\n      \r\n      return { room: _info.room, _info: info.pin };\r\n    }\r\n  }\r\n  function validateConferenceMeetingInfo(config, info) {\r\n    var confInfo = { type: config.conferenceType, url: '', tel: '', room: '', dial: '', isHost: false };\r\n    confInfo = info.urls.reduce(function (r, item) {\r\n      if (r.room) {\r\n        return r;\r\n      }\r\n\r\n      var res = validateConferenceMeetingUrl(config, item);\r\n      if (res) {\r\n        if (res.room) {\r\n          r.url = res.url.url;\r\n          r.room = res.room;\r\n        } else {\r\n          r.url = r.url || res.url.url;\r\n        }\r\n      }\r\n      return r;\r\n    }, confInfo);\r\n\r\n    var res = validateConferenceMeetingCode(info);\r\n    if (!confInfo.room && res) {\r\n      confInfo.room = res.room;\r\n      confInfo.pin = res.pin || '';\r\n    } else if (!confInfo.pin && res) {\r\n      confInfo.pin = res.pin || '';\r\n    }\r\n    // in above block should we care if pin retrieved from url somehow, or forcing it from PC code or tels is ok\r\n\r\n    var telInfo = info.tels.reduce(function (r, item){\r\n      var info = getConferenceInfoFromCodeAdjusted(item.pin);\r\n\r\n      if (info.pin && ((info.room === r.room) || !r.room)) {\r\n        r.telRoom = r.telRoom || item.tel;\r\n\r\n        r.telPIN = r.telPIN || info.pin;\r\n        if (!r.room) {\r\n          r._room = r._room || info.room;\r\n        }\r\n      } else {\r\n        r.telFirst = r.telFirst || item.tel;\r\n      }\r\n      return r;\r\n    }, { room: confInfo.room.replace(/[^0-9*#]/ig, '') });\r\n    confInfo.tel = telInfo.telRoom || telInfo.telFirst || '';\r\n\r\n    if (!confInfo.room && telInfo._room) {\r\n      confInfo.room = telInfo._room || '';\r\n    }\r\n    if (!confInfo.pin && telInfo.telPIN) {\r\n      confInfo.pin = (telInfo.telPIN || '');\r\n    }\r\n\r\n    if (!confInfo.room || (!confInfo.url && !confInfo.tel)) {\r\n      logger.info('validateConferenceMeetingInfo (no room/url+tel): ' + JSON.stringify(confInfo));\r\n      return null;\r\n    }\r\n    \r\n    var confPC = (config.conferenceParticipantCode || '').replace(/[^0-9\\*\\#\\,]/ig, '');\r\n    var confPCInfo = getConferenceInfoFromCodeAdjusted(confPC);\r\n    var confMC = (config.conferenceModeratorCode || '').replace(/[^0-9\\*\\#\\,]/ig, '');\r\n    var confMCInfo = getConferenceInfoFromCodeAdjusted(confMC);\r\n\r\n    var roomNP = (confInfo.room || '');\r\n    \r\n    var hostServer = (parseUrl(config.conferenceModeratorUrl) || {}).serverName || '-';\r\n    var confServer = (parseUrl(confInfo.url) || {}).serverName || '';\r\n    confInfo.isHost = /*(!confServer || (hostServer === confServer)) &&*/ (roomNP === confPCInfo.room);\r\n    if (config.conferenceParticipantUrl && (config.conferenceParticipantUrl === confInfo.url)) {\r\n      confInfo.isHost = true;\r\n    }\r\n    confInfo.tel = confInfo.tel;\r\n\r\n    var dtmf = '';\r\n    if (confInfo.isHost) {\r\n      dtmf = confMCInfo.room + '#';\r\n      if (confMCInfo.pinOrig) {\r\n        confInfo.pin = confMCInfo.pinOrig;\r\n        dtmf = dtmf + confMCInfo.pinOrig;\r\n      }\r\n    }\r\n    if (!dtmf) {\r\n      dtmf = confInfo.room + '#';\r\n      if (confInfo.pin) {\r\n        dtmf = dtmf + ',,' + confInfo.pin;\r\n      }\r\n    }\r\n\r\n    confInfo.dial = confInfo.tel ? confInfo.tel + (dtmf ? ',,,' + dtmf : '') : '';\r\n\r\n    return confInfo;\r\n  }\r\n  // Conference Validation\r\n\r\n  function extractMeetingInfo(config, rooms, meeting) {\r\n    rooms = rooms || [];\r\n    logger.info('extractMeetingInfo rooms: ' + JSON.stringify(rooms));\r\n    var extracted = { };\r\n    extracted.location = { urls: extractUrls(meeting.location || ''), tels: extractTels(meeting.location || ''), value: meeting.location || '' };\r\n    logger.info('extracted location: urls: ' + JSON.stringify(extracted.location.urls) + ', tels: ' + JSON.stringify(extracted.location.tels));\r\n    extracted.body = { urls: extractUrls(meeting.body || ''), tels: extractTels(meeting.body || ''), value: meeting.body || '' };\r\n    logger.info('extracted body: urls: ' + JSON.stringify(extracted.body.urls) + ', tels: ' + JSON.stringify(extracted.body.tels));\r\n    extracted.urls = [].concat(extracted.location.urls, extracted.body.urls);\r\n    extracted.tels = [].concat(extracted.location.tels, extracted.body.tels);\r\n    var confInfo = validateEquinoxMeetingInfo(config, rooms, extracted);\r\n    if (!confInfo) {\r\n      confInfo = validateConferenceMeetingInfo(config, extracted);\r\n    }\r\n    if (!confInfo) {\r\n      confInfo = { url: '', dial: '', room: '', pin: '', isHost: false, type: 'empty' };\r\n    }\r\n    logger.info('extractMeetingInfo: ' + JSON.stringify(confInfo));\r\n    return confInfo;\r\n  }\r\n\r\n  function getJoinConferenceMeetingUri(info) {\r\n    logger.info('getJoinConferenceMeetingUri');\r\n    if (info.dial) {\r\n      var uri = 'avaya://video?' + info.dial;\r\n      logger.info('getJoinConferenceMeetingUri:' + uri);\r\n      return uri;\r\n    }\r\n    return '';\r\n  }\r\n  function getJoinEquinoxMeetingUri(info) {\r\n    logger.info('getJoinEquinoxMeetingUri:' + JSON.stringify(info));\r\n    if (info.bridge) {\r\n      var uri;\r\n      if (!info.clientUrl) {\r\n        uri = info.url;\r\n      } else {\r\n        var args = { };\r\n        if (info.pin) {\r\n          args['MeetingPasscode'] = info.pin;\r\n        }\r\n        if (info.room) {\r\n          args['MeetingId'] = info.room;\r\n        }\r\n        if (info.url) {\r\n          args['portalUrl'] = info.url;\r\n        }\r\n\r\n        var urlArgs = Object.getOwnPropertyNames(args).reduce(function (r, key) {\r\n          // r.push([key, encodeURIComponent(args[key])].join('='));\r\n          r.push([key, args[key]].join('='));\r\n          return r;\r\n        }, []);\r\n        if (urlArgs.length) {\r\n          urlArgs = '&' + urlArgs.join('&');\r\n        }\r\n        uri = 'avaya://video?' + info.bridge + urlArgs;\r\n      }\r\n      logger.info('getJoinEquinoxMeetingUri:' + uri);\r\n      return uri;\r\n    }\r\n  }\r\n\r\n  function getJoinMeetingUri(meetingInfo) {\r\n    logger.info('getJoinMeetingUri');\r\n    if (meetingInfo.type !== 'equinox') {\r\n      return getJoinConferenceMeetingUri(meetingInfo);\r\n    } else {\r\n      return getJoinEquinoxMeetingUri(meetingInfo);\r\n    }\r\n  }\r\n\r\n  function joinMeeting(meetingInfo) {\r\n    var uri = getJoinMeetingUri(meetingInfo);\r\n    if (uri) {\r\n      window.open(uri, '_self');\r\n    }\r\n  }\r\n\r\n  var TopOfMind = {\r\n    extractMeetingInfo: extractMeetingInfo,\r\n    getJoinMeetingUri: getJoinMeetingUri,\r\n    joinMeeting: joinMeeting,\r\n  };\r\n\r\n  module.exports = TopOfMind;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/rooms/tom.js\n// module id = 37\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  function Templates(opt) {\r\n    this._url = opt.url || '../templates/';\r\n    this._langId = opt.langId || 'en';\r\n    this._html = !!opt.html;\r\n    this._maxLineLength = opt.maxLineLength || 68;\r\n    this._logger = opt.logger;\r\n    this.i18n = opt.i18n;\r\n  }\r\n  Templates.prototype._limitLineLength = function (s, len) {\r\n    var words = s.split(' ');\r\n    var lines = words.reduce(function (r, word) {\r\n      var line = r[r.length - 1] || '';\r\n      if (!line.length) {\r\n        line = word;\r\n      } else if (line.length + word.length + 1 > len) {\r\n        line = word;\r\n        r.push('');\r\n      } else {\r\n        line = line + ' ' + word;\r\n      }\r\n      r[r.length - 1] = line;\r\n  \r\n      return r;\r\n    }, ['']);\r\n  \r\n    return lines.join('\\r\\n');\r\n  };\r\n\r\n  Templates.prototype._splitCompoundValues = function (strings) {\r\n    Object.getOwnPropertyNames(strings).forEach(function(key) {\r\n      var value = strings[key];\r\n      if (value.indexOf('%%') !== -1) {\r\n        delete strings[key];\r\n        var pp = value.split('%%');\r\n        strings[key + '_PREFIX'] = pp[0];\r\n        strings[key + '_POSTFIX'] = pp[2];\r\n      } else {\r\n        var re = /(.*)?<a xsubst>(.*)?<\\/a>(.*)?/;\r\n        var m = re.exec(value);\r\n        if (m && m.length === 4) {\r\n          delete strings[key];\r\n          strings[key + '_PREFIX'] = m[1] || '';\r\n          strings[key + '_LINK'] = m[2] || '';\r\n          strings[key + '_POSTFIX'] = m[3] || '';\r\n        }\r\n      }\r\n   });\r\n  }\r\n    \r\n  Templates.prototype.applyTranslations = function(content, type, langId, html) {\r\n    var self = this;\r\n    langId = langId || self._langId || 'en';\r\n\r\n    var ln_strings = self.i18n[langId] || self.i18n;\r\n    this._splitCompoundValues(ln_strings);\r\n    var langIdEn = 'en';\r\n    var en_strings = self.i18n[langIdEn] || { };\r\n    this._splitCompoundValues(en_strings);\r\n\r\n    var lineTag = html ? '--' + Date.now() + '--' : '';\r\n  \r\n    var re = /\\$\\(([^\\)]+)\\)/gm;\r\n    content = content.replace(re, function (m, key) {\r\n      var s = typeof(ln_strings[type + '_' + key]) !== 'undefined' ? ln_strings[type + '_' + key] : en_strings[type + '_' + key];\r\n      if (typeof(s) !== 'undefined') {\r\n        return lineTag + (s);\r\n      }\r\n      return m;\r\n    });\r\n  \r\n    var reTag = /--\\d+--/ig;\r\n    var reLines = /^.*(--\\d+--).*$/gm;\r\n    var maxLen = this._maxLineLength;\r\n    content = content.replace(reLines, function (m, tag) {\r\n      if (tag !== lineTag) {\r\n        return m;\r\n      }\r\n      m = m.replace(reTag, '');\r\n      return self._limitLineLength(m, maxLen);\r\n    });\r\n  \r\n    return content;\r\n  };\r\n    \r\n  Templates.prototype.getTemplate = function (type) {\r\n    var self = this;\r\n    var templateUrl = self._url + type + (self._html ? '.html' : '.txt');\r\n    if (self._logger) {\r\n      self._logger.info('getTemplate: ' + templateUrl);\r\n    }\r\n    return fetch(templateUrl).then(function (r) {\r\n      return r.text();\r\n    }).then(function (content) {\r\n      return self.applyTranslations(content, type.toUpperCase(), self._langId, self._html);\r\n    }, function (err) {\r\n      throw { error: { fetchTemplate: true } };\r\n    });\r\n  };\r\n\r\n  module.exports = Templates;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/rooms/templates.js\n// module id = 38\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var schema = require('/lib/jsl/chrome/rpc/schema');\r\n\r\n  var SpacesSchema = {\r\n    onTopic: schema.eventBroadcast,\r\n    onSearch: schema.eventUnicast,\r\n\r\n    getTopics: schema.methodPromise,\r\n    searchTopics: schema.methodPromise,\r\n\r\n    createInvite: schema.methodPromise,\r\n    removeInvite: schema.methodPromise,\r\n\r\n    createTopic: schema.methodPromise,    \r\n    removeTopic: schema.methodPromise,\r\n    \r\n    refresh: schema.methodPromise,\r\n\r\n    joinTopic: schema.methodOneWay,\r\n  };\r\n\r\n  module.exports = SpacesSchema;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/spaces/schema.js\n// module id = 39\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise = require('./promise');\r\n\r\n  function createToken() {\r\n    var self = { };\r\n    self.token = new Promise(function (resolve, reject) {\r\n      self.cancel = reject.bind(null, { error: { canceled: true } });\r\n    });\r\n    return self;\r\n  }\r\n  \r\n  function PromiseCancel() {\r\n    var token = createToken();\r\n    this.token = token.token;\r\n    this.cancel = token.cancel;\r\n  }\r\n  PromiseCancel.prototype.exec = function (promise) {\r\n    var cmd = Promise.race([promise, this.token]);\r\n    cmd.cancel = this.cancel;\r\n    return cmd;\r\n  };\r\n\r\n  module.exports = PromiseCancel;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/promise.cancel.js\n// module id = 40\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var Base = require('../base');  \r\n  var Promise = require('../promise');\r\n  var Utils = require('../utils');\r\n  var OAuthStorage = require('./oauth.storage');\r\n\r\n  /** @constructor */  \r\n  function OAuth(opt) {\r\n    this.storage = opt.storage || new OAuthStorage(opt);\r\n    this.providers = [];\r\n  }\r\n  OAuth.prototype.registerProvider = function (provider) {\r\n    provider.setStorage(this.storage);\r\n    \r\n    this.providers.push(provider);\r\n  };\r\n  OAuth.prototype.getProvider = function (type) {\r\n    var providers = this.providers;\r\n    for (var i = 0; i < providers.length; i++) {\r\n      var provider = providers[i];\r\n      if (provider.clientType === type) {\r\n        return provider;\r\n      }\r\n    }\r\n  };\r\n  \r\n  OAuth.prototype.login = function (opt) {\r\n    if (!opt.type) {\r\n      var p = this.storage.getPrimary();\r\n      if (p) {\r\n        opt.type = p.type;\r\n      }\r\n    }\r\n    \r\n    var provider = this.getProvider(opt.type);\r\n    if (!provider) {\r\n      return Promise.reject({ error: { provider: true } });\r\n    }\r\n    \r\n    return provider.login(opt);\r\n  };\r\n  OAuth.prototype.logout = function (opt) {\r\n    var provider = this.getProvider(opt.type);\r\n    if (!provider) {\r\n      return Promise.reject({ error: { provider: true } });\r\n    }\r\n    return provider.logout(opt);\r\n  };\r\n  OAuth.prototype.getToken = function (opt) {\r\n    Utils.showLogInfo('identity: OAuth.getToken', opt, ['cancelToken'], true);\r\n    var provider = this.getProvider(opt.type);\r\n    if (!provider) {\r\n      return Promise.reject({ error: { provider: true } });\r\n    }\r\n    return provider.getToken(opt);\r\n  };\r\n\r\n  module.exports = Base.extend(OAuth);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/id/oauth.js\n// module id = 41\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var Base = require('../base');\r\n  var Storage = require('../storage');\r\n  var Utils = require('../utils');\r\n\r\n  /** @constructor */  \r\n  function OAuthStorage(opt) {\r\n    this.key = opt.key || 'oauth_storage';\r\n    this.allowSave = !!opt.allowSave;\r\n\r\n    this.load();\r\n  }\r\n  OAuthStorage.prototype.load = function () {\r\n    var jso = Storage.getItem(this.key) || null;\r\n    this.items = Utils.safeParse(jso) || {};\r\n  };\r\n  OAuthStorage.prototype.save = function () {\r\n    if (!this.allowSave) {\r\n      return;\r\n    }\r\n    var jso = JSON.stringify(this.items);\r\n    Storage.setItem(this.key, jso);\r\n  };\r\n  OAuthStorage.prototype.clear = function () {\r\n    this.items = {};\r\n    this.save();\r\n  };\r\n  OAuthStorage.prototype.getAll = function () {\r\n    var res = [];\r\n    var types = Object.getOwnPropertyNames(this.items);\r\n    for (var i = 0; i < types.length; i++) {\r\n      res.push(this.items[types[i]]);\r\n    }\r\n    return res;\r\n  };\r\n  OAuthStorage.prototype.getPrimary = function () {\r\n    var items = this.getAll();\r\n    for (var i = 0; i < items.length; i++) {\r\n      if (items[i].primary) {\r\n        return items[i];\r\n      }\r\n    }\r\n  };\r\n  OAuthStorage.prototype.getByType = function (type, userId) {\r\n    if (!type) {\r\n      return null;\r\n    }\r\n    var key = type;\r\n    if (userId) {\r\n      key = key + '-' + userId;\r\n    }\r\n    return this.items[key] || null;\r\n  };\r\n  OAuthStorage.prototype.add = function (item) {\r\n    if (item && item.type) {\r\n      var key = item.type;\r\n      if (!item.primary && item.userId) {\r\n        key = key + '-' + item.userId;\r\n      }\r\n      this.items[key] = item;\r\n      this.save();\r\n    }\r\n  };\r\n  OAuthStorage.prototype.remove = function (item) {\r\n    if (item && item.type) {\r\n      var key = item.type;\r\n      if (!item.primary && item.userId) {\r\n        key = key + '-' + item.userId;\r\n      }\r\n      delete this.items[key];\r\n      this.save();\r\n    }\r\n  };\r\n  \r\n  module.exports = Base.extend(OAuthStorage);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/id/oauth.storage.js\n// module id = 42\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var OAuthProvider = require('./oauth.provider');\r\n  var fetchproxy = require('../io/fetchproxy');\r\n\r\n  var clientType = 'google';\r\n\r\n  /** @constructor */\r\n  function OAuthProviderGoogle() {\r\n    this.clientType = clientType;\r\n  }\r\n  OAuthProviderGoogle.clientType = clientType;\r\n  \r\n  OAuthProviderGoogle.prototype.init = function (opt) {\r\n    this.initUrls({ urlLogin: 'https://accounts.google.com/o/oauth2/auth', urlToken: 'https://accounts.google.com/o/oauth2/token' });\r\n    this.initClient(opt.client);\r\n  };\r\n  OAuthProviderGoogle.prototype.getUserInfo = function (info) {\r\n    var url = 'https://www.googleapis.com/oauth2/v1/userinfo';\r\n\r\n    var opt = { 'method': 'GET', 'headers': { 'authorization': 'Bearer ' + info.token.token } };\r\n    return fetchproxy(url, opt).then(function (r) {\r\n      return r.json();\r\n    }).then(function (r) {\r\n      info.userInfo = {};\r\n      info.userInfo.user = r['email'] || '';\r\n      info.userInfo.image = r['picture'] || '';\r\n      info.userInfo.name = r['name'] || '';\r\n      return info;\r\n    });\r\n  };\r\n  \r\n  module.exports = OAuthProvider.extend(OAuthProviderGoogle);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/id/oauth.provider.google.js\n// module id = 43\n// module chunks = 0 1","define(function (require, exports, module){\r\n  'use strict';\r\n  \r\n  var globals = require('../globals');\r\n  //var fetch = require('./fetch.poly');\r\n  var fetchDefs = require('./fetch.const');\r\n\r\n  var loader = require('../loader');\r\n\r\n  var _fetch = globals.safeProp(fetchDefs.fetchKey);\r\n  var fetch = _fetch;\r\n\r\n  if (!fetch) {\r\n    fetch = function fetch() {\r\n      return _fetch.apply(null, arguments);\r\n    };\r\n    loader.load('/lib/contrib/fetch.js', 'fetch', function () {\r\n      _fetch = globals.safeProp(fetchDefs.fetchKey);\r\n    });\r\n  }\r\n\r\n  module.exports = fetch;\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/io/fetch.js\n// module id = 44\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var globals = require('../globals');\r\n\r\n  var debug = '';\r\n\r\n  var fetchMethods = {\r\n    get: 'GET',\r\n    delete: 'DELETE',\r\n    head: 'HEAD',\r\n    options: 'OPTIONS',\r\n    post: 'POST',\r\n    put: 'PUT'\r\n  };\r\n\r\n  var fetchDefinitions = {\r\n    sEmpty: '',\r\n    sEqual: '=',\r\n    sSpace: ' ',\r\n    sAmp: '&',\r\n    sLF: '\\n',\r\n    sColon: ':',\r\n\r\n    encodedSpace: /\\+/g,\r\n    \r\n    headersKey: debug + 'Headers',\r\n    headersValidator: /[^a-z0-9\\-#$%&'*+.\\^_`|~]/i,\r\n    headersInvalidHeader: 'Invalid character in header field name',\r\n    headersContentType: 'content-type',\r\n    headersLocation: 'location',\r\n    headersXRequestUrl: 'X-Request-URL',\r\n\r\n    errBodyUnsupported: 'unsupported type',\r\n    errBodyConsumed: 'already read',\r\n    errBodyFormBlob: 'could not read FormData body as blob',\r\n    errBodyFormText: 'could not read FormData body as text',\r\n    errRedirectStatus: 'Invalid status code',\r\n    errRequestBody: 'Body not allowed for GET or HEAD requests',\r\n    errRequestFailed: 'Network request failed',\r\n\r\n    hasFormData: globals.hasKey('FormData'),\r\n    hasBlob: globals.hasKey('FileReader') && globals.hasKey('Blob'),\r\n    hasSearchParams: globals.hasKey('URLSearchParams'),\r\n    hasArrayBuffer: globals.hasKey('ArrayBuffer'),\r\n\r\n    mimeTextUTF8: 'text/plain;charset=UTF-8',\r\n    mimeFormUTF8: 'application/x-www-form-urlencoded;charset=UTF-8',\r\n\r\n    fetchKey: debug + 'fetch',\r\n\r\n    requestKey: debug + 'Request',\r\n    requestCredentialsInclude: 'include',\r\n\r\n    responseKey: debug + 'Response',    \r\n    responseTypeDefault: 'default',\r\n    responseTypeError: 'error',\r\n    responseTypeKeyXHR: 'responseType',\r\n    responseTypeBlobXHR: 'blob',\r\n    responseKeyXHR: 'response',\r\n    responseURLKeyXHR: 'responseURL',\r\n    \r\n    redirectCodes: [301, 302, 303, 307, 308],\r\n    requestMethods: fetchMethods,\r\n    requestMethodsNormalize: [ fetchMethods.get, fetchMethods.post, fetchMethods.delete, fetchMethods.put, fetchMethods.head, fetchMethods.options ],\r\n  };\r\n\r\n  module.exports = fetchDefinitions;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/io/fetch.const.js\n// module id = 45\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var LiteralMap = require('../maps/literal');\r\n\r\n  var jwtProps = new LiteralMap({\r\n    audience: 'aud', nonce: 'nonce', issuer: 'iss', issued: 'iat', expiry: 'exp', verified: 'email_verified', email: 'email',\r\n    client: 'azp', hash: 'at_hash', subject: 'sub' \r\n  });\r\n\r\n  /** @constructor */  \r\n  function JWT(data) {\r\n    if (!(this instanceof JWT)) {\r\n      return new JWT(data);\r\n    }\r\n    if (typeof (data) === 'string') {\r\n      var jso = JSON.parse(atob(data.split('.')[1]));\r\n      jwtProps.mapReverse(jso, this);\r\n\r\n      var dt = Date.now() / 1000;\r\n      this.expiry = new Date((this.expiry || dt)*1000);\r\n      this.issued = new Date((this.issued || dt)*1000);\r\n      this.token = data;\r\n    }\r\n  }\r\n\r\n  module.exports = JWT;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/id/jwt.js\n// module id = 46\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var Timer = require('../timer');  \r\n  var Promise = require('../promise');\r\n  var Utils = require('../utils');\r\n  var chrome = require('../chrome/chrome');\r\n  var Window = require('../chrome/window');\r\n\r\n  var authErrKey = 'auth-error';\r\n\r\n  function exec(promise, cancel, cleanup) {\r\n    var ap = [promise];\r\n    if (cancel) {\r\n      ap.push(cancel);\r\n    }\r\n    var resolve = function (res) {\r\n      if (cleanup) {\r\n        cleanup();\r\n      }\r\n      return Promise.resolve(res);\r\n    };\r\n    var reject = function (err) {\r\n      if (cleanup) {\r\n        cleanup();\r\n      }\r\n      return Promise.reject(err);\r\n    };\r\n    return Promise.race(ap).then(resolve, reject);\r\n  }\r\n\r\n  function clearAuthInfo() {\r\n    for (var i = 0; i < arguments.length; i++) {\r\n      var key = arguments[i];\r\n      if (key && localStorage.getItem(key)) {\r\n        localStorage.removeItem(key);\r\n      }\r\n    }\r\n  }\r\n  function extractAuthInfo(hash) {\r\n    var info = {};\r\n    Utils.extractUrlInfo(hash || '', info);\r\n    return info;\r\n  }\r\n  \r\n  function addFrame(url, cb) {\r\n    var frame = document.createElement('iframe');\r\n    frame.src = url;\r\n    frame.style.display = 'none';\r\n    frame.addEventListener('load', cb);\r\n    document.body.appendChild(frame);\r\n    return frame;\r\n  }\r\n\r\n  function UnattendedValidator(opt) {\r\n    Utils.showLogInfo('identity: UnattendedValidator', opt, ['cancelToken'], true);\r\n    this.opt = opt;\r\n  }  \r\n  UnattendedValidator.prototype.init = function (resolve, reject) {\r\n    this.resolve = resolve;\r\n    this.reject = reject;\r\n\r\n    if (this.opt.nosilent) {\r\n      return this.reject({ error: { nosilent: true } });\r\n    }\r\n\r\n    clearAuthInfo(this.opt.state, authErrKey); // just for case\r\n    this.frame = addFrame(this.opt.url, function () {\r\n      this._waitFrame = setTimeout(this.check.bind(this, true), 2000);\r\n    }.bind(this));\r\n\r\n    window.addEventListener('message', this.cbMessage = function (ev) {\r\n      //debugger;\r\n      console.info('RECV:', ev);\r\n      var data = ev.data || {};\r\n\r\n      if (data.validate) {\r\n        if (data.id === chrome.runtime.id) {\r\n          ev.source.postMessage({ id: data.id }, '*');\r\n        }\r\n      } else if (typeof(data.hash) !== 'undefined') {\r\n        localStorage.setItem(this.opt.state, data.hash);\r\n        this.check(true);\r\n      }\r\n    }.bind(this));  \r\n\r\n    this._waitEvent = this.check.bind(this);\r\n    window.addEventListener('storage', this._waitEvent);\r\n  };\r\n  UnattendedValidator.prototype.shut = function () {\r\n    if (this.frame) {\r\n      this.frame.parentElement.removeChild(this.frame);\r\n      this.frame = null;\r\n    }\r\n    if (this.cbMessage) {\r\n      window.removeEventListener('message', this.cbMessage);\r\n      this.cbMessage = null;\r\n    }\r\n    if (this._waitFrame) {\r\n      this._waitFrame = clearTimeout(this._waitFrame) || 0;\r\n    }\r\n    if (this._waitEvent) {\r\n      window.removeEventListener('storage', this._waitEvent);\r\n      this._waitEvent = null;\r\n    }\r\n  };\r\n  UnattendedValidator.prototype.check = function (force) {\r\n    var hash = localStorage.getItem(this.opt.state);\r\n    if (hash) {\r\n      if (this._waitFrame) {\r\n        this._waitFrame = clearTimeout(this._waitFrame) || 0;\r\n      }\r\n      clearAuthInfo(this.opt.state);\r\n      Utils.showLogInfo('identity: UnattendedValidator.check', hash);\r\n      var res = extractAuthInfo(hash);\r\n      Utils.showLogInfo('identity: UnattendedValidator.check resolve', res);\r\n      if (!res.error) {\r\n        this.resolve(res);\r\n      } else {\r\n        this.reject(res);\r\n      }\r\n    } else if (force) {\r\n      clearAuthInfo(authErrKey);\r\n      var err = { error: { unattended: true } };\r\n      Utils.showLogInfo('identity: UnattendedValidator.check reject', err);\r\n      this.reject(err);\r\n    }\r\n  };\r\n  UnattendedValidator.prototype.async = function () {\r\n    var cmd = new Promise(this.init.bind(this));\r\n    return exec(cmd, this.opt.cancelToken, this.shut.bind(this));\r\n  };\r\n\r\n  var FORCEGETITEM = 'forceGetItem'; // Force MS Outlook catch state on check (see below), storage event never occurs\r\n  \r\n  function AttendedValidator(opt) {\r\n    Utils.showLogInfo('identity: AttendedValidator', opt, ['cancelToken'], true);\r\n    this.opt = opt;\r\n  }\r\n  AttendedValidator.prototype.init = function (resolve, reject) {\r\n    this.resolve = resolve;\r\n    this.reject = reject;\r\n\r\n    if (this.opt.noui) {\r\n      var err = { error: { noui: true } };\r\n      Utils.showLogInfo('identity: AttendedValidator reject', err);\r\n      return this.reject(err);\r\n    }\r\n    var self = this;\r\n    var apppath = window.location.protocol + '//' + window.location.hostname + window.location.pathname;\r\n// self.wnd = window.open(self.opt.url, '_self'); // open auth url in the app window\r\n// localStorage.setItem('myAppPath', apppath);\r\n    if (!this.opt.asyncui) {\r\n      var url = this.opt.url;\r\n      if (!(chrome && chrome.runtime)) { // allow Chrome (Edge, Firefox) open auth window directly (or as tab)\r\n        var redirectpath = apppath.replace(/(.*)\\/.*\\.html$/i, '$1/redirect.html'); // but use redirect for IE\r\n        url = redirectpath + '?' + this.opt.url;\r\n      }\r\n      this.wnd = Window.open(url, this.opt.target || '_blank');\r\n      if (!this.wnd) {\r\n        var err = { error: { blocked: true } };\r\n        Utils.showLogInfo('identity: AttendedValidator reject', err);\r\n        return this.reject(err);\r\n      }\r\n      this.checkWndClosed = true;\r\n    } else {\r\n      var url;\r\n      if (this.opt.asyncui.hostName === 'Outlook') {\r\n        url = apppath.replace(/(.*)\\/.*\\.html$/i, '$1/redirect.html') + '?' + this.opt.url;\r\n      } else {\r\n        url = this.opt.url;\r\n      }\r\n\r\n      this.opt.asyncui.open(url).then(function (result) {\r\n        function closePending() {\r\n          window.removeEventListener('unload', closePending);\r\n          if (self.wnd) {\r\n            self.wnd.close();\r\n            self.wnd = null;\r\n          }\r\n        }\r\n        window.addEventListener('unload', closePending);\r\n        self.wnd = result.value;\r\n        if (self.wnd) { // all known browsers open OAuth window via DialogAPI\r\n          var asyncDialog = typeof(self.wnd) === 'object' && 'addEventHandler' in self.wnd;\r\n          self.checkWndClosed = !asyncDialog;\r\n          if (asyncDialog) {\r\n            self.wnd.addEventHandler(Microsoft.Office.WebExtension.EventType.DialogEventReceived, function (event) {\r\n              if (!self.wnd) {\r\n                return;\r\n              }\r\n              console.info('dialog event received:', event.message);\r\n              if (event.error === 12002) {\r\n                if (self.wnd) {\r\n                  self.wnd.close();\r\n                  self.wnd = null;\r\n                }\r\n                self.reject({ error: { blocked: true } });\r\n                return;\r\n              }\r\n              if (event.error === 12006) {\r\n                self.wnd = null;\r\n              }\r\n              self.reject({ error: { closed: true } });\r\n            });\r\n          }\r\n        // } else if (self.opt.asyncui.hostName === 'Outlook') { // but old Outlook desktop client returns 5001 error\r\n        //   // self.wnd = window.open(self.opt.url, '_blank'); // redirect is not required // avoid allow popups request\r\n        //   self.wnd = window.open(self.opt.url, '_self'); // open auth url in the app window instead\r\n        //   localStorage.setItem('myAppPath', apppath);\r\n        }\r\n        if (!self.wnd) {\r\n          return self.reject({ error: { blocked: true } });\r\n        }\r\n      }, function (result) {\r\n          return self.reject({ error: { blocked: true } });\r\n      });\r\n    }\r\n    clearAuthInfo(this.opt.state, this.opt.authErrKey, FORCEGETITEM); // just for case\r\n    window.addEventListener('storage', this.onStorage = function onStorage(e) {\r\n      if (e.key === self.opt.state && e.newValue) {\r\n        var hash = e.newValue;\r\n        window.removeEventListener('storage', onStorage);\r\n        clearAuthInfo(self.opt.state, FORCEGETITEM);\r\n        Utils.showLogInfo('identity: AttendedValidator event resolve', hash);\r\n        self.resolve(extractAuthInfo(hash));\r\n      } \r\n      if (e.key === authErrKey && e.newValue) {\r\n        var err = e.newValue;\r\n        window.removeEventListener('storage', onStorage);\r\n        clearAuthInfo(authErrKey, FORCEGETITEM);\r\n        Utils.showLogInfo('identity: AttendedValidator event reject', err);\r\n        self.reject(err);\r\n      } \r\n    });\r\n    this.timerInterval = this.opt.checkInterval || 1000;\r\n    this.checks = 0;\r\n    this.timer = new Timer(this.check.bind(this), 0);\r\n  };\r\n  AttendedValidator.prototype.shut = function () {\r\n    if (this.wnd) {\r\n      this.wnd.close();\r\n      this.wnd = null;\r\n    }\r\n    if (this.timer) {\r\n      this.timer.reset();\r\n      this.timer = null;\r\n    }\r\n  };\r\n  AttendedValidator.prototype.check = function () {\r\n    this.checks += 1;\r\n    localStorage.setItem(FORCEGETITEM, '!!!'); // MS Outlook never gets state item without some setItem call\r\n    var hash = localStorage.getItem(this.opt.state);\r\n    if (hash) {\r\n      window.removeEventListener('storage', this.onStorage);\r\n      clearAuthInfo(this.opt.state, FORCEGETITEM);\r\n      Utils.showLogInfo('identity: AttendedValidator.check (' + this.checks + ') resolve', hash);\r\n      this.resolve(extractAuthInfo(hash));\r\n    }\r\n\r\n    if (this.checkWndClosed) {\r\n      if (chrome) { //  && chrome.runtime???\r\n        var closed;\r\n        try {\r\n          // if window.close() executed in web browser control could lead to exception here\r\n          closed = this.wnd.closed || (this.wnd.opener !== window.self);\r\n        } catch (e) {\r\n          closed = true; // wnd.opener on closed window causes error in IE\r\n        }\r\n        if (closed) {\r\n          // skip cleanup for window that is reported as closed anyway\r\n          this.wnd = null; \r\n          var err = { error: { closed: true } };\r\n          Utils.showLogInfo('identity: AttendedValidator.check (' + this.checks + ') reject', err);\r\n          return this.reject(err);\r\n        }\r\n      }\r\n    }\r\n    if (this.timeout > Date.now()) {\r\n      var err = { error: { timeout: true } };\r\n      Utils.showLogInfo('identity: AttendedValidator.check (' + this.checks + ') reject', err);\r\n      return this.reject(err);\r\n    }\r\n\r\n    this.timer.start(this.timerInterval);\r\n  };\r\n  AttendedValidator.prototype.async = function () {\r\n    var cmd = new Promise(this.init.bind(this));\r\n    return exec(cmd, this.opt.cancelToken, this.shut.bind(this));\r\n  };\r\n\r\n \r\n  function OAuthInteractive(opt) {\r\n    return new UnattendedValidator(opt).async().then(null, function (res) {\r\n      Utils.showLogInfo('identity: OAuthInteractive rejected', res);\r\n      if (res && res.error && res.error.canceled) {\r\n        return Promise.reject(res);\r\n      }\r\n      return new AttendedValidator(opt).async();\r\n    });\r\n  }\r\n\r\n  module.exports = OAuthInteractive;\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/id/oauth.interactive.js\n// module id = 47\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var ChromeTabs = require('./chrome.tabs');\r\n\r\n  function open(url, target) {\r\n    switch (window.location.protocol) {\r\n      case 'moz-extension:':\r\n        return ChromeTabs.create(url);\r\n      default:\r\n        return window.open(url, target);\r\n    }\r\n  }\r\n  \r\n  module.exports = { open: open };\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/chrome/window.js\n// module id = 48\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  // chrome.tabs is only available in background scripts\r\n  if (window.location.protocol !== 'moz-extension:') { // see ChromeTabs usage in ./window\r\n    module.exports = { };\r\n    return;\r\n  }\r\n\r\n  var chrome = require('./chrome');\r\n  var Utils = require('../utils');\r\n\r\n  var OAUTH_PROVIDER = 'https://manage1.esna.com/oauth/token.redirect';\r\n\r\n  /** @constructor */\r\n  function ChromeTabs() {\r\n    this.tabs = { };\r\n    chrome.tabs.onRemoved.addListener(function (id, info) {\r\n      if (this.tabs[id]) {\r\n        this.tabs[id].closed = true;\r\n        delete this.tabs[id];\r\n      }\r\n    }.bind(this));\r\n    chrome.tabs.onUpdated.addListener(function (id, info) {\r\n      if (!this.tabs[id] || !info || !info.url || info.url.indexOf(OAUTH_PROVIDER) !== 0) {\r\n        return;\r\n      }\r\n      var auth = info.url.substr(OAUTH_PROVIDER.length);\r\n      var state = Utils.extractUrlInfo(auth, {})['state'];\r\n      localStorage.setItem(state, auth);\r\n    }.bind(this));\r\n  }\r\n\r\n  ChromeTabs.prototype.create = function (url) {\r\n    var objtab = { opener: window };\r\n    var self = this;\r\n    chrome.tabs.create({ 'url': url }, function (tab) {\r\n      objtab.id = tab.id;\r\n      self.tabs[tab.id] = objtab;\r\n    });\r\n    objtab.close = function() {\r\n      if (this.id && !this.closed) {\r\n        chrome.tabs.remove(this.id);\r\n      }\r\n      this.closed = true;\r\n    };\r\n    objtab.closed = false;\r\n    return objtab;\r\n  };\r\n\r\n  module.exports = new ChromeTabs();\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/chrome/chrome.tabs.js\n// module id = 49\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var OAuthProvider = require('./oauth.provider');\r\n\r\n  var clientType = 'salesforce';\r\n  \r\n  /** @constructor */  \r\n  function OAuthProviderSalesforce() {\r\n    this.clientType = clientType;\r\n  }\r\n  OAuthProviderSalesforce.clientType = clientType;\r\n  \r\n  OAuthProviderSalesforce.prototype.init = function (opt) {\r\n    opt = opt || {};\r\n    if (!opt.urls) {\r\n      opt.urls = { urlLogin: 'https://login.salesforce.com/services/oauth2/authorize', urlToken: 'https://login.salesforce.com/services/oauth2/token' };\r\n    }\r\n    this.initUrls(opt.urls);\r\n    this.initClient(opt.client);\r\n  };\r\n  \r\n  module.exports = OAuthProvider.extend(OAuthProviderSalesforce);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/id/oauth.provider.salesforce.js\n// module id = 50\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var OAuthProvider = require('./oauth.provider');\r\n  var Utils = require('../utils');\r\n  var fetchproxy = require('../io/fetchproxy');\r\n\r\n  var clientType = 'esna';\r\n\r\n  /** @constructor */  \r\n  function OAuthProviderEsna() {\r\n    this.clientType = clientType;\r\n  }\r\n  OAuthProviderEsna.clientType = clientType;\r\n  \r\n  OAuthProviderEsna.prototype.init = function (opt) {\r\n    opt = opt || {};\r\n    if (!opt.urls) {\r\n      var root = opt.accountsUrl || 'https://accounts.zang.io';\r\n      if (opt.staging) {\r\n        root = 'https://onesnastaging.appspot.com';\r\n      } else if (opt.testing) {\r\n        root = 'https://onesnatesting.appspot.com';\r\n      }\r\n      var urlLogin = root + '/oauth2/authorize';\r\n      var urlLogout = root + '/account/logout' + '?next=' +  encodeURIComponent(urlLogin);\r\n      opt.urls = { urlRoot: root, urlLogin: urlLogin, urlLogout: urlLogout, urlToken: root + '/oauth2/access_token' };\r\n    }\r\n    this.initUrls(opt.urls);\r\n    this.initClient(opt.client);\r\n  };\r\n  OAuthProviderEsna.prototype.supportsIncremental = function () {\r\n    return false;\r\n  };\r\n  OAuthProviderEsna.prototype.supportsOpenId = function () {\r\n    return false;\r\n  };\r\n  OAuthProviderEsna.prototype.applyLoginScope = function (scope) {\r\n    scope.push('https://www.onesna.com/auth/userinfo.email');\r\n    scope.push('https://www.onesna.com/auth/userinfo.profile');\r\n  };\r\n  OAuthProviderEsna.prototype.getUserInfo = function (info) {\r\n    var root = this.urlRoot;\r\n    \r\n    var url = '/api/1.0/user/self/';\r\n    //var url = '/api/users/me/';\r\n    url = root + url;\r\n\r\n    var opt = { 'method': 'GET', 'headers': { 'authorization': 'Bearer ' + info.token.token } };\r\n    return fetchproxy(url, opt).then(function (r) {\r\n      try {\r\n        return r.json();\r\n      } catch (e) {\r\n        Utils.showLogInfo('identity: OAuthProviderEsna.getUserInfo, error: ' + e.message + ', r: ' + r.toString());\r\n        return Promise.reject({ error: { fetch: true } });\r\n      }\r\n    }).then(function (r) {\r\n      info.userInfo = { };\r\n      info.userInfo.user = r['username'];    \r\n      info.userInfo.image = r['picture_url'];\r\n      var n = [], name = r['name'];\r\n      if (name['formatted']) {\r\n        n.push(name['formatted']);\r\n      } else {\r\n        if (name['givenname']) {\r\n          n.push(name['givenname']);\r\n        }\r\n        if (name['familyname']) {\r\n          n.push(name['familyname']);\r\n        }\r\n      }\r\n      info.userInfo.name = n.join(' ') || '';\r\n      Utils.showLogInfo('identity: OAuthProviderEsna.getUserInfo', info);\r\n      return info;\r\n    });\r\n  };\r\n  \r\n  module.exports = OAuthProvider.extend(OAuthProviderEsna);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/id/oauth.provider.esna.js\n// module id = 51\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var OAuthProvider = require('./oauth.provider');\r\n\r\n  var clientType = 'microsoft';\r\n\r\n  /** @constructor */\r\n  function OAuthProviderMicrosoft() {\r\n    this.clientType = clientType;\r\n  }\r\n  OAuthProviderMicrosoft.clientType = clientType;\r\n  \r\n  OAuthProviderMicrosoft.prototype.init = function (opt) {\r\n    opt = opt || {};\r\n    if (!opt.urls) {\r\n      opt.urls = { urlLogin: 'https://login.windows.net/common/oauth2/authorize', urlToken: 'https://login.windows.net/common/oauth2/token' };\r\n    }\r\n    this.initUrls(opt.urls);\r\n    this.initClient(opt.client);\r\n  };\r\n  \r\n  module.exports = OAuthProvider.extend(OAuthProviderMicrosoft);\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/id/oauth.provider.microsoft.js\n// module id = 52\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise = require('/lib/jsl/promise');\r\n  var PromiseQueue = require('/lib/jsl/promise.queue');\r\n  var fetchproxy = require('/lib/jsl/io/fetchproxy');\r\n  var Utils = require('/lib/jsl/utils');\r\n\r\n  var commands = {\r\n    check: {\r\n      url: '/api/1.0/licenses/self/check',\r\n      method: 'GET',\r\n      'authorization': 'Bearer '\r\n    },\r\n    accept: {\r\n      url: '/api/1.0/users/self/products/{0}/agreement/',\r\n      method: 'POST',\r\n      headers: {\r\n        'content-type': 'application/json',\r\n        'authorization': 'Bearer '\r\n      }\r\n    },\r\n    load: {\r\n      url: '/api/1.0/users/self/products/{0}/app_profile_setting/',\r\n      method: 'GET',\r\n      headers: {\r\n        'authorization': 'Bearer '\r\n      }\r\n    },\r\n    save: {\r\n      url: '/api/1.0/users/self/products/{0}/app_profile_setting/',\r\n      method: 'POST',\r\n      headers: {\r\n        'content-type': 'application/json',\r\n        'authorization': 'Bearer '\r\n      }\r\n    }\r\n  };\r\n\r\n  function getToken(provider, opt) {\r\n    var args = opt.args;\r\n    if (!args.headers || !args.headers['authorization']) {\r\n      return Promise.resolve(opt);\r\n    }\r\n    return provider.getToken().then(function (r) {\r\n      args.headers['authorization'] = 'Bearer ' + r.token;\r\n      return opt;\r\n    });\r\n  }\r\n  function execQueued(provider, queue, opt) {\r\n    var url = opt.endpoint + opt.cmd.url;\r\n    url = url.replace(/\\{0\\}/ig, opt.sku);\r\n\r\n    var data = opt.data;\r\n    var headers = { };\r\n    var h = opt.cmd.headers || {};\r\n    for (var key in h) {\r\n      headers[key] = h[key];\r\n    }\r\n    \r\n    opt = { url: url, args: { 'method': opt.cmd.method, 'body': data, 'headers': headers } };\r\n    return queue.ready().then(function (r) {\r\n      r = r;\r\n      return getToken(provider, opt);\r\n    }).then(function (opt) {\r\n      return fetchproxy(opt.url, opt.args);\r\n    }).then(function (res) {\r\n      queue.done();\r\n      if (!res.ok) {\r\n        return {};\r\n      }\r\n      return res.json();\r\n    }, function (err) {\r\n      queue.done();\r\n      return Promise.reject(err);\r\n    });\r\n  }\r\n\r\n  /** @constructor */  \r\n  function OnEsna() {\r\n    this.local = true;\r\n    \r\n    this.queue = new PromiseQueue({ max: 1 });\r\n  }\r\n  OnEsna.prototype.init = function (opt) {\r\n    this.sku      = opt.sku || 'kale';\r\n    this.endpoint = opt.endpoint || opt.accountsUrl;\r\n    this.getToken = opt.getToken;\r\n  };\r\n  OnEsna.prototype.shut = function () {\r\n    delete this.sprofile;\r\n    delete this.profile;\r\n    \r\n    this.queue.clear();\r\n  };\r\n\r\n  OnEsna.prototype.checkLicense = function () {\r\n    //var self = this;\r\n    return execQueued(this, this.queue, { endpoint: this.endpoint, sku: this.sku, cmd: commands.check }).then(function (res) {\r\n      res = res;\r\n      return Promise.resolve(true);\r\n    }, function (res) {\r\n      res = res;\r\n      return Promise.resolve(false);\r\n    });\r\n  };\r\n  OnEsna.prototype.loadProfile = function () {\r\n    if (typeof (this.profile) !== 'undefined') {\r\n      return Promise.resolve(this.profile);\r\n    }\r\n\r\n    if (this.local) {\r\n      var r = localStorage.getItem('jsl_onesna');\r\n      r = Utils.safeParse(r) || {};\r\n      this.profile = r;\r\n      this.sprofile = JSON.stringify(r);\r\n      return Promise.resolve(r);\r\n    }\r\n    \r\n    var self = this;\r\n    return execQueued(this, this.queue, { endpoint: this.endpoint, sku: this.sku, cmd: commands.load }).then(function (res) {\r\n      self.profile = res;\r\n      self.sprofile = JSON.stringify(self.profile);\r\n      return Promise.resolve(self.profile);\r\n    });\r\n  };\r\n  OnEsna.prototype.saveProfile = function (data) {\r\n    var profile = JSON.stringify(data);\r\n    if (profile === this.sprofile) {\r\n      return Promise.resolve(data);\r\n    }\r\n    \r\n    if (this.local) {\r\n      this.sprofile = JSON.stringify(this.profile);\r\n      localStorage.setItem('jsl_onesna', this.sprofile);\r\n      return Promise.resolve(this.profile);\r\n    }\r\n\r\n    var self = this;\r\n    return execQueued(this, this.queue, { endpoint: this.endpoint, sku: this.sku, cmd: commands.save, data: profile }).then(function (res) {\r\n      self.profile = data;\r\n      self.sprofile = profile;\r\n      return Promise.resolve(res);\r\n    });\r\n  };\r\n  OnEsna.prototype.loadProfileSection = function (key) {\r\n    return this.loadProfile().then(function (r) {\r\n      return (r || {})[key] || null;\r\n    });\r\n  };\r\n  OnEsna.prototype.saveProfileSection = function (key, val) {\r\n    if (!this.profile) {\r\n      return;\r\n    }\r\n    this.profile[key] = val;\r\n    return this.saveProfile(this.profile);\r\n  };\r\n\r\n  module.exports = OnEsna;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/onesna/model.js\n// module id = 53\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise = require('./promise');\r\n  //var PromiseCancel = require('./promise.cancel');\r\n\r\n  function next(queue) {\r\n    var n = queue.current.length;\r\n    for (var i = n; i < queue.max; i++) {\r\n      var qi = queue.items.shift();\r\n      if (!qi) {\r\n        return;\r\n      }\r\n      queue.current.push(qi.resolve(queue));\r\n    }\r\n  }\r\n\r\n  function PromiseQueue(opt) {\r\n    this.max     = opt.max || 1;\r\n    this.items   = [];\r\n    this.current = [];\r\n  }\r\n  PromiseQueue.prototype.ready = function () {\r\n    var self = this;\r\n    return new Promise(function (resolve, reject) {\r\n      self.items.push({ resolve: resolve, cancel: reject.bind(null, { error: { canceled: true } }) });\r\n      next(self);\r\n    });\r\n  };\r\n  PromiseQueue.prototype.done = function () {\r\n    if (this.current.length) {\r\n      this.current.pop();\r\n      next(this);\r\n    }\r\n  };\r\n  PromiseQueue.prototype.clear = function () {\r\n    var items = this.items;\r\n    var current = this.current;\r\n\r\n    var item;    \r\n    while (item = items.pop()) {\r\n      if (item.cancel) {\r\n        item.cancel();\r\n      }\r\n    }\r\n    while (item = current.pop()) {\r\n      if (item.cancel) {\r\n        item.cancel();\r\n      }\r\n    }\r\n  };\r\n\r\n  module.exports = PromiseQueue;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/promise.queue.js\n// module id = 54\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var channel = require('/lib/jsl/chrome/rpc/server');\r\n\r\n  function Channel() {\r\n    this.onConnect = channel.onConnect;\r\n    this.onDisconnect = channel.onDisconnect;\r\n  }\r\n\r\n  module.exports = new Channel();\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/channel/model.js\n// module id = 55\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var globals = require('../../globals');\r\n  var chrome = require('../chrome');\r\n\r\n  var Event = require('../../event');\r\n\r\n  var RPCPort = require('./port');\r\n  var RPCRouter = require('./router');\r\n  var RPCProxy = require('./proxy');\r\n\r\n  /** @constructor */  \r\n  function RPCServer() {\r\n    this.router = new RPCRouter();\r\n    \r\n    this.onRecv = new Event();\r\n    \r\n    this.onConnectInternal = this.onConnect.bind(this, 'internal');\r\n    //this.onConnectExternal = this.onConnect.bind(this, 'external');\r\n  }\r\n  RPCServer.prototype.connect = function () {\r\n    this.router.init();\r\n    \r\n    chrome.runtime['onConnect']['addListener'](this.onConnectInternal);\r\n    //chrome.runtime['onConnectExternal']['addListener'](this.onConnectExternal);\r\n\r\n    this.onRecv.dispatch({ msg: { open: true }, sender: { server: true } });\r\n  };\r\n  RPCServer.prototype.disconnect = function () {\r\n    this.router.shut();\r\n    \r\n    chrome.runtime['onConnect']['removeListener'](this.onConnectInternal);\r\n    //chrome.runtime['onConnectExternal']['removeListener'](this.onConnectExternal);\r\n\r\n    this.onRecv.dispatch({ msg: { close: true }, sender: { server: true } });\r\n  };\r\n  RPCServer.prototype.onConnect = function (type, port) {\r\n    var rpc = new RPCPort();\r\n    rpc.attach(port);\r\n    this.router.addPort(rpc);\r\n    this.router.addServices(rpc.id, type);\r\n\r\n    var sender = port['sender'] || null;\r\n    if (sender) {\r\n      sender = { id: rpc.id, appId: sender['id'] || null, tabId: (sender['tab'] || {})['id'] || null, frameId: sender['frameId'] || null, url: sender['url'] || null, tls: sender['tlsChannelId'] || null };\r\n    } else {\r\n      sender = { id: rpc.id };\r\n    }\r\n    this.onRecv.dispatch({ msg: { open: true }, sender: sender });\r\n    rpc.send({ open: true, sender: sender });\r\n    \r\n    rpc.onRecv.addListener(function (sender, packet) {\r\n      // disconnected\r\n      if (!packet) {\r\n        this.router.delPort(sender.id);\r\n        this.onRecv.dispatch({ msg: { close: true }, sender: sender });\r\n        return;\r\n      }\r\n\r\n      // subscribe services\r\n      if (packet.msg.services) {\r\n        if (!packet.msg.remove) {\r\n          this.router.addServices(sender.id, packet.msg.services);\r\n        } else {\r\n          this.router.delServices(sender.id, packet.msg.services);\r\n        }  \r\n        return;\r\n      }\r\n\r\n      packet.sender = sender;\r\n      this.onRecv.dispatch(packet);\r\n    }.bind(this, sender));\r\n  };\r\n  RPCServer.prototype.send = function (msg, destination) {\r\n    var ports = this.router.getPorts(destination);\r\n    for (var i = 0; i < ports.length; i++) {\r\n      var port = this.router.ports[ports[i]];\r\n      if (port) {\r\n        port.send(msg);\r\n      }\r\n    }\r\n  };\r\n  RPCServer.prototype.subscribe = function () {\r\n  };\r\n\r\n  module.exports = new RPCProxy(new RPCServer());\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/chrome/rpc/server.js\n// module id = 56\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var globals = require('../../globals');\r\n  var Event = require('../../event');\r\n  var Guid = require('../../guid');\r\n  var chrome = require('../chrome');\r\n\r\n  function RPCPort() {\r\n    this.id       = Guid.NewGuid().toString();\r\n    this.services = [];\r\n    \r\n    this.onRecv   = new Event();\r\n  }\r\n  RPCPort.prototype.attach = function (port) {\r\n    this.port = port;\r\n    var self = this;    \r\n    port['onMessage']['addListener'](function (msg) {\r\n      self.onRecv.dispatch({ msg: msg });\r\n    });\r\n    port['onDisconnect']['addListener'](function () {\r\n      self.onRecv.dispatch(null);\r\n    });\r\n  };\r\n  RPCPort.prototype.connect = function (name) {\r\n    this.attach(chrome.runtime.connect({ 'name': name }));\r\n  };\r\n  RPCPort.prototype.disconnect = function () {\r\n    if (this.port) {\r\n      this.port['disconnect']();\r\n      this.port = null;\r\n    }\r\n  };\r\n  RPCPort.prototype.send = function (msg) {\r\n    if (this.port) {\r\n      this.port['postMessage'](msg);\r\n    }\r\n  };\r\n\r\n  module.exports = RPCPort;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/chrome/rpc/port.js\n// module id = 57\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  function RPCRouter() {\r\n    this.init();\r\n  }\r\n  RPCRouter.prototype.init = function () {\r\n    this.ports = {};\r\n    this.services = {};\r\n  };\r\n  RPCRouter.prototype.shut = function () {\r\n    this.ports = {};\r\n    this.services = {};\r\n  };\r\n  RPCRouter.prototype.addPort = function (port) {\r\n    this.ports[port.id] = port;\r\n  };\r\n  RPCRouter.prototype.delPort = function (portId) {\r\n    var port = this.ports[portId];\r\n    if (port) {\r\n      delete this.ports[portId];\r\n      if (port.services) {\r\n        for (var i = 0; i < port.services.length; i++) {\r\n          var service = this.services[port.services[i]];\r\n          if (service) {\r\n            delete service[portId];\r\n          }\r\n        }\r\n      }\r\n    }\r\n  };\r\n  \r\n  RPCRouter.prototype.addServices = function (portId, services) {\r\n    var port = this.ports[portId];\r\n    if (port) {\r\n      var ps = port.services;\r\n      if (typeof (services) === 'string') {\r\n        services = [services];\r\n      }\r\n      for (var i = 0; i < services.length; i++) {\r\n        var service = services[i];\r\n        if (ps.indexOf(service) < 0) {\r\n          ps.push(service);\r\n\r\n          var all = this.services[service];\r\n          if (!all) {\r\n            all = this.services[service] = {};\r\n          }\r\n          all[portId] = 1;\r\n        }\r\n      }\r\n    }\r\n  };\r\n  RPCRouter.prototype.delServices = function (portId, services) {\r\n    var port = this.ports[portId];\r\n    if (port) {\r\n      var ps = port.services;\r\n      if (typeof (services) === 'string') {\r\n        services = [services];\r\n      }\r\n      for (var i = 0; i < services.length; i++) {\r\n        var service = services[i];\r\n        var n = ps.indexOf(service); \r\n        if (n >= 0) {\r\n          ps.splice(n, 1);\r\n\r\n          var all = this.services[service];\r\n          if (all) {\r\n            delete all[portId];\r\n          }\r\n        }\r\n      }\r\n    }\r\n  };\r\n  \r\n  RPCRouter.prototype.getPorts = function (filter) {\r\n    if (!filter) {\r\n      return [];\r\n    }\r\n    if (typeof (filter) === 'string') {\r\n      return [filter];\r\n    }\r\n    var res = {};\r\n    var fs = filter.services;\r\n    if (fs) {\r\n      for (var i = 0; i < fs.length; i++) {\r\n        var sc = this.services[fs[i]];\r\n        if (sc) {\r\n          var clients = Object.getOwnPropertyNames(sc);\r\n          for (var j = 0; j < clients.length; j++) {\r\n            res[clients[j]] = 1;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    var ports = filter.ports;\r\n    if (ports) {\r\n      for (var k = 0; k < ports.length; k++) {\r\n        res[ports[k]] = 1;\r\n      }\r\n    }\r\n    var exclude = filter.exclude;\r\n    if (typeof (exclude) === 'string') {\r\n      delete res[exclude];\r\n    } else if (exclude) {\r\n      for (var l = 0; l < exclude.length; l++) {\r\n        delete res[exclude[l]];\r\n      }\r\n    }\r\n    return Object.getOwnPropertyNames(res);\r\n  };\r\n\r\n  module.exports = RPCRouter;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/chrome/rpc/router.js\n// module id = 58\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise = require('../../promise');\r\n  var Event = require('../../event');\r\n  \r\n  var RPCSchema = require('./schema');\r\n\r\n  function reportError(proxy, e) {\r\n    proxy.onError.dispatch(e);\r\n  }\r\n\r\n  function bindMethod(proxy, service, method, opt) {\r\n    // if registering non-proxy method, then return original\r\n    if (service.server || (service.service && service.service.rpc) || !opt) {\r\n      var f = service.service[method];\r\n      if (!f) {\r\n        throw new Error('Method is not defined:' + service.id + ':' + method);\r\n      }\r\n      return f;\r\n    }\r\n\r\n    // otherwise proxy method\r\n    return function () {\r\n      var args = Array.prototype.slice.call(arguments);\r\n      var msg = { id: service.id, method: method, args: args };\r\n\r\n      // methods could be one way, or return result either via promise or callback      \r\n      var cb = null;\r\n      var promise;\r\n      if (opt.promise) {\r\n        promise = new Promise(function (resolve, reject) {\r\n          cb = { resolve: resolve, reject: reject };\r\n        });\r\n      } else if (!opt.oneway) {\r\n        cb = (typeof (args[args.length - 1]) === 'function') ? args.pop() : null;\r\n        cb = cb ? { resolve: cb, reject: cb } : null;\r\n      }\r\n\r\n      // register callback if required\r\n      if (cb) {\r\n        msg.rid = service.rid++;\r\n        service.pending[msg.rid] = cb;\r\n      }\r\n      \r\n      proxy.send(msg);\r\n      return promise;\r\n    };\r\n  }\r\n  \r\n  function bindEvent(proxy, service, event, opt) {\r\n    var evt = !service.service ? new Event() : service.service[event];\r\n    if (!evt) {\r\n      throw new Error('Event not defined:' + service.id + ':' + event);\r\n    }\r\n    opt = opt || { notify: evt.notify };\r\n    \r\n    // if registering server event\r\n    if (service.server || (service.service && service.service.rpc)) {\r\n      // bind to server event\r\n      evt.addListener(function () {\r\n        var args = Array.prototype.slice.call(arguments);\r\n        var msg = { id: service.id, event: event, args: args };\r\n\r\n        var dst = { services: [service.id] };\r\n        // if event declared to provide explicit destination\r\n        if (opt.notify) {\r\n          dst = args.shift();\r\n        }\r\n        proxy.send(msg, dst);\r\n      });\r\n    }\r\n    return evt;\r\n  }\r\n\r\n\r\n  function bindService(proxy, serviceId, service) {\r\n    var id = serviceId;\r\n    if (!id) {\r\n      throw new RangeError('Service id not defined');\r\n    }\r\n    var svc = proxy.services[id] = { id: id, rid: 1, service: service, proxy: {}, pending: {} };\r\n    \r\n    var keys = Object.getOwnPropertyNames(service);\r\n    keys = keys.concat(Object.getOwnPropertyNames(service.constructor.prototype));\r\n    for (var i = 0; i < keys.length; i++) {\r\n      var key = keys[i];\r\n      var item = service[key];\r\n\r\n      if (typeof (item) === 'function') {\r\n        svc.proxy[key] = bindMethod(proxy, svc, key, item.rpc);\r\n      } else if (item instanceof Event) {\r\n        svc.proxy[key] = bindEvent(proxy, svc, key);\r\n      }\r\n    }\r\n    return svc.proxy;\r\n  }\r\n  function unbindService(proxy, serviceId) {\r\n    var id = serviceId;\r\n    if (!id) {\r\n      throw new RangeError('Service id not defined');\r\n    }\r\n    delete proxy.services[id];\r\n  }  \r\n  \r\n\r\n  function bindSchema(proxy, schemaId, schema, service) {\r\n    var id = schemaId;\r\n    if (!id) {\r\n      throw new RangeError('Schema id not defined');\r\n    }\r\n    var svc = proxy.services[id] = { id: id, rid: 1, service: service, proxy: {}, pending: {}, server: !!service };\r\n\r\n    var wrap = !svc.server ? schema : {};\r\n    var keys = Object.getOwnPropertyNames(schema);\r\n    for (var i = 0; i < keys.length; i++) {\r\n      var key = keys[i];\r\n      var item = schema[key];\r\n\r\n      if (item === RPCSchema.methodOneWay) {\r\n        wrap[key] = svc.proxy[key] = bindMethod(proxy, svc, key, { oneway: true });\r\n      } else if (item === RPCSchema.methodPromise) {\r\n        wrap[key] = svc.proxy[key] = bindMethod(proxy, svc, key, { promise: true });\r\n      } else if (item === RPCSchema.methodCallback) {\r\n        wrap[key] = svc.proxy[key] = bindMethod(proxy, svc, key, { });\r\n      } else if (item === RPCSchema.eventBroadcast) {\r\n        wrap[key] = svc.proxy[key] = bindEvent(proxy, svc, key, { });\r\n      } else if (item === RPCSchema.eventUnicast) {\r\n        wrap[key] = svc.proxy[key] = bindEvent(proxy, svc, key, { notify: true });\r\n      }\r\n    }\r\n    \r\n    return svc.proxy;\r\n  }\r\n  function unbindSchema(proxy, schemaId, schema) {\r\n    unbindService(proxy, schemaId, schema);\r\n  }\r\n\r\n  function getService(proxy, id) {\r\n    var service = proxy.services[id];\r\n    if (!service) {\r\n      reportError(proxy, { warning: 'getService', id: id });\r\n    }\r\n    return service;\r\n  }\r\n  function invokeOpen(proxy, sender, msg) {\r\n    proxy.onConnect.dispatch(sender || msg.sender);\r\n  }\r\n  function invokeClose(proxy, sender, msg) {\r\n    msg = msg;\r\n    proxy.onDisconnect.dispatch(sender);\r\n  }\r\n  function replyMethod(proxy, sender, msg, args, error) {\r\n    if (msg.rid) {\r\n      msg.reply = true;\r\n      msg.args = args;\r\n      msg.error = error;\r\n      proxy.send(msg, sender.id);\r\n    }\r\n  }\r\n  function invokeMethod(proxy, sender, msg) {\r\n    try {\r\n      var service = getService(proxy, msg.id);\r\n      var method = service ? service.service[msg.method] : null;\r\n      if (!method) {\r\n        throw new Error('Invalid method');\r\n      }\r\n\r\n      service.service.rpcSender = sender;\r\n      var args = msg.args;\r\n      if (!Array.isArray(args)) {\r\n        args = [args];\r\n      }\r\n      var res = method.apply(service.service, args);\r\n      if (res instanceof Promise) {\r\n        res.then(replyMethod.bind(null, proxy, sender, msg), replyMethod.bind(null, proxy, sender, msg, undefined));\r\n      } else {\r\n        replyMethod(proxy, sender, msg, res);\r\n      }\r\n      service.service.rpcSender = null;\r\n    } catch (e) {\r\n      reportError(proxy, { error: 'invokeMethod', e: e, sender: sender, msg: msg });\r\n      replyMethod(proxy, sender, msg, undefined, e);\r\n    }\r\n  }\r\n  function invokeReply(proxy, sender, msg) {\r\n    try {\r\n      var service = getService(proxy, msg.id);\r\n      if (!service) {\r\n        return reportError(proxy, { warning: 'invokeReply', sender: sender, msg: msg });\r\n      }\r\n      var pending = service.pending[msg.rid];\r\n      if (!pending) {\r\n        return reportError(proxy, { warning: 'invokeReply', sender: sender, msg: msg });\r\n      }\r\n      delete service.pending[msg.rid];\r\n      if (msg.error) {\r\n        pending.reject(msg.error);\r\n      } else {\r\n        pending.resolve(msg.args);\r\n      }\r\n    } catch (e) {\r\n      return reportError(proxy, { error: 'invokeReply', e: e, sender: sender, msg: msg });\r\n    }\r\n  }\r\n  function invokeEvent(proxy, sender, msg) {\r\n    try {\r\n      var service = getService(proxy, msg.id);\r\n      if (!service) {\r\n        return reportError(proxy, { warning: 'invokeEvent', sender: sender, msg: msg });\r\n      }\r\n      var event = service.proxy[msg.event];\r\n      if (!event) {\r\n        return reportError(proxy, { warning: 'invokeEvent', sender: sender, msg: msg });\r\n      }\r\n      event.dispatch.apply(event, msg.args);\r\n    } catch (e) {\r\n      return reportError(proxy, { error: 'invokeEvent', e: e, sender: sender, msg: msg });\r\n    }\r\n  }\r\n  function invoke(proxy, packet) {\r\n    //console.info('[RPC]', 'invoke', packet);\r\n    if (!packet) {\r\n      invokeClose(proxy, { }, { });\r\n    } else if (packet.msg.open) {\r\n      invokeOpen(proxy, packet.sender, packet.msg);\r\n    } else if (packet.msg.close) {\r\n      invokeClose(proxy, packet.sender, packet.msg);\r\n    } else if (packet.msg.reply) {\r\n      invokeReply(proxy, packet.sender, packet.msg);\r\n    } else if (packet.msg.event) {\r\n      invokeEvent(proxy, packet.sender, packet.msg);\r\n    } else if (packet.msg.method) {\r\n      invokeMethod(proxy, packet.sender, packet.msg);\r\n    } else {\r\n      reportError(proxy, { warning: 'invoke', packet: packet });\r\n    }\r\n  }\r\n  function logError(e) {\r\n    if (e.error) {\r\n      console.error('[RPC]', e);\r\n    } else {\r\n      console.warn('[RPC]', e);\r\n    }\r\n  }\r\n\r\n  /** @constructor */  \r\n  function RPCProxy(channel) {\r\n    this.channel = channel;\r\n    this.channel.onRecv.addListener(invoke.bind(null, this));\r\n    this.services = {};\r\n\r\n    this.onConnect = new Event();\r\n    this.onDisconnect = new Event();\r\n    this.onError = new Event();\r\n    \r\n    this.onError.addListener(logError);\r\n  }\r\n\r\n  // register service channel\r\n  RPCProxy.prototype.register = function (serviceId, service) {\r\n    return bindService(this, serviceId, service);\r\n  };\r\n  RPCProxy.prototype.unregister = function (serviceId, service) {\r\n    return unbindService(this, serviceId, service);\r\n  };\r\n  RPCProxy.prototype.registerSchema = function (schemaId, schema, service) {\r\n    return bindSchema(this, schemaId, schema, service);\r\n  };\r\n  RPCProxy.prototype.unregisterSchema = function (schemaId, schema) {\r\n    return unbindSchema(this, schemaId, schema);\r\n  };\r\n\r\n  RPCProxy.prototype.connect = function () {\r\n    this.channel.connect();\r\n    this.subscribe();\r\n  };\r\n  RPCProxy.prototype.disconnect = function () {\r\n    this.channel.disconnect();\r\n  };\r\n  RPCProxy.prototype.send = function (msg, destination) {\r\n    this.channel.send(msg, destination);\r\n  };\r\n  \r\n  RPCProxy.prototype.subscribe = function () {\r\n    var services = Object.getOwnPropertyNames(this.services);\r\n    this.channel.subscribe(services);\r\n  };\r\n\r\n  module.exports = RPCProxy;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/jsl/chrome/rpc/proxy.js\n// module id = 59\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var schema = require('/lib/jsl/chrome/rpc/schema');\r\n\r\n  var IdentitySchema = {\r\n    onAccount: schema.eventBroadcast,\r\n    onAccounts: schema.eventUnicast,\r\n\r\n    login: schema.methodPromise,\r\n    logout: schema.methodPromise,\r\n\r\n    createAccount: schema.methodPromise,\r\n    removeAccount: schema.methodPromise,\r\n    updateAccount: schema.methodPromise,\r\n  };\r\n\r\n  module.exports = IdentitySchema;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/identity/schema.js\n// module id = 60\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var schema = require('/lib/jsl/chrome/rpc/schema');\r\n\r\n  var PartiesSchema = {\r\n    onParties: schema.eventBroadcast,\r\n    onPartiesType: schema.eventBroadcast,\r\n\r\n    getParties: schema.methodPromise,\r\n    createParty: schema.methodPromise,\r\n    removeParty: schema.methodPromise,\r\n\r\n    getPartiesType: schema.methodPromise,\r\n    setPartiesType: schema.methodPromise,\r\n  };\r\n\r\n  module.exports = PartiesSchema;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/parties/schema.js\n// module id = 61\n// module chunks = 0 1","define(function (require, exports, module) {\r\n  'use strict';\r\n\r\n  var Promise = require('/lib/jsl/promise');\r\n  var fetchproxy = require('/lib/jsl/io/fetchproxy');\r\n\r\n  var methods = {\r\n    fetchUser: {\r\n      url: '/api/users/me',\r\n      method: 'GET',\r\n      authorize: true,\r\n      headers: {\r\n      }\r\n    },\r\n    fetchTopics: {\r\n      url: '/api/users/me/topics?size=100',\r\n      method: 'GET',\r\n      authorize: true,\r\n      headers: {\r\n      }\r\n    },\r\n    createTopic: {\r\n      url: '/api/topics/invite',\r\n      method: 'POST',\r\n      authorize: true,\r\n      json: true,\r\n      headers: {\r\n        'content-type': 'application/json'\r\n      }\r\n    },\r\n    createInvite: {\r\n      url: '/api/topics/{0}/invite',\r\n      method: 'POST',\r\n      authorize: true,\r\n      json: true,\r\n      headers: {\r\n        'content-type': 'application/json'\r\n      }\r\n    },\r\n    updateInvite: {\r\n      url: '/api/topics/invites/{0}',\r\n      method: 'POST',\r\n      authorize: true,\r\n      json: true,\r\n      headers: {\r\n        'content-type': 'application/json'\r\n      }\r\n    },\r\n    removeInvite: {\r\n      url: '/api/topics/invites/{0}',\r\n      method: 'DELETE',\r\n      authorize: true,\r\n      headers: {\r\n        'content-type': 'application/json'\r\n      }\r\n    },\r\n    getTopic: {\r\n      url: '/api/topics/invites/{0}/join',\r\n      method: 'GET',\r\n      authorize: true,\r\n      json: true,\r\n      headers: {\r\n        'content-type': 'application/json'\r\n      }\r\n    },\r\n  };\r\n\r\n  function applyHeaders(request) {\r\n    var keys = Object.getOwnPropertyNames(request.method.headers);\r\n    var headers = request.headers = {};\r\n    for (var i = 0; i < keys.length; i++) {\r\n      headers[keys[i]] = request.method.headers[keys[i]];\r\n    }\r\n  }\r\n  function applyBody(request) {\r\n    if (request.method.json) {\r\n      return JSON.stringify(request.args.json);\r\n    }\r\n  }\r\n  function authorize(request) {\r\n    if (!request.method.authorize) {\r\n      return Promise.resolve(request);\r\n    }\r\n    return request.token().then(function (r) {\r\n      if (r.token && r.token.token) {\r\n        r = r.token;\r\n      }\r\n      request.headers['authorization'] = [r.type, r.token].join(' ');\r\n      return request;\r\n    });\r\n  }\r\n  function convertInviteCreate(self, args) {\r\n    var topic;\r\n    var urlargs = [];\r\n    if (!args.id) {\r\n      topic = { 'title': args.title, 'description': args.description, 'type': 'group' };\r\n    } else {\r\n      urlargs.push(args.id);\r\n    }\r\n\r\n    var parties = args.parties || [];    \r\n    var invitees = [];\r\n    for (var i = 0; i < parties.length; i++) {\r\n      var item = parties[i];\r\n      if (item.email) {\r\n        if (item.email.toLowerCase() !== self.email.toLowerCase()) {\r\n          invitees.push({ 'invitee': item.email, 'inviteeType': 'email', 'role': item.member ? 'member' : 'guest' });\r\n        }\r\n      }\r\n    }\r\n    if (invitees.length === 0) {\r\n      invitees.push({ 'invitee': self.email, 'inviteeType': 'email', 'role': 'admin' });\r\n    }\r\n    var topicrq = { 'invitees': invitees };\r\n    if (topic) {\r\n      topicrq['topic'] = topic;\r\n    }\r\n    if (args.start) {\r\n      topicrq['startDateTime'] = new Date(args.start).toISOString();\r\n    }\r\n    if (args.end) {\r\n      topicrq['endDateTime'] = new Date(args.end).toISOString();\r\n    }\r\n    topicrq['informChannel'] = args.client ? 'outlook' : 'server';\r\n    topicrq['inviteMode'] = 'meet';\r\n\r\n    return { urlargs: urlargs, json: topicrq };\r\n  }\r\n  \r\n  function convertDate(v) {\r\n    if (v) {\r\n      try {\r\n        return new Date(v).valueOf();\r\n      } catch (e) {\r\n      }\r\n    }\r\n    return 0;\r\n  }\r\n  function convertMembers(self, topic, members) {\r\n    for (var i = 0; i < members.length; i++) {\r\n      var m = members[i];\r\n      var p = {};\r\n      p.joined = convertDate(m['joinTime']);\r\n\r\n      p.admin = (m['role'] === 'admin');\r\n      p.member = (m['role'] === 'member');\r\n\r\n      p.name = m['displayname'] || '';\r\n\r\n      p.id = (m['memberType'] === 'userId') ? m['member'] || '' : m['memberType'] + ':' + m['member'];\r\n      p.email = m['username'] || '';\r\n\r\n      p.self = (p.id.toLowerCase() === self.id.toLowerCase()) || (p.email.toLowerCase() === self.email.toLowerCase());\r\n      if (p.self && (p.admin || p.member)) {\r\n        topic.selfMember = true;\r\n      }\r\n      topic.members.push(p);\r\n    }\r\n  }\r\n  function convertInvitees(self, invitees) {\r\n    var res = [];\r\n    for (var i = 0; i < invitees.length; i++) {\r\n      var m = invitees[i];\r\n      var p = {};\r\n      p.admin = (m['role'] === 'admin');\r\n      p.email = (m['inviteeType'] === 'email') ? m['invitee'] || '' : m['inviteeType'] + ':' + m['invitee'];\r\n      p.self = (p.email === self.email); \r\n      res.push(p);\r\n    }\r\n    return res;\r\n  }\r\n  \r\n  function convertTopic(self, topic) {\r\n    var res = { \r\n      id: topic['targetId'] || topic['_id'], own: self.id === topic['cid'], \r\n      title: topic['title'] || '', description: topic['description'] || '', \r\n      pinned: !!topic['isPinned'], selfGuest: topic['role'] === 'guest', type: topic['type'],\r\n      status: topic['status'] || 0, lastAccess: convertDate(topic['lastAccess']), members: [] \r\n    };\r\n\r\n    res.created = convertDate(topic['created']);\r\n\r\n    res.selfMember = !res.selfGuest;\r\n    convertMembers(self, res, topic['members'] || []);\r\n\r\n    //if (res.selfMember !== !res.selfGuest) {\r\n    //  debugger;\r\n    //}\r\n\r\n    return res;\r\n  }\r\n  \r\n  function convert(request, response) {\r\n    var res = null;\r\n    switch (request.method) {\r\n      case methods.fetchUser:\r\n        res = request.response = { };\r\n        res.id = response['_id'];\r\n        res.name = response['displayname'];\r\n        res.email = response['username'];\r\n        break;\r\n      case methods.fetchTopics:\r\n        res = request.response = { next: response['nextPageUrl'], items: [], from: response['from'] - 1, to: response['to'] - 1 };\r\n        var topics = response['data'] || [];\r\n        for (var i = 0; i < topics.length; i++) {\r\n          res.items.push(convertTopic(request.userInfo, topics[i]));\r\n        }\r\n        break;\r\n      case methods.createTopic:\r\n        var topic = (response['data'] || [])[0];\r\n        res = request.response = { id: topic['topicId'], own: true, members: [], title: request.args.json['topic']['title'], description: request.args.json['topic']['description'] };\r\n        if (topic['created']) {\r\n          res.created = convertDate(topic['created']) || 0;\r\n        }\r\n        var content = response['inviteContent'] || {};\r\n        res.invite = { id: topic['_id'], content: { text: content['text'], html: content['html'] } };\r\n        res.members = convertInvitees(request.userInfo, topic['invitees'] || []);\r\n        break;\r\n      case methods.createInvite:\r\n        var invite = (response['data'] || [])[0];\r\n        var inviteContent = response['inviteContent'] || {};\r\n        res = request.response = { id: invite['_id'], topicId: invite['topicId'], content: { text: inviteContent['text'], html: inviteContent['html'] }  };\r\n        break;\r\n      case methods.getTopic:\r\n        res = request.response = { topic: response['topic'] };\r\n        break;\r\n      default:\r\n        //debugger;\r\n        break;\r\n    }\r\n    return res;\r\n  }\r\n  function execUser(request) {\r\n    if (!request.user) {\r\n      return Promise.resolve(request);\r\n    }\r\n    return request.user().then(function (r) {\r\n      request.userInfo = r;\r\n      return request;\r\n    });\r\n  }\r\n  function execRequest(request) {\r\n    applyHeaders(request);\r\n    var url = request.endpoint + (request.url || request.method.url);\r\n\r\n    if (request.args && request.args.urlargs) {\r\n      var urlargs = request.args.urlargs;\r\n      url = url.replace(/\\{[0-9]+\\}/ig, function (key) {\r\n        key = key.substr(1, key.length - 2);\r\n        return urlargs[0 | key];\r\n      });\r\n    }\r\n    \r\n    request.fetch = { url: url, opt: { 'method': request.method.method, 'headers': request.headers, 'body': applyBody(request) } };\r\n    \r\n    return execUser(request).then(function (request) {\r\n      return authorize(request); \r\n    }).then(function (request) {\r\n      return fetchproxy(request.fetch.url, request.fetch.opt); // fetchproxy causes r.status (see below) 500 if no connection \r\n    }).then(function (r) {\r\n      return r.ok ? r.json() : Promise.reject(r.status + ': ' + r.statusText); // if no connection, error is '500: ' (no statusText provided)\r\n    }).then(function (r) {\r\n      return convert(request, r);\r\n    });\r\n  }\r\n\r\n  function ZangSpaces() {\r\n    this.fetchUser = this.fetchUser.bind(this);    \r\n  }\r\n  ZangSpaces.prototype.init = function (opt) {\r\n    this.opt = opt;\r\n    this.opt.url = this.opt.url || 'https://spacesapis.zang.io';\r\n  };\r\n  ZangSpaces.prototype.shut = function () {\r\n    delete this.opt;\r\n  };\r\n\r\n  ZangSpaces.prototype.fetchUser = function () {\r\n    if (this.userInfo) {\r\n      return Promise.resolve(this.userInfo);\r\n    }\r\n    \r\n    var self = this;\r\n    return execRequest({ endpoint: this.opt.url, token: this.opt.token, method: methods.fetchUser }).then(function (r) {\r\n      if (self.opt) {\r\n        self.userInfo = r;\r\n      }\r\n      return r;\r\n    });\r\n  };\r\n  \r\n  ZangSpaces.prototype.fetchTopics = function (args) {\r\n    return execRequest({ endpoint: this.opt.url, url: args ? args.url : null, token: this.opt.token, user: this.fetchUser, method: methods.fetchTopics, args: args });\r\n  };\r\n\r\n  ZangSpaces.prototype.createTopic = function (args) {\r\n    args = convertInviteCreate(this.userInfo, args);\r\n    //return Promise.resolve({});\r\n    return execRequest({ endpoint: this.opt.url, token: this.opt.token, user: this.fetchUser, method: methods.createTopic, args: args });\r\n  };\r\n  ZangSpaces.prototype.updateTopic = function (args) {\r\n  };\r\n  ZangSpaces.prototype.removeTopic = function (args) {\r\n  };\r\n  \r\n  ZangSpaces.prototype.createInvite = function (args) {\r\n    args = convertInviteCreate(this.userInfo, args);\r\n    //return Promise.resolve({});\r\n    return execRequest({ endpoint: this.opt.url, token: this.opt.token, user: this.fetchUser, method: methods.createInvite, args: args });\r\n  };\r\n  ZangSpaces.prototype.updateInvite = function (args) {\r\n    return execRequest({ endpoint: this.opt.url, token: this.opt.token, user: this.fetchUser, method: methods.updateInvite, args: args });\r\n  };\r\n  ZangSpaces.prototype.removeInvite = function (args) {\r\n    args = { urlargs: [args.id] };\r\n    return execRequest({ endpoint: this.opt.url, token: this.opt.token, user: this.fetchUser, method: methods.removeInvite, args: args });\r\n  };\r\n  ZangSpaces.prototype.getTopic = function (args) {\r\n    args = { urlargs: [args.id] };\r\n    return execRequest({ endpoint: this.opt.url, token: this.opt.token, user: this.fetchUser, method: methods.getTopic, args: args });\r\n  };\r\n\r\n  ZangSpaces.prototype.getJoinUrl = function (id) {\r\n    if (!this.opt) {\r\n      return;\r\n    }\r\n    return this.opt.url + '/spaces/' + id;\r\n  };\r\n  ZangSpaces.prototype.getInviteJoinUrl = function (id) {\r\n    if (!this.opt) {\r\n      return;\r\n    }\r\n    return this.opt.url + '/spaces/invites/' + id + '/meet';\r\n  };\r\n  \r\n  module.exports = ZangSpaces;\r\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./model/spaces/spaces.js\n// module id = 62\n// module chunks = 0 1","define(function(require, exports, module) {\r\n  'use strict';\r\n\r\n  var loader = require('/lib/jsl/loader');\r\n  var Promise = require('/lib/jsl/promise');\r\n  var Log = require('/lib/jsl/log');\r\n\r\n  var office = require('./office');\r\n  var invite = require('./invite'); // define extractMeetingInfoNative\r\n\r\n  var i18n = require('./i18n');\r\n\r\n  var logger = Log.createLogger('BKG');\r\n\r\n  var joinKey = 'joinStatus';\r\n  var joinIcon = 'join16';\r\n  var maxLength = 128;\r\n  var ellipsis = '...';\r\n\r\n  function truncateMessage(message) {\r\n    // outlook-web throws error if message length exceeds 150 symbols\r\n    if (message && message.length > maxLength) {\r\n      return message.substr(0, maxLength - ellipsis.length) + ellipsis;\r\n    }\r\n    return message;\r\n  }\r\n\r\n  function notifyInfo(message) {\r\n    logger.info('notifyInfo: ' + message);\r\n    if (!message) {\r\n      return;\r\n    }\r\n    office.notifyInfo(joinKey, joinIcon, truncateMessage(message));\r\n  }\r\n\r\n  function notifyError(error) {\r\n    var message = error ?  i18n.i18n.notificationMeetingNotJoined + ': ' + error : i18n.i18n.notificationMeetingNotJoined;\r\n    logger.info('notifyError: ' + message);\r\n    office.notifyError(joinKey, truncateMessage(message));\r\n  }\r\n\r\n  function completeEvent(event, res) {\r\n    if (res && res.error) {\r\n      notifyError(res.error);\r\n    }\r\n    if (event) {\r\n      event.completed();\r\n    }\r\n  }\r\n\r\n  function openWindow(url) {\r\n    var popup =  url.indexOf('http') === 0; // Popup required: rooms: no, spaces: yes\r\n    var target = popup ? '_blank' : '_self';\r\n\r\n    // ACMACOS-10782\r\n    if (navigator.vendor.indexOf('Apple') === 0) {\r\n      // ACMACOS-10963\r\n      if (office.hostName === 'Outlook') {\r\n        target = '_blank';\r\n      }\r\n    }\r\n\r\n    logger.info('openWindow ' + url + ', webAPI: ' + office.webAPI + ', popup: ' + popup + ', target: ' + target);\r\n\r\n    var wnd = window.open(url, target);\r\n    logger.info('opened ' + url + ', wnd: ' + !!wnd);\r\n    if (wnd || !popup || !office.webAPI) {\r\n      return Promise.resolve();\r\n    } else {\r\n      // ACMACOS-10964\r\n      if ((navigator.vendor.indexOf('Apple') === 0) && (office.hostName === 'Outlook')) {\r\n        return Promise.resolve();\r\n      }\r\n    }\r\n\r\n    if (office.hostName !== 'Outlook') {\r\n      notifyError(i18n.i18n.errorPopupBlocked);\r\n      return Promise.resolve();\r\n    }\r\n\r\n    // supress in case of web mode for desktop client\r\n    // we could re-enable this later to show popup\r\n    // enable banner when popups are blocked\r\n    notifyError(i18n.i18n.errorPopupBlocked);\r\n    return Promise.resolve();\r\n\r\n    var apppath = window.location.protocol + '//' + window.location.hostname + window.location.pathname;\r\n    url = apppath.replace(/(.*)\\/.*\\.html$/i, '$1/join.html') + '?' + url;\r\n    url += '&languageId=' + i18n.languageId;\r\n    localStorage.setItem('__track_join__', 1);\r\n\r\n    // handle join window in case Outlook + Web app (if join window is allowed (see supress above))\r\n    return office.displayDialog(url, { width: 30, height: 10, requireHTTPS: true }).then(function (r) {\r\n      if (!r.value) {\r\n        notifyError(i18n.i18n.errorPopupBlocked);\r\n        return Promise.resolve();\r\n      }\r\n\r\n      wnd = r.value;\r\n      return new Promise(function (resolve, reject) {\r\n        (function poll() {\r\n          if (!wnd) {\r\n            return;\r\n          }\r\n          if (localStorage.getItem('__track_join__')) {\r\n            return setTimeout(poll, 100);\r\n          }\r\n          \r\n          wnd.close();\r\n          wnd = null;\r\n\r\n          resolve();\r\n        })();\r\n\r\n        wnd.addEventHandler(Microsoft.Office.WebExtension.EventType.DialogEventReceived, function (event) {\r\n          wnd = null;\r\n          \r\n          resolve();\r\n        });\r\n      });\r\n    }, function (err) {\r\n      logger.info('openWindow displayDialog err: ' + JSON.stringify(err));\r\n      notifyError(i18n.i18n.errorPopupBlocked);\r\n    });\r\n  }\r\n\r\n  function joinMeeting1(event) {\r\n    var complete = completeEvent.bind(null, event);\r\n    invite.getJoinMeetingUrl().then(function (info) {\r\n      var url = (info || { }).url;\r\n      if (!url) {\r\n        complete({ error: i18n.i18n.notificationNoMeetingLink });\r\n        return;\r\n      }\r\n      openWindow(url).then(complete, complete);\r\n    });\r\n  }\r\n\r\n  var _loaded = false;\r\n  loader.wait(function () {\r\n    if (_loaded) {\r\n      return;\r\n    }\r\n    _loaded = true;\r\n    window.joinMeeting = joinMeeting1;\r\n    if (window.joinMeetingEvent) {\r\n      window.joinMeeting(window.joinMeetingEvent);\r\n      delete window.joinMeetingEvent;\r\n    }\r\n  });\r\n\r\n  var cache = window.applicationCache;\r\n  var loaded = 0;\r\n  cache.addEventListener('checking', function () {\r\n    console.info('bkg:appcache:checking');\r\n  });\r\n  cache.addEventListener('noupdate', function () {\r\n    console.info('bkg:appcache:noupdate');\r\n  });\r\n  cache.addEventListener('downloading', function () {\r\n    console.info('bkg:appcache:downloading');\r\n  });\r\n  cache.addEventListener('progress', function () {\r\n    // console.info('bkg:appcache:progress');\r\n    loaded += 1;\r\n  });\r\n  cache.addEventListener('cached', function () {\r\n    console.info('bkg:appcache:cached:' + loaded);\r\n  });\r\n  cache.addEventListener('updateready', function () {\r\n    console.info('bkg:appcache:updateready');\r\n    cache.swapCache();\r\n    location.reload();\r\n  });\r\n  cache.addEventListener('obsolete', function () {\r\n    console.info('bkg:appcache:obsolete');\r\n  });\r\n  cache.addEventListener('error', function (err) {\r\n    err = err || { };\r\n    console.error('bkg:appcache:error:' + JSON.stringify({ reason: err.reason, url: err.url, status: err.status, message: err.message }));\r\n  });\r\n\r\n  module.exports = { };\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./bkg.js\n// module id = 89\n// module chunks = 1"],"sourceRoot":""}